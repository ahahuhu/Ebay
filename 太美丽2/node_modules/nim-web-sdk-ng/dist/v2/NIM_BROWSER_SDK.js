/**
 * 
 *   Version: 10.2.700
 * 
 *   Git Hash: 18df1970f7eab400dd95135e615b73e18c93f312
 * 
 *   Created At: 2024/5/31 下午4:54:44
 * 
 *   Target: NIM_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((t="undefined"!=typeof globalThis?globalThis:t||self).NIM={})}(this,(function(t){"use strict";var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var c,m,check=function(t){return t&&t.Math==Math&&t},h=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof a&&a)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},g=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),I=Function.prototype,M=I.apply,T=I.call,S="object"==typeof Reflect&&Reflect.apply||(g?T.bind(M):function(){return T.apply(M,arguments)}),E=Function.prototype,b=E.bind,C=E.call,A=g&&b.bind(C,C),N=g?function(t){return t&&A(t)}:function(t){return t&&function(){return C.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},R=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),k=Function.prototype.call,w=g?k.bind(k):function(){return k.apply(k,arguments)},O={}.propertyIsEnumerable,P=Object.getOwnPropertyDescriptor,x={f:P&&!O.call({1:2},1)?function propertyIsEnumerable(t){var a=P(this,t);return!!a&&a.enumerable}:O},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},V=N({}.toString),L=N("".slice),classofRaw=function(t){return L(V(t),8,-1)},D=Object,U=N("".split),B=fails((function(){return!D("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?U(t,""):D(t)}:D,isNullOrUndefined=function(t){return null==t},q=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw q("Can't call method on "+t);return t},toIndexedObject=function(t){return B(requireObjectCoercible(t))},G="object"==typeof document&&document.all,j=void 0===G&&void 0!==G?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===G}:function(t){return"object"==typeof t?null!==t:isCallable(t)},H={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(H[t])||aFunction(h[t]):H[t]&&H[t][a]||h[t]&&h[t][a]},$=N({}.isPrototypeOf),Y=getBuiltIn("navigator","userAgent")||"",W=h.process,z=h.Deno,K=W&&W.versions||z&&z.version,Q=K&&K.v8;Q&&(m=(c=Q.split("."))[0]>0&&c[0]<4?1:+(c[0]+c[1])),!m&&Y&&(!(c=Y.match(/Edge\/(\d+)/))||c[1]>=74)&&(c=Y.match(/Chrome\/(\d+)/))&&(m=+c[1]);var J=m,X=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&J&&J<41})),Z=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ee=Object,te=Z?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&$(a.prototype,ee(t))},re=String,tryToString=function(t){try{return re(t)}catch(t){return"Object"}},ne=TypeError,aCallable=function(t){if(isCallable(t))return t;throw ne(tryToString(t)+" is not a function")},getMethod=function(t,a){var c=t[a];return isNullOrUndefined(c)?void 0:aCallable(c)},ae=TypeError,ie=Object.defineProperty,oe="__core-js_shared__",se=h[oe]||function(t,a){try{ie(h,t,{value:a,configurable:!0,writable:!0})}catch(c){h[t]=a}return a}(oe,{}),ce=createCommonjsModule((function(t){(t.exports=function(t,a){return se[t]||(se[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),le=Object,toObject=function(t){return le(requireObjectCoercible(t))},ue=N({}.hasOwnProperty),de=Object.hasOwn||function hasOwn(t,a){return ue(toObject(t),a)},pe=0,me=Math.random(),he=N(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+he(++pe+me,36)},fe=ce("wks"),ge=h.Symbol,ve=ge&&ge.for,ye=Z?ge:ge&&ge.withoutSetter||uid,wellKnownSymbol=function(t){if(!de(fe,t)||!X&&"string"!=typeof fe[t]){var a="Symbol."+t;X&&de(ge,t)?fe[t]=ge[t]:fe[t]=Z&&ve?ve(a):ye(a)}return fe[t]},_e=TypeError,Ie=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!j(t)||te(t))return t;var c,m=getMethod(t,Ie);if(m){if(void 0===a&&(a="default"),c=w(m,t,a),!j(c)||te(c))return c;throw _e("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var c,m;if("string"===a&&isCallable(c=t.toString)&&!j(m=w(c,t)))return m;if(isCallable(c=t.valueOf)&&!j(m=w(c,t)))return m;if("string"!==a&&isCallable(c=t.toString)&&!j(m=w(c,t)))return m;throw ae("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return te(a)?a:a+""},Me=h.document,Te=j(Me)&&j(Me.createElement),documentCreateElement=function(t){return Te?Me.createElement(t):{}},Se=!R&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Ee=Object.getOwnPropertyDescriptor,be={f:R?Ee:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),Se)try{return Ee(t,a)}catch(t){}if(de(t,a))return createPropertyDescriptor(!w(x.f,t,a),t[a])}},Ce=/#|\.prototype\./,isForced=function(t,a){var c=Ne[Ae(t)];return c==ke||c!=Re&&(isCallable(a)?fails(a):!!a)},Ae=isForced.normalize=function(t){return String(t).replace(Ce,".").toLowerCase()},Ne=isForced.data={},Re=isForced.NATIVE="N",ke=isForced.POLYFILL="P",we=isForced,Oe=N(N.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:g?Oe(t,a):function(){return t.apply(a,arguments)}},Pe=R&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xe=String,Ve=TypeError,anObject=function(t){if(j(t))return t;throw Ve(xe(t)+" is not an object")},Le=TypeError,De=Object.defineProperty,Ue=Object.getOwnPropertyDescriptor,Fe="enumerable",Be="configurable",qe="writable",Ge={f:R?Pe?function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),"function"==typeof t&&"prototype"===a&&"value"in c&&qe in c&&!c.writable){var m=Ue(t,a);m&&m.writable&&(t[a]=c.value,c={configurable:Be in c?c.configurable:m.configurable,enumerable:Fe in c?c.enumerable:m.enumerable,writable:!1})}return De(t,a,c)}:De:function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),Se)try{return De(t,a,c)}catch(t){}if("get"in c||"set"in c)throw Le("Accessors not supported");return"value"in c&&(t[a]=c.value),t}},je=R?function(t,a,c){return Ge.f(t,a,createPropertyDescriptor(1,c))}:function(t,a,c){return t[a]=c,t},He=be.f,wrapConstructor=function(t){var Wrapper=function(a,c,m){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,c)}return new t(a,c,m)}return S(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var c,m,g,I,M,T,S,E,b=t.target,C=t.global,A=t.stat,R=t.proto,k=C?h:A?h[b]:(h[b]||{}).prototype,w=C?H:H[b]||je(H,b,{})[b],O=w.prototype;for(g in a)c=!we(C?g:b+(A?".":"#")+g,t.forced)&&k&&de(k,g),M=w[g],c&&(T=t.dontCallGetSet?(E=He(k,g))&&E.value:k[g]),I=c&&T?T:a[g],c&&typeof M==typeof I||(S=t.bind&&c?functionBindContext(I,h):t.wrap&&c?wrapConstructor(I):R&&isCallable(I)?N(I):I,(t.sham||I&&I.sham||M&&M.sham)&&je(S,"sham",!0),je(w,g,S),R&&(de(H,m=b+"Prototype")||je(H,m,{}),je(H[m],g,I),t.real&&O&&!O[g]&&je(O,g,I)))},$e=Ge.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==$e,sham:!R},{defineProperty:$e});var Ye,We=createCommonjsModule((function(t){var a=H.Object,c=t.exports=function defineProperty(t,c,m){return a.defineProperty(t,c,m)};a.defineProperty.sham&&(c.sham=!0)})),ze=We,Ke=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}t.exports=function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),ze(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Qe=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Je=Math.ceil,Xe=Math.floor,Ze=Math.trunc||function trunc(t){var a=+t;return(a>0?Xe:Je)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Ze(a)},et=Math.max,rt=Math.min,toAbsoluteIndex=function(t,a){var c=toIntegerOrInfinity(t);return c<0?et(c+a,0):rt(c,a)},nt=Math.min,toLength=function(t){return t>0?nt(toIntegerOrInfinity(t),9007199254740991):0},lengthOfArrayLike=function(t){return toLength(t.length)},createMethod$5=function(t){return function(a,c,m){var h,g=toIndexedObject(a),I=lengthOfArrayLike(g),M=toAbsoluteIndex(m,I);if(t&&c!=c){for(;I>M;)if((h=g[M++])!=h)return!0}else for(;I>M;M++)if((t||M in g)&&g[M]===c)return t||M||0;return!t&&-1}},at={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},it={},ot=at.indexOf,st=N([].push),objectKeysInternal=function(t,a){var c,m=toIndexedObject(t),h=0,g=[];for(c in m)!de(it,c)&&de(m,c)&&st(g,c);for(;a.length>h;)de(m,c=a[h++])&&(~ot(g,c)||st(g,c));return g},ct=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],lt=Object.keys||function keys(t){return objectKeysInternal(t,ct)},ut=R&&!Pe?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var c,m=toIndexedObject(a),h=lt(a),g=h.length,I=0;g>I;)Ge.f(t,c=h[I++],m[c]);return t},dt={f:ut},pt=getBuiltIn("document","documentElement"),mt=ce("keys"),sharedKey=function(t){return mt[t]||(mt[t]=uid(t))},ht=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{Ye=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&Ye?NullProtoObjectViaActiveX(Ye):((a=documentCreateElement("iframe")).style.display="none",pt.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(Ye);for(var c=ct.length;c--;)delete NullProtoObject.prototype[ct[c]];return NullProtoObject()};it[ht]=!0;var ft=Object.create||function create(t,a){var c;return null!==t?(EmptyConstructor.prototype=anObject(t),c=new EmptyConstructor,EmptyConstructor.prototype=null,c[ht]=t):c=NullProtoObject(),void 0===a?c:dt.f(c,a)};_export({target:"Object",stat:!0,sham:!R},{create:ft});var gt=H.Object,vt=function create(t,a){return gt.create(t,a)},yt=String,_t=TypeError,It=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,c={};try{(t=N(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(c,[]),a=c instanceof Array}catch(t){}return function setPrototypeOf(c,m){return anObject(c),function(t){if("object"==typeof t||isCallable(t))return t;throw _t("Can't set "+yt(t)+" as a prototype")}(m),a?t(c,m):c.__proto__=m,c}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:It});var Mt=H.Object.setPrototypeOf,Tt=N([].slice),St=Function,Et=N([].concat),bt=N([].join),Ct={},construct$8=function(t,a,c){if(!de(Ct,a)){for(var m=[],h=0;h<a;h++)m[h]="a["+h+"]";Ct[a]=St("C,a","return new C("+bt(m,",")+")")}return Ct[a](t,c)},At=g?St.bind:function bind(t){var a=aCallable(this),c=a.prototype,m=Tt(arguments,1),h=function bound(){var c=Et(m,Tt(arguments));return this instanceof h?construct$8(a,c.length,c):a.apply(t,c)};return j(c)&&(h.prototype=c),h};_export({target:"Function",proto:!0,forced:Function.bind!==At},{bind:At});var entryVirtual=function(t){return H[t+"Prototype"]},Nt=entryVirtual("Function").bind,Rt=Function.prototype,bind$1=function(t){var a=t.bind;return t===Rt||$(Rt,t)&&a===Rt.bind?Nt:a},kt=createCommonjsModule((function(t){function _setPrototypeOf(a,c){var m;return t.exports=_setPrototypeOf=Mt?bind$1(m=Mt).call(m):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,c)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),wt=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=vt(a.prototype),t.prototype.constructor=t,kt(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports})));_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var Ot=9007199254740991,Pt={f:Object.getOwnPropertySymbols},xt=Object.assign,Vt=Object.defineProperty,Lt=N([].concat),Dt=!xt||fails((function(){if(R&&1!==xt({b:1},xt(Vt({},"a",{enumerable:!0,get:function(){Vt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},c=Symbol(),m="abcdefghijklmnopqrst";return t[c]=7,m.split("").forEach((function(t){a[t]=t})),7!=xt({},t)[c]||lt(xt({},a)).join("")!=m}))?function assign(t,a){for(var c=toObject(t),m=arguments.length,h=1,g=Pt.f,I=x.f;m>h;)for(var M,T=B(arguments[h++]),S=g?Lt(lt(T),g(T)):lt(T),E=S.length,b=0;E>b;)M=S[b++],R&&!w(I,T,M)||(c[M]=T[M]);return c}:xt;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==Dt},{assign:Dt});var Ut,Ft,Bt,qt=H.Object.assign,Gt={},jt=h.WeakMap,Ht=isCallable(jt)&&/native code/.test(String(jt)),$t="Object already initialized",Yt=h.TypeError,Wt=h.WeakMap;if(Ht||se.state){var zt=se.state||(se.state=new Wt),Kt=N(zt.get),Qt=N(zt.has),Jt=N(zt.set);Ut=function(t,a){if(Qt(zt,t))throw Yt($t);return a.facade=t,Jt(zt,t,a),a},Ft=function(t){return Kt(zt,t)||{}},Bt=function(t){return Qt(zt,t)}}else{var Xt=sharedKey("state");it[Xt]=!0,Ut=function(t,a){if(de(t,Xt))throw Yt($t);return a.facade=t,je(t,Xt,a),a},Ft=function(t){return de(t,Xt)?t[Xt]:{}},Bt=function(t){return de(t,Xt)}}var Zt,er,tr,rr={set:Ut,get:Ft,has:Bt,enforce:function(t){return Bt(t)?Ft(t):Ut(t,{})},getterFor:function(t){return function(a){var c;if(!j(a)||(c=Ft(a)).type!==t)throw Yt("Incompatible receiver, "+t+" required");return c}}},nr=Function.prototype,ar=R&&Object.getOwnPropertyDescriptor,ir=de(nr,"name"),or={EXISTS:ir,PROPER:ir&&"something"===function something(){}.name,CONFIGURABLE:ir&&(!R||R&&ar(nr,"name").configurable)},sr=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),cr=sharedKey("IE_PROTO"),lr=Object,ur=lr.prototype,dr=sr?lr.getPrototypeOf:function(t){var a=toObject(t);if(de(a,cr))return a[cr];var c=a.constructor;return isCallable(c)&&a instanceof c?c.prototype:a instanceof lr?ur:null},defineBuiltIn=function(t,a,c,m){return m&&m.enumerable?t[a]=c:je(t,a,c),t},pr=wellKnownSymbol("iterator"),mr=!1;[].keys&&("next"in(tr=[].keys())?(er=dr(dr(tr)))!==Object.prototype&&(Zt=er):mr=!0);var hr=!j(Zt)||fails((function(){var t={};return Zt[pr].call(t)!==t}));Zt=hr?{}:ft(Zt),isCallable(Zt[pr])||defineBuiltIn(Zt,pr,(function(){return this}));var fr={IteratorPrototype:Zt,BUGGY_SAFARI_ITERATORS:mr},gr={};gr[wellKnownSymbol("toStringTag")]="z";var vr="[object z]"===String(gr),yr=wellKnownSymbol("toStringTag"),_r=Object,Ir="Arguments"==classofRaw(function(){return arguments}()),Mr=vr?classofRaw:function(t){var a,c,m;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(c=function(t,a){try{return t[a]}catch(t){}}(a=_r(t),yr))?c:Ir?classofRaw(a):"Object"==(m=classofRaw(a))&&isCallable(a.callee)?"Arguments":m},Tr=vr?{}.toString:function toString(){return"[object "+Mr(this)+"]"},Sr=Ge.f,Er=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,c,m){if(t){var h=c?t:t.prototype;de(h,Er)||Sr(h,Er,{configurable:!0,value:a}),m&&!vr&&je(h,"toString",Tr)}},br=fr.IteratorPrototype,returnThis$1=function(){return this},Cr=or.PROPER,Ar=fr.BUGGY_SAFARI_ITERATORS,Nr=wellKnownSymbol("iterator"),Rr="keys",kr="values",wr="entries",returnThis=function(){return this},iteratorDefine=function(t,a,c,m,h,g,I){!function(t,a,c,m){var h=a+" Iterator";t.prototype=ft(br,{next:createPropertyDescriptor(+!m,c)}),setToStringTag(t,h,!1,!0),Gt[h]=returnThis$1}(c,a,m);var M,T,S,getIterationMethod=function(t){if(t===h&&N)return N;if(!Ar&&t in C)return C[t];switch(t){case Rr:return function keys(){return new c(this,t)};case kr:return function values(){return new c(this,t)};case wr:return function entries(){return new c(this,t)}}return function(){return new c(this)}},E=a+" Iterator",b=!1,C=t.prototype,A=C[Nr]||C["@@iterator"]||h&&C[h],N=!Ar&&A||getIterationMethod(h),R="Array"==a&&C.entries||A;if(R&&(M=dr(R.call(new t)))!==Object.prototype&&M.next&&(setToStringTag(M,E,!0,!0),Gt[E]=returnThis),Cr&&h==kr&&A&&A.name!==kr&&(b=!0,N=function values(){return w(A,this)}),h)if(T={values:getIterationMethod(kr),keys:g?N:getIterationMethod(Rr),entries:getIterationMethod(wr)},I)for(S in T)(Ar||b||!(S in C))&&defineBuiltIn(C,S,T[S]);else _export({target:a,proto:!0,forced:Ar||b},T);return I&&C[Nr]!==N&&defineBuiltIn(C,Nr,N,{name:h}),Gt[a]=N,T};Ge.f;var Or="Array Iterator",Pr=rr.set,xr=rr.getterFor(Or);iteratorDefine(Array,"Array",(function(t,a){Pr(this,{type:Or,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=xr(this),a=t.target,c=t.kind,m=t.index++;return!a||m>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==c?{value:m,done:!1}:"values"==c?{value:a[m],done:!1}:{value:[m,a[m]],done:!1}}),"values"),Gt.Arguments=Gt.Array;var Vr=wellKnownSymbol("toStringTag");for(var Lr in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Dr=h[Lr],Ur=Dr&&Dr.prototype;Ur&&Mr(Ur)!==Vr&&je(Ur,Vr,Lr),Gt[Lr]=Gt.Array}var Fr=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},Br=N(Function.toString);isCallable(se.inspectSource)||(se.inspectSource=function(t){return Br(t)});var qr=se.inspectSource,noop$1=function(){},Gr=[],jr=getBuiltIn("Reflect","construct"),Hr=/^\s*(?:class|function)\b/,$r=N(Hr.exec),Yr=!Hr.exec(noop$1),Wr=function isConstructor(t){if(!isCallable(t))return!1;try{return jr(noop$1,Gr,t),!0}catch(t){return!1}},zr=function isConstructor(t){if(!isCallable(t))return!1;switch(Mr(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Yr||!!$r(Hr,qr(t))}catch(t){return!0}};zr.sham=!0;var Kr=!jr||fails((function(){var t;return Wr(Wr.call)||!Wr(Object)||!Wr((function(){t=!0}))||t}))?zr:Wr,Qr=wellKnownSymbol("species"),Jr=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return Fr(t)&&(a=t.constructor,(Kr(a)&&(a===Jr||Fr(a.prototype))||j(a)&&null===(a=a[Qr]))&&(a=void 0)),void 0===a?Jr:a}(t))(0===a?0:a)},Xr=N([].push),createMethod$4=function(t){var a=1==t,c=2==t,m=3==t,h=4==t,g=6==t,I=7==t,M=5==t||g;return function(T,S,E,b){for(var C,A,N=toObject(T),R=B(N),k=functionBindContext(S,E),w=lengthOfArrayLike(R),O=0,P=b||arraySpeciesCreate,x=a?P(T,w):c||I?P(T,0):void 0;w>O;O++)if((M||O in R)&&(A=k(C=R[O],O,N),t))if(a)x[O]=A;else if(A)switch(t){case 3:return!0;case 5:return C;case 6:return O;case 2:Xr(x,C)}else switch(t){case 4:return!1;case 7:Xr(x,C)}return g?-1:m||h?h:x}},Zr={forEach:createMethod$4(0),map:createMethod$4(1),filter:createMethod$4(2),some:createMethod$4(3),every:createMethod$4(4),find:createMethod$4(5),findIndex:createMethod$4(6),filterReject:createMethod$4(7)},arrayMethodIsStrict=function(t,a){var c=[][t];return!!c&&fails((function(){c.call(null,a||function(){return 1},1)}))},en=Zr.forEach,tn=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return en(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=tn},{forEach:tn});var rn=entryVirtual("Array").forEach,nn=Array.prototype,an={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===nn||$(nn,t)&&a===nn.forEach||de(an,Mr(t))?rn:a},sn=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return J>=51||!fails((function(){var a=[];return(a.constructor={})[sn]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},cn=Zr.filter,ln=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!ln},{filter:function filter(t){return cn(this,t,arguments.length>1?arguments[1]:void 0)}});var un=entryVirtual("Array").filter,dn=Array.prototype,filter=function(t){var a=t.filter;return t===dn||$(dn,t)&&a===dn.filter?un:a},pn=fails((function(){lt(1)}));_export({target:"Object",stat:!0,forced:pn},{keys:function keys(t){return lt(toObject(t))}});var mn=H.Object.keys,hn=ct.concat("length","prototype"),fn={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,hn)}},gn=N([].concat),vn=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=fn.f(anObject(t)),c=Pt.f;return c?gn(a,c(t)):a},yn=Error,_n=N("".replace),In=String(yn("zxcasd").stack),Mn=/\n\s*at [^:]*:[^\n]*/,Tn=Mn.test(In),errorStackClear=function(t,a){if(Tn&&"string"==typeof t&&!yn.prepareStackTrace)for(;a--;)t=_n(t,Mn,"");return t},installErrorCause=function(t,a){j(a)&&"cause"in a&&je(t,"cause",a.cause)},Sn=wellKnownSymbol("iterator"),En=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(Gt.Array===t||En[Sn]===t)},bn=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,bn)||getMethod(t,"@@iterator")||Gt[Mr(t)]},Cn=TypeError,getIterator=function(t,a){var c=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(c))return anObject(w(c,t));throw Cn(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,c){var m,h;anObject(t);try{if(!(m=getMethod(t,"return"))){if("throw"===a)throw c;return c}m=w(m,t)}catch(t){h=!0,m=t}if("throw"===a)throw c;if(h)throw m;return anObject(m),c},An=TypeError,Result=function(t,a){this.stopped=t,this.result=a},Nn=Result.prototype,iterate=function(t,a,c){var m,h,g,I,M,T,S,E=c&&c.that,b=!(!c||!c.AS_ENTRIES),C=!(!c||!c.IS_RECORD),A=!(!c||!c.IS_ITERATOR),N=!(!c||!c.INTERRUPTED),R=functionBindContext(a,E),stop=function(t){return m&&iteratorClose(m,"normal",t),new Result(!0,t)},callFn=function(t){return b?(anObject(t),N?R(t[0],t[1],stop):R(t[0],t[1])):N?R(t,stop):R(t)};if(C)m=t.iterator;else if(A)m=t;else{if(!(h=getIteratorMethod$5(t)))throw An(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(h)){for(g=0,I=lengthOfArrayLike(t);I>g;g++)if((M=callFn(t[g]))&&$(Nn,M))return M;return new Result(!1)}m=getIterator(t,h)}for(T=C?t.next:m.next;!(S=w(T,m)).done;){try{M=callFn(S.value)}catch(t){iteratorClose(m,"throw",t)}if("object"==typeof M&&M&&$(Nn,M))return M}return new Result(!1)},Rn=String,toString$1=function(t){if("Symbol"===Mr(t))throw TypeError("Cannot convert a Symbol value to a string");return Rn(t)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},kn=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),wn=wellKnownSymbol("toStringTag"),On=Error,Pn=[].push,xn=function AggregateError(t,a){var c,m=arguments.length>2?arguments[2]:void 0,h=$(Vn,this);It?c=It(On(),h?dr(this):Vn):(c=h?this:ft(Vn),je(c,wn,"Error")),void 0!==a&&je(c,"message",normalizeStringArgument(a)),kn&&je(c,"stack",errorStackClear(c.stack,1)),installErrorCause(c,m);var g=[];return iterate(t,Pn,{that:g}),je(c,"errors",g),c};It?It(xn,On):function(t,a,c){for(var m=vn(a),h=Ge.f,g=be.f,I=0;I<m.length;I++){var M=m[I];de(t,M)||c&&de(c,M)||h(t,M,g(a,M))}}(xn,On,{name:!0});var Vn=xn.prototype=ft(On.prototype,{constructor:createPropertyDescriptor(1,xn),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:xn});var Ln,Dn,Un,Fn,Bn="process"==classofRaw(h.process),qn=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),c=Ge.f;R&&a&&!a[qn]&&c(a,qn,{configurable:!0,get:function(){return this}})},Gn=TypeError,anInstance=function(t,a){if($(a,t))return t;throw Gn("Incorrect invocation")},jn=TypeError,aConstructor=function(t){if(Kr(t))return t;throw jn(tryToString(t)+" is not a constructor")},Hn=wellKnownSymbol("species"),speciesConstructor=function(t,a){var c,m=anObject(t).constructor;return void 0===m||isNullOrUndefined(c=anObject(m)[Hn])?a:aConstructor(c)},$n=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw $n("Not enough arguments");return t},Yn=/(?:ipad|iphone|ipod).*applewebkit/i.test(Y),Wn=h.setImmediate,zn=h.clearImmediate,Kn=h.process,Qn=h.Dispatch,Jn=h.Function,Xn=h.MessageChannel,Zn=h.String,ea=0,ta={},ra="onreadystatechange";try{Ln=h.location}catch(t){}var run=function(t){if(de(ta,t)){var a=ta[t];delete ta[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){h.postMessage(Zn(t),Ln.protocol+"//"+Ln.host)};Wn&&zn||(Wn=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Jn(t),c=Tt(arguments,1);return ta[++ea]=function(){S(a,void 0,c)},Dn(ea),ea},zn=function clearImmediate(t){delete ta[t]},Bn?Dn=function(t){Kn.nextTick(runner(t))}:Qn&&Qn.now?Dn=function(t){Qn.now(runner(t))}:Xn&&!Yn?(Fn=(Un=new Xn).port2,Un.port1.onmessage=listener,Dn=functionBindContext(Fn.postMessage,Fn)):h.addEventListener&&isCallable(h.postMessage)&&!h.importScripts&&Ln&&"file:"!==Ln.protocol&&!fails(post)?(Dn=post,h.addEventListener("message",listener,!1)):Dn=ra in documentCreateElement("script")?function(t){pt.appendChild(documentCreateElement("script")).onreadystatechange=function(){pt.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var na,aa,ia,oa,sa,ca,la,ua,da={set:Wn,clear:zn},pa=/ipad|iphone|ipod/i.test(Y)&&void 0!==h.Pebble,ma=/web0s(?!.*chrome)/i.test(Y),ha=be.f,fa=da.set,ga=h.MutationObserver||h.WebKitMutationObserver,va=h.document,ya=h.process,_a=h.Promise,Ia=ha(h,"queueMicrotask"),Ma=Ia&&Ia.value;Ma||(na=function(){var t,a;for(Bn&&(t=ya.domain)&&t.exit();aa;){a=aa.fn,aa=aa.next;try{a()}catch(t){throw aa?oa():ia=void 0,t}}ia=void 0,t&&t.enter()},Yn||Bn||ma||!ga||!va?!pa&&_a&&_a.resolve?((la=_a.resolve(void 0)).constructor=_a,ua=functionBindContext(la.then,la),oa=function(){ua(na)}):Bn?oa=function(){ya.nextTick(na)}:(fa=functionBindContext(fa,h),oa=function(){fa(na)}):(sa=!0,ca=va.createTextNode(""),new ga(na).observe(ca,{characterData:!0}),oa=function(){ca.data=sa=!sa}));var Ta=Ma||function(t){var a={fn:t,next:void 0};ia&&(ia.next=a),aa||(aa=a,oa()),ia=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Sa,Ea,ba=Queue,Ca=h.Promise,Aa="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Na=!Aa&&!Bn&&"object"==typeof window&&"object"==typeof document,Ra=Ca&&Ca.prototype,ka=wellKnownSymbol("species"),wa=!1,Oa=isCallable(h.PromiseRejectionEvent),Pa=we("Promise",(function(){var t=qr(Ca),a=t!==String(Ca);if(!a&&66===J)return!0;if(!Ra.catch||!Ra.finally)return!0;if(!J||J<51||!/native code/.test(t)){var c=new Ca((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((c.constructor={})[ka]=FakePromise,!(wa=c.then((function(){}))instanceof FakePromise))return!0}return!a&&(Na||Aa)&&!Oa})),xa={CONSTRUCTOR:Pa,REJECTION_EVENT:Oa,SUBCLASSING:wa},Va=TypeError,PromiseCapability=function(t){var a,c;this.promise=new t((function(t,m){if(void 0!==a||void 0!==c)throw Va("Bad Promise constructor");a=t,c=m})),this.resolve=aCallable(a),this.reject=aCallable(c)},La={f:function(t){return new PromiseCapability(t)}},Da=da.set,Ua="Promise",Fa=xa.CONSTRUCTOR,Ba=xa.REJECTION_EVENT,qa=rr.getterFor(Ua),Ga=rr.set,ja=Ca&&Ca.prototype,Ha=Ca,$a=ja,Ya=h.TypeError,Wa=h.document,za=h.process,Ka=La.f,Qa=Ka,Ja=!!(Wa&&Wa.createEvent&&h.dispatchEvent),Xa="unhandledrejection",isThenable=function(t){var a;return!(!j(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var c,m,h,g=a.value,I=1==a.state,M=I?t.ok:t.fail,T=t.resolve,S=t.reject,E=t.domain;try{M?(I||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===M?c=g:(E&&E.enter(),c=M(g),E&&(E.exit(),h=!0)),c===t.promise?S(Ya("Promise-chain cycle")):(m=isThenable(c))?w(m,c,T,S):T(c)):S(g)}catch(t){E&&!h&&E.exit(),S(t)}},notify=function(t,a){t.notified||(t.notified=!0,Ta((function(){for(var c,m=t.reactions;c=m.get();)callReaction(c,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,c){var m,g;Ja?((m=Wa.createEvent("Event")).promise=a,m.reason=c,m.initEvent(t,!1,!0),h.dispatchEvent(m)):m={promise:a,reason:c},!Ba&&(g=h["on"+t])?g(m):t===Xa&&function(t,a){var c=h.console;c&&c.error&&(1==arguments.length?c.error(t):c.error(t,a))}("Unhandled promise rejection",c)},onUnhandled=function(t){w(Da,h,(function(){var a,c=t.facade,m=t.value;if(isUnhandled(t)&&(a=perform((function(){Bn?za.emit("unhandledRejection",m,c):dispatchEvent(Xa,c,m)})),t.rejection=Bn||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){w(Da,h,(function(){var a=t.facade;Bn?za.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,c){return function(m){t(a,m,c)}},internalReject=function(t,a,c){t.done||(t.done=!0,c&&(t=c),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,c){if(!t.done){t.done=!0,c&&(t=c);try{if(t.facade===a)throw Ya("Promise can't be resolved itself");var m=isThenable(a);m?Ta((function(){var c={done:!1};try{w(m,a,bind(internalResolve,c,t),bind(internalReject,c,t))}catch(a){internalReject(c,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};Fa&&($a=(Ha=function Promise(t){anInstance(this,$a),aCallable(t),w(Sa,this);var a=qa(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Sa=function Promise(t){Ga(this,{type:Ua,done:!1,notified:!1,parent:!1,reactions:new ba,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn($a,"then",(function then(t,a){var c=qa(this),m=Ka(speciesConstructor(this,Ha));return c.parent=!0,m.ok=!isCallable(t)||t,m.fail=isCallable(a)&&a,m.domain=Bn?za.domain:void 0,0==c.state?c.reactions.add(m):Ta((function(){callReaction(m,c)})),m.promise})),Ea=function(){var t=new Sa,a=qa(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},La.f=Ka=function(t){return t===Ha||undefined===t?new Ea(t):Qa(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:Fa},{Promise:Ha}),setToStringTag(Ha,Ua,!1,!0),setSpecies(Ua);var Za=wellKnownSymbol("iterator"),ei=!1;try{var ti=0,ri={next:function(){return{done:!!ti++}},return:function(){ei=!0}};ri[Za]=function(){return this},Array.from(ri,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!ei)return!1;var c=!1;try{var m={};m[Za]=function(){return{next:function(){return{done:c=!0}}}},t(m)}catch(t){}return c},ni=xa.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){Ca.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:ni},{all:function all(t){var a=this,c=La.f(a),m=c.resolve,h=c.reject,g=perform((function(){var c=aCallable(a.resolve),g=[],I=0,M=1;iterate(t,(function(t){var T=I++,S=!1;M++,w(c,a,t).then((function(t){S||(S=!0,g[T]=t,--M||m(g))}),h)})),--M||m(g)}));return g.error&&h(g.value),c.promise}});var ai=xa.CONSTRUCTOR;Ca&&Ca.prototype,_export({target:"Promise",proto:!0,forced:ai,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:ni},{race:function race(t){var a=this,c=La.f(a),m=c.reject,h=perform((function(){var h=aCallable(a.resolve);iterate(t,(function(t){w(h,a,t).then(c.resolve,m)}))}));return h.error&&m(h.value),c.promise}}),_export({target:"Promise",stat:!0,forced:xa.CONSTRUCTOR},{reject:function reject(t){var a=La.f(this);return w(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),j(a)&&a.constructor===t)return a;var c=La.f(t);return(0,c.resolve)(a),c.promise},oi=xa.CONSTRUCTOR,si=getBuiltIn("Promise"),ci=!oi;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(ci&&this===si?Ca:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,c=La.f(a),m=c.resolve,h=c.reject,g=perform((function(){var c=aCallable(a.resolve),h=[],g=0,I=1;iterate(t,(function(t){var M=g++,T=!1;I++,w(c,a,t).then((function(t){T||(T=!0,h[M]={status:"fulfilled",value:t},--I||m(h))}),(function(t){T||(T=!0,h[M]={status:"rejected",reason:t},--I||m(h))}))})),--I||m(h)}));return g.error&&h(g.value),c.promise}});var li="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,c=getBuiltIn("AggregateError"),m=La.f(a),h=m.resolve,g=m.reject,I=perform((function(){var m=aCallable(a.resolve),I=[],M=0,T=1,S=!1;iterate(t,(function(t){var E=M++,b=!1;T++,w(m,a,t).then((function(t){b||S||(S=!0,h(t))}),(function(t){b||S||(b=!0,I[E]=t,--T||g(new c(I,li)))}))})),--T||g(new c(I,li))}));return I.error&&g(I.value),m.promise}});var ui=Ca&&Ca.prototype,di=!!Ca&&fails((function(){ui.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:di},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),c=isCallable(t);return this.then(c?function(c){return promiseResolve(a,t()).then((function(){return c}))}:t,c?function(c){return promiseResolve(a,t()).then((function(){throw c}))}:t)}});var pi=N("".charAt),mi=N("".charCodeAt),hi=N("".slice),createMethod$3=function(t){return function(a,c){var m,h,g=toString$1(requireObjectCoercible(a)),I=toIntegerOrInfinity(c),M=g.length;return I<0||I>=M?t?"":void 0:(m=mi(g,I))<55296||m>56319||I+1===M||(h=mi(g,I+1))<56320||h>57343?t?pi(g,I):m:t?hi(g,I,I+2):h-56320+(m-55296<<10)+65536}},fi={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)},gi=fi.charAt,vi="String Iterator",yi=rr.set,_i=rr.getterFor(vi);iteratorDefine(String,"String",(function(t){yi(this,{type:vi,string:toString$1(t),index:0})}),(function next(){var t,a=_i(this),c=a.string,m=a.index;return m>=c.length?{value:void 0,done:!0}:(t=gi(c,m),a.index+=t.length,{value:t,done:!1})}));var Ii=H.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=La.f(this),c=perform(t);return(c.error?a.reject:a.resolve)(c.value),a.promise}});var Mi=Ii,Ti=x.f,Si=N(Ti),Ei=N([].push),createMethod$2=function(t){return function(a){for(var c,m=toIndexedObject(a),h=lt(m),g=h.length,I=0,M=[];g>I;)c=h[I++],R&&!Si(m,c)||Ei(M,t?[c,m[c]]:m[c]);return M}},bi={entries:createMethod$2(!0),values:createMethod$2(!1)}.values;_export({target:"Object",stat:!0},{values:function values(t){return bi(t)}});var Ci=H.Object.values,Ai=Date,Ni=N(Ai.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return Ni(new Ai)}});var Ri=H.Date.now,ki=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw ki("Maximum allowed index exceeded");return t},createProperty=function(t,a,c){var m=toPropertyKey(a);m in t?Ge.f(t,m,createPropertyDescriptor(0,c)):t[m]=c},wi=wellKnownSymbol("isConcatSpreadable"),Oi=J>=51||!fails((function(){var t=[];return t[wi]=!1,t.concat()[0]!==t})),Pi=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!j(t))return!1;var a=t[wi];return void 0!==a?!!a:Fr(t)};_export({target:"Array",proto:!0,arity:1,forced:!Oi||!Pi},{concat:function concat(t){var a,c,m,h,g,I=toObject(this),M=arraySpeciesCreate(I,0),T=0;for(a=-1,m=arguments.length;a<m;a++)if(isConcatSpreadable(g=-1===a?I:arguments[a]))for(h=lengthOfArrayLike(g),doesNotExceedSafeInteger(T+h),c=0;c<h;c++,T++)c in g&&createProperty(M,T,g[c]);else doesNotExceedSafeInteger(T+1),createProperty(M,T++,g);return M.length=T,M}});var xi=entryVirtual("Array").concat,Vi=Array.prototype,concat=function(t){var a=t.concat;return t===Vi||$(Vi,t)&&a===Vi.concat?xi:a},Li=/MSIE .\./.test(Y),Di=h.Function,wrap$1=function(t){return Li?function(a,c){var m=validateArgumentsLength(arguments.length,1)>2,h=isCallable(a)?a:Di(a),g=m?Tt(arguments,2):void 0;return t(m?function(){S(h,this,g)}:h,c)}:t},Ui={setTimeout:wrap$1(h.setTimeout),setInterval:wrap$1(h.setInterval)},Fi=Ui.setInterval;_export({global:!0,bind:!0,forced:h.setInterval!==Fi},{setInterval:Fi});var Bi=Ui.setTimeout;_export({global:!0,bind:!0,forced:h.setTimeout!==Bi},{setTimeout:Bi});var qi=H.setTimeout,Gi=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,c="~";function Events(){}function EE(t,a,c){this.fn=t,this.context=a,this.once=c||!1}function addListener(t,a,m,h,g){if("function"!=typeof m)throw new TypeError("The listener must be a function");var I=new EE(m,h||t,g),M=c?c+a:a;return t._events[M]?t._events[M].fn?t._events[M]=[t._events[M],I]:t._events[M].push(I):(t._events[M]=I,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(c=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,m,h=[];if(0===this._eventsCount)return h;for(m in t=this._events)a.call(t,m)&&h.push(c?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},EventEmitter.prototype.listeners=function listeners(t){var a=c?c+t:t,m=this._events[a];if(!m)return[];if(m.fn)return[m.fn];for(var h=0,g=m.length,I=new Array(g);h<g;h++)I[h]=m[h].fn;return I},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=c?c+t:t,m=this._events[a];return m?m.fn?1:m.length:0},EventEmitter.prototype.emit=function emit(t,a,m,h,g,I){var M=c?c+t:t;if(!this._events[M])return!1;var T,S,E=this._events[M],b=arguments.length;if(E.fn){switch(E.once&&this.removeListener(t,E.fn,void 0,!0),b){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,a),!0;case 3:return E.fn.call(E.context,a,m),!0;case 4:return E.fn.call(E.context,a,m,h),!0;case 5:return E.fn.call(E.context,a,m,h,g),!0;case 6:return E.fn.call(E.context,a,m,h,g,I),!0}for(S=1,T=new Array(b-1);S<b;S++)T[S-1]=arguments[S];E.fn.apply(E.context,T)}else{var C,A=E.length;for(S=0;S<A;S++)switch(E[S].once&&this.removeListener(t,E[S].fn,void 0,!0),b){case 1:E[S].fn.call(E[S].context);break;case 2:E[S].fn.call(E[S].context,a);break;case 3:E[S].fn.call(E[S].context,a,m);break;case 4:E[S].fn.call(E[S].context,a,m,h);break;default:if(!T)for(C=1,T=new Array(b-1);C<b;C++)T[C-1]=arguments[C];E[S].fn.apply(E[S].context,T)}}return!0},EventEmitter.prototype.on=function on(t,a,c){return addListener(this,t,a,c,!1)},EventEmitter.prototype.once=function once(t,a,c){return addListener(this,t,a,c,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,m,h){var g=c?c+t:t;if(!this._events[g])return this;if(!a)return clearEvent(this,g),this;var I=this._events[g];if(I.fn)I.fn!==a||h&&!I.once||m&&I.context!==m||clearEvent(this,g);else{for(var M=0,T=[],S=I.length;M<S;M++)(I[M].fn!==a||h&&!I[M].once||m&&I[M].context!==m)&&T.push(I[M]);T.length?this._events[g]=1===T.length?T[0]:T:clearEvent(this,g)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=c?c+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=c,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}));_export({global:!0},{globalThis:h});var ji=h,Hi=at.includes,$i=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:$i},{includes:function includes(t){return Hi(this,t,arguments.length>1?arguments[1]:void 0)}});var Yi=entryVirtual("Array").includes,Wi=wellKnownSymbol("match"),zi=TypeError,notARegexp=function(t){if(function(t){var a;return j(t)&&(void 0!==(a=t[Wi])?!!a:"RegExp"==classofRaw(t))}(t))throw zi("The method doesn't accept regular expressions");return t},Ki=wellKnownSymbol("match"),correctIsRegexpLogic=function(t){var a=/./;try{"/./"[t](a)}catch(c){try{return a[Ki]=!1,"/./"[t](a)}catch(t){}}return!1},Qi=N("".indexOf);_export({target:"String",proto:!0,forced:!correctIsRegexpLogic("includes")},{includes:function includes(t){return!!~Qi(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var Ji=entryVirtual("String").includes,Xi=Array.prototype,Zi=String.prototype,includes=function(t){var a=t.includes;return t===Xi||$(Xi,t)&&a===Xi.includes?Yi:"string"==typeof t||t===Zi||$(Zi,t)&&a===Zi.includes?Ji:a},eo=arrayMethodHasSpeciesSupport("slice"),to=wellKnownSymbol("species"),ro=Array,no=Math.max;_export({target:"Array",proto:!0,forced:!eo},{slice:function slice(t,a){var c,m,h,g=toIndexedObject(this),I=lengthOfArrayLike(g),M=toAbsoluteIndex(t,I),T=toAbsoluteIndex(void 0===a?I:a,I);if(Fr(g)&&(c=g.constructor,(Kr(c)&&(c===ro||Fr(c.prototype))||j(c)&&null===(c=c[to]))&&(c=void 0),c===ro||void 0===c))return Tt(g,M,T);for(m=new(void 0===c?ro:c)(no(T-M,0)),h=0;M<T;M++,h++)M in g&&createProperty(m,h,g[M]);return m.length=h,m}});var ao=entryVirtual("Array").slice,io=Array.prototype,slice=function(t){var a=t.slice;return t===io||$(io,t)&&a===io.slice?ao:a},oo=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),ze(t,"prototype",{writable:!1}),t}var t={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},a=function emptyFn(){},c=function(){function Reporter(a){_classCallCheck(this,Reporter),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Ri(),this.timer=null,this.endedAsyncMsgByModule={},this.setConfig(a),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){var a=qt({},this.reportConfig.common,t.common);this.reportConfig=qt({},this.reportConfig,t),this.reportConfig.common=a,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(t,a){var c=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(t,qt({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,m;null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(t,a){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(c.priority||(c.priority=this.getEventPriority(t,a)),this.reportConfig.isDataReportEnable&&t){var m=Ri();"HIGH"===c.priority?this.highPriorityMsgList.push({module:t,msg:a,createTime:m}):"NORMAL"===c.priority?this.msgList.push({module:t,msg:a,createTime:m}):"LOW"===c.priority&&this.lowPriorityMsgList.push({module:t,msg:a,createTime:m}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(this.reportConfig.isDataReportEnable&&t&&!this.traceMsgCache[t]){var c=qt(qt({start_time:Ri()},a),{extension:[]});this.traceMsgCache[t]=c}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a,c){var m,h=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t]){var g=this.traceMsgCache[t].extension,I=g.length,M=(new Date).getTime();0===I?a.duration=M-this.traceMsgCache[t].start_time:g[I-1].end_time?a.duration=M-g[I-1].end_time:a.duration=M-this.traceMsgCache[t].start_time,g.push(qt({end_time:M},a));var T=g.length-1;(null==c?void 0:c.asyncParams)&&((m=this.traceMsgCache[t]).asyncPromiseArray||(m.asyncPromiseArray=[]),this.traceMsgCache[t].asyncPromiseArray.push(c.asyncParams.then((function(a){h.traceMsgCache[t]&&h.traceMsgCache[t].extension[T]&&qt(h.traceMsgCache[t].extension[T],a)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a,c,m=this,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t])if("nos"!==t||!1===h){"boolean"==typeof h?this.traceMsgCache[t].succeed=!!h:this.traceMsgCache[t].state=h,this.traceMsgCache[t].duration=Ri()-this.traceMsgCache[t].start_time,forEach$1(a=this.traceMsgCache[t].extension).call(a,(function(t){delete t.end_time}));var g=this.traceMsgCache[t];if(this.traceMsgCache[t]=null,g.asyncPromiseArray){(c=this.endedAsyncMsgByModule)[t]||(c[t]=[]),this.endedAsyncMsgByModule[t].push(g);var I=function asyncCallback(){var a;m.endedAsyncMsgByModule[t]&&includes(a=m.endedAsyncMsgByModule[t]).call(a,g)&&(delete g.asyncPromiseArray,m.report(t,g,{priority:m.getEventPriority(t,g)}))};Mi.all(g.asyncPromiseArray).then(I).catch(I)}else this.report(t,g,{priority:this.getEventPriority(t,g)})}else this.traceMsgCache[t]=null}},{key:"getEventPriority",value:function getEventPriority(t,a){if("exceptions"===t){if(0===a.action)return"HIGH";if(2===a.action)return"HIGH";if(1===a.action&&0!==a.exception_service)return"HIGH"}else{if("msgReceive"===t)return"LOW";if("nim_api_trace"===t)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(t){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[t]=[],this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var t,c=this;this.reportConfig.isDataReportEnable&&(forEach$1(t=mn(this.traceMsgCache)).call(t,(function(t){c.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=a,this.report=a,this.reportTraceStart=a,this.reportTraceUpdate=a,this.reportTraceEnd=a,this.pause=a,this.restore=a,this.destroy=a,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var t,a,c=this;if(!this.loading){this.loading=!0;var m=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:m.dev_id,sdkVer:m.sdk_ver,platform:m.platform,appkey:m.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,m;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var h=t.data.data||{};c.reportConfig.maxSize=h.maxSize>1e3?1e3:h.maxSize,c.reportConfig.maxInterval=h.maxInterval>1e4?1e4:h.maxInterval,c.reportConfig.maxInterval=h.maxInterval<10?10:h.maxInterval,c.reportConfig.minInterval=h.minInterval<2?2:h.minInterval,c.reportConfig.maxDelay=h.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.isUploadEnable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.log("Get reporter upload config success")}})).catch((function(t){var a,m;c.loading=!1,null===(m=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===m||m.error("Get reporter upload config failed",t)}))}catch(c){this.loading=!1,null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.error("Exec reporter request failed",c)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=qi((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Ri()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t,a,c,m,h,g,I=this,M={},T=Ri();this.highPriorityMsgList=filter(t=this.highPriorityMsgList).call(t,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.msgList=filter(a=this.msgList).call(a,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.lowPriorityMsgList=filter(c=this.lowPriorityMsgList).call(c,(function(t){return T-t.createTime<I.reportConfig.maxDelay})),this.cacheMsgList=filter(m=this.cacheMsgList).call(m,(function(t){return T-t.createTime<I.reportConfig.maxDelay}));var S=slice(h=this.highPriorityMsgList).call(h,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=slice(g=this.highPriorityMsgList).call(g,S.length),S.length<this.reportConfig.maxSize){var E,b,C=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(E=this.msgList).call(E,0,C)),this.msgList=slice(b=this.msgList).call(b,C)}if(S.length<this.reportConfig.maxSize){var A,N,R=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(A=this.lowPriorityMsgList).call(A,0,R)),this.lowPriorityMsgList=slice(N=this.lowPriorityMsgList).call(N,R)}if(S.length<this.reportConfig.maxSize){var k,w,O=this.reportConfig.maxSize-S.length;S=concat(S).call(S,slice(k=this.cacheMsgList).call(k,0,O)),this.cacheMsgList=slice(w=this.cacheMsgList).call(w,O)}return forEach$1(S).call(S,(function(t){M[t.module]?M[t.module].push(t.msg):M[t.module]=[t.msg]})),{uploadMsgArr:S,uploadMsg:M}}},{key:"upload",value:function upload(){var t,a,c=this;if(this.isUploadEnable&&!(this.lastReportTime&&Ri()-this.lastReportTime<this.reportConfig.minInterval)){var m=this.getUploadMsg(),h=m.uploadMsgArr,g=m.uploadMsg;if(h.length){this.lastReportTime=Ri();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:g},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,m,g,I;c.cacheMsgList=slice(a=concat(m=c.cacheMsgList).call(m,h)).call(a,0,c.reportConfig.cacheMaxSize),null===(I=null===(g=c.reportConfig)||void 0===g?void 0:g.logger)||void 0===I||I.warn("Reporter upload failed",t)}))}catch(c){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",c)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()})),so=Array.isArray,co="object"==typeof a&&a&&a.Object===Object&&a,lo="object"==typeof self&&self&&self.Object===Object&&self,uo=co||lo||Function("return this")(),po=uo.Symbol,mo=Object.prototype,ho=mo.hasOwnProperty,fo=mo.toString,go=po?po.toStringTag:void 0;var vo=function getRawTag(t){var a=ho.call(t,go),c=t[go];try{t[go]=void 0;var m=!0}catch(t){}var h=fo.call(t);return m&&(a?t[go]=c:delete t[go]),h},yo=Object.prototype.toString;var _o=function objectToString(t){return yo.call(t)},Io=po?po.toStringTag:void 0;var Mo=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Io&&Io in Object(t)?vo(t):_o(t)};var To=function isObjectLike(t){return null!=t&&"object"==typeof t};var So=function isSymbol(t){return"symbol"==typeof t||To(t)&&"[object Symbol]"==Mo(t)},Eo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bo=/^\w*$/;var Co=function isKey(t,a){if(so(t))return!1;var c=typeof t;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=t&&!So(t))||(bo.test(t)||!Eo.test(t)||null!=a&&t in Object(a))};var Ao=function isObject$1(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var No=function isFunction(t){if(!Ao(t))return!1;var a=Mo(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},Ro=uo["__core-js_shared__"],ko=function(){var t=/[^.]+$/.exec(Ro&&Ro.keys&&Ro.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var wo=function isMasked(t){return!!ko&&ko in t},Oo=Function.prototype.toString;var Po=function toSource(t){if(null!=t){try{return Oo.call(t)}catch(t){}try{return t+""}catch(t){}}return""},xo=/^\[object .+?Constructor\]$/,Vo=Function.prototype,Lo=Object.prototype,Do=Vo.toString,Uo=Lo.hasOwnProperty,Fo=RegExp("^"+Do.call(Uo).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Bo=function baseIsNative(t){return!(!Ao(t)||wo(t))&&(No(t)?Fo:xo).test(Po(t))};var qo=function getValue(t,a){return null==t?void 0:t[a]};var Go=function getNative(t,a){var c=qo(t,a);return Bo(c)?c:void 0},jo=Go(Object,"create");var Ho=function hashClear(){this.__data__=jo?jo(null):{},this.size=0};var $o=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},Yo=Object.prototype.hasOwnProperty;var Wo=function hashGet(t){var a=this.__data__;if(jo){var c=a[t];return"__lodash_hash_undefined__"===c?void 0:c}return Yo.call(a,t)?a[t]:void 0},zo=Object.prototype.hasOwnProperty;var Ko=function hashHas(t){var a=this.__data__;return jo?void 0!==a[t]:zo.call(a,t)};var Qo=function hashSet(t,a){var c=this.__data__;return this.size+=this.has(t)?0:1,c[t]=jo&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}Hash.prototype.clear=Ho,Hash.prototype.delete=$o,Hash.prototype.get=Wo,Hash.prototype.has=Ko,Hash.prototype.set=Qo;var Jo=Hash;var Xo=function listCacheClear(){this.__data__=[],this.size=0};var Zo=function eq(t,a){return t===a||t!=t&&a!=a};var es=function assocIndexOf(t,a){for(var c=t.length;c--;)if(Zo(t[c][0],a))return c;return-1},ts=Array.prototype.splice;var rs=function listCacheDelete(t){var a=this.__data__,c=es(a,t);return!(c<0)&&(c==a.length-1?a.pop():ts.call(a,c,1),--this.size,!0)};var ns=function listCacheGet(t){var a=this.__data__,c=es(a,t);return c<0?void 0:a[c][1]};var as=function listCacheHas(t){return es(this.__data__,t)>-1};var is=function listCacheSet(t,a){var c=this.__data__,m=es(c,t);return m<0?(++this.size,c.push([t,a])):c[m][1]=a,this};function ListCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}ListCache.prototype.clear=Xo,ListCache.prototype.delete=rs,ListCache.prototype.get=ns,ListCache.prototype.has=as,ListCache.prototype.set=is;var os=ListCache,ss=Go(uo,"Map");var cs=function mapCacheClear(){this.size=0,this.__data__={hash:new Jo,map:new(ss||os),string:new Jo}};var ls=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var us=function getMapData(t,a){var c=t.__data__;return ls(a)?c["string"==typeof a?"string":"hash"]:c.map};var ds=function mapCacheDelete(t){var a=us(this,t).delete(t);return this.size-=a?1:0,a};var ps=function mapCacheGet(t){return us(this,t).get(t)};var ms=function mapCacheHas(t){return us(this,t).has(t)};var hs=function mapCacheSet(t,a){var c=us(this,t),m=c.size;return c.set(t,a),this.size+=c.size==m?0:1,this};function MapCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}MapCache.prototype.clear=cs,MapCache.prototype.delete=ds,MapCache.prototype.get=ps,MapCache.prototype.has=ms,MapCache.prototype.set=hs;var fs=MapCache;function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var c=arguments,m=a?a.apply(this,c):c[0],h=memoized.cache;if(h.has(m))return h.get(m);var g=t.apply(this,c);return memoized.cache=h.set(m,g)||h,g};return memoized.cache=new(memoize.Cache||fs),memoized}memoize.Cache=fs;var gs=memoize;var vs=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ys=/\\(\\)?/g,_s=function memoizeCapped(t){var a=gs(t,(function(t){return 500===c.size&&c.clear(),t})),c=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(vs,(function(t,c,m,h){a.push(m?h.replace(ys,"$1"):c||t)})),a})),Is=_s;var Ms=function arrayMap(t,a){for(var c=-1,m=null==t?0:t.length,h=Array(m);++c<m;)h[c]=a(t[c],c,t);return h},Ts=po?po.prototype:void 0,Ss=Ts?Ts.toString:void 0;var Es=function baseToString(t){if("string"==typeof t)return t;if(so(t))return Ms(t,baseToString)+"";if(So(t))return Ss?Ss.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var bs=function toString(t){return null==t?"":Es(t)};var Cs=function castPath(t,a){return so(t)?t:Co(t,a)?[t]:Is(bs(t))};var As=function toKey(t){if("string"==typeof t||So(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Ns=function baseGet(t,a){for(var c=0,m=(a=Cs(a,t)).length;null!=t&&c<m;)t=t[As(a[c++])];return c&&c==m?t:void 0};var Rs=function get(t,a,c){var m=null==t?void 0:Ns(t,a);return void 0===m?c:m},ks=Array,ws=Math.max,arraySliceSimple=function(t,a,c){for(var m=lengthOfArrayLike(t),h=toAbsoluteIndex(a,m),g=toAbsoluteIndex(void 0===c?m:c,m),I=ks(ws(g-h,0)),M=0;h<g;h++,M++)createProperty(I,M,t[h]);return I.length=M,I},Os=fn.f,Ps="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],xs={f:function getOwnPropertyNames(t){return Ps&&"Window"==classofRaw(t)?function(t){try{return Os(t)}catch(t){return arraySliceSimple(Ps)}}(t):Os(toIndexedObject(t))}},Vs={f:wellKnownSymbol},Ls=Ge.f,wellKnownSymbolDefine=function(t){var a=H.Symbol||(H.Symbol={});de(a,t)||Ls(a,t,{value:Vs.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,c=a&&a.valueOf,m=wellKnownSymbol("toPrimitive");a&&!a[m]&&defineBuiltIn(a,m,(function(t){return w(c,this)}),{arity:1})},Ds=Zr.forEach,Us=sharedKey("hidden"),Fs="Symbol",Bs=rr.set,qs=rr.getterFor(Fs),Gs=Object.prototype,js=h.Symbol,Hs=js&&js.prototype,$s=h.TypeError,Ys=h.QObject,Ws=be.f,zs=Ge.f,Ks=xs.f,Qs=x.f,Js=N([].push),Xs=ce("symbols"),Zs=ce("op-symbols"),ec=ce("wks"),tc=!Ys||!Ys.prototype||!Ys.prototype.findChild,rc=R&&fails((function(){return 7!=ft(zs({},"a",{get:function(){return zs(this,"a",{value:7}).a}})).a}))?function(t,a,c){var m=Ws(Gs,a);m&&delete Gs[a],zs(t,a,c),m&&t!==Gs&&zs(Gs,a,m)}:zs,wrap=function(t,a){var c=Xs[t]=ft(Hs);return Bs(c,{type:Fs,tag:t,description:a}),R||(c.description=a),c},nc=function defineProperty(t,a,c){t===Gs&&nc(Zs,a,c),anObject(t);var m=toPropertyKey(a);return anObject(c),de(Xs,m)?(c.enumerable?(de(t,Us)&&t[Us][m]&&(t[Us][m]=!1),c=ft(c,{enumerable:createPropertyDescriptor(0,!1)})):(de(t,Us)||zs(t,Us,createPropertyDescriptor(1,{})),t[Us][m]=!0),rc(t,m,c)):zs(t,m,c)},ac=function defineProperties(t,a){anObject(t);var c=toIndexedObject(a),m=lt(c).concat($getOwnPropertySymbols(c));return Ds(m,(function(a){R&&!w(ic,c,a)||nc(t,a,c[a])})),t},ic=function propertyIsEnumerable(t){var a=toPropertyKey(t),c=w(Qs,this,a);return!(this===Gs&&de(Xs,a)&&!de(Zs,a))&&(!(c||!de(this,a)||!de(Xs,a)||de(this,Us)&&this[Us][a])||c)},oc=function getOwnPropertyDescriptor(t,a){var c=toIndexedObject(t),m=toPropertyKey(a);if(c!==Gs||!de(Xs,m)||de(Zs,m)){var h=Ws(c,m);return!h||!de(Xs,m)||de(c,Us)&&c[Us][m]||(h.enumerable=!0),h}},sc=function getOwnPropertyNames(t){var a=Ks(toIndexedObject(t)),c=[];return Ds(a,(function(t){de(Xs,t)||de(it,t)||Js(c,t)})),c},$getOwnPropertySymbols=function(t){var a=t===Gs,c=Ks(a?Zs:toIndexedObject(t)),m=[];return Ds(c,(function(t){!de(Xs,t)||a&&!de(Gs,t)||Js(m,Xs[t])})),m};X||(js=function Symbol(){if($(Hs,this))throw $s("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===Gs&&w(setter,Zs,t),de(this,Us)&&de(this[Us],a)&&(this[Us][a]=!1),rc(this,a,createPropertyDescriptor(1,t))};return R&&tc&&rc(Gs,a,{configurable:!0,set:setter}),wrap(a,t)},Hs=js.prototype,defineBuiltIn(Hs,"toString",(function toString(){return qs(this).tag})),defineBuiltIn(js,"withoutSetter",(function(t){return wrap(uid(t),t)})),x.f=ic,Ge.f=nc,dt.f=ac,be.f=oc,fn.f=xs.f=sc,Pt.f=$getOwnPropertySymbols,Vs.f=function(t){return wrap(wellKnownSymbol(t),t)},R&&zs(Hs,"description",{configurable:!0,get:function description(){return qs(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!X,sham:!X},{Symbol:js}),Ds(lt(ec),(function(t){wellKnownSymbolDefine(t)})),_export({target:Fs,stat:!0,forced:!X},{useSetter:function(){tc=!0},useSimple:function(){tc=!1}}),_export({target:"Object",stat:!0,forced:!X,sham:!R},{create:function create(t,a){return void 0===a?ft(t):ac(ft(t),a)},defineProperty:nc,defineProperties:ac,getOwnPropertyDescriptor:oc}),_export({target:"Object",stat:!0,forced:!X},{getOwnPropertyNames:sc}),symbolDefineToPrimitive(),setToStringTag(js,Fs),it[Us]=!0;var cc=X&&!!Symbol.for&&!!Symbol.keyFor,lc=ce("string-to-symbol-registry"),uc=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!cc},{for:function(t){var a=toString$1(t);if(de(lc,a))return lc[a];var c=getBuiltIn("Symbol")(a);return lc[a]=c,uc[c]=a,c}});var dc=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!cc},{keyFor:function keyFor(t){if(!te(t))throw TypeError(tryToString(t)+" is not a symbol");if(de(dc,t))return dc[t]}});var pc=getBuiltIn("JSON","stringify"),mc=N(/./.exec),hc=N("".charAt),fc=N("".charCodeAt),gc=N("".replace),vc=N(1..toString),yc=/[\uD800-\uDFFF]/g,_c=/^[\uD800-\uDBFF]$/,Ic=/^[\uDC00-\uDFFF]$/,Mc=!X||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=pc([t])||"{}"!=pc({a:t})||"{}"!=pc(Object(t))})),Tc=fails((function(){return'"\\udf06\\ud834"'!==pc("\udf06\ud834")||'"\\udead"'!==pc("\udead")})),stringifyWithSymbolsFix=function(t,a){var c=Tt(arguments),m=a;if((j(a)||void 0!==t)&&!te(t))return Fr(a)||(a=function(t,a){if(isCallable(m)&&(a=w(m,this,t,a)),!te(a))return a}),c[1]=a,S(pc,null,c)},fixIllFormed=function(t,a,c){var m=hc(c,a-1),h=hc(c,a+1);return mc(_c,t)&&!mc(Ic,h)||mc(Ic,t)&&!mc(_c,m)?"\\u"+vc(fc(t,0),16):t};pc&&_export({target:"JSON",stat:!0,arity:3,forced:Mc||Tc},{stringify:function stringify(t,a,c){var m=Tt(arguments),h=S(Mc?stringifyWithSymbolsFix:pc,null,m);return Tc&&"string"==typeof h?gc(h,yc,fixIllFormed):h}});var Sc=!X||fails((function(){Pt.f(1)}));_export({target:"Object",stat:!0,forced:Sc},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=Pt.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(h.JSON,"JSON",!0);var Ec=H.Symbol;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var bc=Ec,Cc=Vs.f("iterator"),Ac=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof bc&&"symbol"==typeof Cc?function(t){return typeof t}:function(t){return t&&"function"==typeof bc&&t.constructor===bc&&t!==bc.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),Nc=fails((function(){dr(1)}));_export({target:"Object",stat:!0,forced:Nc,sham:!sr},{getPrototypeOf:function getPrototypeOf(t){return dr(toObject(t))}});var Rc=H.Object.getPrototypeOf,kc=N([].reverse),wc=[1,2];_export({target:"Array",proto:!0,forced:String(wc)===String(wc.reverse())},{reverse:function reverse(){return Fr(this)&&(this.length=this.length),kc(this)}});var Oc=entryVirtual("Array").reverse,Pc=Array.prototype,reverse$1=function(t){var a=t.reverse;return t===Pc||$(Pc,t)&&a===Pc.reverse?Oc:a},xc=createCommonjsModule((function(t){var a=Ac.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return c},t.exports.__esModule=!0,t.exports.default=t.exports;var c={},m=Object.prototype,h=m.hasOwnProperty,g="function"==typeof bc?bc:{},I=g.iterator||"@@iterator",M=g.asyncIterator||"@@asyncIterator",T=g.toStringTag||"@@toStringTag";function define(t,a,c){return ze(t,a,{value:c,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,c){return t[a]=c}}function wrap(t,a,c,m){var h=a&&a.prototype instanceof Generator?a:Generator,g=vt(h.prototype),I=new Context(m||[]);return g._invoke=function(t,a,c){var m="suspendedStart";return function(h,g){if("executing"===m)throw new Error("Generator is already running");if("completed"===m){if("throw"===h)throw g;return doneResult()}for(c.method=h,c.arg=g;;){var I=c.delegate;if(I){var M=maybeInvokeDelegate(I,c);if(M){if(M===S)continue;return M}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===m)throw m="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);m="executing";var T=tryCatch(t,a,c);if("normal"===T.type){if(m=c.done?"completed":"suspendedYield",T.arg===S)continue;return{value:T.arg,done:c.done}}"throw"===T.type&&(m="completed",c.method="throw",c.arg=T.arg)}}}(t,c,I),g}function tryCatch(t,a,c){try{return{type:"normal",arg:t.call(a,c)}}catch(t){return{type:"throw",arg:t}}}c.wrap=wrap;var S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var E={};define(E,I,(function(){return this}));var b=Rc&&Rc(Rc(values([])));b&&b!==m&&h.call(b,I)&&(E=b);var C=GeneratorFunctionPrototype.prototype=Generator.prototype=vt(E);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,c){function invoke(m,g,I,M){var T=tryCatch(t[m],t,g);if("throw"!==T.type){var S=T.arg,E=S.value;return E&&"object"==a(E)&&h.call(E,"__await")?c.resolve(E.__await).then((function(t){invoke("next",t,I,M)}),(function(t){invoke("throw",t,I,M)})):c.resolve(E).then((function(t){S.value=t,I(S)}),(function(t){return invoke("throw",t,I,M)}))}M(T.arg)}var m;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new c((function(c,m){invoke(t,a,c,m)}))}return m=m?m.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var c=t.iterator[a.method];if(void 0===c){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return S;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var m=tryCatch(c,t.iterator,a.arg);if("throw"===m.type)return a.method="throw",a.arg=m.arg,a.delegate=null,S;var h=m.arg;return h?h.done?(a[t.resultName]=h.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,S):h:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,S)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[I];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var c=-1,m=function next(){for(;++c<t.length;)if(h.call(t,c))return next.value=t[c],next.done=!1,next;return next.value=void 0,next.done=!0,next};return m.next=m}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(C,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,T,"GeneratorFunction"),c.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},c.mark=function(t){return Mt?Mt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,T,"GeneratorFunction")),t.prototype=vt(C),t},c.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,M,(function(){return this})),c.AsyncIterator=AsyncIterator,c.async=function(t,a,m,h,g){void 0===g&&(g=Mi);var I=new AsyncIterator(wrap(t,a,m,h),g);return c.isGeneratorFunction(a)?I:I.next().then((function(t){return t.done?t.value:I.next()}))},defineIteratorMethods(C),define(C,T,"Generator"),define(C,I,(function(){return this})),define(C,"toString",(function(){return"[object Generator]"})),c.keys=function(t){var a=[];for(var c in t)a.push(c);return reverse$1(a).call(a),function next(){for(;a.length;){var c=a.pop();if(c in t)return next.value=c,next.done=!1,next}return next.done=!0,next}},c.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var c in this)"t"===c.charAt(0)&&h.call(this,c)&&!isNaN(+slice(c).call(c,1))&&(this[c]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(c,m){return g.type="throw",g.arg=t,a.next=c,m&&(a.method="next",a.arg=void 0),!!m}for(var c=this.tryEntries.length-1;c>=0;--c){var m=this.tryEntries[c],g=m.completion;if("root"===m.tryLoc)return handle("end");if(m.tryLoc<=this.prev){var I=h.call(m,"catchLoc"),M=h.call(m,"finallyLoc");if(I&&M){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0);if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}else if(I){if(this.prev<m.catchLoc)return handle(m.catchLoc,!0)}else{if(!M)throw new Error("try statement without catch or finally");if(this.prev<m.finallyLoc)return handle(m.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var c=this.tryEntries.length-1;c>=0;--c){var m=this.tryEntries[c];if(m.tryLoc<=this.prev&&h.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var g=m;break}}g&&("break"===t||"continue"===t)&&g.tryLoc<=a&&a<=g.finallyLoc&&(g=null);var I=g?g.completion:{};return I.type=t,I.arg=a,g?(this.method="next",this.next=g.finallyLoc,S):this.complete(I)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),S},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===t)return this.complete(c.completion,c.afterLoc),resetTryEntry(c),S}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===t){var m=c.completion;if("throw"===m.type){var h=m.arg;resetTryEntry(c)}return h}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,c){return this.delegate={iterator:values(t),resultName:a,nextLoc:c},"next"===this.method&&(this.arg=void 0),S}},c}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),Vc=xc(),Lc=Vc;try{regeneratorRuntime=Vc}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Vc:Function("r","regeneratorRuntime = r")(Vc)}H.JSON||(H.JSON={stringify:JSON.stringify});var Dc=function stringify(t,a,c){return S(H.JSON.stringify,null,arguments)},Uc=Dc;function __rest(t,a){var c={};for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&a.indexOf(m)<0&&(c[m]=t[m]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(m=Object.getOwnPropertySymbols(t);h<m.length;h++)a.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(t,m[h])&&(c[m[h]]=t[m[h]])}return c}function __awaiter(t,a,c,m){return new(c||(c=Promise))((function(h,g){function fulfilled(t){try{step(m.next(t))}catch(t){g(t)}}function rejected(t){try{step(m.throw(t))}catch(t){g(t)}}function step(t){t.done?h(t.value):function adopt(t){return t instanceof c?t:new c((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((m=m.apply(t,a||[])).next())}))}var Fc=Zr.map,Bc=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!Bc},{map:function map(t){return Fc(this,t,arguments.length>1?arguments[1]:void 0)}});var qc=entryVirtual("Array").map,Gc=Array.prototype,map$6=function(t){var a=t.map;return t===Gc||$(Gc,t)&&a===Gc.map?qc:a};_export({target:"Array",stat:!0},{isArray:Fr});var jc=H.Array.isArray,callWithSafeIterationClosing=function(t,a,c,m){try{return m?a(anObject(c)[0],c[1]):a(c)}catch(a){iteratorClose(t,"throw",a)}},Hc=Array,$c=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:$c},{from:function from(t){var a=toObject(t),c=Kr(this),m=arguments.length,h=m>1?arguments[1]:void 0,g=void 0!==h;g&&(h=functionBindContext(h,m>2?arguments[2]:void 0));var I,M,T,S,E,b,C=getIteratorMethod$5(a),A=0;if(!C||this===Hc&&isArrayIteratorMethod(C))for(I=lengthOfArrayLike(a),M=c?new this(I):Hc(I);I>A;A++)b=g?h(a[A],A):a[A],createProperty(M,A,b);else for(E=(S=getIterator(a,C)).next,M=c?new this:[];!(T=w(E,S)).done;A++)b=g?callWithSafeIterationClosing(S,h,[T.value,A],!0):T.value,createProperty(M,A,b);return M.length=A,M}});var Yc=H.Array.from,Wc=getIteratorMethod$5;var zc=function isUndefined(t){return void 0===t},Kc=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Qc=Object.isExtensible,Jc=fails((function(){Qc(1)}))||Kc?function isExtensible(t){return!!j(t)&&((!Kc||"ArrayBuffer"!=classofRaw(t))&&(!Qc||Qc(t)))}:Qc,Xc=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),Zc=createCommonjsModule((function(t){var a=Ge.f,c=!1,m=uid("meta"),h=0,setMetadata=function(t){a(t,m,{value:{objectID:"O"+h++,weakData:{}}})},g=t.exports={enable:function(){g.enable=function(){},c=!0;var t=fn.f,a=N([].splice),h={};h[m]=1,t(h).length&&(fn.f=function(c){for(var h=t(c),g=0,I=h.length;g<I;g++)if(h[g]===m){a(h,g,1);break}return h},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:xs.f}))},fastKey:function(t,a){if(!j(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!de(t,m)){if(!Jc(t))return"F";if(!a)return"E";setMetadata(t)}return t[m].objectID},getWeakData:function(t,a){if(!de(t,m)){if(!Jc(t))return!0;if(!a)return!1;setMetadata(t)}return t[m].weakData},onFreeze:function(t){return Xc&&c&&Jc(t)&&!de(t,m)&&setMetadata(t),t}};it[m]=!0})),el=Ge.f,tl=Zr.forEach,rl=rr.set,nl=rr.getterFor,collection=function(t,a,c){var m,g=-1!==t.indexOf("Map"),I=-1!==t.indexOf("Weak"),M=g?"set":"add",T=h[t],S=T&&T.prototype,E={};if(R&&isCallable(T)&&(I||S.forEach&&!fails((function(){(new T).entries().next()})))){var b=(m=a((function(a,c){rl(anInstance(a,b),{type:t,collection:new T}),null!=c&&iterate(c,a[M],{that:a,AS_ENTRIES:g})}))).prototype,C=nl(t);tl(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in S)||I&&"clear"==t||je(b,t,(function(c,m){var h=C(this).collection;if(!a&&I&&!j(c))return"get"==t&&void 0;var g=h[t](0===c?0:c,m);return a?this:g}))})),I||el(b,"size",{configurable:!0,get:function(){return C(this).collection.size}})}else m=c.getConstructor(a,t,g,M),Zc.enable();return setToStringTag(m,t,!1,!0),E[t]=m,_export({global:!0,forced:!0},E),I||c.setStrong(m,t,g),m},defineBuiltIns=function(t,a,c){for(var m in a)c&&c.unsafe&&t[m]?t[m]=a[m]:defineBuiltIn(t,m,a[m],c);return t},al=Ge.f,il=Zc.fastKey,ol=rr.set,sl=rr.getterFor,cl={getConstructor:function(t,a,c,m){var h=t((function(t,h){anInstance(t,g),ol(t,{type:a,index:ft(null),first:void 0,last:void 0,size:0}),R||(t.size=0),isNullOrUndefined(h)||iterate(h,t[m],{that:t,AS_ENTRIES:c})})),g=h.prototype,I=sl(a),define=function(t,a,c){var m,h,g=I(t),M=getEntry(t,a);return M?M.value=c:(g.last=M={index:h=il(a,!0),key:a,value:c,previous:m=g.last,next:void 0,removed:!1},g.first||(g.first=M),m&&(m.next=M),R?g.size++:t.size++,"F"!==h&&(g.index[h]=M)),t},getEntry=function(t,a){var c,m=I(t),h=il(a);if("F"!==h)return m.index[h];for(c=m.first;c;c=c.next)if(c.key==a)return c};return defineBuiltIns(g,{clear:function clear(){for(var t=I(this),a=t.index,c=t.first;c;)c.removed=!0,c.previous&&(c.previous=c.previous.next=void 0),delete a[c.index],c=c.next;t.first=t.last=void 0,R?t.size=0:this.size=0},delete:function(t){var a=this,c=I(a),m=getEntry(a,t);if(m){var h=m.next,g=m.previous;delete c.index[m.index],m.removed=!0,g&&(g.next=h),h&&(h.previous=g),c.first==m&&(c.first=h),c.last==m&&(c.last=g),R?c.size--:a.size--}return!!m},forEach:function forEach(t){for(var a,c=I(this),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:c.first;)for(m(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(g,c?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),R&&al(g,"size",{get:function(){return I(this).size}}),h},setStrong:function(t,a,c){var m=a+" Iterator",h=sl(a),g=sl(m);iteratorDefine(t,a,(function(t,a){ol(this,{type:m,target:t,state:h(t),kind:a,last:void 0})}),(function(){for(var t=g(this),a=t.kind,c=t.last;c&&c.removed;)c=c.previous;return t.target&&(t.last=c=c?c.next:t.state.first)?"keys"==a?{value:c.key,done:!1}:"values"==a?{value:c.value,done:!1}:{value:[c.key,c.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),c?"entries":"values",!c,!0),setSpecies(a)}};collection("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),cl);var ll=H.Map,ul=[].push,dl=function from(t){var a,c,m,h,g=arguments.length,I=g>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==I)&&aCallable(I),isNullOrUndefined(t)?new this:(c=[],a?(m=0,h=functionBindContext(I,g>2?arguments[2]:void 0),iterate(t,(function(t){w(ul,c,h(t,m++))}))):iterate(t,ul,{that:c}),new this(c))};_export({target:"Map",stat:!0,forced:!0},{from:dl});var pl=function of(){return new this(Tt(arguments))};_export({target:"Map",stat:!0,forced:!0},{of:pl});var ml=function deleteAll(){for(var t,a=anObject(this),c=aCallable(a.delete),m=!0,h=0,g=arguments.length;h<g;h++)t=w(c,a,arguments[h]),m=m&&t;return!!m};_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:ml});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var c,m,h=anObject(this),g=aCallable(h.get),I=aCallable(h.has),M=aCallable(h.set);return w(I,h,t)?(c=w(g,h,t),"update"in a&&(c=a.update(c,t,h),w(M,h,t,c)),c):(m=a.insert(t,h),w(M,h,t,m),m)}});var hl=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c,h){if(!m(c,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){m(c,t,a)&&w(g,h,t,c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h(c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var fl=N([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var c=getIterator(t),m=new this,h=aCallable(m.has),g=aCallable(m.get),I=aCallable(m.set);return iterate(c,(function(t){var c=a(t);w(h,m,c)?fl(w(g,m,c),t):w(I,m,c,[t])}),{IS_ITERATOR:!0}),m}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(hl(anObject(this)),(function(a,c,m){if((h=c)===(g=t)||h!=h&&g!=g)return m();var h,g}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var c=new this;aCallable(a);var m=aCallable(c.set);return iterate(t,(function(t){w(m,c,a(t),t)})),c}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(hl(anObject(this)),(function(a,c,m){if(c===t)return m(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){w(g,h,m(c,t,a),c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),g=aCallable(h.set);return iterate(c,(function(t,c){w(g,h,t,m(c,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),c=aCallable(a.set),m=arguments.length,h=0;h<m;)iterate(arguments[h++],c,{that:a,AS_ENTRIES:!0});return a}});var gl=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=hl(a),m=arguments.length<2,h=m?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c,g){m?(m=!1,h=g):h=t(h,g,c,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m)throw gl("Reduce of empty map with no initial value");return h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=hl(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,h){if(m(c,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var vl=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var c=anObject(this),m=aCallable(c.get),h=aCallable(c.has),g=aCallable(c.set),I=arguments.length;aCallable(a);var M=w(h,c,t);if(!M&&I<3)throw vl("Updating absent value");var T=M?w(m,c,t):aCallable(I>2?arguments[2]:void 0)(t,c);return w(g,c,t,a(T,t,c)),c}});var yl=TypeError,_l=function upsert(t,a){var c,m=anObject(this),h=aCallable(m.get),g=aCallable(m.has),I=aCallable(m.set),M=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(M))throw yl("At least one callback required");return w(g,m,t)?(c=w(h,m,t),isCallable(a)&&(c=a(c),w(I,m,t,c))):isCallable(M)&&(c=M(),w(I,m,t,c)),c};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:_l}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:_l});var Il=ll,Ml=createCommonjsModule((function(t){function _getPrototypeOf(a){var c;return t.exports=_getPrototypeOf=Mt?bind$1(c=Rc).call(c):function _getPrototypeOf(t){return t.__proto__||Rc(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Tl=at.indexOf,Sl=N([].indexOf),El=!!Sl&&1/Sl([1],1,-0)<0,bl=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:El||!bl},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return El?Sl(this,t,a)||0:Tl(this,t,a)}});var Cl=entryVirtual("Array").indexOf,Al=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Al||$(Al,t)&&a===Al.indexOf?Cl:a},Nl=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),Rl=getBuiltIn("Reflect","construct"),kl=Object.prototype,wl=[].push,Ol=fails((function(){function F(){}return!(Rl((function(){}),[],F)instanceof F)})),Pl=!fails((function(){Rl((function(){}))})),xl=Ol||Pl;_export({target:"Reflect",stat:!0,forced:xl,sham:xl},{construct:function construct(t,a){aConstructor(t),anObject(a);var c=arguments.length<3?t:aConstructor(arguments[2]);if(Pl&&!Ol)return Rl(t,a,c);if(t==c){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var m=[null];return S(wl,m,a),new(S(At,t,m))}var h=c.prototype,g=ft(j(h)?h:kl),I=S(t,g,a);return j(I)?I:g}});var Vl=H.Reflect.construct,Ll=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Vl)return!1;if(Vl.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Vl(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Dl=createCommonjsModule((function(t){function _construct(a,c,m){var h;Ll()?(t.exports=_construct=bind$1(h=Vl).call(h),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,c){var m=[null];m.push.apply(m,a);var h=new(bind$1(Function).apply(t,m));return c&&kt(h,c.prototype),h},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),Ul=createCommonjsModule((function(t){function _wrapNativeSuper(a){var c="function"==typeof Il?new Il:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!Nl(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(t))return c.get(t);c.set(t,Wrapper)}function Wrapper(){return Dl(t,arguments,Ml(this).constructor)}return Wrapper.prototype=vt(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),kt(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),Fl=getDefaultExportFromCjs(Ul),Bl=TypeError,createMethod$1=function(t){return function(a,c,m,h){aCallable(c);var g=toObject(a),I=B(g),M=lengthOfArrayLike(g),T=t?M-1:0,S=t?-1:1;if(m<2)for(;;){if(T in I){h=I[T],T+=S;break}if(T+=S,t?T<0:M<=T)throw Bl("Reduce of empty array with no initial value")}for(;t?T>=0:M>T;T+=S)T in I&&(h=c(h,I[T],T,g));return h}},ql={left:createMethod$1(!1),right:createMethod$1(!0)}.left,Gl=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!Gl||!Bn&&J>79&&J<83},{reduce:function reduce(t){var a=arguments.length;return ql(this,t,a,a>1?arguments[1]:void 0)}});var jl,Hl,$l,Yl,Wl,zl,Kl,Ql,Jl,Xl,Zl,eu,tu,ru,nu,au,iu,ou,su,cu,lu,uu,du,pu,mu,hu,fu,gu,vu,yu,_u,Iu,Mu,Tu,Su,Eu,bu,Cu,Au,Nu,Ru,ku,wu,Ou=entryVirtual("Array").reduce,Pu=Array.prototype,reduce=function(t){var a=t.reduce;return t===Pu||$(Pu,t)&&a===Pu.reduce?Ou:a};!function(t){t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(jl||(jl={})),function(t){t[t.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",t[t.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",t[t.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Hl||(Hl={})),function(t){t[t.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",t[t.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",t[t.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}($l||($l={})),function(t){t[t.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",t[t.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",t[t.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",t[t.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(Yl||(Yl={})),function(t){t[t.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",t[t.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",t[t.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(Wl||(Wl={})),function(t){t[t.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",t[t.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(zl||(zl={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Kl||(Kl={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Ql||(Ql={})),function(t){t[t.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",t[t.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Jl||(Jl={})),function(t){t[t.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",t[t.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",t[t.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",t[t.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Xl||(Xl={})),function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(Zl||(Zl={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(eu||(eu={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(tu||(tu={})),function(t){t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",t[t.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(ru||(ru={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(nu||(nu={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(au||(au={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(iu||(iu={})),function(t){t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(ou||(ou={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(su||(su={})),function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(cu||(cu={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(lu||(lu={})),function(t){t[t.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(uu||(uu={})),function(t){t[t.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(du||(du={})),function(t){t[t.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",t[t.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(pu||(pu={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(mu||(mu={})),function(t){t[t.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",t[t.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(hu||(hu={})),function(t){t[t.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",t[t.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",t[t.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",t[t.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",t[t.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",t[t.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",t[t.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",t[t.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(fu||(fu={})),function(t){t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(gu||(gu={})),function(t){t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(vu||(vu={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(yu||(yu={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(_u||(_u={})),function(t){t[t.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",t[t.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",t[t.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(Iu||(Iu={})),function(t){t[t.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",t[t.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",t[t.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(Mu||(Mu={})),function(t){t[t.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",t[t.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(Tu||(Tu={})),function(t){t[t.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",t[t.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(Su||(Su={})),function(t){t[t.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(Eu||(Eu={})),function(t){t[t.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(bu||(bu={})),function(t){t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(Cu||(Cu={})),function(t){t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL=0]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER=1]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE=2]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE"}(Au||(Au={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",t[t.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(Nu||(Nu={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(Ru||(Ru={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(ku||(ku={})),function(t){t[t.teamApply=0]="teamApply",t[t.teamApplyReject=1]="teamApplyReject",t[t.teamInvite=2]="teamInvite",t[t.teamInviteReject=3]="teamInviteReject",t[t.tlistUpdate=4]="tlistUpdate",t[t.superTeamApply=15]="superTeamApply",t[t.superTeamApplyReject=16]="superTeamApplyReject",t[t.superTeamInvite=17]="superTeamInvite",t[t.superTeamInviteReject=18]="superTeamInviteReject"}(wu||(wu={}));var xu={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_MESSAGE_HIT_CLIENT_ANTISPAM:{code:107452,message:"message hit client antispam"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},Vu=mn(xu),Lu=reduce(Vu).call(Vu,(function(t,a){var c=xu[a];return t[a]=c.code,t}),{}),Du=reduce(Vu).call(Vu,(function(t,a){var c=xu[a];return t[c.code]=c.message,t}),{}),Uu=Object.freeze({__proto__:null,V2NIMErrorCode:Lu,V2NIMErrorDesc:Du,get V2NIMDataSyncLevel(){return jl},get V2NIMDataSyncType(){return Hl},get V2NIMDataSyncState(){return $l},get V2NIMConversationType(){return Yl},get V2NIMLastMessageState(){return Wl},get V2NIMFriendAddMode(){return zl},get V2NIMFriendAddApplicationType(){return Kl},get V2NIMFriendAddApplicationStatus(){return Ql},get V2NIMFriendDeletionType(){return Jl},get V2NIMFriendVerifyType(){return Xl},get V2NIMLoginAuthType(){return Zl},get V2NIMLoginStatus(){return eu},get V2NIMLoginClientType(){return tu},get V2NIMKickedOfflineReason(){return ru},get V2NIMLoginClientChange(){return nu},get V2NIMConnectStatus(){return au},get V2NIMMessageType(){return iu},get V2NIMMessageNotificationType(){return ou},get V2NIMMessageAttachmentUploadState(){return su},get V2NIMMessageSendingState(){return cu},get V2NIMQueryDirection(){return lu},get V2NIMMessageRevokeType(){return uu},get V2NIMMessagePinState(){return du},get V2NIMMessageQuickCommentType(){return pu},get V2NIMClientAntispamOperateType(){return mu},get V2NIMSortOrder(){return hu},get V2NIMSystemMessageType(){return fu},get V2NIMTeamMessageMuteMode(){return gu},get V2NIMP2PMessageMuteMode(){return vu},get V2NIMTeamMemberRoleQueryType(){return _u},get V2NIMTeamType(){return Iu},get V2NIMTeamJoinMode(){return Mu},get V2NIMTeamAgreeMode(){return Tu},get V2NIMTeamInviteMode(){return Su},get V2NIMTeamUpdateInfoMode(){return Eu},get V2NIMTeamChatBannedMode(){return bu},get V2NIMTeamUpdateExtensionMode(){return Cu},get V2NIMTeamMessageNotifyMode(){return Au},get V2NIMTeamJoinActionType(){return Ru},get V2NIMTeamJoinActionStatus(){return ku},get V2NIMTeamNotificationType(){return wu},get V2NIMTeamMemberRole(){return Nu}}),Fu=function(t){function V2NIMErrorImpl(a){var c;return(c=t.call(this,a.desc)||this).name="V2NIMError",c.code=a.code||0,c.desc=a.desc||Du[c.code]||$u[c.code]||"",c.message=c.desc,c.detail=a.detail||{},c}return wt(V2NIMErrorImpl,t),V2NIMErrorImpl.prototype.toString=function toString(){var t,a=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?Uc(this.detail):"");return(null===(t=null==this?void 0:this.detail)||void 0===t?void 0:t.rawError)&&(a+="\n rawError: "+this.detail.rawError.message),a},V2NIMErrorImpl}(Fl(Error));var Bu=function(t){function ValidateError(a,c,m){var h;return void 0===c&&(c={}),(h=t.call(this,{code:Lu.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:a,rules:m,data:c}})||this).name="validateError",h.message=h.message+"\n"+Uc(h.detail,null,2),h.data=c,h.rules=m,h}return wt(ValidateError,t),ValidateError}(Fu),qu=function(t){function ValidateErrorV2(a){var c,m,h,g;return(c=t.call(this,{code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(m=a.detail)||void 0===m?void 0:m.reason,rules:null===(h=a.detail)||void 0===h?void 0:h.rules,data:null===(g=a.detail)||void 0===g?void 0:g.data}})||this).name="ValidateErrorV2",c}return wt(ValidateErrorV2,t),ValidateErrorV2}(Fu),Gu=function(t){function FormatError(a,c,m){var h;return(h=t.call(this,{code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:a,key:c,rules:m}})||this).name="formatError",h}return wt(FormatError,t),FormatError}(Fu),ju=function(t){function UploadError(a){var c;return(c=t.call(this,qt({code:400},a))||this).desc=c.desc||"upload file error",c.message=c.desc,c.name="uploadError",c}return wt(UploadError,t),UploadError}(Fu),Hu=function(t){function CustomError(a,c,m){var h;return void 0===c&&(c={}),void 0===m&&(m=400),(h=t.call(this,{code:m,desc:a,detail:c})||this).name="customError",h.data=c,h}return wt(CustomError,t),CustomError}(Fu),$u={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Service unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};var Yu=function stackClear(){this.__data__=new os,this.size=0};var Wu=function stackDelete(t){var a=this.__data__,c=a.delete(t);return this.size=a.size,c};var zu=function stackGet(t){return this.__data__.get(t)};var Ku=function stackHas(t){return this.__data__.has(t)};var Qu=function stackSet(t,a){var c=this.__data__;if(c instanceof os){var m=c.__data__;if(!ss||m.length<199)return m.push([t,a]),this.size=++c.size,this;c=this.__data__=new fs(m)}return c.set(t,a),this.size=c.size,this};function Stack(t){var a=this.__data__=new os(t);this.size=a.size}Stack.prototype.clear=Yu,Stack.prototype.delete=Wu,Stack.prototype.get=zu,Stack.prototype.has=Ku,Stack.prototype.set=Qu;var Ju=Stack,Xu=function(){try{var t=Go(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Zu=function baseAssignValue(t,a,c){"__proto__"==a&&Xu?Xu(t,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):t[a]=c};var ed=function assignMergeValue(t,a,c){(void 0!==c&&!Zo(t[a],c)||void 0===c&&!(a in t))&&Zu(t,a,c)};var td=function createBaseFor(t){return function(a,c,m){for(var h=-1,g=Object(a),I=m(a),M=I.length;M--;){var T=I[t?M:++h];if(!1===c(g[T],T,g))break}return a}}(),rd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c?uo.Buffer:void 0,g=h?h.allocUnsafe:void 0;t.exports=function cloneBuffer(t,a){if(a)return t.slice();var c=t.length,m=g?g(c):new t.constructor(c);return t.copy(m),m}})),nd=uo.Uint8Array;var ad=function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new nd(a).set(new nd(t)),a};var id=function cloneTypedArray(t,a){var c=a?ad(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.length)};var od=function copyArray(t,a){var c=-1,m=t.length;for(a||(a=Array(m));++c<m;)a[c]=t[c];return a},sd=Object.create,cd=function(){function object(){}return function(t){if(!Ao(t))return{};if(sd)return sd(t);object.prototype=t;var a=new object;return object.prototype=void 0,a}}();var ld=function overArg(t,a){return function(c){return t(a(c))}},ud=ld(Object.getPrototypeOf,Object),dd=Object.prototype;var pd=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||dd)};var md=function initCloneObject(t){return"function"!=typeof t.constructor||pd(t)?{}:cd(ud(t))};var hd=function baseIsArguments(t){return To(t)&&"[object Arguments]"==Mo(t)},fd=Object.prototype,gd=fd.hasOwnProperty,vd=fd.propertyIsEnumerable,yd=hd(function(){return arguments}())?hd:function(t){return To(t)&&gd.call(t,"callee")&&!vd.call(t,"callee")},_d=yd;var Id=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var Md=function isArrayLike(t){return null!=t&&Id(t.length)&&!No(t)};var Td=function isArrayLikeObject(t){return To(t)&&Md(t)};var Sd=function stubFalse(){return!1},Ed=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c?uo.Buffer:void 0,g=(h?h.isBuffer:void 0)||Sd;t.exports=g})),bd=Function.prototype,Cd=Object.prototype,Ad=bd.toString,Nd=Cd.hasOwnProperty,Rd=Ad.call(Object);var kd=function isPlainObject(t){if(!To(t)||"[object Object]"!=Mo(t))return!1;var a=ud(t);if(null===a)return!0;var c=Nd.call(a,"constructor")&&a.constructor;return"function"==typeof c&&c instanceof c&&Ad.call(c)==Rd},wd={};wd["[object Float32Array]"]=wd["[object Float64Array]"]=wd["[object Int8Array]"]=wd["[object Int16Array]"]=wd["[object Int32Array]"]=wd["[object Uint8Array]"]=wd["[object Uint8ClampedArray]"]=wd["[object Uint16Array]"]=wd["[object Uint32Array]"]=!0,wd["[object Arguments]"]=wd["[object Array]"]=wd["[object ArrayBuffer]"]=wd["[object Boolean]"]=wd["[object DataView]"]=wd["[object Date]"]=wd["[object Error]"]=wd["[object Function]"]=wd["[object Map]"]=wd["[object Number]"]=wd["[object Object]"]=wd["[object RegExp]"]=wd["[object Set]"]=wd["[object String]"]=wd["[object WeakMap]"]=!1;var Od=function baseIsTypedArray(t){return To(t)&&Id(t.length)&&!!wd[Mo(t)]};var Pd=function baseUnary(t){return function(a){return t(a)}},xd=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,m=c&&t&&!t.nodeType&&t,h=m&&m.exports===c&&co.process,g=function(){try{var t=m&&m.require&&m.require("util").types;return t||h&&h.binding&&h.binding("util")}catch(t){}}();t.exports=g})),Vd=xd&&xd.isTypedArray,Ld=Vd?Pd(Vd):Od;var Dd=function safeGet(t,a){if(("constructor"!==a||"function"!=typeof t[a])&&"__proto__"!=a)return t[a]},Ud=Object.prototype.hasOwnProperty;var Fd=function assignValue(t,a,c){var m=t[a];Ud.call(t,a)&&Zo(m,c)&&(void 0!==c||a in t)||Zu(t,a,c)};var Bd=function copyObject(t,a,c,m){var h=!c;c||(c={});for(var g=-1,I=a.length;++g<I;){var M=a[g],T=m?m(c[M],t[M],M,c,t):void 0;void 0===T&&(T=t[M]),h?Zu(c,M,T):Fd(c,M,T)}return c};var qd=function baseTimes(t,a){for(var c=-1,m=Array(t);++c<t;)m[c]=a(c);return m},Gd=/^(?:0|[1-9]\d*)$/;var jd=function isIndex(t,a){var c=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==c||"symbol"!=c&&Gd.test(t))&&t>-1&&t%1==0&&t<a},Hd=Object.prototype.hasOwnProperty;var $d=function arrayLikeKeys(t,a){var c=so(t),m=!c&&_d(t),h=!c&&!m&&Ed(t),g=!c&&!m&&!h&&Ld(t),I=c||m||h||g,M=I?qd(t.length,String):[],T=M.length;for(var S in t)!a&&!Hd.call(t,S)||I&&("length"==S||h&&("offset"==S||"parent"==S)||g&&("buffer"==S||"byteLength"==S||"byteOffset"==S)||jd(S,T))||M.push(S);return M};var Yd=function nativeKeysIn(t){var a=[];if(null!=t)for(var c in Object(t))a.push(c);return a},Wd=Object.prototype.hasOwnProperty;var zd=function baseKeysIn(t){if(!Ao(t))return Yd(t);var a=pd(t),c=[];for(var m in t)("constructor"!=m||!a&&Wd.call(t,m))&&c.push(m);return c};var Kd=function keysIn(t){return Md(t)?$d(t,!0):zd(t)};var Qd=function toPlainObject(t){return Bd(t,Kd(t))};var Jd=function baseMergeDeep(t,a,c,m,h,g,I){var M=Dd(t,c),T=Dd(a,c),S=I.get(T);if(S)ed(t,c,S);else{var E=g?g(M,T,c+"",t,a,I):void 0,b=void 0===E;if(b){var C=so(T),A=!C&&Ed(T),N=!C&&!A&&Ld(T);E=T,C||A||N?so(M)?E=M:Td(M)?E=od(M):A?(b=!1,E=rd(T,!0)):N?(b=!1,E=id(T,!0)):E=[]:kd(T)||_d(T)?(E=M,_d(M)?E=Qd(M):Ao(M)&&!No(M)||(E=md(T))):b=!1}b&&(I.set(T,E),h(E,T,m,g,I),I.delete(T)),ed(t,c,E)}};var Xd=function baseMerge(t,a,c,m,h){t!==a&&td(a,(function(g,I){if(h||(h=new Ju),Ao(g))Jd(t,a,I,c,baseMerge,m,h);else{var M=m?m(Dd(t,I),g,I+"",t,a,h):void 0;void 0===M&&(M=g),ed(t,I,M)}}),Kd)};var Zd=function identity(t){return t};var ep=function apply(t,a,c){switch(c.length){case 0:return t.call(a);case 1:return t.call(a,c[0]);case 2:return t.call(a,c[0],c[1]);case 3:return t.call(a,c[0],c[1],c[2])}return t.apply(a,c)},tp=Math.max;var rp=function overRest(t,a,c){return a=tp(void 0===a?t.length-1:a,0),function(){for(var m=arguments,h=-1,g=tp(m.length-a,0),I=Array(g);++h<g;)I[h]=m[a+h];h=-1;for(var M=Array(a+1);++h<a;)M[h]=m[h];return M[a]=c(I),ep(t,this,M)}};var np=function constant(t){return function(){return t}},ap=Xu?function(t,a){return Xu(t,"toString",{configurable:!0,enumerable:!1,value:np(a),writable:!0})}:Zd,ip=Date.now;var op=function shortOut(t){var a=0,c=0;return function(){var m=ip(),h=16-(m-c);if(c=m,h>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},sp=op(ap);var cp=function baseRest(t,a){return sp(rp(t,a,Zd),t+"")};var lp=function isIterateeCall(t,a,c){if(!Ao(c))return!1;var m=typeof a;return!!("number"==m?Md(c)&&jd(a,c.length):"string"==m&&a in c)&&Zo(c[a],t)};var up=function createAssigner(t){return cp((function(a,c){var m=-1,h=c.length,g=h>1?c[h-1]:void 0,I=h>2?c[2]:void 0;for(g=t.length>3&&"function"==typeof g?(h--,g):void 0,I&&lp(c[0],c[1],I)&&(g=h<3?void 0:g,h=1),a=Object(a);++m<h;){var M=c[m];M&&t(a,M,m,g)}return a}))},dp=up((function(t,a,c){Xd(t,a,c)})),pp=Zr.some,mp=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!mp},{some:function some(t){return pp(this,t,arguments.length>1?arguments[1]:void 0)}});var hp,fp,gp=entryVirtual("Array").some,vp=Array.prototype,some=function(t){var a=t.some;return t===vp||$(vp,t)&&a===vp.some?gp:a};!function(t){t[t.Unset=0]="Unset",t[t.RN=2]="RN",t[t.UNIAPP=3]="UNIAPP",t[t.Electron=5]="Electron",t[t.WeiXin=6]="WeiXin",t[t.BROWSER=100]="BROWSER",t[t.H5=101]="H5",t[t.Ali=102]="Ali",t[t.Baidu=103]="Baidu",t[t.Tiktok=104]="Tiktok"}(hp||(hp={})),function(t){t[t.kStatNetTypeUnkonw=0]="kStatNetTypeUnkonw",t[t.kStatNetTypeEthernet=1]="kStatNetTypeEthernet",t[t.kStatNetTypeWifi=2]="kStatNetTypeWifi",t[t.kStatNetType2G=3]="kStatNetType2G",t[t.kStatNetType3G=4]="kStatNetType3G",t[t.kStatNetType4G=5]="kStatNetType4G",t[t.kStatNetType5G=6]="kStatNetType5G"}(fp||(fp={}));var yp={wifi:fp.kStatNetTypeWifi,"2g":fp.kStatNetType2G,"3g":fp.kStatNetType3G,"4g":fp.kStatNetType4G,"5g":fp.kStatNetType5G,ethernet:fp.kStatNetTypeEthernet,unknown:fp.kStatNetTypeUnkonw,none:fp.kStatNetTypeUnkonw,notreachable:fp.kStatNetTypeUnkonw,wwan:fp.kStatNetTypeUnkonw};function isMobile(){if(!navigator||!navigator.userAgent)return!1;var t=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return some(t).call(t,(function(t){return navigator.userAgent.match(t)}))}function isElectron(){var t;return!(!navigator||!navigator.userAgent)&&("object"==typeof navigator&&"string"==typeof navigator.userAgent&&indexOf(t=navigator.userAgent).call(t,"Electron")>=0)}function isBrowser(){return navigator&&navigator.userAgent}var _p={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")},getFileUploadInformation:function getFileUploadInformation(t){throw new Error("Function not implemented.")},net:{__getEnv:function __getEnv(){return null},__onNetworkStatusChangeFn:null,getNetworkStatus:function getNetworkStatus(){var t=this.__getEnv();return new Mi((function(a,c){t.getNetworkType({success:function success(t){var c=!1;c="boolean"==typeof t.networkAvailable?t.networkAvailable:"none"!==t.networkType.toLowerCase(),a({net_type:yp[t.networkType.toLowerCase()],net_connect:c})},fail:function fail(){c(new Error("getNetworkType failed"))}})}))},onNetworkStatusChange:function onNetworkStatusChange(t){var a=this.__getEnv();this.offNetworkStatusChange(),a.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(a){var c=a.networkType.toLowerCase();t({isConnected:a.isConnected||"none"!==c,networkType:yp[c]})},a.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange:function offNetworkStatusChange(){var t=this.__getEnv();t.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&t.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}}};function getPromiseWithAbort(t){var a={},c=new Mi((function(t,c){a.abort=c}));return a.promise=Mi.race([t,c]),a}Mi.reject;var Ip=function(){function PromiseManager(){this.abortFns=[]}var t=PromiseManager.prototype;return t.add=function add(t){var a=getPromiseWithAbort(t);return this.abortFns.push(a.abort),a.promise},t.clear=function clear(t){var a;forEach$1(a=this.abortFns).call(a,(function(a){return a(t||new Fu({code:Lu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function destroy(){this.clear()},PromiseManager}(),Mp={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},Tp={timestamp:0,rtt:0,baseClock:0,baseTime:0},Sp=function(){function TimeOrigin(t,a,c){void 0===c&&(c="getServerTime"),this.serverOrigin=Tp,this.config=Mp,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=t,this.logger=t.logger,this.promiseManager=new Ip,this.cmdName=c,a&&this.setOptions(a)}var t=TimeOrigin.prototype;return t.setOptions=function setOptions(t){this.config=qt({},Mp,this.config,t)},t.reset=function reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=Tp,this.currentChance=0},t.setOriginTimetick=function setOriginTimetick(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t,a,c,m,h,g,I,M,T,S;return Lc.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:if(this.config.enable){E.next=2;break}return E.abrupt("return");case 2:if(!this.isSettingNTP){E.next=4;break}return E.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){E.next=6;break}return E.abrupt("return");case 6:if(t=Rs(this.core,"auth.status"),a=Rs(this.core,"status"),c=Rs(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===a||c===eu.V2NIM_LOGIN_STATUS_LOGINED){E.next=11;break}return E.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,m="TimeOrigin::setOriginTimetick:",h=Ri(),this.core.logger.log(m+" getServerTime start, times "+this.currentChance),E.prev=18,E.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:I=E.sent,g=Rs(I,"content.time"),this.isSettingNTP=!1,E.next=33;break;case 26:return E.prev=26,E.t0=E.catch(18),M=E.t0,this.isSettingNTP=!1,this.logger.warn(m+" Calculate Delay time, getServerTime error",M),M.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=qi(bind$1(T=this.setOriginTimetick).call(T,this),this.failedDelay)),E.abrupt("return");case 33:if(g){E.next=37;break}return this.core.logger.warn(m+" Calculate Delay time incorrect format"),this.config.enable=!1,E.abrupt("return");case 37:S=Ri()-h,this.doSet(g,S);case 39:case"end":return E.stop()}}),_callee,this,[[18,26]])})))},t.doSet=function doSet(t,a){var c,m="TimeOrigin::setOriginTimetick:";if(a>this.config.tolerantRTT)this.logger.warn(m+" Denied, cause of exceeding the maximum tolerance range of RTT: "+a),this.timer=qi(bind$1(c=this.setOriginTimetick).call(c,this),this.failedDelay);else if(a>this.config.bestRTT){var h;this.serverOrigin.rtt&&a>=this.serverOrigin.rtt?this.logger.log(m+" Denied, cause of current.RTT >= serverOrigin.RTT: "+a):(this.setServerOrigin(a,t),this.logger.log(m+" Accept within maximum tolerance range of RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=qi(bind$1(h=this.setOriginTimetick).call(h,this),this.failedDelay)}else{var g;this.setServerOrigin(a,t),this.logger.log(m+" Accept within best RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=qi(bind$1(g=this.setOriginTimetick).call(g,this),this.successDelay)}},t.getNTPTime=function getNTPTime(t){if(void 0===t&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var a=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+a}return Ri()},t.checkNodeReliable=function checkNodeReliable(t){if(this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var a=t.clock-this.serverOrigin.baseClock,c=t.time-this.serverOrigin.baseTime;return Math.abs(c-a)<500}return!1},t.checkPerformance=function checkPerformance(){return"BROWSER"===_p.platform&&!("undefined"==typeof performance||!performance.now)},TimeOrigin.checkPerformance=function checkPerformance(){return"BROWSER"===_p.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Ri()}},TimeOrigin.getTimeNode=function getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:Ri()}},t.setServerOrigin=function setServerOrigin(t,a){this.serverOrigin={timestamp:a+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:Ri()}},TimeOrigin}();function _createForOfIteratorHelperLoose$b(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$b(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$b(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$b(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$b(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var Ep={},bp={};function createCmd(t,a,c,m){var h=Ep[t];if(!h)return c.error("createCmd:: can not find cmd config: ",t),null;var g,I={SER:a,SID:h.sid,CID:h.cid,Q:[]};h.params&&m&&forEach$1(g=h.params).call(g,(function(t){var a=m[t.name];if(null!=a){var c=t.type,h=t.reflectMapper,g=t.select;switch(t.type){case"PropertyArray":c="ArrayMable",a=map$6(a).call(a,(function(t){return{t:"Property",v:h?serialize(t,h,g):t}}));break;case"Property":a=h?serialize(a,h,g):a;break;case"Bool":a=a?"true":"false"}I.Q.push({t:c,v:a})}}));return{packet:I,hasPacketResponse:"boolean"!=typeof h.hasPacketResponse||h.hasPacketResponse,hasPacketTimer:"boolean"!=typeof h.hasPacketTimer||h.hasPacketTimer}}function parseCmd(t,a){var c,m;try{m=JSON.parse(t)}catch(c){return void a.error('Parse command error:"'+t+'"')}var h=m.sid+"_"+m.cid,g=m.r;if(includes(c=["4_1","4_2","4_10","4_11"]).call(c,h)){var I=m.r[1].headerPacket;h=I.sid+"_"+I.cid,m.sid=I.sid,m.cid=I.cid,g=m.r[1].body}var M=bp[h],T=[];if(M){for(var S,E=_createForOfIteratorHelperLoose$b(M);!(S=E()).done;){var b=S.value;T.push(parseEachCmd(m,b.config,b.cmd,g,a))}return T}a.error("parseCmd:: mapper not exist",h,m.code)}function parseEachCmd(t,a,c,m,h){var g,I={cmd:c,raw:t,error:null,service:null==a?void 0:a.service,content:{},__receiveTimeNode:Sp.getTimeNode()};if(!c||!a)return I.notFound=!0,I;a.sid>=26&&a.sid<100&&(t.code=function toReadableCode(t){if("number"!=typeof t)throw new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:t}});if(t>=0&&t<1e3)return t;if(t>=2e4&&t<=20099)return t;var a=(65535&t)>>9;a-=a<=38?1:2;return 1e5+1e3*a+(511&t)}(t.code));var M,T=function genCmdError(t,a){var c=Du[t],m=$u[t];return null===m?null:new Fu({code:t,desc:c||m||t,detail:{cmd:a,timetag:Ri()}})}(t.code,c);if(I.error=T,I.error){if(I.error.detail.cmd=c,!(null===(g=null==a?void 0:a.ignoreErrCodes)||void 0===g?void 0:includes(g).call(g,t.code)))return I;h.warn("parseCmd:: ignore error ",I.error),I.error.detail.ignore=!0}a.response&&forEach$1(M=a.response).call(M,(function(t,a){var c=m[a],h=t.type,g=t.name,M=t.reflectMapper;if(!zc(c))switch(h){case"Property":I.content[g]=M?deserialize(c,M):c;break;case"PropertyArray":I.content[g]=map$6(c).call(c,(function(t){return M?deserialize(t,M):t}));break;case"Int":case"Long":case"Byte":I.content[g]=+c;break;case"Bool":I.content[g]="true"===c||!0===c||1===c;break;default:I.content[g]=c}}));return I}function serialize(t,a,c){var m={};for(var h in t=function flattenObjByMapper(t,a){var c={};for(var m in a){for(var h,g=a[m],I="number"==typeof g?m:g.access?g.access:m,M=t,T=_createForOfIteratorHelperLoose$b(I.split("."));!(h=T()).done;){var S=h.value;if(void 0===M[S]||null===M[S]){M=void 0;break}M=M[S]}void 0!==M&&(c[I]=M)}return c}(t,a),a){var g=a[h],I="number"==typeof g?h:g.access?g.access:h;c&&!includes(c).call(c,h)||(I in t?"number"==typeof g?m[g]=t[I]:"object"==typeof g&&(g.converter?m[g.id]=g.converter(t[I],t):m[g.id]=t[I]):"object"==typeof g&&g.def&&("function"==typeof g.def?m[g.id]=g.def(t):m[g.id]=g.def))}return m}function deserialize(t,a){var c={};for(var m in t){var h=a[m];if("string"==typeof h)c[h]=t[m];else if("object"==typeof h&&"prop"in h){var g=h.access?h.access:h.prop;h.converter?c[g]=h.converter(t[m],t):h.type&&"number"===h.type?c[g]=+t[m]:h.type&&"boolean"===h.type?c[g]=!("0"===t[m]||!t[m]):c[g]=t[m]}}for(var I in a){var M=a[I];if(M&&void 0!==M.def){var T=M.access?M.access:M.prop;T in c||("function"==typeof M.def?c[T]=M.def(t):c[T]=M.def)}}return c=function unflattenObj(t){var a={},c=function _loop(c){var m=c.split(".");reduce(m).call(m,(function(a,h,g){return a[h]||(a[h]=isNaN(Number(m[g+1]))?m.length-1==g?t[c]:{}:[])}),a)};for(var m in t)c(m);return a}(c),c}function registerParser(t){for(var a in qt(Ep,t.cmdConfig),t.cmdMap){var c=t.cmdMap[a],m=t.cmdConfig[c];if(m)if(jc(bp[a])){for(var h,g=!1,I=_createForOfIteratorHelperLoose$b(bp[a]);!(h=I()).done;){var M=h.value;if(M.cmd===c&&M.config.service===m.service){g=!0;break}}g||bp[a].push({config:m,cmd:c})}else bp[a]=[{config:m,cmd:c}]}}function invertSerializeMap(t){var a,c={};return forEach$1(a=mn(t)).call(a,(function(a){c[a]=invertSerializeItem(t[a])})),c}function invertSerializeItem(t){var a={};for(var c in t){var m=t[c];"number"==typeof m?a[m]=c:"object"==typeof m&&(a[m.id]={prop:c,type:m.retType,access:m.retAccess?m.retAccess:m.access?m.access:c,def:m.retDef,converter:m.retConverter})}return a}function boolToInt(t){return t?1:0}function objectToJSONString(t){if(t&&"object"==typeof t)try{return Uc(t)}catch(t){return}}function stringToJSONObject(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return}}var Cp={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},Ap={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},Np=invertSerializeMap(Ap),Rp={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Ap.login}],response:[{type:"Property",name:"loginRes",reflectMapper:Np.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:Np.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:Np.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Np.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}},kp="\t\n\v\f\r                　\u2028\u2029\ufeff",wp=N("".replace),Op="["+kp+"]",Pp=RegExp("^"+Op+Op+"*"),xp=RegExp(Op+Op+"*$"),createMethod=function(t){return function(a){var c=toString$1(requireObjectCoercible(a));return 1&t&&(c=wp(c,Pp,"")),2&t&&(c=wp(c,xp,"")),c}},Vp={start:createMethod(1),end:createMethod(2),trim:createMethod(3)},Lp=Vp.trim,Dp=h.parseInt,Up=h.Symbol,Fp=Up&&Up.iterator,Bp=/^[+-]?0x/i,qp=N(Bp.exec),Gp=8!==Dp(kp+"08")||22!==Dp(kp+"0x16")||Fp&&!fails((function(){Dp(Object(Fp))}))?function parseInt(t,a){var c=Lp(toString$1(t));return Dp(c,a>>>0||(qp(Bp,c)?16:10))}:Dp;_export({global:!0,forced:parseInt!=Gp},{parseInt:Gp});var jp,Hp,$p,Yp,Wp,zp=H.parseInt;!function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(jp||(jp={})),function(t){t[t.p2p=0]="p2p",t[t.team=1]="team",t[t.superTeam=5]="superTeam"}(Hp||(Hp={})),function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}($p||($p={})),function(t){t[t.unread=1]="unread",t[t.read=2]="read",t[t.deleted=3]="deleted",t[t.sending=4]="sending",t[t.sendFailed=5]="sendFailed",t[t.sent=6]="sent",t[t.receipt=7]="receipt",t[t.refused=10]="refused"}(Yp||(Yp={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(Wp||(Wp={}));var Kp=Math.min,Qp=[].lastIndexOf,Jp=!!Qp&&1/[1].lastIndexOf(1,-0)<0,Xp=arrayMethodIsStrict("lastIndexOf"),Zp=Jp||!Xp?function lastIndexOf(t){if(Jp)return S(Qp,this,arguments)||0;var a=toIndexedObject(this),c=lengthOfArrayLike(a),m=c-1;for(arguments.length>1&&(m=Kp(m,toIntegerOrInfinity(arguments[1]))),m<0&&(m=c+m);m>=0;m--)if(m in a&&a[m]===t)return m||0;return-1}:Qp;_export({target:"Array",proto:!0,forced:Zp!==[].lastIndexOf},{lastIndexOf:Zp});var em=entryVirtual("Array").lastIndexOf,tm=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===tm||$(tm,t)&&a===tm.lastIndexOf?em:a},rm=Zr.findIndex,nm="findIndex",am=!0;nm in[]&&Array(1).findIndex((function(){am=!1})),_export({target:"Array",proto:!0,forced:am},{findIndex:function findIndex(t){return rm(this,t,arguments.length>1?arguments[1]:void 0)}});var im=entryVirtual("Array").findIndex,om=Array.prototype,findIndex$1=function(t){var a=t.findIndex;return t===om||$(om,t)&&a===om.findIndex?im:a},sm=ld(Object.keys,Object),cm=Object.prototype.hasOwnProperty;var lm=function baseKeys(t){if(!pd(t))return sm(t);var a=[];for(var c in Object(t))cm.call(t,c)&&"constructor"!=c&&a.push(c);return a};var um,dm=function keys$7(t){return Md(t)?$d(t):lm(t)},pm=up((function(t,a,c,m){Bd(a,dm(a),t,m)})),mm=(um=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return um()+um()+um()+um()+um()+um()+um()+um()});function getEnumKeys(t){var a;return filter(a=mn(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumValues(t){var a,c;return map$6(a=filter(c=mn(t)).call(c,(function(t){return+t>=0}))).call(a,(function(t){return zp(t)}))}function getEnumKeyByEnumValue(t,a){var c,m=filter(c=mn(t)).call(c,(function(c){return t[c]==a}));return m.length>0?m[0]:void 0}function getAccountFromSessionId(t,a){if(void 0===a&&(a="-"),!t)throw new Hu("No sessionId",{},400);var c=indexOf(t).call(t,a);if(-1===c)throw new Hu("Can not find conjunctions",{},400);var m=slice(t).call(t,0,c);return{accid:slice(t).call(t,c+1),scene:"super_team"===m?"superTeam":m}}function getMiniappEnv(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}function assignOptions(t,a){return pm({},t,a,(function(t,a){return zc(a)?t:a}))}function emptyFuncWithPromise(){return Mi.resolve()}function getFileExtension(t){var a=lastIndexOf(t).call(t,".");return a>-1?slice(t).call(t,a):""}function findIndexWithinTargetValue(t,a,c){return 0===t.length||t[0][a]<=c?0:t[t.length-1][a]>c?t.length:findIndex$1(t).call(t,(function(m,h){if(t[h-1]&&t[h-1][a]>c&&c>=m[a])return!0}))}var hm=entryVirtual("Array").values,fm=Array.prototype,gm={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===fm||$(fm,t)&&a===fm.values||de(gm,Mr(t))?hm:a};function format(t,a){if(!kd(a))return{};var c=JSON.parse(Uc(a)),m=doFormat(t,c);return JSON.parse(Uc(qt(qt({},c),m)))}function doFormat(t,a){if(!kd(a))return{};var c={},m=mn(t);return forEach$1(m).call(m,(function(m){var h=t[m].type;if("string"!=typeof h){var g=doFormat(t[m],a);mn(g).length>0&&(c[m]=g)}else{var I=t[m],M=I.rawKey||m,T=vm[h](a,M,I);void 0!==T&&(a[M]=void 0,c[m]=T)}})),c}var vm={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!kd(a))return{};var c=JSON.parse(Uc(a)),m=doFormatReverse(t,c);return JSON.parse(Uc(qt(qt({},c),m)))}function doFormatReverse(t,a){var c;if(!kd(a))return reduce(c=mn(t)).call(c,(function(a,c){return a[t[c].rawKey||c]=void 0,a}),{});var m={},h=mn(t);return forEach$1(h).call(h,(function(c){var h=t[c].type;if("string"!=typeof h){var g=doFormatReverse(t[c],a[c]);return qt(m,g),void(a[c]=void 0)}var I=t[c],M=I.rawKey||c,T=ym[h](a,c,I);a[M]=void 0,m[M]=T})),m}var ym={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,c){return values(c)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return Uc(t[a])}catch(t){return""}}},_m=ym;function formatMultiPortLoginInfo(t,a){return t&&t.length>0?map$6(t).call(t,(function(t){return qt(qt({},t),{account:t.account,connectionId:t.connectionId,deviceId:t.deviceId,ip:t.ip,mac:t.mac,os:t.os,type:getEnumKeyByEnumValue($p,t.type)||t.type,time:zp(t.time),online:3!==a})})):[]}var Im={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var Mm=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),c=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-c:t+c}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var Tm=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Sm=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,c=null==t?0:t.length;for(this.__data__=new fs;++a<c;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Tm,SetCache.prototype.has=Sm;var Em=SetCache;var bm=function baseFindIndex(t,a,c,m){for(var h=t.length,g=c+(m?1:-1);m?g--:++g<h;)if(a(t[g],g,t))return g;return-1};var Cm=function baseIsNaN(t){return t!=t};var Am=function strictIndexOf(t,a,c){for(var m=c-1,h=t.length;++m<h;)if(t[m]===a)return m;return-1};var Nm=function baseIndexOf(t,a,c){return a==a?Am(t,a,c):bm(t,Cm,c)};var Rm=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&Nm(t,a,0)>-1};var km=function arrayIncludesWith(t,a,c){for(var m=-1,h=null==t?0:t.length;++m<h;)if(c(a,t[m]))return!0;return!1};var wm=function cacheHas(t,a){return t.has(a)},Om=Go(uo,"Set");var Pm=function noop(){};var xm=function setToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=t})),c},Vm=Om&&1/xm(new Om([,-0]))[1]==1/0?function(t){return new Om(t)}:Pm,Lm=Vm;var Dm=function baseUniq(t,a,c){var m=-1,h=Rm,g=t.length,I=!0,M=[],T=M;if(c)I=!1,h=km;else if(g>=200){var S=a?null:Lm(t);if(S)return xm(S);I=!1,h=wm,T=new Em}else T=a?[]:M;e:for(;++m<g;){var E=t[m],b=a?a(E):E;if(E=c||0!==E?E:0,I&&b==b){for(var C=T.length;C--;)if(T[C]===b)continue e;a&&T.push(b),M.push(E)}else h(T,b,c)||(T!==M&&T.push(b),M.push(E))}return M};var Um=function uniq(t){return t&&t.length?Dm(t):[]},Fm=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Bm=["transport not supported","client not handshaken","unauthorized"],qm=["reconnect"],Gm=function(t){function BaseWebsocket(a,c){var m;return(m=t.call(this)||this).url=c,m.websocket=null,m.socketConnectTimer=0,m.core=a,m.url=c,m.status="disconnected",m.logger=a.logger,m.connect(),m}wt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+Ri(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(a){if("connecting"===t.status){var c=a.data.split(":"),m=c[0];return c[1],t.sessionId=m,t.logger.log("imsocket::XHR success. status "+t.status+", "+("connecting"===t.status?"continue websocket connection":"stop websocket connection")),t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+m)}})).catch((function(a){if("connecting"===t.status){var c='imsocket::XHR fail. raw message: "'+(a=a||{}).message+'", code: "'+a.code+'"',m=a.code;m="v2"===Rs(t.core,"options.apiVersion")?a.code===Lu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Lu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Lu.V2NIM_ERROR_CODE_CONNECT_FAILED:408===a.code?408:415;var h=new Fu({code:m,detail:{reason:c,rawError:a}});t.logger.error(c),t.status="disconnected",t.emit("handshakeFailed",h)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t){this.logger.warn("imsocket::attempt to send encodePacket error",t)}try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=qi((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("handshakeFailed",new Fu({code:"v2"===Rs(c.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new _p.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(t){var a=(null==t?void 0:t.reason)||(null==t?void 0:t.message)||(null==t?void 0:t.errMsg)||"websocket.onclose";c.logger.log("imsocket::Websocket onclose done. code is "+(null==t?void 0:t.code)+" and reason is "+a),c.clean(),c.emit("disconnect",{code:(null==t?void 0:t.code)||0,reason:a})},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"logined"===c.core.status&&c.core.clientSocket.ping()}},a.onMessage=function onMessage(t){var a,c=this.decodePacket(t.data);if(c)switch(c.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",c.data);break;case"event":c.name&&this.emit(c.name,c.args);break;case"error":"unauthorized"===c.reason?this.emit("connect_failed",c.reason):this.emit("error",c.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new Fu({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",c.type)}},a.encodePacket=function encodePacket(t){var a,c,m=t.type,h=t.id,g=void 0===h?"":h,I=t.endpoint,M=void 0===I?"":I,T=t.ack,S=null;if(!m)return"";switch(m){case"error":a=t.reason?indexOf(Bm).call(Bm,t.reason):"",c=t.advice?indexOf(qm).call(qm,t.advice):"",""===a&&""===c||(S=a+(""!==c?"+"+c:""));break;case"message":""!==t.data&&(S=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},S=Uc(a);break;case"json":S=Uc(t.data);break;case"connect":t.qs&&(S=t.qs);break;case"ack":S=t.ackId+(t.args&&t.args.length?"+"+Uc(t.args):"")}var E=[indexOf(Fm).call(Fm,m),g+("data"===T?"+":""),M];return null!=S&&E.push(S),E.join(":")},a.decodePacket=function decodePacket(t){if(t)if("�"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var c,m=a[1],h=a[2],g=a[3],I=a[4],M=a[5],T={type:Fm[+m],endpoint:I};switch(h&&(T.id=h,T.ack=!g||"data"),T.type){case"error":c=M.split("+"),T.reason=Bm[+c[0]]||"";break;case"message":T.data=M||"";break;case"connect":T.qs=M||"";break;case"event":try{var S=JSON.parse(M);T.name=S.name,T.args=S.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}T.args=T.args||[];break;case"json":try{T.data=JSON.parse(M)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((c=M.match(/^([0-9]+)(\+)?(.*)/))&&(T.ackId=c[1],T.args=[],c[3]))try{T.args=c[3]?JSON.parse(c[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return T}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))},a.send=function send(t){var a,c={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(c))},BaseWebsocket}(Gi),jm=Zr.every,Hm=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Hm},{every:function every(t){return jm(this,t,arguments.length>1?arguments[1]:void 0)}});var $m=entryVirtual("Array").every,Ym=Array.prototype,every=function(t){var a=t.every;return t===Ym||$(Ym,t)&&a===Ym.every?$m:a};var Wm=function baseIsRegExp(t){return To(t)&&"[object RegExp]"==Mo(t)},zm=xd&&xd.isRegExp,Km=zm?Pd(zm):Wm;var Qm=function baseDifference(t,a,c,m){var h=-1,g=Rm,I=!0,M=t.length,T=[],S=a.length;if(!M)return T;c&&(a=Ms(a,Pd(c))),m?(g=km,I=!1):a.length>=200&&(g=wm,I=!1,a=new Em(a));e:for(;++h<M;){var E=t[h],b=null==c?E:c(E);if(E=m||0!==E?E:0,I&&b==b){for(var C=S;C--;)if(a[C]===b)continue e;T.push(E)}else g(a,b,m)||T.push(E)}return T},Jm=cp((function(t,a){return Td(t)?Qm(t,a):[]})),Xm=Jm;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,c,m){var h;void 0===a&&(a={}),void 0===m&&(m=!1);var g={};return forEach$1(h=mn(t)).call(h,(function(h){var I=t[h].type,M=c?"In "+c+", ":"";if(null==a){var T=M+"param is null or undefined";throw m?new qu({detail:{reason:T,data:{key:h},rules:"required"}}):new Bu(T,{key:h},"required")}if(void 0===a[h]){if(!1===t[h].required)return void(g[h]=a[h]);var S=M+"param '"+h+"' is required";throw m?new qu({detail:{reason:S,data:{key:h},rules:"required"}}):new Bu(S,{key:h},"required")}var E=Zm[I];if(E&&!E(a,h,t[h],m)){var b=M+"param '"+h+"' unexpected",C={key:h,value:a[h]};throw m?new qu({detail:{reason:b,data:C,rules:Uc(t[h],replacer)}}):new Bu(b,C,Uc(t[h],replacer))}g[h]=a[h]})),g}var Zm={string:function string(t,a,c){var m=c.allowEmpty,h=c.max,g=c.min,I=c.regExp,M=t[a];return"string"==typeof M&&((!1!==m||""!==M)&&(!("number"==typeof h&&M.length>h)&&(!("number"==typeof g&&M.length<g)&&!(Km(I)&&!I.test(M)))))},number:function number(t,a,c){var m=c.min,h=c.max,g=t[a];return"number"==typeof g&&(!("number"==typeof m&&g<m)&&!("number"==typeof h&&g>h))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},file:function file(t,a){return!0},enum:function _enum(t,a,c){var m=values(c),h=t[a];return!m||indexOf(m).call(m,h)>-1},func:function func(t,a){return"function"==typeof t[a]},array:function array(t,a,c,m){var h;void 0===m&&(m=!1);var g=c.itemType,I=c.rules,M=c.min,T=c.max,S=values(c),E=t[a];return!!jc(E)&&(!("number"==typeof T&&E.length>T)&&(!("number"==typeof M&&E.length<M)&&(!(g&&"enum"!==g&&!every(E).call(E,(function(t){return typeof t===g})))&&(("enum"!==g||!S||!Xm.apply(void 0,concat(h=[E]).call(h,S)).length)&&(I&&forEach$1(E).call(E,(function(t,c){return validate(I,t,a+"["+c+"]",m)})),!0)))))},object:function object(t,a,c,m){void 0===m&&(m=!1);var h=c.rules,g=c.allowEmpty,I=t[a];if("object"!=typeof I||null===I)return!1;if(h){var M=mn(h),T=mn(I),S=filter(T).call(T,(function(t){return indexOf(M).call(M,t)>-1}));if(!1===g&&0===S.length)return!1;validate(h,I,a,m)}return!0}};function validateConversationId(t,a){if(!t)throw new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE});validate({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+t+"\\|[1-3]\\|")}},{conversationId:a},"",!0)}var eh,th="weblink.netease.im:443",rh=["https://lbs.netease.im/lbs/webconf.jsp"],nh="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",ah="imElite_sdk_abtest_web";function _createForOfIteratorHelperLoose$a(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$a(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$a(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$a(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$a(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(eh||(eh={}));var ih=function(){function V1ClientSocket(t,a){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Mm({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Il,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,a&&(this.auth=a),this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager}var t=V1ClientSocket.prototype;return t.setSessionId=function setSessionId(t){},t.connect=function connect(t,a){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I,M;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.core.status)){T.next=5;break}return c="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(c),T.abrupt("return",Mi.reject(c));case 5:this.core.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(m=t.linkUrls).call(m,this.linkUrls),this.linkUrls=Um(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(th),h=0;case 9:if(!(h<this.linkUrls.length)){T.next=31;break}return g=this.linkUrls[h],I=(new Date).getTime(),T.prev=12,T.next=15,this.doConnect(g);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+g),T.abrupt("return",g);case 20:T.prev=20,T.t0=T.catch(12),M=T.t0,a&&a(M,g),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:I,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof M.code?M.code:0,description:M.message||""+M.code,operation_type:0,target:g},{asyncParams:_p.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+g,T.t0);case 28:h++,T.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(eh.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(eh.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return T.stop()}}),_callee,this,[[12,20]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new Gm(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV1::on connect",t),a.core.reporterHookLinkKeep&&(a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"",operation_type:0,target:t})),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",m),!this.core.reporterHookLinkKeep){a.next=5;break}return a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:c=!0,this.doDisconnect(eh.OFFLINE,"SocketOnDisconnect");case 7:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientsocketV1::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function beforeConnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a,c){var m,h,g,I,M;if(this.logger.log("doDisconnect: type "+t+", description "+a),"unconnected"!==this.core.status){var T={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Fu({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:T}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var S=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(t===eh.ACTIVE||S)this.logger.log("doDisconnect: emit disconnect, type "+t,S),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(m=this.auth)||void 0===m||m.emit("disconnect"),this.destroyOnlineListener();else if(t===eh.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var E="string"==typeof a?{reason:"unknow",message:a}:a;this.core.eventBus.emit("kicked",E),this.core.emit("kicked",E),null===(h=this.auth)||void 0===h||h.emit("kicked",E),this.destroyOnlineListener()}else t===eh.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):t===eh.OFFLINE&&(null===(I=null===(g=this.auth)||void 0===g?void 0:g.authenticator)||void 0===I?void 0:I.checkLoginTerminalCode(null==c?void 0:c.code))?(this.logger.log("doDisconnect: login terminal code "+(null==c?void 0:c.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(M=this.auth)||void 0===M||M.emit("disconnect")):t===eh.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function attempToReconnect(){var t,a,c=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(t=this.auth)||void 0===t||t.emit("disconnect"));var m=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+m),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:m}),null===(a=this.auth)||void 0===a||a.emit("willReconnect",{retryCount:this.retryCount,duration:m}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=qi((function(){return __awaiter(c,void 0,void 0,Lc.mark((function _callee3(){var t=this;return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if("waitReconnect"===this.core.status){a.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),a.abrupt("return");case 3:return a.next=5,_p.net.getNetworkStatus();case 5:!1===a.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(eh.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return a.stop()}}),_callee3,this)})))}),m)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function sendCmd(t,a,c){var m=this;if("logined"!==this.core.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+t),Mi.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return Mi.reject("No_socket");var h="heartbeat"!==t,g=h?this.packetSer++:0,I=createCmd(t,g,this.logger,a);if(!I){var M="SendCmd "+g+" "+t+" error";return this.logger.error(M),Mi.reject(new Error(M))}var T=I.packet,S=I.hasPacketResponse,E=I.hasPacketTimer,b=Uc(T);h&&("debug"===this.core.options.debugLevel?this.logger.debug("clientsocketV1::sendCmd",t,"ser:"+g,b):this.logger.log("clientsocketV1::sendCmd",t,"ser:"+g));var C=(new Date).getTime();return new Mi((function(h,I){S&&m.sendingCmdMap.set(g,{cmd:t,params:a,callback:[h,I],timer:E?qi((function(){var a=new Fu({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:t,ser:g,timetag:Ri()}});m.markCmdInvalid(g,a,t)}),c&&c.timeout?c.timeout:m.core.config.timeout):null});try{m.socket.send(b),S||h(T)}catch(a){var M=new Fu({code:415,detail:{reason:a&&a.message||"Unable to send packet",cmd:t,ser:g,timetag:Ri(),rawError:a}});m.markCmdInvalid(g,M,t),I(a)}})).catch((function(t){var a,c=[408,415];if(!includes(c).call(c,t.code))return Mi.reject(t);m.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account,trace_id:null===(a=m.socket)||void 0===a?void 0:a.sessionId,start_time:C,action:2,exception_service:6});var h=Rs(t,"data.disconnect_reason")||"",g=408===t.code?"Send failed due to timeout":"Send failed. Reason unknown";return g=415===t.code?Uc({disconnect_reason:h}):g,m.reporter.reportTraceUpdateV2("exceptions",{code:t.code||415,description:g,operation_type:1,target:T.SID+"-"+T.CID,context:""+T.SER},{asyncParams:_p.net.getNetworkStatus()}),m.reporter.reportTraceEnd("exceptions",1),Mi.reject(t)}))},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,m=_createForOfIteratorHelperLoose$a(a);!(c=m()).done;){var h=c.value,g=h.raw.ser;if(h.error&&this.logger.error("core:onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+g+",",h.error),h.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+g);"heartbeat"!==h.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+g,h.cmd,h.content):this.logger.log("imsocket::recvCmd ser:"+g,h.cmd)),this.packetHandler(h)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",t.service,t.cmd),g[0]())}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug('markAllCmdInvaild:: cmd "'+g+'"'),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a=this;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=18;break;case 6:return c.prev=6,c.t0=c.catch(1),c.next=10,this.testHeartBeat5Timeout();case 10:if(!c.sent){c.next=18;break}if(!this.core.reporterHookLinkKeep){c.next=16;break}return c.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(eh.OFFLINE,"PingError"),c.abrupt("return");case 18:this.pingTimer=qi((function(){a.ping()}),3e4);case 19:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var t;return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,_p.net.onNetworkStatusChange((function(a){t.logger.log("clientsocketV1::onlineListener:network change",a),a.isConnected&&"logined"===t.core.status?t.ping():a.isConnected&&"waitReconnect"===t.core.status?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),t.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}))):a.isConnected||t.doDisconnect(eh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientsocketV1::onlineListener:destroy"),_p.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function disconnect(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(eh.ACTIVE,"UserActiveDisconnect"),Mi.resolve();default:return Mi.resolve()}},V1ClientSocket}(),oh=function(){function V1NIMLoginLbs(t){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=t,this.auth=t.V1NIMLoginService,this.logger=this.core.logger}var t=V1NIMLoginLbs.prototype;return t.getLbsInfos=function getLbsInfos(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t,a,c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),h.abrupt("return",Mi.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),a=Um(this.auth.config.lbsUrls),h.prev=7,h.next=10,this.ladderLoad(a);case 10:if(200===(c=h.sent).status&&c.data){h.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",c.status,c),new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+c.status}});case 14:this.success(c),h.next=25;break;case 17:if(h.prev=17,h.t0=h.catch(7),m=h.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(a[0],m.code,m.message),!this.checkTerminator(m.code)){h.next=24;break}throw h.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return h.abrupt("return",this.socketLinkUrls);case 26:case"end":return h.stop()}}),_callee,this,[[7,17]])})))},t.checkTerminator=function checkTerminator(t){return t===Lu.V2NIM_ERROR_CODE_CANCELLED||t===Lu.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function generateUrl(t){return t+(indexOf(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function requstLbs(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function setLadderTimer(t,a,c,m){var h=this;this.timer&&clearTimeout(this.timer);var g=t[a];this.timer=qi((function(){g&&(h.setLadderTimer(t,a+1,c,m),h.core.logger.log("V1NIMLoginService::getLbsInfos "+a+":",g),h.reportForLbsStart(g,a),h.requstLbs(g).then((function(t){h.reset(),c(qt(qt({},t),{url:g}))})).catch((function(c){var I;if(h.core.logger.warn("V1NIMLoginService::getLbsInfos "+a+" failed:",c),h.failedCount+=1,h.reportForFailOnce(g,c.code,(null===(I=c.detail)||void 0===I?void 0:I.reason)||c.message),h.failedCount>=t.length||h.checkTerminator(c.code))return h.reset(),void m(c)})))}),2e3)},t.ladderLoad=function ladderLoad(t){var a=this;return new Mi((function(c,m){t.length>1&&a.setLadderTimer(t,1,c,m);var h=t[0];a.core.logger.log("V1NIMLoginService::getLbsInfos 0:",h),a.reportForLbsStart(h,0),a.requstLbs(h).then((function(t){a.reset(),c(qt(qt({},t),{url:h}))})).catch((function(c){var g;a.failedCount+=1,a.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",c),a.reportForFailOnce(h,c.code,(null===(g=c.detail)||void 0===g?void 0:g.reason)||c.message),(a.failedCount>=t.length||a.checkTerminator(c.code))&&(a.reset(),m(c))}))}))},t.success=function success(t){var a,c,m,h=t.data,g=[this.auth.config.linkUrl];Rs(h,"common.link")&&(g=concat(m=Rs(h,"common.link")).call(m,g));Rs(h,'common["link.default"]')&&(g=concat(g).call(g,Rs(h,'common["link.default"]'))),this.socketLinkUrls=Um(g),h["nos-chunk"]&&(null===(c=this.core.cloudStorage)||void 0===c?void 0:c.setOptions)&&this.core.cloudStorage.setOptions({chunkUploadHost:h["nos-chunk"]}),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",slice(a=this.socketLinkUrls).call(a,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},t.reportForLbsStart=function reportForLbsStart(t,a){this.core.reporterHookLBS.updateBegin({target:t,index:a})},t.reportForLbsSuccess=function reportForLbsSuccess(t,a){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:Uc(a)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:_p.net.getNetworkStatus()})},t.reportForFailOnce=function reportForFailOnce(t,a,c){this.core.reporterHookLBS.updateComplete({target:t,code:a,body:c})},t.reportForFail=function reportForFail(t,a,c){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:c,code:a,succeed:!1},{asyncParams:_p.net.getNetworkStatus()})},t.reset=function reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},V1NIMLoginLbs}(),sh=function(){function V1NIMLoginAuthenticator(t){this.core=t}var t=V1NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){var a,c,m;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var h,g,I,M,T,S,E,b,C,A,N,R;return Lc.wrap((function _callee$(k){for(;;)switch(k.prev=k.next){case 0:return g=this.core.options,I=_p.getSystemInfo(),M=qt(qt({},g),{appLogin:t?0:1,appkey:g.appkey,account:g.account,token:g.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100207,sdkHumanVersion:"10.2.700",os:I.os,browser:I.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.2.700":slice(h=I.userAgent).call(h,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:I.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:I.hostEnvEnum}),T=I.os.toLowerCase(),"UNIAPP"!==_p.platform||"ios"!==T&&"android"!==T||(M.isReactNative=1,M.clientType="ios"===T?2:1,S=!!(null===(a=this.core.offlinePush.authConfig)||void 0===a?void 0:a.honorCertificateName),I.pushDeviceInfo&&I.pushDeviceInfo.MANUFACTURER&&(M.deviceInfo=Uc(qt({IS_SUPPORT_HONOR:S},I.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",g.account,null===(m=null===(c=this.core.clientSocket)||void 0===c?void 0:c.socket)||void 0===m?void 0:m.sessionId),k.next=8,this.core.clientSocket.sendCmd("login",{login:M});case 8:if(!(E=k.sent).error){k.next=11;break}throw E.error;case 11:return b=E.content,C=b.loginRes,A=b.loginPorts,N=b.aosPushInfo,R=formatMultiPortLoginInfo(A,2),(R=filter(R).call(R,(function(t){return t.connectionId!==C.connectionId}))).length>0&&this.core.emit("multiPortLogin",R),k.abrupt("return",qt(qt({},C),{aosPushInfo:N}));case 16:case"end":return k.stop()}}),_callee,this)})))},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){if(void 0===t)return!1;var a=[201,302,317,403,404,417,422];return includes(a).call(a,t)},V1NIMLoginAuthenticator}(),ch=function(t){function V2Service(a,c){var m;return(m=t.call(this)||this).name=a,m.logger=c.logger,m.core=c,m}wt(V2Service,t);var a=V2Service.prototype;return a.checkV2=function checkV2(){var t=this.core.options.apiVersion;if("v2"===t)return!0;throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+t+'" of client is not supported.'}})},a.emit=function emit(a){var c=this;try{for(var m,h,g=arguments.length,I=new Array(g>1?g-1:0),M=1;M<g;M++)I[M-1]=arguments[M];this.logger.debug(this.name+'::emit event: "'+a.toString()+'",',void 0!==I[0]?I[0]:"",void 0!==I[1]?I[1]:"",void 0!==I[2]?I[2]:"");var T=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,I));return T}catch(t){return qi((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a){if(t.error)return this.logger.error(t.cmd+"::recvError",t.error),Mi.reject(t.error);try{var c=a.call(this,t);return Mi.resolve(c)}catch(t){return Mi.reject(t)}}var m=Rs(t,"error.detail.ignore");return t.error&&!m?Mi.reject(t.error):Mi.resolve(t)},V2Service}(Gi),lh={needReconnect:!0,reconnectionAttempts:Ot,lbsUrls:rh,linkUrl:th,xhrConnectTimeout:8e3,socketConnectTimeout:8e3},uh=function(t){function V1NIMLoginServiceImpl(a,c){var m;(m=t.call(this,"V1NIMLoginService",a)||this).account="",m.token="",m.deviceId="",m.clientSession="",m.status="unconnected",m.config=lh,m.isManualLoginAttempt=!1,registerParser({cmdMap:Cp,cmdConfig:Rp}),a.V1NIMLoginService=Qe(m),c&&m.setOptions(c);var h=new ih(m.core,Qe(m));return m.clientSocket=h,"v1"===m.core.options.apiVersion&&(m.core.clientSocket=h,m.core.auth=Qe(m)),m.lbs=new oh(a),m.authenticator=new sh(a),m.doLoginStepsManager=new Ip,m}wt(V1NIMLoginServiceImpl,t);var a=V1NIMLoginServiceImpl.prototype;return a.reset=function reset(){this.lbs.reset()},a.setOptions=function setOptions(t){t&&mn(t).length>0?(this.config=assignOptions(this.config,t),this.account=t.account||this.core.options.account,this.token=t.token||this.core.options.token,this.core.options=qt(qt({},this.core.options),this.config)):(this.config=assignOptions(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token);var a="",c="";this.config.isFixedDeviceId?(a=_p.localStorage.getItem("__NIM_DEVC_ID__")||mm(),c=_p.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||mm(),_p.localStorage.setItem("__NIM_DEVC_ID__",a),_p.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",c)):(a=mm(),c=mm()),this.deviceId=a,this.clientSession=c,this.core.reporter.setConfig({common:{dev_id:a}})},a.connect=function connect(t){return void 0===t&&(t={}),this.login(t)},a.login=function login(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkApiVersion(),t.isAutoReconnect||(this.isManualLoginAttempt=!0),a.next=4,this._connect(t);case 4:return this.core.abtest.abtRequest(),a.prev=5,a.next=8,this.doLogin(t.isAutoReconnect);case 8:this.isManualLoginAttempt=!1,a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(5),this.isManualLoginAttempt=!1,a.t0;case 15:case"end":return a.stop()}}),_callee,this,[[5,11]])})))},a._connect=function _connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h=this;return Lc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){g.next=4;break}return a="NIM status is "+this.core.status+", and would not connect",this.logger.warn(a),g.abrupt("return",Mi.reject(a));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:t.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Uc(qt(qt({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:_p.net.getNetworkStatus()}),g.next=10,this.lbs.getLbsInfos();case 10:return c=g.sent,g.prev=11,g.next=14,this.clientSocket.connect({linkUrls:c,isAutoReconnect:t.isAutoReconnect},(function(t,a){h.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:a,code:t.code||408,description:"ws_handshake_failed:"+t.message,succeed:!1},{asyncParams:_p.net.getNetworkStatus()})}));case 14:(m=g.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:m,code:200,succeed:!0},{asyncParams:_p.net.getNetworkStatus()}),g.next=22;break;case 18:throw g.prev=18,g.t0=g.catch(11),this.core.reporter.reportTraceEnd("login",!1),g.t0;case 22:case"end":return g.stop()}}),_callee2,this,[[11,18]])})))},a.doLogin=function doLogin(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h;return Lc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.authenticator.verifyAuthentication(t);case 3:a=g.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:_p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",g.next=21;break;case 9:if(g.prev=9,g.t0=g.catch(0),c=g.t0,m=Rs(c,"data.disconnect_reason")||"",h=415===c.code?Uc({disconnect_reason:m}):c.message,this.core.logger.warn("nim login:: login failed",g.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:c.code||0,succeed:!1,description:h},{asyncParams:_p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(eh.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",g.t0),!this.isManualLoginAttempt){g.next=20;break}throw g.t0;case 20:return g.abrupt("return");case 21:return g.prev=21,g.next=24,this.core.cloudStorage.init();case 24:g.next=29;break;case 26:g.prev=26,g.t1=g.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",g.t1);case 29:this.core.eventBus.emit("logined",a),this.core.emit("logined",a),this.emit("logined",a),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 35:case"end":return g.stop()}}),_callee3,this,[[0,9],[21,26]])})))},a.disconnect=function disconnect(){return this.logout()},a.logout=function logout(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),t.t0=this.status,t.next="logined"===t.t0?5:"connected"===t.t0||"connecting"===t.t0||"waitReconnect"===t.t0?18:"unconnected"===t.t0||"destroyed"===t.t0?21:22;break;case 5:return t.prev=5,t.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(eh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.next=17;break;case 12:t.prev=12,t.t1=t.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",t.t1),this.clientSocket.doDisconnect(eh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return t.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(eh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),t.abrupt("return",Mi.resolve());case 21:return t.abrupt("return",Mi.resolve());case 22:case"end":return t.stop()}}),_callee4,this,[[5,12]])})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var c;return Lc.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this._checkApiVersion(),m.next=3,this.clientSocket.sendCmd("kick",t);case 3:return c=m.sent,m.abrupt("return",null===(a=c.content)||void 0===a?void 0:a.deviceIds);case 5:case"end":return m.stop()}}),_callee5,this)})))},a._checkApiVersion=function _checkApiVersion(){if("v1"!==this.core.options.apiVersion)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){if(t.error)this.logger.error("nimLoginClientChangeHandler:: error, ",t.error);else{var a=t.content,c=formatMultiPortLoginInfo(a.datas,a.state);c.length>0&&(this.core.emit("multiPortLogin",c),this.emit("multiPortLogin",c))}},a.kickedHandler=function kickedHandler(t){if(t.error)this.logger.error("kickedHandler:: error, ",t.error);else{var a=function formatBeKickedTag$1(t){var a=format({clientType:{type:"enum",values:$p},customClientType:{type:"number"}},t),c=Im[a.reason];return qt(a,c=c||{reason:"unknow",message:"Unknown reason"})}(t.content);this.logger.warn("kicked::",a),this.clientSocket.doDisconnect(eh.KICKED,a),this.core._clearModuleData()}},a.getConnectStatus=function getConnectStatus(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},a.getLoginStatus=function getLoginStatus(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},a.getLoginUser=function getLoginUser(){return this.core.options.account},V1NIMLoginServiceImpl}(ch);function formatLoginInfo(t){return format({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timetag:{type:"number"},loginType:{type:"number"}},t)}var dh=TypeError,ph=Object.getOwnPropertyDescriptor,mh=R&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(Fr(t)&&!ph(t,"length").writable)throw dh("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},fh=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw fh("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},gh=arrayMethodHasSpeciesSupport("splice"),vh=Math.max,yh=Math.min;_export({target:"Array",proto:!0,forced:!gh},{splice:function splice(t,a){var c,m,h,g,I,M,T=toObject(this),S=lengthOfArrayLike(T),E=toAbsoluteIndex(t,S),b=arguments.length;for(0===b?c=m=0:1===b?(c=0,m=S-E):(c=b-2,m=yh(vh(toIntegerOrInfinity(a),0),S-E)),doesNotExceedSafeInteger(S+c-m),h=arraySpeciesCreate(T,m),g=0;g<m;g++)(I=E+g)in T&&createProperty(h,g,T[I]);if(h.length=m,c<m){for(g=E;g<S-m;g++)M=g+c,(I=g+m)in T?T[M]=T[I]:deletePropertyOrThrow(T,M);for(g=S;g>S-m+c;g--)deletePropertyOrThrow(T,g-1)}else if(c>m)for(g=S-m;g>E;g--)M=g+c-1,(I=g+m-1)in T?T[M]=T[I]:deletePropertyOrThrow(T,M);for(g=0;g<c;g++)T[g+E]=arguments[g+2];return mh(T,S-m+c),h}});var _h=entryVirtual("Array").splice,Ih=Array.prototype,splice$1=function(t){var a=t.splice;return t===Ih||$(Ih,t)&&a===Ih.splice?_h:a};function _createForOfIteratorHelperLoose$9(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$9(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$9(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$9(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$9(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var Mh=function(){function TimerManager(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,c){void 0===a&&(a=0),void 0===c&&(c=1);var m=(new Date).getTime(),h=this.id;return this.timerList.push({id:h,loop:c,count:0,timeout:m+a,interval:a,callback:t}),this.id++,this.checkTimer(m),h},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,c,m=0,h=_createForOfIteratorHelperLoose$9(this.timerList);!(a=h()).done;){var g=a.value;(0===m||m>g.timeout)&&(m=g.timeout)}if(0!==this.timerList.length)if(null===this.timer||m<this.timeout||this.timeout<t)this.timer=qi(bind$1(c=this.nowTime).call(c,this),m-t),this.timeout=m}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$9(this.timerList);!(t=a()).done;){var c=t.value;nowTime>=c.timeout&&(c.callback(),c.count++,c.timeout=nowTime+c.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var c;if(this.timerList[a].id===t)splice$1(c=this.timerList).call(c,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,c=this.timerList[t];if(c.loop>=0&&c.count>=c.loop)splice$1(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},TimerManager}();var Th=function baseForOwn(t,a){return t&&td(t,a,dm)};var Sh=function baseInverter(t,a,c,m){return Th(t,(function(t,h,g){a(m,c(t),h,g)})),m};var Eh=function createInverter(t,a){return function(c,m){return Sh(c,t,a(m),{})}},bh=Object.prototype.toString,Ch=Eh((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=bh.call(a)),t[a]=c}),np(Zd)),Ah={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},Nh={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},Rh={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,ip:3,port:4,type:5,customClientType:6,timetag:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,ip:103,port:104,timetag:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,ip:103,port:104,type:6,customClientType:13,timetag:105,os:30,pushType:100,hasTokenPreviously:101}},kh={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:Rh.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:Ch(Rh.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:Ch(Rh.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Ch(Rh.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},wh={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Ch(Rh.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:Ch(Rh.qchatAuthRepTag)}]}},Oh=fi.codeAt;_export({target:"String",proto:!0},{codePointAt:function codePointAt(t){return Oh(this,t)}});var Ph=entryVirtual("String").codePointAt,xh=String.prototype,codePointAt=function(t){var a=t.codePointAt;return"string"==typeof t||t===xh||$(xh,t)&&a===xh.codePointAt?Ph:a},Vh=RangeError,Lh=String.fromCharCode,Dh=String.fromCodePoint,Uh=N([].join),Fh=!!Dh&&1!=Dh.length;_export({target:"String",stat:!0,arity:1,forced:Fh},{fromCodePoint:function fromCodePoint(t){for(var a,c=[],m=arguments.length,h=0;m>h;){if(a=+arguments[h++],toAbsoluteIndex(a,1114111)!==a)throw Vh(a+" is not a valid code point");c[h]=a<65536?Lh(a):Lh(55296+((a-=65536)>>10),a%1024+56320)}return Uh(c,"")}});var Bh=H.String.fromCodePoint,qh=function abs(t){var a;if(void 0!==t)return(a=BigNumber(t)).sign=1,a},Gh=function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)},jh=function isValidType(t){var a;return some(a=["number"==typeof t,"string"==typeof t&&t.length>0,Gh(t)&&t.length>0,t instanceof BigNumber]).call(a,(function(t){return!0===t}))},Hh="Invalid Number",$h="Invalid Number - Division By Zero";function BigNumber(t){var a;if(!(this instanceof BigNumber))return new BigNumber(t);if(this.number=[],this.sign=1,this.rest=0,jh(t)){if(Gh(t)){for((t.length&&"-"===t[0]||"+"===t[0])&&(this.sign="+"===t[0]?1:-1,t.shift(0)),a=t.length-1;a>=0;a--)if(!this.addDigit(t[a]))return}else for("-"!==(t=t.toString()).charAt(0)&&"+"!==t.charAt(0)||(this.sign="+"===t.charAt(0)?1:-1,t=t.substring(1)),a=t.length-1;a>=0;a--)if(!this.addDigit(zp(t.charAt(a),10)))return}else this.number=Hh}BigNumber.prototype.addDigit=function(t){return function testDigit(t){return/^\d$/.test(t)}(t)?(this.number.push(t),this):(this.number=Hh,!1)},BigNumber.prototype._compare=function(t){var a,c;if(!jh(t))return null;if(a=BigNumber(t),this.sign!==a.sign)return this.sign;if(this.number.length>a.number.length)return this.sign;if(this.number.length<a.number.length)return-1*this.sign;for(c=this.number.length-1;c>=0;c--){if(this.number[c]>a.number[c])return this.sign;if(this.number[c]<a.number[c])return-1*this.sign}return 0},BigNumber.prototype.gt=function(t){return this._compare(t)>0},BigNumber.prototype.gte=function(t){return this._compare(t)>=0},BigNumber.prototype.equals=function(t){return 0===this._compare(t)},BigNumber.prototype.lte=function(t){return this._compare(t)<=0},BigNumber.prototype.lt=function(t){return this._compare(t)<0},BigNumber.prototype.subtract=function(t){var a;return void 0===t?this:(a=BigNumber(t),this.sign!==a.sign?(this.number=BigNumber._add(this,a),this):(this.sign=this.lt(a)?-1:1,this.number=qh(this).lt(qh(a))?BigNumber._subtract(a,this):BigNumber._subtract(this,a),this))},BigNumber._add=function(t,a){var c,m=0,h=Math.max(t.number.length,a.number.length);for(c=0;c<h||m>0;c++)t.number[c]=(m+=(t.number[c]||0)+(a.number[c]||0))%10,m=Math.floor(m/10);return t.number},BigNumber._subtract=function(t,a){var c,m,h=0,g=t.number.length;for(c=0;c<g;c++)t.number[c]-=(a.number[c]||0)+h,t.number[c]+=10*(h=t.number[c]<0?1:0);for(c=0,g=t.number.length-1;0===t.number[g-c]&&g-c>0;)c++;c>0&&splice$1(m=t.number).call(m,-c);return t.number},BigNumber.prototype.multiply=function(t){if(void 0===t)return this;var a,c,m=BigNumber(t),h=0,g=[];if(this.isZero()||m.isZero())return BigNumber(0);for(this.sign*=m.sign,a=0;a<this.number.length;a++)for(h=0,c=0;c<m.number.length||h>0;c++)g[a+c]=(h+=(g[a+c]||0)+this.number[a]*(m.number[c]||0))%10,h=Math.floor(h/10);return this.number=g,this},BigNumber.prototype.divide=function(t){if(void 0===t)return this;var a,c,m=BigNumber(t),h=[],g=BigNumber(0);if(m.isZero())return this.number=$h,this;if(this.isZero())return this.rest=BigNumber(0),this;if(this.sign*=m.sign,m.sign=1,1===m.number.length&&1===m.number[0])return this.rest=BigNumber(0),this;for(a=this.number.length-1;a>=0;a--)for(g.multiply(10),g.number[0]=this.number[a],h[a]=0;m.lte(g);)h[a]++,g.subtract(m);for(a=0,c=h.length-1;0===h[c-a]&&c-a>0;)a++;return a>0&&splice$1(h).call(h,-a),this.rest=g,this.number=h,this},BigNumber.prototype.mod=function(t){return this.divide(t).rest},BigNumber.prototype.isZero=function(){var t;for(t=0;t<this.number.length;t++)if(0!==this.number[t])return!1;return!0},BigNumber.prototype.toString=function(){var t,a="";if("string"==typeof this.number)return this.number;for(t=this.number.length-1;t>=0;t--)a+=this.number[t];return this.sign>0?a:"-"+a};var Yh=Math.pow(2,32);function varintToBytes(t){var a=new Uint8Array(4),c=new DataView(a.buffer),m=0;do{var h=127&t;(t>>>=7)>0&&(h|=128),c.setUint8(m++,h)}while(t>0);return slice(a).call(a,0,m)}function encodeText(t){if("function"==typeof TextEncoder)return(new TextEncoder).encode(t);var a=function textEncoder(t){for(var a=[],c=t.length,m=0;m<c;){var h=codePointAt(t).call(t,m),g=0,I=0;for(h<=127?(g=0,I=0):h<=2047?(g=6,I=192):h<=65535?(g=12,I=224):h<=2097151&&(g=18,I=240),a.push(I|h>>g),g-=6;g>=0;)a.push(128|h>>g&63),g-=6;m+=h>=65536?2:1}return a}(t);return new Uint8Array(a)}function decodeText(t){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(t):function textDecoder(t){for(var a="",c=0;c<t.length;){var m=t[c],h=0,g=0;if(m<=127?(h=0,g=255&m):m<=223?(h=1,g=31&m):m<=239?(h=2,g=15&m):m<=244&&(h=3,g=7&m),t.length-c-h>0)for(var I=0;I<h;)g=g<<6|63&(m=t[c+I+1]),I+=1;else g=65533,h=t.length-c;a+=Bh(g),c+=h+1}return a}(t)}var Wh=function(){function Unpack(t){this.offset=0,this.buffer=new Uint8Array(t),this.view=new DataView(t)}var t=Unpack.prototype;return t.checkBufferBoundaryAccess=function checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength},t.length=function length(){var t;return(null===(t=this.view)||void 0===t?void 0:t.byteLength)||0},t.getBuffer=function getBuffer(){return this.view.buffer},t.popRaw=function popRaw(t){try{var a,c=slice(a=this.buffer).call(a,this.offset,this.offset+t);return this.offset+=t,c}catch(t){throw new Error("UnpackException raw")}},t.popByte=function popByte(){try{var t=this.view.getUint8(this.offset);return this.offset+=1,t}catch(t){throw new Error("UnpackException byte")}},t.popVarbin=function popVarbin(){return this.popRaw(this.popVarInt())},t.popString=function popString(){try{return decodeText(this.popVarbin())}catch(t){throw new Error("UnpackException string")}},t.popInt=function popInt(){try{var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}catch(t){throw new Error("UnpackException int")}},t.popVarInt=function popVarInt(){var t=1,a=0,c=0;do{a+=(127&(c=this.popByte()))*t,t*=128}while(0!=(128&c));return a},t.popLong=function popLong(){try{var t,a=function getBigUint64(t,a){void 0===a&&(a=!1);var c=new DataView(t.buffer),m=a?[4,0]:[0,4],h=m[0],g=m[1],I=c.getUint32(h,a),M=c.getUint32(g,a);return I>0?I*Yh+M:M}(slice(t=this.buffer).call(t,this.offset,this.offset+8),!0);return this.offset+=8,Number(a)}catch(t){throw new Error("UnpackException long")}},t.popShort=function popShort(){try{var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}catch(t){throw new Error("UnpackException short")}},t.popBoolean=function popBoolean(){return this.popByte()>0},t.toString=function toString(){return Yc(new Uint8Array(this.buffer)).toString()},t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},Unpack}(),zh=function(){function PacketDecoder(t){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.unpack=new Wh(t)}var t=PacketDecoder.prototype;return t.reset=function reset(){this.innerHeader=null,this.unpack.reset()},t.unmarshalHeader=function unmarshalHeader(){var t,a=this._unmarshalHeader();this.packetLength=a.packetLength,this.serviceId=a.serviceId,this.commandId=a.commandId,this.serialId=a.serialId,this.tag=a.tag,this.resCode=a.resCode,4===a.serviceId&&includes(t=[1,2,10,11]).call(t,a.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function _unmarshalHeader(){var t=this.unpack.popVarInt(),a=this.unpack.popByte(),c=this.unpack.popByte(),m=this.unpack.popShort(),h=this.unpack.popByte(),g=200;return this.hasRescode(h)&&(g=this.unpack.popShort()),{packetLength:t,serviceId:a,commandId:c,serialId:m,tag:h,resCode:g}},t.hasRescode=function hasRescode(t){return 0!=((t=t||this.tag)&PacketDecoder.RES_CODE)},t.getHeader=function getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function unmarshalProperty(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popVarInt(),h=this.unpack.popString();a[m]=h}return a},t.unmarshalPropertyArray=function unmarshalPropertyArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalProperty());return a},t.unmarshalLong=function unmarshalLong(){return this.unpack.popLong()},t.unmarshalLongArray=function unmarshalLongArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popLong());return a},t.unmarshalStrArray=function unmarshalStrArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popString());return a},t.unmarshalStrLongMap=function unmarshalStrLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popString(),h=this.unpack.popLong();a[m]=h}return a},t.unmarshalStrStrMap=function unmarshalStrStrMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popString(),h=this.unpack.popString();a[m]=h}return a},t.unmarshalLongLongMap=function unmarshalLongLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var m=this.unpack.popLong(),h=this.unpack.popLong();a[m]=h}return{m_map:a}},t.unmarshalKVArray=function unmarshalKVArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalStrStrMap());return a},t.unmarshal=function unmarshal(t){var a,c=this,m=qt(qt({},this.getHeader()),{r:[]});if(this.innerHeader&&(m.r[0]=this.msgId,m.r[1]={body:[],headerPacket:this.getInnerHeader()}),!includes(a=[200,406,808,810,7101]).call(a,m.code))return Uc(m);var h=[];return t&&forEach$1(t).call(t,(function(t){if(!c.unpack.checkBufferBoundaryAccess())switch(t.type){case"PropertyArray":h.push(c.unmarshalPropertyArray());break;case"Property":h.push(c.unmarshalProperty());break;case"Byte":h.push(c.unpack.popByte());break;case"Int":h.push(c.unpack.popInt());break;case"Bool":h.push(c.unpack.popBoolean());break;case"Long":h.push(c.unmarshalLong());break;case"LongArray":h.push(c.unmarshalLongArray());break;case"String":h.push(c.unpack.popString());break;case"StrArray":h.push(c.unmarshalStrArray());break;case"StrStrMap":h.push(c.unmarshalStrStrMap());break;case"StrLongMap":h.push(c.unmarshalStrLongMap());break;case"LongLongMap":h.push(c.unmarshalLongLongMap());break;case"KVArray":h.push(c.unmarshalKVArray())}})),this.innerHeader?m.r[1].body=h:m.r=h,Uc(m)},PacketDecoder}();zh.RES_CODE=2;var Kh=function(){function Pack(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=Pack.prototype;return t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},t.size=function size(){return this.offset},t.getBuffer=function getBuffer(){var t;return slice(t=this.buffer).call(t,0,this.offset).buffer},t.ensureCapacity=function ensureCapacity(t){var a=this.offset+t;if(a>this.capacity)throw new Error("PackException over limit");if(a>this.buffer.byteLength){var c=Math.ceil(a/this.pageSize)*this.pageSize,m=new Uint8Array(c);m.set(this.buffer),this.buffer=m,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function putRaw(t){this.ensureCapacity(t.length);try{this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException raw")}},t.putByte=function putByte(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t)}catch(t){throw new Error("PackException byte")}},t.putString=function putString(t){try{var a=encodeText(t);this.putVarbin(a)}catch(t){throw new Error("PackException string")}},t.putInt=function putInt(t){this.ensureCapacity(4);try{this.view.setInt32(this.offset,t,!0),this.offset+=4}catch(t){throw new Error("PackException int")}},t.putVarInt=function putVarInt(t){var a=varintToBytes(t);this.putRaw(a)},t.putBoolean=function putBoolean(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t?1:0)}catch(t){throw new Error("PackException boolean")}},t.putLong=function putLong(t){this.ensureCapacity(8);try{var a=function setBigUint64(t,a){void 0===a&&(a=!1);var c=new Uint8Array(8),m=new DataView(c.buffer),h=Number(t>Yh-1?t/Yh:0),g=Number(4294967295&t),I=a?[4,0]:[0,4],M=I[0],T=I[1];return m.setUint32(M,h,a),m.setUint32(T,g,a),c}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException long")}},t.putStringAsLong=function putStringAsLong(t){this.ensureCapacity(8);try{var a=function setBigUint64ForNumberOverflow(t,a){var c,m;void 0===a&&(a=!1);var h=new Uint8Array(8),g=new DataView(h.buffer),I=reverse$1(c=BigNumber(t).divide(Yh).number).call(c).join(""),M=reverse$1(m=BigNumber(t).mod(Yh).number).call(m).join(""),T=Number(I),S=Number(M),E=a?[4,0]:[0,4],b=E[0],C=E[1];return g.setUint32(b,T,a),g.setUint32(C,S,a),h}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException stringAsLong")}},t.putShort=function putShort(t){this.ensureCapacity(2);try{this.view.setInt16(this.offset,t,!0),this.offset+=2}catch(t){throw new Error("PackException short")}},t.putVarbin=function putVarbin(t){if(!t)return this.ensureCapacity(1),this.putVarInt(0);if(t.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var a=varintToBytes(t.length);this.ensureCapacity(a.length+t.length);try{this.buffer.set(a,this.offset),this.offset+=a.length,this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException varbin")}},Pack}();function isConvertibleToNumber(t){if("number"!=typeof t){if(null==t)return!1;t=Number(t)}if(isNaN(t))throw new Error("Number type conversion error");return!0}function isUndefinedOrNull(t){return null==t}var Qh,Jh=function(){function PacketEncoder(t,a,c){this.pack=new Kh,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=t,this.commandId=a,this.serialId=c}var t=PacketEncoder.prototype;return t.marshalHeader=function marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function marshalProperty(t){var a=this,c=mn(t),m=filter(c).call(c,(function(t){return!isUndefinedOrNull(t)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putVarInt(Number(c)),jc(t[c])||"[object Object]"===Object.prototype.toString.call(t[c])?a.pack.putString(Uc(t[c])):a.pack.putString(String(t[c]))}))},t.marshalPropertyArray=function marshalPropertyArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalProperty(null==t?void 0:t.v)}))},t.marshalStrArray=function marshalStrArray(t){var a=this,c=filter(t).call(t,(function(t){return!isUndefinedOrNull(t)})),m=c.length;this.pack.putVarInt(m),forEach$1(c).call(c,(function(t){a.pack.putString(String(t))}))},t.marshalLongArray=function marshalLongArray(t){var a=this,c=filter(t).call(t,(function(t){return isConvertibleToNumber(t)})),m=c.length;this.pack.putVarInt(m),forEach$1(c).call(c,(function(t){a.putLong(t)}))},t.marshalStrStrMap=function marshalStrStrMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){return!isUndefinedOrNull(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putString(String(c)),a.pack.putString(String(t[c]))}))},t.marshalStrLongMap=function marshalStrLongMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){return isConvertibleToNumber(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){a.pack.putString(String(c)),a.putLong(t[c])}))},t.marshalLongLongMap=function marshalLongLongMap(t){var a=this,c=mn(t),m=filter(c).call(c,(function(a){var c=Number(a);return isConvertibleToNumber(c)&&isConvertibleToNumber(t[c])}));this.pack.putVarInt(m.length),forEach$1(m).call(m,(function(c){var m=Number(c);a.putLong(m),a.putLong(t[m])}))},t.marshalKVArray=function marshalKVArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalStrStrMap(t)}))},t.putLong=function putLong(t){"string"==typeof t&&t.length>15?this.pack.putStringAsLong(t):this.pack.putLong(Number(t))},t.marshal=function marshal(t,a){var c=this;return this.marshalHeader(),a&&forEach$1(a).call(a,(function(a,m){var h,g=a.type,I=null===(h=t[m])||void 0===h?void 0:h.v;if(!isUndefinedOrNull(I))switch(g){case"PropertyArray":c.marshalPropertyArray(I);break;case"Property":c.marshalProperty(I);break;case"Byte":if(!isConvertibleToNumber(I))return;c.pack.putByte(Number(I));break;case"Int":if(!isConvertibleToNumber(I))return;c.pack.putInt(Number(I));break;case"Bool":"false"===I?I=!1:"true"===I&&(I=!0),c.pack.putBoolean(I);break;case"Long":if(!isConvertibleToNumber(I))return;c.putLong(I);break;case"LongArray":c.marshalLongArray(I);break;case"String":c.pack.putString(String(I));break;case"StrArray":c.marshalStrArray(I);break;case"StrStrMap":c.marshalStrStrMap(I);break;case"StrLongMap":c.marshalStrLongMap(I);break;case"LongLongMap":c.marshalLongLongMap(I);break;case"KVArray":c.marshalKVArray(I)}})),this.pack.getBuffer()},t.reset=function reset(){this.pack.reset()},PacketEncoder}(),Xh=function(t){function BaseWebsocket(a,c){var m;return(m=t.call(this)||this).url=c,m.websocket=null,m.socketConnectTimer=0,m.core=a,m.url=c,m.status="disconnected",m.logger=a.logger,m.connect(),m}wt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket("wss://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect")}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=qi((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("connectFailed",new Fu({code:"v2"===Rs(c.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new _p.WebSocket(t),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(){c.logger.log("imsocket::Websocket onclose done"),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new Fu({code:"v2"===Rs(c.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new Fu({code:"v2"===Rs(c.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){c.onConnect()}},a.onMessage=function onMessage(t){if(t.data){var a=new zh(t.data),c={sid:-1,cid:-1,ser:-1,packetLength:-1},m=null;try{a.unmarshalHeader(),c=a.getHeader(),m=a.getInnerHeader()}catch(t){this.reportBinaryError({err:t,sid:m?m.sid:null==c?void 0:c.sid,cid:m?m.cid:null==c?void 0:c.cid,type:"decode"})}var h=m?m.sid:c.sid,g=m?m.cid:c.cid,I=h+"_"+g,M=bp[I];if(M&&M.length>0){var T,S=M[0].config;try{T=a.unmarshal(S.response)}catch(t){this.reportBinaryError({err:t,sid:h,cid:g,type:"decode"}),a.reset();var E=qt(qt({},c),{sid:h,cid:g,code:Lu.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+E.sid+"_"+E.cid+'", ser '+E.ser+", packetLength "+E.packetLength+" unmarshal error",t),void this.emit("message",Uc(E))}this.emit("message",T)}else this.core.logger.warn("imsocket::onMessage cmd not found",I);a.reset()}},a.send=function send(t,a,c,m,h){var g,I,M=new Jh(t,a,c),T=Ep[m],S="";try{S=Uc(h),I=M.marshal(JSON.parse(S),T.params)}catch(m){throw this.reportBinaryError({err:m,sid:t,cid:a,rawStr:S,type:"encode"}),M.reset(),new Fu({code:Lu.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:t+"-"+a+", ser "+c+" marshal error",rawError:m}})}null===(g=this.websocket)||void 0===g||g.send(I),M.reset()},a.reportBinaryError=function reportBinaryError(t){var a,c,m=t.err,h=t.rawStr,g=t.sid,I=t.cid,M=t.type;this.core.reporter.reportTraceStart("exceptions",{user_id:null===(a=this.core.auth)||void 0===a?void 0:a.account,trace_id:null===(c=this.core.clientSocket.socket)||void 0===c?void 0:c.sessionId,start_time:Ri(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===M?Lu.V2NIM_ERROR_CODE_PACK_ERROR:Lu.V2NIM_ERROR_CODE_UNPACK_ERROR,description:m&&(m.message||""+m.code)+" rawObj: "+h,operation_type:"encode"===M?3:4,target:g+"-"+I},{asyncParams:_p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},BaseWebsocket}(Gi);function _createForOfIteratorHelperLoose$8(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$8(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$8(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$8(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$8(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(Qh||(Qh={}));var Zh,ef=function(){function V2BinaryClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Mm({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Il,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2BinaryClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,m;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var h,g,I,M;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.isReconnect=a,(h=this.core.auth.getConnectStatus())!==au.V2NIM_CONNECT_STATUS_CONNECTED){T.next=7;break}return g="clientSocket::connect status is "+h+", and would not repeat connect",I=new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:g}}),this.logger.warn(g),T.abrupt("return",Mi.reject(I));case 7:return this.auth.lifeCycle.processEvent("connect"),T.prev=8,T.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:_p.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),T.next=28;break;case 16:if(T.prev=16,T.t0=T.catch(8),M=T.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:M.code||0,description:"connectFailed:"+M.message,mixlink:!0,succeed:!1},{asyncParams:_p.net.getNetworkStatus()}),M.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&M.code!==Lu.V2NIM_ERROR_CODE_TIMEOUT){T.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(m=this.socket)||void 0===m||m.removeAllListeners(),this.socket=void 0,T.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,M),this.auth.lifeCycle.processEvent("connectFail",M),T.t0;case 28:case"end":return T.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new Xh(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"",operation_type:0,target:t}),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",m),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Qh.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("connectFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::connectFailed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==au.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Fu({code:Lu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===Qh.ACTIVE||t===Qh.KICKED?this.destroyOnlineListener():t===Qh.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Fu({code:Lu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var m=this,h=this.core.auth.getLoginStatus(),g=["v2Login","login","chatroomLogin","v2ChatroomLogin"],I={cmd:t};if(h!==eu.V2NIM_LOGIN_STATUS_LOGINED&&!includes(g).call(g,t))return this.logger.warn("clientSocketV2::NIM login status is "+h+", so can not sendCmd "+t),Mi.reject(new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:qt({reason:"Can not sendCmd due to no logined"},I)}));var M="heartbeat"!==t,T=M?this.packetSer++:0,S=createCmd(t,T,this.logger,a);if(!S){var E=new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:qt(qt({},I),{reason:"SendCmd::createCmd error: "+T+" "+t})});return this.logger.error(E),Mi.reject(E)}var b=S.packet,C=S.hasPacketResponse,A=S.hasPacketTimer,N=Uc(b);M&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+T,N):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+T));var R=(new Date).getTime();return new Mi((function(h,g){C&&m.sendingCmdMap.set(T,{cmd:t,params:a,callback:[h,g],timer:A?qi((function(){var a=new Fu({code:Lu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:qt({ser:T,reason:"Packet Timeout: ser "+T+" cmd "+t,timetag:(new Date).getTime()},I)});m.markCmdInvalid(T,a,t)}),c&&c.timeout?c.timeout:m.packetTimeout):null});try{m.socket.send(b.SID,b.CID,T,t,b.Q),C||h(b)}catch(a){var M=new Fu({code:Lu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:qt({ser:T,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},I)});m.markCmdInvalid(T,M,t),g(M)}})).catch((function(t){return __awaiter(m,void 0,void 0,Lc.mark((function _callee3(){var a,c;return Lc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t,c=[Lu.V2NIM_ERROR_CODE_DISCONNECT,Lu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Lu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(c).call(c,a.code)){m.next=4;break}return m.abrupt("return",Mi.reject(a));case 4:return this.reportSendCmdFailed(a,{sid:b.SID,cid:b.CID,ser:T},R),m.abrupt("return",Mi.reject(a));case 6:case"end":return m.stop()}}),_callee3,this)})))}))},t.reportSendCmdFailed=function reportSendCmdFailed(t,a,c){var m;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(m=this.socket)||void 0===m?void 0:m.sessionId,start_time:c,action:2,exception_service:6});var h=Rs(t,"detail.disconnect_reason")||"",g=t.code===Lu.V2NIM_ERROR_CODE_DISCONNECT?Uc({disconnect_reason:h}):t.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:t.code,description:g,operation_type:1,target:a.sid+"-"+a.cid,context:""+a.ser},{asyncParams:_p.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,m=_createForOfIteratorHelperLoose$8(a);!(c=m()).done;){var h=c.value,g=h.raw.ser;if(h.error&&this.logger.error("clientSocketV2::onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+g+",",h.error),h.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+g);"heartbeat"!==h.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+g,h.cmd,h.content):this.logger.log("clientSocketV2::recvCmd ser:"+g,h.cmd)),this.packetHandler(h)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),g[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+g),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a=this;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==Lu.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Qh.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=qi((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var t;return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,_p.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),m=t.auth.getLoginStatus();a.isConnected&&m===eu.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===au.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(Qh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),_p.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2BinaryClientSocket}();function _createForOfIteratorHelperLoose$7(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$7(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$7(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$7(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$7(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(Zh||(Zh={}));var tf=function(){function V2ClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new Mm({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Il,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2ClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,m;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var h,g,I,M;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.isReconnect=a,(h=this.core.auth.getConnectStatus())!==au.V2NIM_CONNECT_STATUS_CONNECTED){T.next=7;break}return g="clientSocket::connect status is "+h+", and would not repeat connect",I=new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:g}}),this.logger.warn(g),T.abrupt("return",Mi.reject(I));case 7:return this.auth.lifeCycle.processEvent("connect"),T.prev=8,T.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:_p.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),T.next=28;break;case 16:if(T.prev=16,T.t0=T.catch(8),M=T.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:M.code||0,description:"connectFailed:"+M.message,mixlink:!0,succeed:!1},{asyncParams:_p.net.getNetworkStatus()}),M.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&M.code!==Lu.V2NIM_ERROR_CODE_TIMEOUT){T.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(m=this.socket)||void 0===m||m.removeAllListeners(),this.socket=void 0,T.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,M),this.auth.lifeCycle.processEvent("connectFail",M),T.t0;case 28:case"end":return T.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new Mi((function(m,h){var g;a.socket=new Gm(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"",operation_type:0,target:t}),c=!0,m()})),a.socket.on("message",bind$1(g=a.onMessage).call(g,a)),a.socket.on("disconnect",(function(m){return __awaiter(a,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",m),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==m?void 0:m.code)||0,description:(null==m?void 0:m.reason)||"",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Zh.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,h(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==au.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new Fu({code:Lu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===Zh.ACTIVE||t===Zh.KICKED?this.destroyOnlineListener():t===Zh.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new Fu({code:Lu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var m=this,h=this.core.auth.getLoginStatus(),g=["v2Login","login","chatroomLogin","v2ChatroomLogin"],I={cmd:t};if(h!==eu.V2NIM_LOGIN_STATUS_LOGINED&&!includes(g).call(g,t))return this.logger.warn("clientSocketV2::NIM login status is "+h+", so can not sendCmd "+t),Mi.reject(new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:qt({reason:"Can not sendCmd due to no logined"},I)}));var M="heartbeat"!==t,T=M?this.packetSer++:0,S=createCmd(t,T,this.logger,a);if(!S){var E=new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:qt(qt({},I),{reason:"SendCmd::createCmd error: "+T+" "+t})});return this.logger.error(E),Mi.reject(E)}var b=S.packet,C=S.hasPacketResponse,A=S.hasPacketTimer,N=Uc(b);M&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+T,N):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+T));var R=(new Date).getTime();return new Mi((function(h,g){C&&m.sendingCmdMap.set(T,{cmd:t,params:a,callback:[h,g],timer:A?qi((function(){var a=new Fu({code:Lu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:qt({ser:T,reason:"Packet Timeout: ser "+T+" cmd "+t,timetag:(new Date).getTime()},I)});m.markCmdInvalid(T,a,t)}),c&&c.timeout?c.timeout:m.packetTimeout):null});try{m.socket.send(N),C||h(b)}catch(a){var M=new Fu({code:Lu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:qt({ser:T,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},I)});m.markCmdInvalid(T,M,t),g(M)}})).catch((function(t){return __awaiter(m,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h,g;return Lc.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:if(c=t,m=[Lu.V2NIM_ERROR_CODE_DISCONNECT,Lu.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Lu.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(m).call(m,c.code)){I.next=4;break}return I.abrupt("return",Mi.reject(c));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(a=this.socket)||void 0===a?void 0:a.sessionId,start_time:R,action:2,exception_service:6}),h=Rs(c,"detail.disconnect_reason")||"",g=c.code===Lu.V2NIM_ERROR_CODE_DISCONNECT?Uc({disconnect_reason:h}):c.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:c.code,description:g,operation_type:1,target:b.SID+"-"+b.CID,context:""+b.SER},{asyncParams:_p.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),I.abrupt("return",Mi.reject(c));case 10:case"end":return I.stop()}}),_callee3,this)})))}))},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,m=_createForOfIteratorHelperLoose$7(a);!(c=m()).done;){var h=c.value,g=h.raw.ser;if(h.error&&this.logger.error("clientSocketV2::onMessage packet error",h.raw.sid+"_"+h.raw.cid+", ser:"+g+",",h.error),h.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",h.raw.sid+"_"+h.raw.cid+", ser:"+g);"heartbeat"!==h.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+g,h.cmd,h.content):this.logger.log("clientSocketV2::recvCmd ser:"+g,h.cmd)),this.packetHandler(h)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var m=t.raw.ser,h=this.sendingCmdMap.get(m);if(h&&h.cmd===t.cmd){var g=h.callback,I=h.timer,M=h.params;if(clearTimeout(I),t.params=M,this.sendingCmdMap.delete(m),"heartbeat"===t.cmd)return void g[0]();var T=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);T&&"function"==typeof T.then?T.then((function(t){g[0](t)})).catch((function(t){g[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),g[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var m=this.sendingCmdMap.get(t);if(m){var h=m.callback,g=m.timer;g&&clearTimeout(g),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),h[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var m=a.callback,h=a.timer,g=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+g),h&&clearTimeout(h),m[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a=this;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==Lu.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Zh.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=qi((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var t;return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,_p.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),m=t.auth.getLoginStatus();a.isConnected&&m===eu.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===au.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(Zh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),_p.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2ClientSocket}(),rf=function(){function V2NIMLoginReconnect(t){this.currenRetryCount=0,this.backoff=new Mm({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginReconnect.prototype;return t.reset=function reset(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function attempToReLogin(){var t=this,a=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var c=this.reconnectDelayProvider(a);"number"==typeof c&&c>=0&&(a=c>=1e3?c:c+200+Math.ceil(300*Math.random()))}catch(t){this.core.logger.error("reconnect::connectDelayProvider excute failed,",t)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+a+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=qi((function(){t.core.logger.log("reconnect::reconnect timer is now triggered");var a=t.auth.getConnectStatus();a===au.V2NIM_CONNECT_STATUS_WAITING?t.doReLogin():t.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+a)}),a),!0},t.doReLogin=function doReLogin(){var t=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var a=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return a.then((function(){t.core.reporter.reportTraceEnd("login",!0)})).catch((function(a){var c=a;if(t.core.logger.warn("reconnect::try login but failed due to",c),t.core.reporter.reportTraceEnd("login",!1),t.auth.checkLoginTerminalCode(c&&c.code))return t.auth.clientSocket.doDisconnect(Qh.ACTIVE,"ReloginTerminated"),void t.auth.lifeCycle.processEvent("exited",c);c&&399===c.code&&t.auth.lbs.reset(),t.auth.lifeCycle.processEvent("waiting")})),a},t._setReconnectDelayProvider=function _setReconnectDelayProvider(t){this.reconnectDelayProvider=t},V2NIMLoginReconnect}(),nf=function(){function V2NIMLoginLbs(t){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginLbs.prototype;return t.getLbsInfos=function getLbsInfos(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t,a,c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.socketLinkUrls.length>0)){h.next=5;break}return t=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",t),h.abrupt("return",Mi.resolve(t));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),a=Um(this.auth.config.lbsUrls),h.prev=8,h.next=11,this.ladderLoad(a);case 11:if(200===(c=h.sent).status&&c.data){h.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",c.status,c),new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+c.status}});case 15:this.success(c),h.next=26;break;case 18:if(h.prev=18,h.t0=h.catch(8),m=h.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",h.t0),this.reportForFail(a[0],m.code,m.message),!this.checkTerminator(m.code)){h.next=25;break}throw h.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return h.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return h.stop()}}),_callee,this,[[8,18]])})))},t.checkTerminator=function checkTerminator(t){return t===Lu.V2NIM_ERROR_CODE_CANCELLED||t===Lu.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function generateUrl(t){return t+(indexOf(t).call(t,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function requstLbs(t){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(t),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function setLadderTimer(t,a,c,m){var h=this;this.timer&&clearTimeout(this.timer);var g=t[a];this.timer=qi((function(){g&&(h.setLadderTimer(t,a+1,c,m),h.core.logger.log("V2NIMLoginService::getLbsInfos "+a+":",g),h.reportForLbsStart(g,a),h.requstLbs(g).then((function(t){h.reset(),c(qt(qt({},t),{url:g}))})).catch((function(c){var I;if(h.core.logger.warn("V2NIMLoginService::getLbsInfos "+a+" failed:",c),h.failedCount+=1,h.reportForFailOnce(g,c.code,(null===(I=c.detail)||void 0===I?void 0:I.reason)||c.message),h.failedCount>=t.length||h.checkTerminator(c.code))return h.reset(),void m(c)})))}),2e3)},t.ladderLoad=function ladderLoad(t){var a=this;return new Mi((function(c,m){t.length>1&&a.setLadderTimer(t,1,c,m);var h=t[0];a.core.logger.log("V2NIMLoginService::getLbsInfos 0:",h),a.reportForLbsStart(h,0),a.requstLbs(h).then((function(t){a.reset(),c(qt(qt({},t),{url:h}))})).catch((function(c){var g;a.failedCount+=1,a.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",c),a.reportForFailOnce(h,c.code,(null===(g=c.detail)||void 0===g?void 0:g.reason)||c.message),(a.failedCount>=t.length||a.checkTerminator(c.code))&&(a.reset(),m(c))}))}))},t.success=function success(t){var a,c,m,h,g=t.data.common;this.socketLinkUrls=Um(concat(a=concat(c=g["mix.link"]).call(c,g["link.default"])).call(a,[this.auth.config.linkUrl])),t.data["nos-chunk"]&&(null===(h=this.core.cloudStorage)||void 0===h?void 0:h.setOptions)&&this.core.cloudStorage.setOptions({chunkUploadHost:t.data["nos-chunk"]}),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",slice(m=this.socketLinkUrls).call(m,0),"chunkUploadHost: ",t.data["nos-chunk"]),this.reportForLbsSuccess(t.url,t.data)},t.reportForLbsStart=function reportForLbsStart(t,a){this.core.reporterHookLBS.updateBegin({target:t,index:a})},t.reportForLbsSuccess=function reportForLbsSuccess(t,a){this.core.reporterHookLBS.updateComplete({target:t,code:200,body:Uc(a)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,code:200,succeed:!0},{asyncParams:_p.net.getNetworkStatus()})},t.reportForFailOnce=function reportForFailOnce(t,a,c){this.core.reporterHookLBS.updateComplete({target:t,code:a,body:c})},t.reportForFail=function reportForFail(t,a,c){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:t,description:c,code:a,succeed:!1},{asyncParams:_p.net.getNetworkStatus()})},t.reset=function reset(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},V2NIMLoginLbs}();var af=function arraySome(t,a){for(var c=-1,m=null==t?0:t.length;++c<m;)if(a(t[c],c,t))return!0;return!1};var sf=function equalArrays(t,a,c,m,h,g){var I=1&c,M=t.length,T=a.length;if(M!=T&&!(I&&T>M))return!1;var S=g.get(t),E=g.get(a);if(S&&E)return S==a&&E==t;var b=-1,C=!0,A=2&c?new Em:void 0;for(g.set(t,a),g.set(a,t);++b<M;){var N=t[b],R=a[b];if(m)var k=I?m(R,N,b,a,t,g):m(N,R,b,t,a,g);if(void 0!==k){if(k)continue;C=!1;break}if(A){if(!af(a,(function(t,a){if(!wm(A,a)&&(N===t||h(N,t,c,m,g)))return A.push(a)}))){C=!1;break}}else if(N!==R&&!h(N,R,c,m,g)){C=!1;break}}return g.delete(t),g.delete(a),C};var cf=function mapToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t,m){c[++a]=[m,t]})),c},lf=po?po.prototype:void 0,uf=lf?lf.valueOf:void 0;var df=function equalByTag(t,a,c,m,h,g,I){switch(c){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!g(new nd(t),new nd(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Zo(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var M=cf;case"[object Set]":var T=1&m;if(M||(M=xm),t.size!=a.size&&!T)return!1;var S=I.get(t);if(S)return S==a;m|=2,I.set(t,a);var E=sf(M(t),M(a),m,h,g,I);return I.delete(t),E;case"[object Symbol]":if(uf)return uf.call(t)==uf.call(a)}return!1};var pf=function arrayPush(t,a){for(var c=-1,m=a.length,h=t.length;++c<m;)t[h+c]=a[c];return t};var mf=function baseGetAllKeys(t,a,c){var m=a(t);return so(t)?m:pf(m,c(t))};var hf=function arrayFilter(t,a){for(var c=-1,m=null==t?0:t.length,h=0,g=[];++c<m;){var I=t[c];a(I,c,t)&&(g[h++]=I)}return g};var gf=function stubArray(){return[]},vf=Object.prototype.propertyIsEnumerable,yf=Object.getOwnPropertySymbols,_f=yf?function(t){return null==t?[]:(t=Object(t),hf(yf(t),(function(a){return vf.call(t,a)})))}:gf,If=_f;var Mf=function getAllKeys(t){return mf(t,dm,If)},Tf=Object.prototype.hasOwnProperty;var Sf=function equalObjects(t,a,c,m,h,g){var I=1&c,M=Mf(t),T=M.length;if(T!=Mf(a).length&&!I)return!1;for(var S=T;S--;){var E=M[S];if(!(I?E in a:Tf.call(a,E)))return!1}var b=g.get(t),C=g.get(a);if(b&&C)return b==a&&C==t;var A=!0;g.set(t,a),g.set(a,t);for(var N=I;++S<T;){var R=t[E=M[S]],k=a[E];if(m)var w=I?m(k,R,E,a,t,g):m(R,k,E,t,a,g);if(!(void 0===w?R===k||h(R,k,c,m,g):w)){A=!1;break}N||(N="constructor"==E)}if(A&&!N){var O=t.constructor,P=a.constructor;O==P||!("constructor"in t)||!("constructor"in a)||"function"==typeof O&&O instanceof O&&"function"==typeof P&&P instanceof P||(A=!1)}return g.delete(t),g.delete(a),A},Ef=Go(uo,"DataView"),bf=Go(uo,"Promise"),Cf=Go(uo,"WeakMap"),Af="[object Map]",Nf="[object Promise]",Rf="[object Set]",kf="[object WeakMap]",wf="[object DataView]",Of=Po(Ef),Pf=Po(ss),xf=Po(bf),Vf=Po(Om),Lf=Po(Cf),Df=Mo;(Ef&&Df(new Ef(new ArrayBuffer(1)))!=wf||ss&&Df(new ss)!=Af||bf&&Df(bf.resolve())!=Nf||Om&&Df(new Om)!=Rf||Cf&&Df(new Cf)!=kf)&&(Df=function(t){var a=Mo(t),c="[object Object]"==a?t.constructor:void 0,m=c?Po(c):"";if(m)switch(m){case Of:return wf;case Pf:return Af;case xf:return Nf;case Vf:return Rf;case Lf:return kf}return a});var Uf=Df,Ff="[object Arguments]",Bf="[object Array]",qf="[object Object]",Gf=Object.prototype.hasOwnProperty;var jf=function baseIsEqualDeep(t,a,c,m,h,g){var I=so(t),M=so(a),T=I?Bf:Uf(t),S=M?Bf:Uf(a),E=(T=T==Ff?qf:T)==qf,b=(S=S==Ff?qf:S)==qf,C=T==S;if(C&&Ed(t)){if(!Ed(a))return!1;I=!0,E=!1}if(C&&!E)return g||(g=new Ju),I||Ld(t)?sf(t,a,c,m,h,g):df(t,a,T,c,m,h,g);if(!(1&c)){var A=E&&Gf.call(t,"__wrapped__"),N=b&&Gf.call(a,"__wrapped__");if(A||N){var R=A?t.value():t,k=N?a.value():a;return g||(g=new Ju),h(R,k,c,m,g)}}return!!C&&(g||(g=new Ju),Sf(t,a,c,m,h,g))};var Hf=function baseIsEqual(t,a,c,m,h){return t===a||(null==t||null==a||!To(t)&&!To(a)?t!=t&&a!=a:jf(t,a,c,m,baseIsEqual,h))};var $f=function baseIsMatch(t,a,c,m){var h=c.length,g=h,I=!m;if(null==t)return!g;for(t=Object(t);h--;){var M=c[h];if(I&&M[2]?M[1]!==t[M[0]]:!(M[0]in t))return!1}for(;++h<g;){var T=(M=c[h])[0],S=t[T],E=M[1];if(I&&M[2]){if(void 0===S&&!(T in t))return!1}else{var b=new Ju;if(m)var C=m(S,E,T,t,a,b);if(!(void 0===C?Hf(E,S,3,m,b):C))return!1}}return!0};var Yf=function isStrictComparable(t){return t==t&&!Ao(t)};var Wf=function getMatchData(t){for(var a=dm(t),c=a.length;c--;){var m=a[c],h=t[m];a[c]=[m,h,Yf(h)]}return a};var zf=function matchesStrictComparable(t,a){return function(c){return null!=c&&(c[t]===a&&(void 0!==a||t in Object(c)))}};var Kf=function baseMatches(t){var a=Wf(t);return 1==a.length&&a[0][2]?zf(a[0][0],a[0][1]):function(c){return c===t||$f(c,t,a)}};var Qf=function baseHasIn(t,a){return null!=t&&a in Object(t)};var Jf=function hasPath(t,a,c){for(var m=-1,h=(a=Cs(a,t)).length,g=!1;++m<h;){var I=As(a[m]);if(!(g=null!=t&&c(t,I)))break;t=t[I]}return g||++m!=h?g:!!(h=null==t?0:t.length)&&Id(h)&&jd(I,h)&&(so(t)||_d(t))};var Xf=function hasIn(t,a){return null!=t&&Jf(t,a,Qf)};var Zf=function baseMatchesProperty(t,a){return Co(t)&&Yf(a)?zf(As(t),a):function(c){var m=Rs(c,t);return void 0===m&&m===a?Xf(c,t):Hf(a,m,3)}};var eg=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var tg=function basePropertyDeep(t){return function(a){return Ns(a,t)}};var rg=function property(t){return Co(t)?eg(As(t)):tg(t)};var ng=function baseIteratee(t){return"function"==typeof t?t:null==t?Zd:"object"==typeof t?so(t)?Zf(t[0],t[1]):Kf(t):rg(t)};var ag=function last(t){var a=null==t?0:t.length;return a?t[a-1]:void 0};var ig=function baseSlice(t,a,c){var m=-1,h=t.length;a<0&&(a=-a>h?0:h+a),(c=c>h?h:c)<0&&(c+=h),h=a>c?0:c-a>>>0,a>>>=0;for(var g=Array(h);++m<h;)g[m]=t[m+a];return g};var og=function parent(t,a){return a.length<2?t:Ns(t,ig(a,0,-1))};var sg=function baseUnset(t,a){return a=Cs(a,t),null==(t=og(t,a))||delete t[As(ag(a))]},cg=Array.prototype.splice;var lg=function basePullAt(t,a){for(var c=t?a.length:0,m=c-1;c--;){var h=a[c];if(c==m||h!==g){var g=h;jd(h)?cg.call(t,h,1):sg(t,h)}}return t};var ug=function remove(t,a){var c=[];if(!t||!t.length)return c;var m=-1,h=[],g=t.length;for(a=ng(a);++m<g;){var I=t[m];a(I,m,t)&&(c.push(I),h.push(m))}return lg(t,h),c},dg=function(){function V2NIMLoginAuthenticator(t){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=t,this.auth=t.V2NIMLoginService}var t=V2NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I,M,T,S,E,b;return Lc.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return c=C.sent,C.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return m=C.sent,this.auth.token=c,h=_p.getSystemInfo(),g={appkey:this.core.options.appkey,account:this.auth.account,token:c,authType:this.auth.loginOption.authType,appLogin:t?0:1,clientType:tu.V2NIM_LOGIN_CLIENT_TYPE_WEB,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100207,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.2.700":slice(a=h.userAgent).call(a,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:h.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:h.hostEnvEnum,sdkHumanVersion:"10.2.700",os:h.os,browser:h.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:m},I=h.os.toLowerCase(),"UNIAPP"!==_p.platform||"ios"!==I&&"android"!==I||(g.isReactNative=1,g.clientType="ios"===I?tu.V2NIM_LOGIN_CLIENT_TYPE_IOS:tu.V2NIM_LOGIN_CLIENT_TYPE_ANDROID,h.pushDeviceInfo&&h.pushDeviceInfo.MANUFACTURER&&(g.deviceInfo=Uc(qt({IS_SUPPORT_HONOR:!0},h.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",g.account,g.clientSession,g.appLogin),C.prev=12,C.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:g}));case 15:M=C.sent,C.next=26;break;case 18:if(C.prev=18,C.t0=C.catch(12),T=C.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:T.code||0,succeed:!1,description:T.message},{asyncParams:_p.net.getNetworkStatus()}),T.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&T.code!==Lu.V2NIM_ERROR_CODE_TIMEOUT){C.next=24;break}throw T;case 24:throw this.processLoginFailed(T),T;case 26:return S=M.content,E=S.data,b=S.loginClients,this.changeLoginClient(nu.V2NIM_LOGIN_CLIENT_CHANGE_LIST,b),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:_p.net.getNetworkStatus()}),this.loginClientOfThisConnection=formatLoginInfo(E),this.core.clientSocket.setSessionId(E.consid),_p.localStorage.setItem(this.lastLoginClientKey,Uc(qt({account:this.auth.account},this.loginClientOfThisConnection))),C.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return C.stop()}}),_callee,this,[[12,18]])})))},t.refreshLoginToken=function refreshLoginToken(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m;return Lc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(this.auth.loginOption.authType!==Zl.V2NIM_LOGIN_AUTH_TYPE_DEFAULT){h.next=2;break}return h.abrupt("return",this.auth.token);case 2:if("function"==typeof this.auth.loginOption.tokenProvider){h.next=4;break}return h.abrupt("return",this.auth.token);case 4:return h.prev=4,h.next=7,this.auth.loginOption.tokenProvider(t);case 7:if("string"!=typeof(a=h.sent)){h.next=12;break}return h.abrupt("return",a);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",a),new Fu({code:Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:a}});case 14:h.next=23;break;case 16:throw h.prev=16,h.t0=h.catch(4),c=h.t0,m=c,c.code!==Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",c),m=new Fu({code:Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:h.t0}})),this.processLoginFailed(c),m;case 23:case"end":return h.stop()}}),_callee2,this,[[4,16]])})))},t.refreshThirdPartyExt=function refreshThirdPartyExt(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if("function"==typeof this.auth.loginOption.loginExtensionProvider){h.next=2;break}return h.abrupt("return","");case 2:return h.prev=2,h.next=5,this.auth.loginOption.loginExtensionProvider(t);case 5:if("string"!=typeof(a=h.sent)){h.next=10;break}return h.abrupt("return",a);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",a),new Fu({code:Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:a}});case 12:h.next=25;break;case 14:if(h.prev=14,h.t0=h.catch(2),c=h.t0,m=c,c.code!==Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",c),m=new Fu({code:Lu.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:h.t0}})),this.auth.loginOption.authType!==Zl.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY){h.next=24;break}throw this.processLoginFailed(c),m;case 24:return h.abrupt("return","");case 25:case"end":return h.stop()}}),_callee3,this,[[2,14]])})))},t.processLoginFailed=function processLoginFailed(t){this.auth.clientSocket.doDisconnect(Qh.ACTIVE,t),this.checkLoginTerminalCode(t.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",t)},t.changeLoginClient=function changeLoginClient(t,a){var c=this,m=map$6(a).call(a,(function(t){return formatLoginInfo(t)}));if(t===nu.V2NIM_LOGIN_CLIENT_CHANGE_LIST)this.loginClients=m,this.auth.emit("onLoginClientChanged",t,this.loginClients);else if(t===nu.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN){var h=filter(m).call(m,(function(t){var a,m=filter(a=c.loginClients).call(a,(function(a){return a.clientId===t.clientId}));return c.loginClients.push(t),0===m.length}));h.length>0&&this.auth.emit("onLoginClientChanged",t,h)}else if(t===nu.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT){var g=filter(m).call(m,(function(t){var a;return ug(c.loginClients,(function(a){return a.clientId===t.clientId&&a.consid===t.consid})),0===filter(a=c.loginClients).call(a,(function(a){return a.clientId===t.clientId})).length}));g.length>0&&this.auth.emit("onLoginClientChanged",t,g)}},t.checkAutoLogin=function checkAutoLogin(t){if(t)return!1;var a=_p.localStorage.getItem(this.lastLoginClientKey);if(!a)return!1;var c="",m="";try{var h=JSON.parse(a);c=Rs(h,"clientId"),m=Rs(h,"account")}catch(t){return!1}return c===this.auth.deviceId&&m===this.auth.account},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){var a=[Lu.V2NIM_ERROR_CODE_CANCELLED,Lu.V2NIM_ERROR_CODE_TIMEOUT,Lu.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Lu.V2NIM_ERROR_CODE_FORBIDDEN,Lu.V2NIM_ERROR_CODE_NOT_FOUND,Lu.V2NIM_ERROR_CODE_PARAMETER_ERROR,Lu.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Lu.V2NIM_ERROR_CODE_IM_DISABLED,Lu.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Lu.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Lu.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Lu.V2NIM_ERROR_CODE_INVALID_TOKEN,Lu.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Lu.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Lu.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Lu.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return includes(a).call(a,t)},t.reset=function reset(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function clearLastLoginClient(){_p.localStorage.removeItem(this.lastLoginClientKey)},V2NIMLoginAuthenticator}(),pg=function(){function V2NIMLoginLifeCycle(t){this.name="V2NIMLoginLifeCycle",this.loginStatus=eu.V2NIM_LOGIN_STATUS_LOGOUT,this.connectStatus=au.V2NIM_CONNECT_STATUS_DISCONNECTED,this.core=t,this.auth=t.V2NIMLoginService,this.logger=t.logger}var t=V2NIMLoginLifeCycle.prototype;return t.processEvent=function processEvent(t,a,c){var m=this.getConnectStatus();switch(t){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_CONNECTING);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_CONNECTING);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGINING),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_CONNECTED);break;case"connectFail":this.logger.log(this.name+"::connect fail",a),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED,a);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",a),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",a);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGINED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",c);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",a),!a)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(a.code)?eu.V2NIM_LOGIN_STATUS_LOGOUT:eu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.auth.emit("onLoginFailed",a);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",c),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",a),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_LOGOUT),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_DISCONNECTED,a);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(eu.V2NIM_LOGIN_STATUS_UNLOGIN),this.setConnectStatus(au.V2NIM_CONNECT_STATUS_WAITING),m!==au.V2NIM_CONNECT_STATUS_CONNECTING&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function getConnectStatus(){return this.connectStatus},t.getLoginStatus=function getLoginStatus(){return this.loginStatus},t.setLoginStatus=function setLoginStatus(t){t!==this.loginStatus&&(this.loginStatus=t,this.logger.log('V2NIMLoginService::emit event "onLoginStatus", means '+eu[t]),this.auth.emit("onLoginStatus",t))},t.setConnectStatus=function setConnectStatus(t,a){if(t!==this.connectStatus){var c=this.connectStatus;this.connectStatus=t,this.logger.log('V2NIMLoginService::emit event "onConnectStatus", means '+au[t]),this.auth.emit("onConnectStatus",t),this.delegateConnectEvent(c,t,a)}},t.delegateConnectEvent=function delegateConnectEvent(t,a,c){t===au.V2NIM_CONNECT_STATUS_CONNECTED&&a===au.V2NIM_CONNECT_STATUS_DISCONNECTED&&c&&this.auth.emit("onDisconnected",c),t===au.V2NIM_CONNECT_STATUS_CONNECTING&&a===au.V2NIM_CONNECT_STATUS_DISCONNECTED&&c&&this.auth.emit("onConnectFailed",c)},V2NIMLoginLifeCycle}(),mg=function(){function V2NIMLoginDataSync(t){this.core=t,this.auth=t.V2NIMLoginService,this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1}var t=V2NIMLoginDataSync.prototype;return t.switchDataSync=function switchDataSync(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I,M;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:c=t.type,m=t.state,h=t.error,g=t.subType,c===Hl.V2NIM_DATA_SYNC_TYPE_MAIN&&m===$l.V2NIM_DATA_SYNC_STATE_COMPLETED&&("mainSync"===g?this.mainSyncFlag=!0:"conversationSync"===g&&(this.conversationSyncFlag=!0)),I=filter(a=this.datas).call(a,(function(t){return t.type===c})),(M=I.length>0?I[0]:null)?(M.state=m,M.error=h):this.datas.push({type:c,state:m,error:h}),this.core.logger.log('V2NIMLoginService::emit event "onDataSync", means '+Hl[c]+" and "+$l[m],h),c===Hl.V2NIM_DATA_SYNC_TYPE_MAIN&&(m===$l.V2NIM_DATA_SYNC_STATE_SYNCING?this.auth.emit("onDataSync",c,m,h):m===$l.V2NIM_DATA_SYNC_STATE_COMPLETED&&this.mainSyncFlag&&this.conversationSyncFlag&&(this.auth.emit("onDataSync",c,m,h),this.mainSyncFlag=!1,this.conversationSyncFlag=!1));case 7:case"end":return T.stop()}}),_callee,this)})))},t.reset=function reset(){this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1},V2NIMLoginDataSync}();var hg,fg,vg=function uniqBy(t,a){return t&&t.length?Dm(t,ng(a)):[]},yg=["https://lbs.netease.im/lbs/webconf.jsp"],_g={retryCount:3,timeout:6e4,forceMode:!1,authType:Zl.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,syncLevel:0},Ig=function(t){function V2NIMLoginServiceImpl(a,c){var m;void 0===c&&(c={}),(m=t.call(this,"V2NIMLoginService",a)||this).account="",m.previousLoginAccount="",m.token="",m.deviceId="",m.clientSession="",m.processId="",m.kickedDetail=null,m.binaryWebsocket=!0,registerParser({cmdMap:Ah,cmdConfig:kh}),"v2"===a.options.apiVersion&&(registerParser({cmdMap:Nh,cmdConfig:wh}),m.core.auth=Qe(m)),m.previousLoginManager=new Ip,m.doLoginStepsManager=new Ip,m.loginTimerManager=new Mh,m.loginOption=qt({},_g),m.config={lbsUrls:yg,linkUrl:"weblink05.netease.im:443"},m.setOptions(c),a.V2NIMLoginService=Qe(m);var h,g=m.core.options.binaryWebsocket,I="BROWSER"===_p.platform&&"function"==typeof TextDecoder&&"function"==typeof TextEncoder&&"function"==typeof Uint8Array;return"boolean"==typeof g&&(I=I&&g),I?(m.binaryWebsocket=!0,h=new ef(m.core)):(m.binaryWebsocket=!1,h=new tf(m.core)),m.clientSocket=h,"v2"===m.core.options.apiVersion&&(m.core.clientSocket=h),m.lifeCycle=new pg(a),m.reconnect=new rf(a),m.lbs=new nf(a),m.authenticator=new dg(a),m.dataSync=new mg(a),m}wt(V2NIMLoginServiceImpl,t);var a=V2NIMLoginServiceImpl.prototype;return a.setOptions=function setOptions(t){validate({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t,"",!0),this.config=assignOptions(this.config,t);var a="",c="";this.config.isFixedDeviceId?(a=_p.localStorage.getItem("__NIM_DEVC_ID__")||mm(),c=_p.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||mm(),_p.localStorage.setItem("__NIM_DEVC_ID__",a),_p.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",c)):(a=mm(),c=mm()),this.deviceId=a,this.clientSession=c,this.core.reporter.setConfig({common:{dev_id:a}})},a.reset=function reset(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},a.login=function login(t,a,c){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var m=this;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkApiVersion(),t){h.next=3;break}throw new qu({detail:{reason:"Empty account"}});case 3:if(validate({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:getEnumValues(Zl),required:!1},syncLevel:{type:"enum",values:getEnumValues(jl),required:!1}},c,"",!0),0!==c.authType||a){h.next=6;break}throw new qu({detail:{reason:"When authType is 0, token cannot be empty"}});case 6:if(""!==this.previousLoginAccount&&this.previousLoginAccount!==t&&this.core._clearModuleData(),this.getLoginStatus()!==eu.V2NIM_LOGIN_STATUS_LOGOUT){h.next=11;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+t,c),h.next=17;break;case 11:if(this.getLoginStatus()!==eu.V2NIM_LOGIN_STATUS_LOGINED){h.next=15;break}return h.abrupt("return",this.smoothForLogined(t,a,c));case 15:if(this.getLoginStatus()!==eu.V2NIM_LOGIN_STATUS_LOGINING){h.next=17;break}return h.abrupt("return",this.smoothForLogining(t,a,c));case 17:return this.account=t,this.previousLoginAccount=t,this.token=a,this.processId=mm(),this.loginOption=assignOptions(_g,c),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var t=new Fu({code:Lu.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});m.doLoginStepsManager.clear(t),m.previousLoginManager.clear(t),m.originLoginPromise=void 0,m.lifeCycle.processEvent("exited",t)}),this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),h.prev=25,h.next=28,this.multiTryDoLogin();case 28:this.loginTimerManager.destroy(),h.next=35;break;case 31:throw h.prev=31,h.t0=h.catch(25),this.loginTimerManager.destroy(),h.t0;case 35:case"end":return h.stop()}}),_callee,this,[[25,31]])})))},a.getChatroomLinkAddress=function getChatroomLinkAddress(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m;return Lc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return validate({roomId:{type:"string",required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:t,miniProgram:a},"",!0),c="unknow environment"!==getMiniappEnv(),a=void 0===a?c:a,h.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:t,miniProgram:a});case 5:return m=h.sent,h.abrupt("return",m.content.linkAddress);case 7:case"end":return h.stop()}}),_callee2,this)})))},a.multiTryDoLogin=function multiTryDoLogin(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h;return Lc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:a=new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),c=0;case 2:if(!(c<=this.loginOption.retryCount)){g.next=32;break}return m="V2NIMLoginService::times of login try: "+c,c>0?this.logger.warn(m):this.logger.log(m),g.prev=5,this.originLoginPromise=t||this.doLogin(!1),t=void 0,g.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return h=g.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,g.abrupt("return",h);case 18:if(g.prev=18,g.t0=g.catch(5),a=g.t0||a,this.logger.error("V2NIMLoginService::login failed, times of login try: "+c+", err.code: "+(null==a?void 0:a.code)+', err.message: "'+(null==a?void 0:a.message)+'"'),a.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(a&&a.code)){g.next=28;break}throw this.lifeCycle.processEvent("exited",a),a;case 28:a&&399===a.code&&this.lbs.reset();case 29:c++,g.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",a),a;case 34:case"end":return g.stop()}}),_callee3,this,[[5,18]])})))},a.doLogin=function doLogin(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var c,m,h;return Lc.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:return c=!!t||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",c?{user_id:this.account,action:"auto_login",binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Uc(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:_p.net.getNetworkStatus()}),g.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return m=g.sent,g.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(m,t));case 9:return g.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(c));case 11:return h=g.sent,this.lifeCycle.processEvent("loginSucc",void 0,qt(qt({},h),{isReconnect:t})),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.clientSocket.ping(),this.core.abtest.abtRequest(),null===(a=this.core.V2NIMClientAntispamUtil)||void 0===a||a.downloadLocalAntiSpamVocabs(),g.prev=18,g.next=21,this.core.cloudStorage.init();case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(18),this.logger.warn("doLogin::cloudStorage init error",g.t0);case 26:return g.abrupt("return",h);case 27:case"end":return g.stop()}}),_callee4,this,[[18,23]])})))},a.smoothForLogined=function smoothForLogined(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var m;return Lc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:if(m=this.checkIsSameLogin(t,a,c),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+m),!m){h.next=6;break}return h.abrupt("return");case 6:return h.next=8,this.logout();case 8:return h.abrupt("return",this.login(t,a,c));case 9:case"end":return h.stop()}}),_callee5,this)})))},a.smoothForLogining=function smoothForLogining(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var m;return Lc.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:if(m=this.checkIsSameLogin(t,a,c),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+m),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=t,this.previousLoginAccount=t,this.token=a,this.loginOption=assignOptions(this.loginOption,c),!m){h.next=18;break}if(this.originLoginPromise){h.next=11;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),h.next=14,Mi.resolve();case 14:return h.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:h.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Qh.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),h.next=24,Mi.resolve();case 24:return h.abrupt("return",this.login(t,a,c));case 25:case"end":return h.stop()}}),_callee6,this)})))},a.checkIsSameLogin=function checkIsSameLogin(t,a,c){return this.account===t&&this.loginOption.authType===c.authType&&(c.authType!==Zl.V2NIM_LOGIN_AUTH_TYPE_DEFAULT||this.token===a)},a.logout=function logout(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var t,a;return Lc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),a=this.getLoginStatus(),c.t0=a,c.next=c.t0===eu.V2NIM_LOGIN_STATUS_LOGINED?10:c.t0===eu.V2NIM_LOGIN_STATUS_LOGINING?25:c.t0===eu.V2NIM_LOGIN_STATUS_UNLOGIN?29:c.t0===eu.V2NIM_LOGIN_STATUS_LOGOUT?33:35;break;case 10:return c.prev=10,c.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),c.next=24;break;case 18:c.prev=18,c.t1=c.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",c.t1),this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return c.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),c.abrupt("break",37);case 33:throw this.core._clearModuleData(),new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+a+". connectStatus "+t}});case 35:throw this.core._clearModuleData(),new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+a+". connectStatus "+t}});case 37:case"end":return c.stop()}}),_callee7,this,[[10,18]])})))},a.getConnectStatus=function getConnectStatus(){return this.lifeCycle.getConnectStatus()},a.getLoginStatus=function getLoginStatus(){return this.lifeCycle.getLoginStatus()},a.getLoginUser=function getLoginUser(){return this.account},a.getLoginClients=function getLoginClients(){return vg(this.authenticator.loginClients,"clientId")},a.getDataSync=function getDataSync(){var t=this.dataSync.datas;return t&&t.length>0?map$6(t).call(t,(function(t){return{type:t.type,state:t.state}})):null},a.setReconnectDelayProvider=function setReconnectDelayProvider(t){this.reconnect._setReconnectDelayProvider(t)},a.kickOffline=function kickOffline(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkApiVersion(),validate({clientId:{type:"string",allowEmpty:!1}},t,"",!0),c.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[t.clientId]});case 4:if(a=c.sent,0!==Rs(a,"content.clientIds.length")){c.next=8;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return c.stop()}}),_callee8,this)})))},a.getKickedOfflineDetail=function getKickedOfflineDetail(){return this.kickedDetail},a.checkLoginTerminalCode=function checkLoginTerminalCode(t){return this.authenticator.checkLoginTerminalCode(t)},a.checkIllegalState=function checkIllegalState(){if(!this.getLoginUser())throw new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE})},a._checkApiVersion=function _checkApiVersion(){if("v2"!==this.core.options.apiVersion)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},a.v2LoginHandler=function v2LoginHandler(t){if(t.error)throw this.clientSocket.doDisconnect(Qh.ACTIVE,t.error),t.error;return t},a.v2LoginClientChangeHandler=function v2LoginClientChangeHandler(t){this.authenticator.changeLoginClient(zp(t.content.state),t.content.datas)},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){this.authenticator.changeLoginClient(zp(t.content.state),t.content.datas)},a.qchatLoginClientChangeHandler=function qchatLoginClientChangeHandler(t){var a=zp(t.content.state);a=1===a?nu.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN:nu.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT,this.authenticator.changeLoginClient(a,[t.content.data])},a.v2BeKickedHandler=function v2BeKickedHandler(t){if(t.error)this.core.logger.error("v2BeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){return format({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},t)}(t.content);this.core.logger.warn("v2Bekicked::",a),this.kickedDetail=a,this.clientSocket.doDisconnect(Qh.KICKED,a),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new Fu({code:Lu.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),a),this.emit("onKickedOffline",a)}},V2NIMLoginServiceImpl}(ch),Mg=function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=Rs(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},Service}(),Tg={"5_1":"sync"},Sg={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},Eg=function(t){function SyncService(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"sync",a)||this).syncDoneFlag=!1,m.config={myInfo:!!a.user.name,offlineMsgs:!!a.msg.name,teams:!!a.team.name,myTeamMembers:!!a.team.name,roamingMsgs:!!a.msg.name,relations:!!a.user.name,friends:!!a.friend.name,friendUsers:!!a.user.name,msgReceipts:!!a.msg.name,broadcastMsgs:!!a.msg.name,recallMsg:!!a.msg.name,sessionAck:!!a.session.name,superTeamSessionAck:!!a.session.name,superTeams:!!a.superTeam.name,mySuperTeamMembers:!!a.superTeam.name,superTeamRoamingMsgs:!!a.superTeam.name,deleteSuperTeamMsg:!!a.superTeam.name,deleteSelfMsgs:!!a.msg.name,sessionHistoryMsgsDelete:!!a.msgLog.name,avSignal:!!a.signaling.name},m.setOptions(c),m.timetags={},m.initEventListeners(),registerParser({cmdMap:Tg,cmdConfig:Sg}),m}wt(SyncService,t);var a=SyncService.prototype;return a.setOptions=function setOptions(t){qt(this.config,t)},a.reset=function reset(){this.timetags={},this.syncDoneFlag=!1},a.getSyncDoneFlag=function getSyncDoneFlag(){return this.syncDoneFlag},a.doSync=function doSync(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return a=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",a),m.prev=2,m.next=5,this.core.clientSocket.sendCmd("sync",{sync:a});case 5:c=m.sent,this.core.logger.log("sync::doSyncV1 done in",null===(t=c.content)||void 0===t?void 0:t.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.next=17;break;case 11:return m.prev=11,m.t0=m.catch(2),this.core.logger.error("sync::doSyncV1 error",m.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),m.abrupt("return");case 17:case"end":return m.stop()}}),_callee,this,[[2,11]])})))},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("logined",(function(){t.syncDoneFlag=!1,t.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(a){var c;forEach$1(c=mn(a)).call(c,(function(c){a[c]>(t.timetags[c]||0)&&(t.timetags[c]=a[c])}))}))},a.genSyncParams=function genSyncParams(){var t,a,c=this;return reduce(t=filter(a=mn(this.config)).call(a,(function(t){var a=t;return c.config[a]}))).call(t,(function(t,a){var m=a;return t[m]=c.timetags[m]||0,t}),{})},a.handleImmediate=function handleImmediate(t){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Mi.resolve(t)},a.delaySyncDone=function delaySyncDone(t){var a=this;return"ALI"===getMiniappEnv()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Mi((function(c){qi((function(){a.handleImmediate(t).then((function(){c(t)}))}),100)}))):this.handleImmediate(t)},a.syncHandler=function syncHandler(t){return this.delaySyncDone(t)},SyncService}(Mg),bg=["error","warn","log","debug"],Cg=function emptyFunc(){},Ag=["off","error","warn","log","debug"],Ng=function(){function Logger(t){this.strategies={debug:{name:"debug",func:console.log},log:{name:"  log",func:console.log},warn:{name:" warn",func:console.warn},error:{name:"error",func:console.error}},this.debug=Cg,this.log=Cg,this.warn=Cg,this.error=Cg,includes(Ag).call(Ag,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,c=findIndex$1(bg).call(bg,(function(a){return a===t}));forEach$1(bg).call(bg,(function(t,m){m<=c&&(a[t]=function(){var a=slice(Array.prototype).call(arguments),c=this.strategies[t],m=this.formatArgs(a,c.name);c.func(m)})}))},t.formatArgs=function formatArgs(t,a){var c=new Date;return"[NIM "+a+" "+(c.getMonth()+1+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds())+"] "+map$6(t).call(t,(function(t){return t instanceof Fu?t.toString():t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?Uc(t):t})).join(" ")},t.destroy=function destroy(){this.debug=Cg,this.log=Cg,this.warn=Cg,this.error=Cg},Logger}(),Rg=function(){function CoreAdapters(t){this.core=t}var t=CoreAdapters.prototype;return t.getFileUploadInformation=function getFileUploadInformation(t){return _p.getFileUploadInformation(t)},t.request=function request(t,a,c){var m=this,h=(new Date).getTime(),g=(null==c?void 0:c.exception_service)||0;return _p.request(t,a).catch((function(c){var I,M,T,S,E=c;throw m.core.reporter.reportTraceStart("exceptions",{user_id:m.core.options.account||(null===(M=null===(I=m.core)||void 0===I?void 0:I.auth)||void 0===M?void 0:M.account),trace_id:null===(S=null===(T=m.core.clientSocket)||void 0===T?void 0:T.socket)||void 0===S?void 0:S.sessionId,start_time:h,action:1,exception_service:g}),m.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof E.code?E.code:0,description:E.message||""+E.code,operation_type:0,target:t,context:a?Uc(a):""},{asyncParams:_p.net.getNetworkStatus()}),m.core.reporter.reportTraceEnd("exceptions",1),c}))},t.uploadFile=function uploadFile(t){var a=this,c=(new Date).getTime();return _p.uploadFile(t).catch((function(m){var h,g,I,M,T=m;a.core.reporter.reportTraceStart("exceptions",{user_id:a.core.options.account||(null===(g=null===(h=a.core)||void 0===h?void 0:h.auth)||void 0===g?void 0:g.account),trace_id:null===(M=null===(I=a.core.clientSocket)||void 0===I?void 0:I.socket)||void 0===M?void 0:M.sessionId,start_time:c,action:1,exception_service:3});var S="BROWSER"===_p.platform?t.chunkUploadHost:t.commonUploadHost?t.commonUploadHost+"/"+(t.nosToken&&t.nosToken.bucket):"https://nos.netease.com/nim";throw a.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof T.code?T.code:0,description:T.message||""+T.code,operation_type:1,target:S},{asyncParams:_p.net.getNetworkStatus()}),a.core.reporter.reportTraceEnd("exceptions",1),m}))},CoreAdapters}(),kg=function(){function ABTest(t,a){this.abtInfo={},this.core=t,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:nh,abtestProjectKey:ah},a)}var t=ABTest.prototype;return t.setOptions=function setOptions(t){this.config=assignOptions(this.config,t)},t.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(this.config.isAbtestEnable){m.next=2;break}return m.abrupt("return");case 2:if(!this.abtInfo.experiments){m.next=4;break}return m.abrupt("return");case 4:if(this.config.abtestUrl){m.next=6;break}return m.abrupt("return");case 6:return m.prev=6,m.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.2.700",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:c=m.sent,m.next=15;break;case 12:m.prev=12,m.t0=m.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==c?void 0:c.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{};case 16:case"end":return m.stop()}}),_callee,this,[[6,12]])})))},ABTest}();!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(hg||(hg={})),function(t){t.Destroy="destroy",t.Logout="logout"}(fg||(fg={}));var wg={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},Og={antispamBusinessId:1},Pg="V2NIMTeamService",xg={teamId:1,name:3,teamType:{id:4,retConverter:function retConverter(t){return 0==+t?1:+t}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function retConverter(t,a){return 1==+t&&(void 0===a[13]||1==+a[13])}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},Vg={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14},Lg={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"}},Dg={v2TeamCreate:{sid:31,cid:1,service:Pg,params:[{type:"Property",name:"team",reflectMapper:xg},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Og}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:Pg,params:[{type:"Property",name:"team",reflectMapper:xg},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Og}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:Pg,params:[{type:"Property",name:"team",reflectMapper:xg},{type:"Property",name:"antispamConfig",reflectMapper:Og}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:Pg,params:[{type:"Property",name:"team",reflectMapper:xg},{type:"Property",name:"antispamConfig",reflectMapper:Og}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:Pg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:Pg,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:Pg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:Pg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2TeamGetByIds:{sid:31,cid:34,service:Pg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:invertSerializeItem(xg)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:Pg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:invertSerializeItem(xg)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:Pg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:Pg,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2TeamRejectInvite:{sid:31,cid:22,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:invertSerializeItem(xg)}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:Pg,params:[{type:"Property",name:"teamMember",reflectMapper:Vg}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:Pg,params:[{type:"Property",name:"teamMember",reflectMapper:Lg}]},v2TeamUpdateMember:{sid:31,cid:20,service:Pg,params:[{type:"Property",name:"teamMember",reflectMapper:Vg}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:Pg,params:[{type:"Property",name:"teamMember",reflectMapper:Lg}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:Pg,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:Pg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:Pg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:Pg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:Pg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Vg)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:Pg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Lg)}]},v2TeamMemberGetList:{sid:31,cid:36,service:Pg,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function converter(t){return+t}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Vg)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:Pg,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(xg)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:Pg,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(xg)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:Pg,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Vg)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:Pg,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Vg)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:Pg,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(xg)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:Pg,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(xg)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:Pg,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Lg)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:Pg,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Lg)},{type:"Long",name:"timetag"}]}};function formatTeamNotificationAttachData(t,a){if(!t)return{};var c=t;return c.tinfo&&(c.tinfo=function formatTeamFromTinfo(t){return deserialize(t,invertSerializeItem(xg))}(c.tinfo),c.tinfo.teamType=a),c.uinfos,void 0!==c.mute&&(c.mute=zp(c.mute)),c}function generateTeamByTeamId(t,a,c){return void 0===c&&(c={}),qt({teamId:t,teamType:a,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:Mu.V2NIM_TEAM_JOIN_MODE_FREE,agreeMode:Tu.V2NIM_TEAM_AGREE_MODE_AUTH,inviteMode:Su.V2NIM_TEAM_INVITE_MODE_MANAGER,updateInfoMode:Eu.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER,updateExtensionMode:Cu.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER,chatBannedMode:bu.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,isValidTeam:!0,messageNotifyMode:Au.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL},c)}function generateMemberByTeamId(t,a,c,m){return void 0===m&&(m={}),qt({teamId:t,teamType:a,accountId:c,joinTime:0,inTeam:!0,memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_NORMAL,chatBanned:!1},m)}function processTeamMembers(t,a){return void 0===a&&(a=Iu.V2NIM_TEAM_TYPE_ADVANCED),map$6(t).call(t,(function(t){return function processTeamMember(t,a){return void 0===a&&(a=Iu.V2NIM_TEAM_TYPE_ADVANCED),t.teamType=a,t.chatBanned=void 0!==t.chatBanned&&t.chatBanned,t}(t,a)}))}function completeMessage(t,a){var c=qt(qt({},a),{conversationId:t.V2NIMConversationIdUtil.messageConversationId(a),isSelf:a.senderId===t.account,sendingState:cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED});return c.threadReply&&(c.threadReply=qt(qt({},c.threadReply),{conversationType:c.conversationType,conversationId:c.conversationId})),c.threadRoot&&(c.threadRoot=qt(qt({},c.threadRoot),{conversationType:c.conversationType,conversationId:c.conversationId})),c}function completeMessageRefer(t,a){return qt(qt({},a),{conversationId:t.V2NIMConversationIdUtil.messageConversationId(a)})}function formatMessageRefer(t,a){var c=a.createTime,m=a.senderId,h=a.receiverId,g=a.conversationType;return{conversationType:g,conversationId:t.V2NIMConversationIdUtil.messageConversationId({conversationType:g,senderId:m,receiverId:h}),senderId:a.senderId,receiverId:a.receiverId,messageServerId:a.messageServerId,createTime:c,messageClientId:a.messageClientId}}function formatRevokeMessage(t,a){var c={7:uu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY,8:uu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY,12:uu.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY,13:uu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY,14:uu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY},m={7:Yl.V2NIM_CONVERSATION_TYPE_P2P,8:Yl.V2NIM_CONVERSATION_TYPE_TEAM,12:Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM,13:Yl.V2NIM_CONVERSATION_TYPE_P2P,14:Yl.V2NIM_CONVERSATION_TYPE_TEAM}[a.sysMsgType];return{postscript:a.postscript,revokeType:c[a.sysMsgType]||uu.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED,revokeAccountId:a.opeAccount||a.senderId,callbackExtension:a.callbackExtension,serverExtension:a.attach||"",messageRefer:{conversationType:m,conversationId:t.V2NIMConversationIdUtil.messageConversationId(qt(qt({},a),{conversationType:m,senderId:a.senderId,receiverId:a.receiverId})),senderId:a.senderId,receiverId:a.receiverId,messageServerId:a.messageServerId,createTime:a.deleteMsgCreatetime,messageClientId:a.messageClientId}}}function formatClearHistoryNotification(t,a){return{conversationId:a.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?t.V2NIMConversationIdUtil.p2pConversationId(a.receiverId):a.conversationType===Yl.V2NIM_CONVERSATION_TYPE_TEAM?t.V2NIMConversationIdUtil.teamConversationId(a.teamId):t.V2NIMConversationIdUtil.superTeamConversationId(a.teamId),deleteTime:a.deleteTime,serverExtension:a.serverExtension}}function convertNotificationType(t,a){var c={0:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE,401:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE,1:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK,402:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK,2:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE,403:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE,3:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO,404:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO,4:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS,405:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS,5:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS,410:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS,6:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER,406:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER,7:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER,407:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER,8:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER,408:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER,9:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT,411:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT,10:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER,409:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER};return void 0===c[a]&&t.logger.warn("[V2NIMMessageService] undefined notification type: "+a),"number"==typeof c[a]?c[a]:ou.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED}function formatMessageAttachment(t,a){return t.messageType===iu.V2NIM_MESSAGE_TYPE_NOTIFICATION?function formatNotificationMessage(t,a){var c,m,h,g,I,M=a.attachment||{};if(a.attachment&&"type"in a.attachment)return a;var T=void 0;if(null===(c=M.data)||void 0===c?void 0:c.tinfo){var S=M.id,E=M.data,b=S>400?Iu.V2NIM_TEAM_TYPE_SUPER:Iu.V2NIM_TEAM_TYPE_ADVANCED,C=formatTeamNotificationAttachData(qt({},E),b).tinfo;T={},C.teamId,T=__rest(C,["teamId"])}var A=qt(qt(qt(qt({raw:M.raw,type:convertNotificationType(t,M.id)},T?{updatedTeamInfo:T}:{}),{targetIds:(null===(m=M.data)||void 0===m?void 0:m.ids)||((null===(h=M.data)||void 0===h?void 0:h.id)?[M.data.id]:[])}),"string"==typeof(null===(g=M.data)||void 0===g?void 0:g.attach)?{serverExtension:M.data.attach}:{}),"number"==typeof(null===(I=M.data)||void 0===I?void 0:I.mute)?{chatBanned:M.data.mute!==gu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF}:{});return qt(qt({},a),{attachment:A})}(a,t):t}function attachmentToRaw(t,a){if(!a)return"";switch(t){case iu.V2NIM_MESSAGE_TYPE_CUSTOM:return a.raw||"";case iu.V2NIM_MESSAGE_TYPE_IMAGE:case iu.V2NIM_MESSAGE_TYPE_VIDEO:case iu.V2NIM_MESSAGE_TYPE_AUDIO:case iu.V2NIM_MESSAGE_TYPE_FILE:return function mediaAttachmentToRaw(t){var a=t,c=a.width,m=a.height,h=a.duration;a.path,a.file,a.raw,a.ctx,a.payload,a.bucketName,a.objectName,a.token,a.md5;var g=__rest(a,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","md5"]);return Uc(qt(qt(qt(qt({},g),void 0===c?{}:{w:c}),void 0===m?{}:{h:m}),void 0===h?{}:{dur:h}))}(a);case iu.V2NIM_MESSAGE_TYPE_LOCATION:return function locationAttachmentToRaw(t){return Uc({lat:t.latitude,lng:t.longitude,title:t.address})}(a);case iu.V2NIM_MESSAGE_TYPE_CALL:return function callAttachmentToRaw(t){t.raw;var a=__rest(t,["raw"]);try{var c;return Uc(qt(qt({},a),{durations:map$6(c=t.durations).call(c,(function(t){return{accid:t.accountId,duration:t.duration}}))}))}catch(a){return Uc(t)}}(a);default:return Uc(a)}}function rawToAttachment(t,a){var c;try{switch(c=JSON.parse(t),a){case iu.V2NIM_MESSAGE_TYPE_CUSTOM:return{raw:t};case iu.V2NIM_MESSAGE_TYPE_LOCATION:return function locationRawToAttachment(t,a){return{latitude:a.lat,longitude:a.lng,address:a.title,raw:t}}(t,c);case iu.V2NIM_MESSAGE_TYPE_AUDIO:case iu.V2NIM_MESSAGE_TYPE_VIDEO:case iu.V2NIM_MESSAGE_TYPE_IMAGE:case iu.V2NIM_MESSAGE_TYPE_FILE:return function mediaRawToAttachment(t,a){var c=a.w,m=a.h,h=a.dur,g=__rest(a,["w","h","dur"]);return qt(qt(qt(qt(qt({},g),void 0===c?{}:{width:c}),void 0===m?{}:{height:m}),void 0===h?{}:{duration:h}),{raw:t})}(t,c);case iu.V2NIM_MESSAGE_TYPE_CALL:return function callRawToAttachment(t,a){var c;return qt(qt({},a),{durations:map$6(c=a.durations).call(c,(function(t){return{accountId:t.accid,duration:t.duration}})),raw:t})}(t,c);default:return"object"==typeof c&&c?qt(qt({},c),{raw:t}):{raw:t}}}catch(a){return"object"==typeof c&&c?qt(qt({},c),{raw:t}):{raw:t}}}var Ug="V2NIMMessageService",Fg={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},Bg={conversationType:{id:0,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function converter(t,a){return attachmentToRaw(a.messageType,t)},retConverter:function retConverter(t,a){return rawToAttachment(t,Number(a[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:boolToInt,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function def(t){if(t["pushConfig.forcePush"])return"#%@all@%#"},converter:function converter(t,a){if(a["pushConfig.forcePush"]){if(0===t.length)return"#%@all@%#";try{return Uc(t)}catch(t){return"#%@all@%#"}}},retConverter:function retConverter(t){if("#%@all@%#"===t)return t;if(t)try{return JSON.parse(t)}catch(t){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:boolToInt,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function def(t){return Rs(t,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function retConverter(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:boolToInt,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:boolToInt,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:boolToInt,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:boolToInt,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:objectToJSONString,retConverter:stringToJSONObject},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:boolToInt,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:boolToInt,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:boolToInt,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:boolToInt,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:boolToInt,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:boolToInt,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:boolToInt,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:boolToInt,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"}},qg=invertSerializeItem(Bg),Gg={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};invertSerializeItem(Gg);var jg,Hg,$g,Yg={version:1,md5:2,nosurl:3,thesaurus:4},Wg={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},zg={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},Kg={v2SendP2pMessage:{sid:30,cid:1,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Bg}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Bg)}]},onMsg:{sid:7,cid:2,service:Ug,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Bg)}]},syncOfflineMsgs:{sid:4,cid:4,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Bg)}]},syncRoamingMsgs:{sid:4,cid:9,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Bg}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2RevokeMessage:{sid:30,cid:13,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Wg}]},v2DeleteMessage:{sid:30,cid:23,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Gg}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:Gg}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Bg}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:zg}],response:[{type:"PropertyArray",name:"tag",reflectMapper:invertSerializeItem(zg)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Bg}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Wg}]},syncP2PMessagReceipts:{sid:4,cid:12,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Bg)}]},onP2PMessageReceipts:{sid:7,cid:12,service:Ug,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:Ug,params:[{type:"PropertyArray",name:"tag",reflectMapper:zg}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(zg)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:zg,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(zg)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(zg)}]},onRevokeMessage:{sid:7,cid:14,service:Ug,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Wg)}]},syncRevokeMessage:{sid:7,cid:15,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Wg)}]},syncOnDeleteMessages:{sid:4,cid:21,service:Ug,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Gg)}]},onDeleteMessage:{sid:7,cid:123,service:Ug,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Gg)}]},onDeleteMessages:{sid:7,cid:124,service:Ug,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Gg)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:Ug,params:[{type:"Property",name:"tag",reflectMapper:Yg}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Yg)}]}};function conversationTypeV2ToV1(t){return t===Yl.V2NIM_CONVERSATION_TYPE_P2P?0:t===Yl.V2NIM_CONVERSATION_TYPE_TEAM?1:t===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?5:void 0}function conversationTypeV1ToV2(t){var a=zp(t);return 0===a?Yl.V2NIM_CONVERSATION_TYPE_P2P:1===a?Yl.V2NIM_CONVERSATION_TYPE_TEAM:5===a?Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM:Yl.V2NIM_CONVERSATION_TYPE_UNKNOWN}var Qg="V2NIMMessageLogUtil",Jg={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},Xg={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:boolToInt},teamId:3,onlineSync:{id:4,converter:boolToInt},deleteTime:{id:6,retType:"number"},serverExtension:7},Zg=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],ev={v2GetMessageList:{sid:30,cid:6,service:Qg,params:concat(jg=[{type:"String",name:"to"}]).call(jg,Zg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Bg)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:Qg,params:[{type:"PropertyArray",name:"tag",reflectMapper:Bg,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Bg)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:Qg,params:[{type:"Property",name:"tag",reflectMapper:Xg}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:Qg,params:concat(Hg=[{type:"Long",name:"to"}]).call(Hg,Zg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Bg)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:Qg,params:concat($g=[{type:"Long",name:"to"}]).call($g,Zg),response:[{type:"PropertyArray",name:"msgs",reflectMapper:invertSerializeItem(Bg)}]},onClearHistoryMessage:{sid:7,cid:118,service:Qg,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Xg)}]},syncClearHistoryMessage:{sid:4,cid:24,service:Qg,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Xg)}]}},tv={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},rv={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},nv={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},av={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}},iv={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},ov=qt(qt({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:objectToJSONString,retConverter:stringToJSONObject},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),sv={msg:ov,recallMsgTag:qt({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},rv),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},cv=invertSerializeMap(sv),lv={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:sv.msg}],response:[{type:"Property",name:"msg",reflectMapper:cv.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:sv.msg}],response:[{type:"Property",name:"msg",reflectMapper:cv.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:sv.msg}],response:[{type:"Property",name:"msg",reflectMapper:cv.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:cv.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:cv.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:cv.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:cv.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:sv.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:sv.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:sv.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:sv.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:cv.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:cv.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:cv.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:cv.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:cv.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:cv.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:cv.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:cv.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:cv.deleteSelfMsgTag}]}},uv={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},dv={msg:ov,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},pv=invertSerializeMap(dv),mv={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:pv.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:dv.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:pv.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:pv.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:dv.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:pv.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:dv.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:pv.msg}]}},hv={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},fv={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},gv=invertSerializeMap(fv),vv={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:gv.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:gv.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:gv.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:fv.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:gv.user}]}},yv={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},_v={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},Iv=invertSerializeMap(_v),Mv={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Iv.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Iv.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:_v.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Iv.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:_v.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Iv.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:_v.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Iv.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:_v.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:Iv.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Iv.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:_v.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Iv.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Iv.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Iv.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Iv.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:_v.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:_v.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:Iv.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:Iv.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:Iv.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:Iv.teamMember},{type:"Long",name:"timetag"}]}},Tv={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},Sv={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},Ev=invertSerializeMap(Sv),bv={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:Ev.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:Ev.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:Sv.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:Ev.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Sv.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Sv.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ev.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ev.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ev.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:Ev.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:Ev.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:Ev.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:Ev.superTeamMember},{type:"Long",name:"timetag"}]}},Cv="V2NIMUserService",Av={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},Nv={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},Rv={v2UpdateBlockList:{sid:34,cid:3,service:Cv,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:Cv,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Nv)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:Cv,params:[{type:"Property",name:"tag",reflectMapper:Nv}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:Cv,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Nv)}]},onUpdateBlockList:{sid:3,cid:103,service:Cv,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:Cv,response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:Cv,response:[{type:"Property",name:"user",reflectMapper:invertSerializeItem(Nv)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:Cv,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:Cv,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}},kv=Ch({none:0,normal:1,all:3}),wv={normal:0,advanced:1},Ov=Ch(wv),Pv=Ch({normal:0,owner:1,manager:2}),xv={noVerify:0,needVerify:1,rejectAll:2},Vv=Ch(xv),Lv={needVerify:0,noVerify:1},Dv=Ch(Lv),Uv={manager:0,all:1},Fv=Ch(Uv),Bv={manager:0,all:1},qv=Ch(Bv),Gv={manager:0,all:1},jv=Ch(Gv);function formatTeam(t){var a,c=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],h=["valid","validToCurrentUser","mute"],g={type:Ov,muteType:kv,joinMode:Vv,beInviteMode:Dv,inviteMode:Fv,updateTeamMode:qv,updateExtMode:jv};t.bits;var I=__rest(t,["bits"]);return forEach$1(c).call(c,(function(t){I[t]&&(I[t]=I[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==I[t]&&(I[t]=zp(I[t]))})),forEach$1(h).call(h,(function(t){void 0!==I[t]&&(I[t]=1===zp(I[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==I[t]&&(I[t]=g[t][I[t]]||I[t])})),I}function formatTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeam(t)})):[]}function generateTeam(t){var a,c=qt({},t),m=["avatar","name","intro","announcement","ext"],h={type:wv,joinMode:xv,beInviteMode:Lv,inviteMode:Uv,updateTeamMode:Bv,updateExtMode:Gv};return forEach$1(m).call(m,(function(t){void 0!==c[t]&&(c[t]=c[t].toString())})),forEach$1(a=mn(h)).call(a,(function(t){void 0!==c[t]&&(c[t]=h[t][c[t]])})),c}function generatorTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],c={};return void 0!==t.bitConfigMask&&(c.bits=zp(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(c[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(c.nickInTeam=t.nickInTeam),c}function formatTeamMember(t){var a,c=["teamId"],m=["joinTime","updateTime","bitConfigMask"],h=["active","valid","mute"],g={type:Pv},I=t.bits,M=__rest(t,["bits"]);return void 0!==I&&(M.muteTeam=1===zp(I),M.bitConfigMask=I),M.id=M.teamId+"-"+M.account,forEach$1(c).call(c,(function(t){M[t]&&(M[t]=M[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==M[t]&&(M[t]=zp(M[t]))})),forEach$1(h).call(h,(function(t){void 0!==M[t]&&(M[t]=1===zp(M[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==M[t]&&(M[t]=g[t][M[t]]||M[t])})),M}function formatTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatTeamMember(t)})):[]}function generatorMemberByTeam(t,a,c){return void 0===c&&(c="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:c,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersByTeam(t,a,c){return void 0===c&&(c="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberByTeam(t,a,c)})):[]}var Hv=function EventForwardCenter(t){var a=this;this.bindEvents=function(){a.core.eventBus.on("forwardSend/msg/sendMsg",a.onV1SendMsg),a.core.eventBus.on("forwardSend/msg/recallMsg",a.onV1RecallMsg),a.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",a.onV1DeleteSelfMsgs),a.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",a.onV1ClearHistoryMessage),a.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",a.onV2SendMsg),a.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",a.onV2RevokeMessage),a.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",a.onV2DeleteSelfMsgs),a.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",a.onV2ClearHistoryMessage),a.core.eventBus.on("forwardSend/team/created",a.onV1TeamCreated),a.core.eventBus.on("forwardSend/team/updateMyMemberInfo",a.onV1TeamMemberUpdate),a.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",a.onV1SuperTeamMemberUpdate),a.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",a.onV2TeamMemberUpdate),a.core.eventBus.on("forwardSend/team/passTeamApply",(function(t,c){return a.onV1TeamApply(t,Iu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(function(t,c){a.onV1TeamApply(t,Iu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/team/rejectTeamApply",(function(t,c){a.onV1TeamApply(t,Iu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(function(t,c){a.onV1TeamApply(t,Iu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/team/acceptTeamInvite",(function(t,c){a.onV1TeamInvite(t,Iu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(function(t,c){a.onV1TeamInvite(t,Iu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED,c)})),a.core.eventBus.on("forwardSend/team/rejectTeamInvite",(function(t,c){a.onV1TeamInvite(t,Iu.V2NIM_TEAM_TYPE_ADVANCED,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(function(t,c){a.onV1TeamInvite(t,Iu.V2NIM_TEAM_TYPE_SUPER,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED,c)})),a.core.eventBus.on("forwardSend/user/updateBlackList",a.onV1UpdateBlackList),a.core.eventBus.on("forwardSend/user/updateUserInfo",a.onV1UpdateUserInfo),a.core.eventBus.on("forwardSend/user/setMute",a.onV1SetMute),a.core.eventBus.on("forwardSend/friend/addFriend",a.onV1AddFriend),a.core.eventBus.on("forwardSend/friend/deleteFriend",a.onV1DeleteFriend),a.core.eventBus.on("forwardSend/friend/updateFriend",a.onV1UpdateFriend),a.core.eventBus.on("forwardSend/friend/passFriendApply",a.onV1PassFriendApply),a.core.eventBus.on("forwardSend/friend/rejectFriendApply",a.onV1RejectFriendApply)},this.onV1TeamApply=function(t,c,m,h){if(h){if(!a.core.V2NIMTeamService.notification.checkIfExpired(h))return;m=ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED}a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:c,operatorAccountId:t.from,actionType:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION},m)},this.onV1TeamInvite=function(t,c,m,h){if(h){if(!a.core.V2NIMTeamService.notification.checkIfExpired(h.code))return;m=ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED}a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:t.teamId,teamType:c,operatorAccountId:t.from,actionType:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION},m)},this.onV1PassFriendApply=function(t,c){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",t,c)},this.onV1RejectFriendApply=function(t,c,m){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:t,recipientAccountId:a.core.account,operatorAccountId:a.core.account,postscript:c||"",timestamp:a.core.timeOrigin.getNTPTime(),read:!0,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED},m)},this.onV1SetMute=function(t,c){a.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",t,c?vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:vu.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF)},this.onV1UpdateFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",t.account,qt(qt({},"alias"in t?{alias:t.alias}:{}),"ext"in t?{serverExtension:t.ext}:{}))},this.onV1AddFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",t)},this.onV1DeleteFriend=function(t){a.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",t)},this.onV1UpdateUserInfo=function(t){var c=deserialize(serialize(t,fv.user),invertSerializeItem(Nv));a.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",c)},this.onV1UpdateBlackList=function(t,c){a.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",t,c)},this.onV1TeamCreated=function(t){var c=deserialize(serialize(generateTeam(t),_v.team),invertSerializeItem(xg));a.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",c)},this.onV1TeamMemberUpdate=function(t){(t=qt({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var c=deserialize(serialize(t,_v.teamMember),invertSerializeItem(Vg));c.teamType=Iu.V2NIM_TEAM_TYPE_ADVANCED,a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",c)},this.onV1SuperTeamMemberUpdate=function(t){(t=qt({},t)).type&&(t.type={normal:0,owner:1,manager:2}[t.type]);var c=deserialize(serialize(t,Sv.superTeamMember),invertSerializeItem(Lg));c.teamType=Iu.V2NIM_TEAM_TYPE_SUPER,a.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",c)},this.onV2TeamMemberUpdate=function(t){var c=t.teamType,m=serialize(t,Vg);if(c===Iu.V2NIM_TEAM_TYPE_SUPER){var h=deserialize(m,invertSerializeItem(Sv.superTeamMember));a.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",h)}else{var g=deserialize(m,invertSerializeItem(_v.teamMember));a.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",g)}},this.onV1SendMsg=function(t){var c=deserialize(serialize(t,ov),qg);(c=completeMessage(a.core,c)).sendingState="sending"===t.status?cu.V2NIM_MESSAGE_SENDING_STATE_SENDING:"sent"===t.status?cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED:cu.V2NIM_MESSAGE_SENDING_STATE_FAILED,a.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",c)},this.onV2SendMsg=function(t){var c=deserialize(serialize(t,Bg),Ch(ov));c.status=t.sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SENDING?"sending":t.sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED?"sent":"sendFailed",a.core.eventBus.emit("forwardReceive/msg/sendMsg",c)},this.onV1RecallMsg=function(t){t.deleteMsgCreatetime=t.time;var c=deserialize(serialize(t,sv.recallMsgTag),invertSerializeItem(Wg));a.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[c])},this.onV2RevokeMessage=function(t){var c=deserialize(serialize(t,Wg),cv.recallMsgTag);a.core.eventBus.emit("forwardReceive/msg/recallMsg",c)},this.onV1DeleteSelfMsgs=function(t){var c=map$6(t).call(t,(function(t){return deserialize(serialize(t,sv.deleteSelfMsgTag),invertSerializeItem(Gg))}));forEach$1(c).call(c,(function(t){t.messageRefer=formatMessageRefer(a.core,t.messageRefer)})),a.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",c)},this.onV2DeleteSelfMsgs=function(t){var c=map$6(t).call(t,(function(t){return deserialize(serialize(t,Gg),cv.deleteSelfMsgTag)}));a.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",c)},this.onV1ClearHistoryMessage=function(t){var c=deserialize(serialize(t,dv.clearHistoryMsgsFromServerReqTag),invertSerializeItem(Xg));a.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",c)},this.onV2ClearHistoryMessage=function(t){var c=deserialize(serialize(t,Xg),pv.clearHistoryMsgsFromServerReqTag);a.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",c)},this.core=t,this.bindEvents()},$v={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},Yv=function(){function ReporterHookLinkKeep(t,a){this.traceData=$v,this.core=t,this.traceData=qt({},$v,a),this.traceData.extension=[]}var t=ReporterHookLinkKeep.prototype;return t.reset=function reset(){this.traceData=qt({},$v),this.traceData.extension=[]},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function update(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,_p.net.getNetworkStatus();case 2:a=h.sent,c=a.net_type,m=a.net_connect,this.traceData.extension.push(qt({code:0,description:"",foreground:!0,foreg_backg_switch:!1,net_type:c,net_connect:m},t));case 6:case"end":return h.stop()}}),_callee,this)})))},t.end=function end(t){var a=this.traceData.extension[0],c=this.traceData.extension[1];if(a&&0===a.operation_type&&c&&1===c.operation_type){var m=a.net_type!==c.net_type||a.net_connect!==c.net_connect;if(t||!m)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},ReporterHookLinkKeep}(),Wv={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},zv=function(){function ReporterHookLBS(t){this.traceData=Wv,this.core=t,this.reset()}var t=ReporterHookLBS.prototype;return t.reset=function reset(){this.traceData=qt({},Wv),this.traceData.history=[]},t.start=function start(t){this.reset(),this.traceData.user_id=t,this.traceData.start_time=Ri()},t.updateBegin=function updateBegin(t){this.traceData.history.push(qt({head:"",body:"",start_time:Ri(),httpdns:!1,index:0},t))},t.updateComplete=function updateComplete(t){var a;forEach$1(a=this.traceData.history).call(a,(function(a){a.target===t.target&&(qt(a,t),a.duration=Ri()-a.start_time)}))},t.end=function end(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h;return Lc.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:if(this.traceData.succeed=t,this.traceData.history=filter(a=this.traceData.history).call(a,(function(t){return void 0!==t.code})),0!==this.traceData.history.length){g.next=5;break}return this.reset(),g.abrupt("return");case 5:return this.traceData.duration=Ri()-this.traceData.start_time,g.next=8,_p.net.getNetworkStatus();case 8:c=g.sent,m=c.net_type,h=c.net_connect,this.traceData.net_type=m,this.traceData.net_connect=h,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return g.stop()}}),_callee,this)})))},ReporterHookLBS}(),Kv={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},Qv="ReporterHook::setMonitorForResources:",Jv=function(){function ReporterHookCloudStorage(t,a){this.traceData=Kv,this.core=t,this.traceData=qt({},Kv,a)}var t=ReporterHookCloudStorage.prototype;return t.reset=function reset(){this.traceData=qt({},Kv)},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ri()},t.update=function update(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.traceData.user_id){a.next=2;break}return a.abrupt("return");case 2:this.core.logger.log(Qv+" upload update",t),qt(this.traceData,t);case 4:case"end":return a.stop()}}),_callee,this)})))},t.end=function end(t){this.traceData.user_id&&(this.core.logger.log(Qv+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ri())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=Kv)},ReporterHookCloudStorage}(),Xv={},Zv={},ey={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Ot,lbsUrls:rh,linkUrl:th,abtestUrl:nh,isAbtestEnable:!0},ty=function(t){function NIM(a,c){var m,h,g,I,M,T,S;void 0===c&&(c={}),(I=t.call(this)||this).instanceName="NIM",I.pluginMap={},I.eventBus=new Gi,I.options={},I.V2NIMConversationIdUtil={},I.V2NIMMessageCreator={},I.V2NIMClientAntispamUtil={},I.DataStructureConverter={},I.V2NIMMessageConverter={},I.V2NIMMessageLogUtil={},I.V2NIMMessageExtendUtil={},I.V2NIMStorageUtil={},I.V2NIMNotificationService={},I.V2NIMStorageService={},I.V1NIMLoginService={},I.V2NIMLoginService={},I.clientSocket={},I.V2NIMSyncService={},I.V2NIMConversationService={},I.V2NIMConversationGroupService={},I.V2NIMMessageService={},I.V2NIMTeamService={},I.V2NIMUserService={},I.V2NIMFriendService={},I.V2NIMSettingService={},I.offlinePush={},I.sync={},I.msg={},I.msgLog={},I.session={},I.cloudSession={},I.misc={},I.user={},I.friend={},I.systemMessage={},I.team={},I.event={},I.msgExtend={},I.cloudStorage={},I.passThrough={},I.superTeam={},I.plugin={},I.signaling={},I.qchatChannel={},I.qchatMedia={},I.qchatMsg={},I.qchatRole={},I.qchatServer={},I.pluginMap=Zv,I.eventForwardCenter=new Hv(Qe(I)),I.logger=new Ng(a.debugLevel),I.setInitOptions(a),I.otherOptions=qt(qt({},c),{cloudStorageConfig:qt({storageKeyPrefix:"NIM"},c.cloudStorageConfig)}),I.timerManager=new Mh,I.timeOrigin=new Sp(Qe(I)),I.adapters=new Rg(Qe(I)),I.abtest=new kg(Qe(I),{isAbtestEnable:I.options.isAbtestEnable,abtestUrl:I.options.abtestUrl,abtestProjectKey:ah});var E=_p.getSystemInfo(),b=null===(M=null==c?void 0:c.reporterConfig)||void 0===M?void 0:M.isDataReportEnable;return"boolean"!=typeof b&&(b=!0),I.reporter=new oo({reportConfigUrl:(null===(T=null==c?void 0:c.reporterConfig)||void 0===T?void 0:T.reportConfigUrl)||"https://statistic.live.126.net/dispatcher/req",reportUrl:(null===(S=null==c?void 0:c.reporterConfig)||void 0===S?void 0:S.reportUrl)||"https://statistic.live.126.net/statics/report/common/form",isDataReportEnable:b,common:{app_key:a.appkey,dev_id:"",platform:"Web",sdk_ver:"10.2.700",env:"online",os_name:E.os,os_ver:E.osVer,lib_env:E.libEnv,host_env:E.hostEnv,host_env_ver:E.hostEnvVer,manufactor:E.manufactor,model:E.model,v2:"v1"!==I.options.apiVersion},request:_p.request,logger:I.logger,autoStart:!0}),I.reporterHookLinkKeep=new Yv(Qe(I)),I.reporterHookCloudStorage=new Jv(Qe(I)),I.reporterHookLBS=new zv(Qe(I)),_p.setLogger(I.logger),"v1"===I.options.apiVersion?I.auth=new uh(Qe(I),I.options):I.auth=new Ig(Qe(I),I.otherOptions.V2NIMLoginServiceConfig),forEach$1(m=filter(h=mn(Xv)).call(h,(function(t){return"V1NIMLoginService"!==t&&"V2NIMLoginService"!==t&&"sync"!==t}))).call(m,(function(t){var a=Xv[t];I[t]=new a(Qe(I))})),Xv.sync&&(I.sync=new Eg(Qe(I),I.otherOptions.syncOptions)),forEach$1(g=mn(Xv)).call(g,(function(t){var a=t+"Config",c=I.otherOptions[a]||{},m=Rs(Qe(I),t+".setOptions");"function"==typeof m&&("cloudStorage"===t&&(c=I.otherOptions[a]||I.otherOptions.serverConfig||{}),m.call(I[t],c))})),NIM.instance=Qe(I),I.logger.log("NIM init, version ","10.2.700"," sdk version ",100207," appkey ",a.appkey),I}wt(NIM,t),NIM.getInstance=function getInstance(t,a){if(!NIM.instance){if(t)return new NIM(t,a);throw new Error("Instance not exist, please input options")}if(t){if(NIM.instance.options.account===t.account&&NIM.instance.options.appkey===t.appkey)return NIM.instance.setOptions(t),NIM.instance;throw new Error("Unexpected login")}return NIM.instance};var a=NIM.prototype;return a.setInitOptions=function setInitOptions(t){validate({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setInitOptions options is",t),this.options=qt(qt({},ey),t)},a.connect=function connect(t){return void 0===t&&(t={}),this.V1NIMLoginService.login(t)},a.setOptions=function setOptions(t){if("object"==typeof t&&null!==t){if(Object.prototype.hasOwnProperty.call(t,"account")&&t.account!==this.options.account||Object.prototype.hasOwnProperty.call(t,"appkey")&&t.appkey!==this.options.appkey)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"apiVersion")&&t.apiVersion!==this.options.apiVersion)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(t,"binaryWebsocket")&&t.binaryWebsocket!==this.options.binaryWebsocket)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});validate({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setOptions options is",t),this.options=qt(qt({},this.options),t),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},a.disconnect=function disconnect(){return this.V1NIMLoginService.logout()},a._disconnect=function _disconnect(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?Rs(this.V2NIMLoginService,"lifeCycle.connectStatus")===au.V2NIM_CONNECT_STATUS_DISCONNECTED&&Rs(this.V2NIMLoginService,"lifeCycle.loginStatus")===eu.V2NIM_LOGIN_STATUS_LOGOUT?Mi.resolve():this.V2NIMLoginService.logout():Mi.resolve()},a.destroy=function destroy(){var t=this;return NIM.instance=void 0,this._disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.logger.destroy(),t.reporter.destroy(),t.timerManager.destroy(),t._clearModuleData(fg.Destroy),t._removeAllModuleListeners(),t.connect=emptyFuncWithPromise,t.disconnect=emptyFuncWithPromise,t._disconnect=emptyFuncWithPromise,t.destroy=emptyFuncWithPromise}))},a._clearModuleData=function _clearModuleData(t){void 0===t&&(t=fg.Logout);var a=Ci(this);forEach$1(a).call(a,(function(a){a&&"function"==typeof a.reset&&a.reset(t)}))},a._removeAllModuleListeners=function _removeAllModuleListeners(){var t=Ci(this);forEach$1(t).call(t,(function(t){t&&"function"==typeof t.removeAllListeners&&t.removeAllListeners()}))},a.kick=function kick(t){return this.V1NIMLoginService.kick(t)},a.sendCmd=function sendCmd(t,a,c){return this.clientSocket.sendCmd(t,a,c)},a.emit=function emit(a){var c=this;try{for(var m,h,g=Ri(),I=arguments.length,M=new Array(I>1?I-1:0),T=1;T<I;T++)M[T-1]=arguments[T];var S=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,M)),E=Ri()-g;return E>=10&&this.logger.warn("Core::emit event: "+a+" process takes: "+E+"ms"),S}catch(t){return this.logger.error("Core::emit event: "+a+". Error: "+t),qi((function(){throw c.logger.error("Core::emit throw error in setTimeout. event: "+a+". Error: "+t),t}),0),!1}},NIM.registerService=function registerService(t,a){Xv[a]=t},NIM.registerPlugin=function registerPlugin(t,a){Zv[a]=t},Ke(NIM,[{key:"account",get:function get(){return this.auth.account}},{key:"status",get:function get(){return this.V1NIMLoginService.status},set:function set(t){this.V1NIMLoginService.status=t}},{key:"config",get:function get(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),NIM}(Gi),ry=createCommonjsModule((function(t,c){(function(){var m={function:!0,object:!0}[typeof window]&&window||this,h=c,g=t&&!t.nodeType&&t,I=h&&g&&"object"==typeof a&&a;!I||I.global!==I&&I.window!==I&&I.self!==I||(m=I);var M=Math.pow(2,53)-1,T=/\bOpera/,S=Object.prototype,E=S.hasOwnProperty,b=S.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var c in t)E.call(t,c)&&a(t[c],c,t)}function getClassOf(t){return null==t?capitalize(t):b.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var c=null;return function each(t,a){var c=-1,m=t?t.length:0;if("number"==typeof m&&m>-1&&m<=M)for(;++c<m;)a(t[c],c,t);else forOwn(t,a)}(t,(function(m,h){c=a(c,m,h,t)})),c}function trim(t){return String(t).replace(/^ +| +$/g,"")}var C=function parse(t){var a=m,c=t&&"object"==typeof t&&"String"!=getClassOf(t);c&&(a=t,t=null);var h=a.navigator||{},g=h.userAgent||"";t||(t=g);var I,M,S=c?!!h.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(b.toString()),E="Object",C=c?E:"ScriptBridgingProxyObject",A=c?E:"Environment",N=c&&a.java?"JavaPackage":getClassOf(a.java),R=c?E:"RuntimeObject",k=/\bJava/.test(N)&&a.java,w=k&&getClassOf(a.environment)==A,O=k?"a":"α",P=k?"b":"β",x=a.document||{},V=a.operamini||a.opera,L=T.test(L=c&&V?V["[[Class]]"]:getClassOf(V))?L:V=null,D=t,U=[],B=null,q=t==g,G=q&&V&&"function"==typeof V.version&&V.version(),j=function getLayout(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),H=function getName(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),$=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Y=function getManufacturer(a){return reduce(a,(function(a,c,m){return a||(c[$]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec($)]||RegExp("\\b"+qualify(m)+"(?:\\b|\\w*\\d)","i").exec(t))&&m}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function getOS(a){return reduce(a,(function(a,c){var m=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+m+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,c){var m={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&c&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(m=m[/[\d.]+$/.exec(t)])&&(t="Windows "+m),t=String(t),a&&c&&(t=t.replace(RegExp(a,"i"),c)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,m,c.label||c)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,c){var m=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+m+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+m+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+m+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(c.label&&!RegExp(m,"i").test(c.label)?c.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),c=c.label||c,a=format(a[0].replace(RegExp(m,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,c){return a||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(W)&&!$&&(I=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&($=trim(I[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Y&&!$?$=getProduct([Y]):Y&&$&&($=$.replace(RegExp("^("+qualify(Y)+")[-_.\\s]","i"),Y+" ").replace(RegExp("^("+qualify(Y)+")[-_.]?(\\w)","i"),Y+" $2")),(I=/\bGoogle TV\b/.exec($))&&($=I[0]),/\bSimulator\b/i.test(t)&&($=($?$+" ":"")+"Simulator"),"Opera Mini"==H&&/\bOPiOS\b/.test(t)&&U.push("running in Turbo/Uncompressed mode"),"IE"==H&&/\blike iPhone OS\b/.test(t)?(Y=(I=parse(t.replace(/like iPhone OS/,""))).manufacturer,$=I.product):/^iP/.test($)?(H||(H="Safari"),W="iOS"+((I=/ OS ([\d_]+)/i.exec(t))?" "+I[1].replace(/_/g,"."):"")):"Konqueror"==H&&/^Linux\b/i.test(W)?W="Kubuntu":Y&&"Google"!=Y&&(/Chrome/.test(H)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test($))||/\bAndroid\b/.test(W)&&/^Chrome/.test(H)&&/\bVersion\//i.test(t)?(H="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==H?(/\bMobi/i.test(t)||(W="Android",U.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&U.unshift("accelerated")):"UC Browser"==H&&/\bUCWEB\b/.test(t)?U.push("speed mode"):"PaleMoon"==H&&(I=/\bFirefox\/([\d.]+)\b/.exec(t))?U.push("identifying as Firefox "+I[1]):"Firefox"==H&&(I=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),$||($=I[1])):!H||(I=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(H))?(H&&!$&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(I+"/")+8))&&(H=null),(I=$||Y||W)&&($||Y||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(H=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:I)+" Browser")):"Electron"==H&&(I=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&U.push("Chromium "+I),G||(G=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(H),"(?:Firefox|Minefield|NetFront)"])),(I=("iCab"==j&&parseFloat(G)>3?"WebKit":/\bOpera\b/.test(H)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(H)&&"NetFront")&&(j=[I]),"IE"==H&&(I=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(H+=" Mobile",W="Windows Phone "+(/\+$/.test(I)?I:I+".x"),U.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(H="IE Mobile",W="Windows Phone 8.x",U.unshift("desktop mode"),G||(G=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=H&&"Trident"==j&&(I=/\brv:([\d.]+)/.exec(t))&&(H&&U.push("identifying as "+H+(G?" "+G:"")),H="IE",G=I[1]),q){if(function isHostType(t,a){var c=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(c)||"object"==c&&!t[a])}(a,"global"))if(k&&(D=(I=k.lang.System).getProperty("os.arch"),W=W||I.getProperty("os.name")+" "+I.getProperty("os.version")),w){try{G=a.require("ringo/engine").version.join("."),H="RingoJS"}catch(t){(I=a.system)&&I.global.system==a.system&&(H="Narwhal",W||(W=I[0].os||null))}H||(H="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(I=a.process)&&("object"==typeof I.versions&&("string"==typeof I.versions.electron?(U.push("Node "+I.versions.node),H="Electron",G=I.versions.electron):"string"==typeof I.versions.nw&&(U.push("Chromium "+G,"Node "+I.versions.node),H="NW.js",G=I.versions.nw)),H||(H="Node.js",D=I.arch,W=I.platform,G=(G=/[\d.]+/.exec(I.version))?G[0]:null));else getClassOf(I=a.runtime)==C?(H="Adobe AIR",W=I.flash.system.Capabilities.os):getClassOf(I=a.phantom)==R?(H="PhantomJS",G=(I=I.version||null)&&I.major+"."+I.minor+"."+I.patch):"number"==typeof x.documentMode&&(I=/\bTrident\/(\d+)/i.exec(t))?(G=[G,x.documentMode],(I=+I[1]+4)!=G[1]&&(U.push("IE "+G[1]+" mode"),j&&(j[1]=""),G[1]=I),G="IE"==H?String(G[1].toFixed(1)):G[0]):"number"==typeof x.documentMode&&/^(?:Chrome|Firefox)\b/.test(H)&&(U.push("masking as "+H+" "+G),H="IE",G="11.0",j=["Trident"],W="Windows");W=W&&format(W)}if(G&&(I=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(G)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(q&&h.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(B=/b/i.test(I)?"beta":"alpha",G=G.replace(RegExp(I+"\\+?$"),"")+("beta"==B?P:O)+(/\d+\+?/.exec(I)||"")),"Fennec"==H||"Firefox"==H&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))H="Firefox Mobile";else if("Maxthon"==H&&G)G=G.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test($))"Xbox 360"==$&&(W=null),"Xbox 360"==$&&/\bIEMobile\b/.test(t)&&U.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(H)&&(!H||$||/Browser|Mobi/.test(H))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==H&&q)try{null===a.external&&U.unshift("platform preview")}catch(t){U.unshift("embedded")}else(/\bBlackBerry\b/.test($)||/\bBB10\b/.test(t))&&(I=(RegExp($.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||G)?(W=((I=[I,/BB10/.test(t)])[1]?($=null,Y="BlackBerry"):"Device Software")+" "+I[0],G=null):this!=forOwn&&"Wii"!=$&&(q&&V||/Opera/.test(H)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==H&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==H&&(W&&!/^Win/.test(W)&&G>5.5||/\bWindows XP\b/.test(W)&&G>8||8==G&&!/\bTrident\b/.test(t)))&&!T.test(I=parse.call(forOwn,t.replace(T,"")+";"))&&I.name&&(I="ing as "+I.name+((I=I.version)?" "+I:""),T.test(H)?(/\bIE\b/.test(I)&&"Mac OS"==W&&(W=null),I="identify"+I):(I="mask"+I,H=L?format(L.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(I)&&(W=null),q||(G=null)),j=["Presto"],U.push(I));else H+=" Mobile";(I=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(I=[parseFloat(I.replace(/\.(\d)$/,".0$1")),I],"Safari"==H&&"+"==I[1].slice(-1)?(H="WebKit Nightly",B="alpha",G=I[1].slice(0,-1)):G!=I[1]&&G!=(I[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(G=null),I[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==I[0]&&537.36==I[2]&&parseFloat(I[1])>=28&&"WebKit"==j&&(j=["Blink"]),q&&(S||I[1])?(j&&(j[1]="like Chrome"),I=I[1]||((I=I[0])<530?1:I<532?2:I<532.05?3:I<533?4:I<534.03?5:I<534.07?6:I<534.1?7:I<534.13?8:I<534.16?9:I<534.24?10:I<534.3?11:I<535.01?12:I<535.02?"13+":I<535.07?15:I<535.11?16:I<535.19?17:I<536.05?18:I<536.1?19:I<537.01?20:I<537.11?"21+":I<537.13?23:I<537.18?24:I<537.24?25:I<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),I=(I=I[0])<400?1:I<500?2:I<526?3:I<533?4:I<534?"4+":I<535?5:I<537?6:I<538?7:I<601?8:I<602?9:I<604?10:I<606?11:I<608?12:"12"),j&&(j[1]+=" "+(I+="number"==typeof I?".x":/[.+]/.test(I)?"":"+")),"Safari"==H&&(!G||parseInt(G)>45)?G=I:"Chrome"==H&&/\bHeadlessChrome/i.test(t)&&U.unshift("headless")),"Opera"==H&&(I=/\bzbov|zvav$/.exec(W))?(H+=" ",U.unshift("desktop mode"),"zvav"==I?(H+="Mini",G=null):H+="Mobile",W=W.replace(RegExp(" *"+I+"$"),"")):"Safari"==H&&/\bChrome\b/.exec(j&&j[1])?(U.unshift("desktop mode"),H="Chrome Mobile",G=null,/\bOS X\b/.test(W)?(Y="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(H)&&!G&&(G=getVersion("Chrome")),G&&0==G.indexOf(I=/[\d.]+$/.exec(W))&&t.indexOf("/"+I+"-")>-1&&(W=trim(W.replace(I,""))),W&&-1!=W.indexOf(H)&&!RegExp(H+" OS").test(W)&&(W=W.replace(RegExp(" *"+qualify(H)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(H)&&(/Browser|Lunascape|Maxthon/.test(H)||"Safari"!=H&&/^iOS/.test(W)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(H)&&j[1])&&(I=j[j.length-1])&&U.push(I),U.length&&(U=["("+U.join("; ")+")"]),Y&&$&&$.indexOf(Y)<0&&U.push("on "+Y),$&&U.push((/^on /.test(U[U.length-1])?"":"on ")+$),W&&(I=/ ([\d.+]+)$/.exec(W),M=I&&"/"==W.charAt(W.length-I[0].length-1),W={architecture:32,family:I&&!M?W.replace(I[0],""):W,version:I?I[1]:null,toString:function(){var t=this.version;return this.family+(t&&!M?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(I=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+I),"")),H&&(/\bWOW64\b/i.test(t)||q&&/\w(?:86|32)$/.test(h.cpuClass||h.platform)&&!/\bWin64; x64\b/i.test(t))&&U.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==H&&parseFloat(G)>=39&&(W.architecture=64),t||(t=null);var z={};return z.description=t,z.layout=j&&j[0],z.manufacturer=Y,z.name=H,z.prerelease=B,z.product=$,z.ua=t,z.version=H&&G,z.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},z.parse=parse,z.toString=function toStringPlatform(){return this.description||""},z.version&&U.unshift(G),z.name&&U.unshift(H),W&&H&&(W!=String(W).split(" ")[0]||W!=H.split(" ")[0]&&!$)&&U.push($?"("+W+")":"on "+W),U.length&&(z.description=U.join(" ")),z}();h&&g?forOwn(C,(function(t,a){h[a]=t})):m.platform=C}).call(a)})),ny=Math.floor,mergeSort=function(t,a){var c=t.length,m=ny(c/2);return c<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,m),a),mergeSort(arraySliceSimple(t,m),a),a)},insertionSort=function(t,a){for(var c,m,h=t.length,g=1;g<h;){for(m=g,c=t[g];m&&a(t[m-1],c)>0;)t[m]=t[--m];m!==g++&&(t[m]=c)}return t},merge=function(t,a,c,m){for(var h=a.length,g=c.length,I=0,M=0;I<h||M<g;)t[I+M]=I<h&&M<g?m(a[I],c[M])<=0?a[I++]:c[M++]:I<h?a[I++]:c[M++];return t},ay=mergeSort,iy=Y.match(/firefox\/(\d+)/i),oy=!!iy&&+iy[1],sy=/MSIE|Trident/.test(Y),cy=Y.match(/AppleWebKit\/(\d+)\./),ly=!!cy&&+cy[1],uy=[],dy=N(uy.sort),py=N(uy.push),hy=fails((function(){uy.sort(void 0)})),fy=fails((function(){uy.sort(null)})),gy=arrayMethodIsStrict("sort"),vy=!fails((function(){if(J)return J<70;if(!(oy&&oy>3)){if(sy)return!0;if(ly)return ly<603;var t,a,c,m,h="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:c=3;break;case 68:case 71:c=4;break;default:c=2}for(m=0;m<47;m++)uy.push({k:a+m,v:c})}for(uy.sort((function(t,a){return a.v-t.v})),m=0;m<uy.length;m++)a=uy[m].k.charAt(0),h.charAt(h.length-1)!==a&&(h+=a);return"DGBEFHACIJK"!==h}}));_export({target:"Array",proto:!0,forced:hy||!fy||!gy||!vy},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(vy)return void 0===t?dy(a):dy(a,t);var c,m,h=[],g=lengthOfArrayLike(a);for(m=0;m<g;m++)m in a&&py(h,a[m]);for(ay(h,function(t){return function(a,c){return void 0===c?-1:void 0===a?1:void 0!==t?+t(a,c)||0:toString$1(a)>toString$1(c)?1:-1}}(t)),c=lengthOfArrayLike(h),m=0;m<c;)a[m]=h[m++];for(;m<g;)deletePropertyOrThrow(a,m++);return a}});var yy=entryVirtual("Array").sort,_y=Array.prototype,sort=function(t){var a=t.sort;return t===_y||$(_y,t)&&a===_y.sort?yy:a},Iy=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function d(a,c){for(var m in c)t.o(c,m)&&!t.o(a,m)&&ze(a,m,{enumerable:!0,get:c[m]})},o:function o(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function _default(){return b}});var c=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(t){},this.onProgress=function(t){},this.onUploadProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var c=void 0!==bc&&Wc(t)||t["@@iterator"];if(!c){if(jc(t)||(c=function(t,a){if(t){var c;if("string"==typeof t)return r(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);return"Object"===m&&t.constructor&&(m=t.constructor.name),"Map"===m||"Set"===m?Yc(t):"Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var m=0,h=function i(){};return{s:h,n:function n(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}},e:function e(t){throw t},f:h}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g,I=!0,M=!1;return{s:function s(){c=c.call(t)},n:function n(){var t=c.next();return I=t.done,t},e:function e(t){M=!0,g=t},f:function f(){try{I||null==c.return||c.return()}finally{if(M)throw g}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var m={privateObj:{},setItem:function setItem(t,a){m.privateObj[t]=a},getItem:function getItem(t){return m.privateObj[t]},removeItem:function removeItem(t){delete m.privateObj[t]},getKeys:function getKeys(){return mn(m.privateObj)}},h={getFileKey:function getFileKey(t){var a=t.size.toString(),c=t.lastModified.toString();return"_NosUploader_"+t.name+slice(a).call(a,a.length-5)+slice(c).call(c,c.length-5)},getFileInfo:function getFileInfo(t){var a=m.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function initFile(t,a,c){h.clearExpiredInfo();var g=this.getFileKey(a),I={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Ri(),end:!1};return t.payload&&(I.payload=t.payload),c&&m.setItem(g,Uc(I)),g},setUploadContext:function setUploadContext(t,a,c){var h=this.getFileInfo(t);h&&(h.ctx=a,c&&m.setItem(t,Uc(h)))},setComplete:function setComplete(t,a){var c=this.getFileInfo(t);c&&(c.modifyAt=Ri(),c.end=!0,a&&m.setItem(t,Uc(c)))},getUploadContext:function getUploadContext(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function removeFileInfo(t){0===indexOf(t).call(t,"_NosUploader_")&&m.removeItem(t)},clearExpiredInfo:function clearExpiredInfo(){var t,a="function"==typeof m.getKeys?m.getKeys():mn(m),c=Ri(),g=[],I=n(a);try{for(I.s();!(t=I.n()).done;){var M=t.value;if(0===indexOf(M).call(M,"_NosUploader_")){var T=h.getFileInfo(M);null===T||c-T.modifyAt>b.expireTime?m.removeItem(M):g.push({fileInfo:T,key:M})}}}catch(t){I.e(t)}finally{I.f()}if(g.length>b.maxFileCache){var S,E,C=n(slice(S=sort(g).call(g,(function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt}))).call(S,b.maxFileCache));try{for(C.s();!(E=C.n()).done;){var A,N=E.value;0===indexOf(A=N.key).call(A,"_NosUploader_")&&m.removeItem(N.key)}}catch(t){C.e(t)}finally{C.f()}}}},g=h;function u(t){return(u="function"==typeof bc&&"symbol"==typeof Cc?function(t){return typeof t}:function(t){return t&&"function"==typeof bc&&t.constructor===bc&&t!==bc.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Il?new Il:void 0;return(l=function l(t){var c,m;if(null===t||(m=t,-1===indexOf(c=Function.toString.call(m)).call(c,"[native code]")))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=vt(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,c){return(s=p()?Vl:function(t,a,c){var m=[null];m.push.apply(m,a);var h=new(bind$1(Function).apply(t,m));return c&&d(h,c.prototype),h}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Vl)return!1;if(Vl.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Vl(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=Mt||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=Mt?Rc:function(t){return t.__proto__||Rc(t)})(t)}var I=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=vt(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,c,m=(a=r,c=p(),function(){var t,m=y(a);if(c){var h=y(this).constructor;t=Vl(m,arguments,h)}else t=m.apply(this,arguments);return f(this,t)});function r(t,a){var c;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(c=m.call(this,"NosUploadError:"+t)).errCode=a,c.errMsg=t,c}return r}(l(Error)),M=function e(t,a,c){if("uploading"===t.uploadState){var m=t.config,h=t.param,M=g.getUploadContext(t.fileKey);if(!M)return c(0);var T=new XMLHttpRequest,S=m.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName))+"?uploadContext"+"&context=".concat(M)+"&version=".concat(m.version);T.onreadystatechange=function(){var h;if("abort"!==t.uploadState&&4===T.readyState){var M,E,b,C;try{C=JSON.parse(T.responseText)}catch(t){C={errMsg:"JsonParseError in getOffset",errCode:500}}200===T.status?C.errCode?t.config.onError(new I(C.errMsg,C.errCode)):c(C.offset):T.status.toString().match(/^5/)?e(t,a-1,c):a>0?("function"==typeof(null===(h=m.logger)||void 0===h?void 0:h.error)&&m.logger.error(concat(M="getOffset(".concat(S,") error. retry after 3 seconds. ")).call(M,(new Date).toTimeString())),qi((function(){e(t,a-1,c)}),3500)):T.status?(g.removeFileInfo(t.fileKey),m.onError(new I(concat(E=concat(b="getOffset(".concat(S,") error: ")).call(b,T.status," ")).call(E,T.statusText)))):m.onError(new I("getOffset(".concat(S,") error. no Error Code")))}},T.open("get",S),T.setRequestHeader("x-nos-token",h.token),T.timeout=m.getOffsetTimeout,T.send()}},T=function e(t,a,c,m){if("uploading"===t.uploadState){var h=t.param,M=t.config,T=slice(File.prototype),S=void 0!==h.ctx?h.ctx:"",E=a+M.trunkSize>t.file.size,b=E?t.file.size:a+M.trunkSize,C=new XMLHttpRequest,A=M.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName));if(C.upload.onprogress=function(c){if("abort"!==t.uploadState){var m=0;c.lengthComputable?(m=(a+c.loaded)/t.file.size,M.onProgress(m),M.onUploadProgress({loaded:c.loaded,total:t.file.size,percentage:m,percentageText:(100*m).toFixed(2)+"%"})):M.onError(new I("browser does not support query upload progress"))}},C.onreadystatechange=function(){var h,T;if("abort"!==t.uploadState&&4===C.readyState){var S,b,N,R;try{R=JSON.parse(C.responseText)}catch(t){"function"==typeof(null===(h=M.logger)||void 0===h?void 0:h.error)&&M.logger.error("JsonParseError in uploadTrunk",t),R={errMsg:"JsonParseError in uploadTrunk"}}200===C.status?(t.setContext(R.context),E?(m(),t.setComplete()):e(t,R.offset,M.retryCount,m)):C.status.toString().match(/^5/)?c>0?e(t,a,c-1,m):(g.removeFileInfo(t.fileKey),M.onError(new I(R.errMsg,R.errCode))):c>0?("function"==typeof(null===(T=M.logger)||void 0===T?void 0:T.error)&&M.logger.error(concat(S="uploadTrunk(".concat(A,") error. retry after 3 seconds. ")).call(S,(new Date).toTimeString())),qi((function(){e(t,a,c-1,m)}),3500)):C.status?(g.removeFileInfo(t.fileKey),M.onError(new I(concat(b=concat(N="uploadTrunk(".concat(A,") error: ")).call(N,C.status," ")).call(b,C.statusText)))):M.onError(new I("uploadTrunk(".concat(A,") error. no Error Code. Please check your network")))}},C.open("post",A+"?offset=".concat(a)+"&complete=".concat(E)+"&context=".concat(S)+"&version=".concat(M.version)),C.setRequestHeader("x-nos-token",h.token),h.md5&&C.setRequestHeader("content-md5",h.md5),t.file.type&&C.setRequestHeader("content-type",t.file.type),C.timeout=M.trunkUploadTimeout,"undefined"!=typeof FileReader){var N=new FileReader;N.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)instanceof ArrayBuffer&&t.target.result.byteLength>0?C.send(t.target.result):M.onError(new I("Read ArrayBuffer failed",194003))})),N.addEventListener("error",(function(t){var a=t.target.error;M.onError(new I("Read ArrayBuffer error. ".concat(a.toString()),194003))})),N.readAsArrayBuffer(T.call(t.file,a,b))}else C.send(T.call(t.file,a,b))}};function v(t,a){for(var c=0;c<a.length;c++){var m=a[c];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),ze(t,m.key,m)}}var S=function(){function e(t,a,c){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=c,this.file=t,this.param=a,this.fileKey=g.initFile(a,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function value(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;M(this,a.retryCount,(function(c){T(t,c,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function value(){this.setUploadState("paused")}},{key:"abort",value:function value(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new I("Upload Aborted",10499)))}},{key:"setUploadState",value:function value(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function value(t){g.setUploadContext(this.fileKey,t,this.config.enableCache),this.param.ctx=t}},{key:"setComplete",value:function value(){g.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&v(e.prototype,t),e}(),E={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function getFileUploadInformation(t){var a=g.getFileKey(t),c=g.getFileInfo(a);return null===c?null:Ri()-c.modifyAt>E.expireTime?(g.removeFileInfo(a),null):{uploadInfo:qt({bucketName:c.bucket,objectName:c.obj,token:c.token,ctx:c.ctx},c.payload?{payload:c.payload}:{}),complete:c.end}},setMaxFileCache:function setMaxFileCache(t){E.maxFileCache=t},setExpireTime:function setExpireTime(t){E.expireTime=t},printCaches:function printCaches(){if("undefined"!=typeof localStorage)for(var t=0,a=mn(localStorage);t<a.length;t++){var c=a[t],m=g.getFileInfo(c);m&&console.log(m,"modifiedAt",new Date(m.modifyAt).toTimeString())}},createConfig:function createConfig(t){return new c(t)},createTask:function createTask(t,a,c){return new S(t,a,c)}},b=E;return a.default}()})),My=createCommonjsModule((function(t,a){t.exports=function(){function object2String(t){if(t){var a,c="";return forEach$1(a=mn(t)).call(a,(function(a,m){c+=0===m?"?":"&",c+=a+"="+t[a]})),c}return""}var t=function(t){function V2NIMError(a,c,m,h){var g;return(g=t.call(this,m)||this).source=a,g.code=c,g.desc=m,g.detail=h||{},g}return wt(V2NIMError,t),V2NIMError}(Fl(Error));function request(a,c){void 0===c&&(c={dataType:"json",method:"GET",timeout:5e3});var m="text"===c.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",h="GET"===c.method?object2String(c.params):"";return new Mi((function(g,I){if(window.XMLHttpRequest){var M,T=new XMLHttpRequest;if(T.onreadystatechange=function(){if(4===T.readyState)if(200===T.status){try{M=JSON.parse(T.response||"{}")}catch(t){M=T.response}g({status:T.status,data:M})}else qi((function(){I(new t(1,T.status,"readyState: "+T.readyState+"; statusText: "+T.statusText))}),0)},T.open(c.method,""+a+h),T.timeout=c.timeout||5e3,T.setRequestHeader("Content-Type",m),c.headers)for(var S in c.headers)T.setRequestHeader(S,c.headers[S]);T.ontimeout=function(a){I(new t(1,408,a&&a.message?a.message:"request timeout"))},T.send(Uc(c.data))}else I(new t(2,10400,"request no suppout"))}))}return request}()})),Ty=console;var Sy=null,Ey=null,by={setLogger:function setLogger(t){Ty=t},platform:"BROWSER",localStorage:window.localStorage,request:My,WebSocket:window.WebSocket,uploadFile:function uploadFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I;return Lc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(t.fileInput||t.file){M.next=2;break}throw new Error("File not exist");case 2:if(!t.file){M.next=6;break}h=t.file,M.next=20;break;case 6:if("string"!=typeof t.fileInput){M.next=15;break}if(!((g=document.getElementById(t.fileInput))&&g.files&&g.files[0])){M.next=12;break}h=g.files[0],M.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:M.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){M.next=19;break}h=t.fileInput.files[0],M.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&h.size>t.maxSize)){M.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+h.size);case 22:return M.next=24,new Mi((function(a,c){var m,g=Iy.getFileUploadInformation(h),I=Iy.createConfig({enableCache:!0,retryCount:0,directUploadAddr:t.chunkUploadHost,onError:function onError(t){c(t)},onUploadProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}});if(g)if(g.complete)t.onUploadProgress&&t.onUploadProgress({total:h.size,loaded:h.size,percentage:1,percentageText:"100%"}),a(g.uploadInfo);else{m=Iy.createTask(h,g.uploadInfo,I);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){Ty.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),c(t)}}else{m=Iy.createTask(h,qt(qt({bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},t.md5?{md5:t.md5}:{}),t.payload?{payload:t.payload}:{}),I);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){Ty.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),c(t)}}}));case 24:return(I=M.sent).name=h.name,I.size=h.size,I.type=h.type,I.ext=lastIndexOf(a=I.name).call(a,".")>-1?slice(c=I.name).call(c,lastIndexOf(m=I.name).call(m,".")+1).toLowerCase():"",M.abrupt("return",I);case 30:case"end":return M.stop()}}),_callee)})))},getFileUploadInformation:function getFileUploadInformation(t){var a;if(t.file)a=t.file;else if("string"==typeof t.fileInput){var c=document.getElementById(t.fileInput);if(!(c&&c.files&&c.files[0]))throw new Error("Can not get file from fileInput");a=c.files[0]}else{if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0]))throw new Error("Can not get file from fileInput "+t.fileInput);a=t.fileInput.files[0]}return Iy.getFileUploadInformation(a)},getSystemInfo:function getSystemInfo(){var t,a,c=ry.version||"";if(isElectron())try{var m=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);m&&m[1]&&"string"==typeof m[1]&&(c=m[1])}catch(t){}return{os:(null===(t=ry.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=ry.os)||void 0===a?void 0:a.version)||"",browser:ry.name||"",browserVer:ry.version||"",libEnv:"BROWSER",hostEnv:isElectron()?"Electron":isMobile()?"H5":isBrowser()?"BROWSER":"Unset",hostEnvEnum:isElectron()?hp.Electron:isMobile()?hp.H5:isBrowser()?hp.BROWSER:hp.Unset,hostEnvVer:c,userAgent:navigator&&navigator.userAgent,model:c,manufactor:ry.name||""}},net:{getNetworkStatus:function getNetworkStatus(){return Mi.resolve({net_type:fp.kStatNetTypeUnkonw,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function onNetworkStatusChange(t){Sy=function onlineListener(){t({isConnected:!0,networkType:fp.kStatNetTypeUnkonw})},Ey=function offlineListener(){t({isConnected:!1,networkType:fp.kStatNetTypeUnkonw})},window.addEventListener("online",Sy),window.addEventListener("offline",Ey)},offNetworkStatusChange:function offNetworkStatusChange(){Sy&&window.removeEventListener("online",Sy),Ey&&window.removeEventListener("offline",Ey),Sy=null,Ey=null}}},Cy=function(){function V2NIMConversationModelImpl(){this.map=new Il}var t=V2NIMConversationModelImpl.prototype;return t.set=function set(t){var a=this;forEach$1(t).call(t,(function(t){t=a.processConversation(t),map$6(a).set(t.conversationId,t)}))},t.reset=function reset(){map$6(this).clear()},t.count=function count(){return map$6(this).size},t.sort=function sort$1(){var t,a=this,c=Yc(values(t=map$6(this)).call(t));sort(c).call(c,(function(t,a){return a.sortOrder-t.sortOrder})),map$6(this).clear(),forEach$1(c).call(c,(function(t){map$6(a).set(t.conversationId,t)}))},t.processConversation=function processConversation(t){return"string"==typeof t.lastMessage&&delete t.lastMessage,void 0===t.localExtension&&(t.localExtension=""),t},t.getById=function getById(t){return map$6(this).get(t)},t.getAll=function getAll(){var t,a=Yc(values(t=map$6(this)).call(t));return sort(a).call(a,(function(t,a){return a.sortOrder-t.sortOrder}))},t.getByOption=function getByOption(t,a,c){var m,h=c.conversationTypes,g=c.onlyUnread,I=c.conversationGroupIds,M=[];forEach$1(m=map$6(this)).call(m,(function(t){if((!(h&&h.length>0)||includes(h).call(h,t.type))&&(!g||t.unreadCount)&&(!c.ignoreMuted||!t.mute)){if(I){var a=t.groupIds,m=(null==a?void 0:a.length)||0;if(0===I.length&&m>0)return;if(I.length>0&&0===m)return;if(I.length>0&&m>0&&!some(I).call(I,(function(t){return a&&includes(a).call(a,t)})))return}M.push(t)}})),M=sort(M).call(M,(function(t,a){return a.sortOrder-t.sortOrder}));var T=0;t>0&&(T=findIndexWithinTargetValue(M,"sortOrder",t),M[T]&&M[T].sortOrder===t&&(T+=1));var S=slice(M).call(M,T).length;return(M=slice(M).call(M,T,T+a)).length>0?{offset:S>a?M[M.length-1].sortOrder:0,finished:!(S>a),conversationList:M}:{offset:0,finished:!0,conversationList:M}},t.upsert=function upsert(t){var a=t.conversationId,c=map$6(this).get(a);if(!c)return t=this.processConversation(qt({},t)),map$6(this).set(a,t),t.unreadCount>0;var m=t.unreadCount!==c.unreadCount,h=qt({},c,t);return h=this.processConversation(h),map$6(this).set(a,h),m},t.bulkUpsert=function bulkUpsert(t){var a=this,c=!1;return forEach$1(t).call(t,(function(t){a.upsert(t)&&(c=!0)})),c},t.deleteById=function deleteById(t){var a=this.getById(t);if(a)return map$6(this).delete(t),a},V2NIMConversationModelImpl}(),Ay=N("".startsWith),Ny=N("".slice),Ry=Math.min,ky=correctIsRegexpLogic("startsWith");_export({target:"String",proto:!0,forced:!ky},{startsWith:function startsWith(t){var a=toString$1(requireObjectCoercible(this));notARegexp(t);var c=toLength(Ry(arguments.length>1?arguments[1]:void 0,a.length)),m=toString$1(t);return Ay?Ay(a,m,c):Ny(a,c,c+m.length)===m}});var wy=entryVirtual("String").startsWith,Oy=String.prototype,startsWith=function(t){var a=t.startsWith;return"string"==typeof t||t===Oy||$(Oy,t)&&a===Oy.startsWith?wy:a},Py=function(){function V2NIMConversationIdUtilImpl(t){this.core=t}var t=V2NIMConversationIdUtilImpl.prototype;return t.p2pConversationId=function p2pConversationId(t){return this.core.account+"|"+Yl.V2NIM_CONVERSATION_TYPE_P2P+"|"+t},t.teamConversationId=function teamConversationId(t){return this.core.account+"|"+Yl.V2NIM_CONVERSATION_TYPE_TEAM+"|"+t},t.superTeamConversationId=function superTeamConversationId(t){return this.core.account+"|"+Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM+"|"+t},t.messageConversationId=function messageConversationId(t){return t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?t.senderId===this.core.account?this.p2pConversationId(t.receiverId):this.p2pConversationId(t.senderId):t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_TEAM?this.teamConversationId(t.receiverId):this.superTeamConversationId(t.receiverId)},t.parseConversationType=function parseConversationType(t){startsWith(t).call(t,this.core.account+"|")||this.core.logger.warn("conversationId is not start with "+this.core.account);var a=t.replace(this.core.account+"|","");return Number(a[0])},t.parseConversationTargetId=function parseConversationTargetId(t){startsWith(t).call(t,this.core.account+"|")||this.core.logger.warn("conversationId is not start with "+this.core.account);var a=t.replace(this.core.account+"|","");return slice(a).call(a,2)},t.convertToV1ConversationId=function convertToV1ConversationId(t){var a=this.parseConversationType(t),c=this.parseConversationTargetId(t);return(a===Yl.V2NIM_CONVERSATION_TYPE_P2P?"p2p":a===Yl.V2NIM_CONVERSATION_TYPE_TEAM?"team":"superTeam")+"|"+c},V2NIMConversationIdUtilImpl}();var xy,Vy=function isEqual(t,a){return Hf(t,a)},Ly=createCommonjsModule((function(t,c){(function(){var m,h="Expected a function",g="__lodash_hash_undefined__",I="__lodash_placeholder__",M=16,T=32,S=64,E=128,b=256,C=1/0,A=9007199254740991,N=NaN,R=4294967295,k=[["ary",E],["bind",1],["bindKey",2],["curry",8],["curryRight",M],["flip",512],["partial",T],["partialRight",S],["rearg",b]],w="[object Arguments]",O="[object Array]",P="[object Boolean]",x="[object Date]",V="[object Error]",L="[object Function]",D="[object GeneratorFunction]",U="[object Map]",B="[object Number]",q="[object Object]",G="[object Promise]",j="[object RegExp]",H="[object Set]",$="[object String]",Y="[object Symbol]",W="[object WeakMap]",z="[object ArrayBuffer]",K="[object DataView]",Q="[object Float32Array]",J="[object Float64Array]",X="[object Int8Array]",Z="[object Int16Array]",ee="[object Int32Array]",te="[object Uint8Array]",re="[object Uint8ClampedArray]",ne="[object Uint16Array]",ae="[object Uint32Array]",ie=/\b__p \+= '';/g,oe=/\b(__p \+=) '' \+/g,se=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ce=/&(?:amp|lt|gt|quot|#39);/g,le=/[&<>"']/g,ue=RegExp(ce.source),de=RegExp(le.source),pe=/<%-([\s\S]+?)%>/g,me=/<%([\s\S]+?)%>/g,he=/<%=([\s\S]+?)%>/g,fe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ge=/^\w*$/,ve=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ye=/[\\^$.*+?()[\]{}|]/g,_e=RegExp(ye.source),Ie=/^\s+/,Me=/\s/,Te=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Se=/\{\n\/\* \[wrapped with (.+)\] \*/,Ee=/,? & /,be=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ce=/[()=,{}\[\]\/\s]/,Ae=/\\(\\)?/g,Ne=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Re=/\w*$/,ke=/^[-+]0x[0-9a-f]+$/i,we=/^0b[01]+$/i,Oe=/^\[object .+?Constructor\]$/,Pe=/^0o[0-7]+$/i,xe=/^(?:0|[1-9]\d*)$/,Ve=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Le=/($^)/,De=/['\n\r\u2028\u2029\\]/g,Ue="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Fe="\\u2700-\\u27bf",Be="a-z\\xdf-\\xf6\\xf8-\\xff",qe="A-Z\\xc0-\\xd6\\xd8-\\xde",Ge="\\ufe0e\\ufe0f",je="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",He="['’]",$e="[\\ud800-\\udfff]",Ye="["+je+"]",We="["+Ue+"]",ze="\\d+",Ke="[\\u2700-\\u27bf]",Qe="["+Be+"]",Je="[^\\ud800-\\udfff"+je+ze+Fe+Be+qe+"]",Xe="\\ud83c[\\udffb-\\udfff]",Ze="[^\\ud800-\\udfff]",et="(?:\\ud83c[\\udde6-\\uddff]){2}",tt="[\\ud800-\\udbff][\\udc00-\\udfff]",rt="["+qe+"]",nt="(?:"+Qe+"|"+Je+")",at="(?:"+rt+"|"+Je+")",it="(?:['’](?:d|ll|m|re|s|t|ve))?",ot="(?:['’](?:D|LL|M|RE|S|T|VE))?",st="(?:"+We+"|"+Xe+")"+"?",ct="[\\ufe0e\\ufe0f]?",lt=ct+st+("(?:\\u200d(?:"+[Ze,et,tt].join("|")+")"+ct+st+")*"),ut="(?:"+[Ke,et,tt].join("|")+")"+lt,dt="(?:"+[Ze+We+"?",We,et,tt,$e].join("|")+")",pt=RegExp(He,"g"),mt=RegExp(We,"g"),ht=RegExp(Xe+"(?="+Xe+")|"+dt+lt,"g"),ft=RegExp([rt+"?"+Qe+"+"+it+"(?="+[Ye,rt,"$"].join("|")+")",at+"+"+ot+"(?="+[Ye,rt+nt,"$"].join("|")+")",rt+"?"+nt+"+"+it,rt+"+"+ot,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ze,ut].join("|"),"g"),gt=RegExp("[\\u200d\\ud800-\\udfff"+Ue+Ge+"]"),vt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],_t=-1,It={};It[Q]=It[J]=It[X]=It[Z]=It[ee]=It[te]=It[re]=It[ne]=It[ae]=!0,It[w]=It[O]=It[z]=It[P]=It[K]=It[x]=It[V]=It[L]=It[U]=It[B]=It[q]=It[j]=It[H]=It[$]=It[W]=!1;var Mt={};Mt[w]=Mt[O]=Mt[z]=Mt[K]=Mt[P]=Mt[x]=Mt[Q]=Mt[J]=Mt[X]=Mt[Z]=Mt[ee]=Mt[U]=Mt[B]=Mt[q]=Mt[j]=Mt[H]=Mt[$]=Mt[Y]=Mt[te]=Mt[re]=Mt[ne]=Mt[ae]=!0,Mt[V]=Mt[L]=Mt[W]=!1;var Tt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},St=parseFloat,Et=parseInt,bt="object"==typeof a&&a&&a.Object===Object&&a,Ct="object"==typeof self&&self&&self.Object===Object&&self,At=bt||Ct||Function("return this")(),Nt=c&&!c.nodeType&&c,Rt=Nt&&t&&!t.nodeType&&t,kt=Rt&&Rt.exports===Nt,wt=kt&&bt.process,Ot=function(){try{var t=Rt&&Rt.require&&Rt.require("util").types;return t||wt&&wt.binding&&wt.binding("util")}catch(t){}}(),Pt=Ot&&Ot.isArrayBuffer,xt=Ot&&Ot.isDate,Vt=Ot&&Ot.isMap,Lt=Ot&&Ot.isRegExp,Dt=Ot&&Ot.isSet,Ut=Ot&&Ot.isTypedArray;function apply(t,a,c){switch(c.length){case 0:return t.call(a);case 1:return t.call(a,c[0]);case 2:return t.call(a,c[0],c[1]);case 3:return t.call(a,c[0],c[1],c[2])}return t.apply(a,c)}function arrayAggregator(t,a,c,m){for(var h=-1,g=null==t?0:t.length;++h<g;){var I=t[h];a(m,I,c(I),t)}return m}function arrayEach(t,a){for(var c=-1,m=null==t?0:t.length;++c<m&&!1!==a(t[c],c,t););return t}function arrayEachRight(t,a){for(var c=null==t?0:t.length;c--&&!1!==a(t[c],c,t););return t}function arrayEvery(t,a){for(var c=-1,m=null==t?0:t.length;++c<m;)if(!a(t[c],c,t))return!1;return!0}function arrayFilter(t,a){for(var c=-1,m=null==t?0:t.length,h=0,g=[];++c<m;){var I=t[c];a(I,c,t)&&(g[h++]=I)}return g}function arrayIncludes(t,a){return!!(null==t?0:t.length)&&baseIndexOf(t,a,0)>-1}function arrayIncludesWith(t,a,c){for(var m=-1,h=null==t?0:t.length;++m<h;)if(c(a,t[m]))return!0;return!1}function arrayMap(t,a){for(var c=-1,m=null==t?0:t.length,h=Array(m);++c<m;)h[c]=a(t[c],c,t);return h}function arrayPush(t,a){for(var c=-1,m=a.length,h=t.length;++c<m;)t[h+c]=a[c];return t}function arrayReduce(t,a,c,m){var h=-1,g=null==t?0:t.length;for(m&&g&&(c=t[++h]);++h<g;)c=a(c,t[h],h,t);return c}function arrayReduceRight(t,a,c,m){var h=null==t?0:t.length;for(m&&h&&(c=t[--h]);h--;)c=a(c,t[h],h,t);return c}function arraySome(t,a){for(var c=-1,m=null==t?0:t.length;++c<m;)if(a(t[c],c,t))return!0;return!1}var Ft=baseProperty("length");function baseFindKey(t,a,c){var m;return c(t,(function(t,c,h){if(a(t,c,h))return m=c,!1})),m}function baseFindIndex(t,a,c,m){for(var h=t.length,g=c+(m?1:-1);m?g--:++g<h;)if(a(t[g],g,t))return g;return-1}function baseIndexOf(t,a,c){return a==a?function strictIndexOf(t,a,c){var m=c-1,h=t.length;for(;++m<h;)if(t[m]===a)return m;return-1}(t,a,c):baseFindIndex(t,baseIsNaN,c)}function baseIndexOfWith(t,a,c,m){for(var h=c-1,g=t.length;++h<g;)if(m(t[h],a))return h;return-1}function baseIsNaN(t){return t!=t}function baseMean(t,a){var c=null==t?0:t.length;return c?baseSum(t,a)/c:N}function baseProperty(t){return function(a){return null==a?m:a[t]}}function basePropertyOf(t){return function(a){return null==t?m:t[a]}}function baseReduce(t,a,c,m,h){return h(t,(function(t,h,g){c=m?(m=!1,t):a(c,t,h,g)})),c}function baseSum(t,a){for(var c,h=-1,g=t.length;++h<g;){var I=a(t[h]);I!==m&&(c=c===m?I:c+I)}return c}function baseTimes(t,a){for(var c=-1,m=Array(t);++c<t;)m[c]=a(c);return m}function baseTrim(t){return t?t.slice(0,trimmedEndIndex(t)+1).replace(Ie,""):t}function baseUnary(t){return function(a){return t(a)}}function baseValues(t,a){return arrayMap(a,(function(a){return t[a]}))}function cacheHas(t,a){return t.has(a)}function charsStartIndex(t,a){for(var c=-1,m=t.length;++c<m&&baseIndexOf(a,t[c],0)>-1;);return c}function charsEndIndex(t,a){for(var c=t.length;c--&&baseIndexOf(a,t[c],0)>-1;);return c}function countHolders(t,a){for(var c=t.length,m=0;c--;)t[c]===a&&++m;return m}var Bt=basePropertyOf({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),qt=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(t){return"\\"+Tt[t]}function hasUnicode(t){return gt.test(t)}function mapToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t,m){c[++a]=[m,t]})),c}function overArg(t,a){return function(c){return t(a(c))}}function replaceHolders(t,a){for(var c=-1,m=t.length,h=0,g=[];++c<m;){var M=t[c];M!==a&&M!==I||(t[c]=I,g[h++]=c)}return g}function setToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=t})),c}function setToPairs(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=[t,t]})),c}function stringSize(t){return hasUnicode(t)?function unicodeSize(t){var a=ht.lastIndex=0;for(;ht.test(t);)++a;return a}(t):Ft(t)}function stringToArray(t){return hasUnicode(t)?function unicodeToArray(t){return t.match(ht)||[]}(t):function asciiToArray(t){return t.split("")}(t)}function trimmedEndIndex(t){for(var a=t.length;a--&&Me.test(t.charAt(a)););return a}var Gt=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var jt=function runInContext(t){var a=(t=null==t?At:jt.defaults(At.Object(),t,jt.pick(At,yt))).Array,c=t.Date,Me=t.Error,Ue=t.Function,Fe=t.Math,Be=t.Object,qe=t.RegExp,Ge=t.String,je=t.TypeError,He=a.prototype,$e=Ue.prototype,Ye=Be.prototype,We=t["__core-js_shared__"],ze=$e.toString,Ke=Ye.hasOwnProperty,Qe=0,Je=function(){var t=/[^.]+$/.exec(We&&We.keys&&We.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Xe=Ye.toString,Ze=ze.call(Be),et=At._,tt=qe("^"+ze.call(Ke).replace(ye,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=kt?t.Buffer:m,nt=t.Symbol,at=t.Uint8Array,it=rt?rt.allocUnsafe:m,ot=overArg(Be.getPrototypeOf,Be),st=Be.create,ct=Ye.propertyIsEnumerable,lt=He.splice,ut=nt?nt.isConcatSpreadable:m,dt=nt?nt.iterator:m,ht=nt?nt.toStringTag:m,gt=function(){try{var t=getNative(Be,"defineProperty");return t({},"",{}),t}catch(t){}}(),Tt=t.clearTimeout!==At.clearTimeout&&t.clearTimeout,bt=c&&c.now!==At.Date.now&&c.now,Ct=t.setTimeout!==At.setTimeout&&t.setTimeout,Nt=Fe.ceil,Rt=Fe.floor,wt=Be.getOwnPropertySymbols,Ot=rt?rt.isBuffer:m,Ft=t.isFinite,Ht=He.join,$t=overArg(Be.keys,Be),Yt=Fe.max,Wt=Fe.min,zt=c.now,Kt=t.parseInt,Qt=Fe.random,Jt=He.reverse,Xt=getNative(t,"DataView"),Zt=getNative(t,"Map"),er=getNative(t,"Promise"),tr=getNative(t,"Set"),rr=getNative(t,"WeakMap"),nr=getNative(Be,"create"),ar=rr&&new rr,ir={},or=toSource(Xt),sr=toSource(Zt),cr=toSource(er),lr=toSource(tr),ur=toSource(rr),dr=nt?nt.prototype:m,pr=dr?dr.valueOf:m,mr=dr?dr.toString:m;function lodash(t){if(isObjectLike(t)&&!_n(t)&&!(t instanceof LazyWrapper)){if(t instanceof LodashWrapper)return t;if(Ke.call(t,"__wrapped__"))return wrapperClone(t)}return new LodashWrapper(t)}var hr=function(){function object(){}return function(t){if(!isObject(t))return{};if(st)return st(t);object.prototype=t;var a=new object;return object.prototype=m,a}}();function baseLodash(){}function LodashWrapper(t,a){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=m}function LazyWrapper(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=R,this.__views__=[]}function Hash(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}function ListCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}function MapCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var m=t[a];this.set(m[0],m[1])}}function SetCache(t){var a=-1,c=null==t?0:t.length;for(this.__data__=new MapCache;++a<c;)this.add(t[a])}function Stack(t){var a=this.__data__=new ListCache(t);this.size=a.size}function arrayLikeKeys(t,a){var c=_n(t),m=!c&&yn(t),h=!c&&!m&&Mn(t),g=!c&&!m&&!h&&Cn(t),I=c||m||h||g,M=I?baseTimes(t.length,Ge):[],T=M.length;for(var S in t)!a&&!Ke.call(t,S)||I&&("length"==S||h&&("offset"==S||"parent"==S)||g&&("buffer"==S||"byteLength"==S||"byteOffset"==S)||isIndex(S,T))||M.push(S);return M}function arraySample(t){var a=t.length;return a?t[baseRandom(0,a-1)]:m}function arraySampleSize(t,a){return shuffleSelf(copyArray(t),baseClamp(a,0,t.length))}function arrayShuffle(t){return shuffleSelf(copyArray(t))}function assignMergeValue(t,a,c){(c!==m&&!eq(t[a],c)||c===m&&!(a in t))&&baseAssignValue(t,a,c)}function assignValue(t,a,c){var h=t[a];Ke.call(t,a)&&eq(h,c)&&(c!==m||a in t)||baseAssignValue(t,a,c)}function assocIndexOf(t,a){for(var c=t.length;c--;)if(eq(t[c][0],a))return c;return-1}function baseAggregator(t,a,c,m){return fr(t,(function(t,h,g){a(m,t,c(t),g)})),m}function baseAssign(t,a){return t&&copyObject(a,keys(a),t)}function baseAssignValue(t,a,c){"__proto__"==a&&gt?gt(t,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):t[a]=c}function baseAt(t,c){for(var h=-1,g=c.length,I=a(g),M=null==t;++h<g;)I[h]=M?m:get(t,c[h]);return I}function baseClamp(t,a,c){return t==t&&(c!==m&&(t=t<=c?t:c),a!==m&&(t=t>=a?t:a)),t}function baseClone(t,a,c,h,g,I){var M,T=1&a,S=2&a,E=4&a;if(c&&(M=g?c(t,h,g,I):c(t)),M!==m)return M;if(!isObject(t))return t;var b=_n(t);if(b){if(M=function initCloneArray(t){var a=t.length,c=new t.constructor(a);a&&"string"==typeof t[0]&&Ke.call(t,"index")&&(c.index=t.index,c.input=t.input);return c}(t),!T)return copyArray(t,M)}else{var C=Ar(t),A=C==L||C==D;if(Mn(t))return cloneBuffer(t,T);if(C==q||C==w||A&&!g){if(M=S||A?{}:initCloneObject(t),!T)return S?function copySymbolsIn(t,a){return copyObject(t,Cr(t),a)}(t,function baseAssignIn(t,a){return t&&copyObject(a,keysIn(a),t)}(M,t)):function copySymbols(t,a){return copyObject(t,br(t),a)}(t,baseAssign(M,t))}else{if(!Mt[C])return g?t:{};M=function initCloneByTag(t,a,c){var m=t.constructor;switch(a){case z:return cloneArrayBuffer(t);case P:case x:return new m(+t);case K:return function cloneDataView(t,a){var c=a?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.byteLength)}(t,c);case Q:case J:case X:case Z:case ee:case te:case re:case ne:case ae:return cloneTypedArray(t,c);case U:return new m;case B:case $:return new m(t);case j:return function cloneRegExp(t){var a=new t.constructor(t.source,Re.exec(t));return a.lastIndex=t.lastIndex,a}(t);case H:return new m;case Y:return function cloneSymbol(t){return pr?Be(pr.call(t)):{}}(t)}}(t,C,T)}}I||(I=new Stack);var N=I.get(t);if(N)return N;I.set(t,M),bn(t)?t.forEach((function(m){M.add(baseClone(m,a,c,m,t,I))})):Sn(t)&&t.forEach((function(m,h){M.set(h,baseClone(m,a,c,h,t,I))}));var R=b?m:(E?S?getAllKeysIn:getAllKeys:S?keysIn:keys)(t);return arrayEach(R||t,(function(m,h){R&&(m=t[h=m]),assignValue(M,h,baseClone(m,a,c,h,t,I))})),M}function baseConformsTo(t,a,c){var h=c.length;if(null==t)return!h;for(t=Be(t);h--;){var g=c[h],I=a[g],M=t[g];if(M===m&&!(g in t)||!I(M))return!1}return!0}function baseDelay(t,a,c){if("function"!=typeof t)throw new je(h);return kr((function(){t.apply(m,c)}),a)}function baseDifference(t,a,c,m){var h=-1,g=arrayIncludes,I=!0,M=t.length,T=[],S=a.length;if(!M)return T;c&&(a=arrayMap(a,baseUnary(c))),m?(g=arrayIncludesWith,I=!1):a.length>=200&&(g=cacheHas,I=!1,a=new SetCache(a));e:for(;++h<M;){var E=t[h],b=null==c?E:c(E);if(E=m||0!==E?E:0,I&&b==b){for(var C=S;C--;)if(a[C]===b)continue e;T.push(E)}else g(a,b,m)||T.push(E)}return T}lodash.templateSettings={escape:pe,evaluate:me,interpolate:he,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=hr(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=hr(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function hashClear(){this.__data__=nr?nr(null):{},this.size=0},Hash.prototype.delete=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},Hash.prototype.get=function hashGet(t){var a=this.__data__;if(nr){var c=a[t];return c===g?m:c}return Ke.call(a,t)?a[t]:m},Hash.prototype.has=function hashHas(t){var a=this.__data__;return nr?a[t]!==m:Ke.call(a,t)},Hash.prototype.set=function hashSet(t,a){var c=this.__data__;return this.size+=this.has(t)?0:1,c[t]=nr&&a===m?g:a,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(t){var a=this.__data__,c=assocIndexOf(a,t);return!(c<0)&&(c==a.length-1?a.pop():lt.call(a,c,1),--this.size,!0)},ListCache.prototype.get=function listCacheGet(t){var a=this.__data__,c=assocIndexOf(a,t);return c<0?m:a[c][1]},ListCache.prototype.has=function listCacheHas(t){return assocIndexOf(this.__data__,t)>-1},ListCache.prototype.set=function listCacheSet(t,a){var c=this.__data__,m=assocIndexOf(c,t);return m<0?(++this.size,c.push([t,a])):c[m][1]=a,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Zt||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(t){var a=getMapData(this,t).delete(t);return this.size-=a?1:0,a},MapCache.prototype.get=function mapCacheGet(t){return getMapData(this,t).get(t)},MapCache.prototype.has=function mapCacheHas(t){return getMapData(this,t).has(t)},MapCache.prototype.set=function mapCacheSet(t,a){var c=getMapData(this,t),m=c.size;return c.set(t,a),this.size+=c.size==m?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(t){return this.__data__.set(t,g),this},SetCache.prototype.has=function setCacheHas(t){return this.__data__.has(t)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(t){var a=this.__data__,c=a.delete(t);return this.size=a.size,c},Stack.prototype.get=function stackGet(t){return this.__data__.get(t)},Stack.prototype.has=function stackHas(t){return this.__data__.has(t)},Stack.prototype.set=function stackSet(t,a){var c=this.__data__;if(c instanceof ListCache){var m=c.__data__;if(!Zt||m.length<199)return m.push([t,a]),this.size=++c.size,this;c=this.__data__=new MapCache(m)}return c.set(t,a),this.size=c.size,this};var fr=createBaseEach(baseForOwn),gr=createBaseEach(baseForOwnRight,!0);function baseEvery(t,a){var c=!0;return fr(t,(function(t,m,h){return c=!!a(t,m,h)})),c}function baseExtremum(t,a,c){for(var h=-1,g=t.length;++h<g;){var I=t[h],M=a(I);if(null!=M&&(T===m?M==M&&!isSymbol(M):c(M,T)))var T=M,S=I}return S}function baseFilter(t,a){var c=[];return fr(t,(function(t,m,h){a(t,m,h)&&c.push(t)})),c}function baseFlatten(t,a,c,m,h){var g=-1,I=t.length;for(c||(c=isFlattenable),h||(h=[]);++g<I;){var M=t[g];a>0&&c(M)?a>1?baseFlatten(M,a-1,c,m,h):arrayPush(h,M):m||(h[h.length]=M)}return h}var vr=createBaseFor(),yr=createBaseFor(!0);function baseForOwn(t,a){return t&&vr(t,a,keys)}function baseForOwnRight(t,a){return t&&yr(t,a,keys)}function baseFunctions(t,a){return arrayFilter(a,(function(a){return isFunction(t[a])}))}function baseGet(t,a){for(var c=0,h=(a=castPath(a,t)).length;null!=t&&c<h;)t=t[toKey(a[c++])];return c&&c==h?t:m}function baseGetAllKeys(t,a,c){var m=a(t);return _n(t)?m:arrayPush(m,c(t))}function baseGetTag(t){return null==t?t===m?"[object Undefined]":"[object Null]":ht&&ht in Be(t)?function getRawTag(t){var a=Ke.call(t,ht),c=t[ht];try{t[ht]=m;var h=!0}catch(t){}var g=Xe.call(t);h&&(a?t[ht]=c:delete t[ht]);return g}(t):function objectToString(t){return Xe.call(t)}(t)}function baseGt(t,a){return t>a}function baseHas(t,a){return null!=t&&Ke.call(t,a)}function baseHasIn(t,a){return null!=t&&a in Be(t)}function baseIntersection(t,c,h){for(var g=h?arrayIncludesWith:arrayIncludes,I=t[0].length,M=t.length,T=M,S=a(M),E=1/0,b=[];T--;){var C=t[T];T&&c&&(C=arrayMap(C,baseUnary(c))),E=Wt(C.length,E),S[T]=!h&&(c||I>=120&&C.length>=120)?new SetCache(T&&C):m}C=t[0];var A=-1,N=S[0];e:for(;++A<I&&b.length<E;){var R=C[A],k=c?c(R):R;if(R=h||0!==R?R:0,!(N?cacheHas(N,k):g(b,k,h))){for(T=M;--T;){var w=S[T];if(!(w?cacheHas(w,k):g(t[T],k,h)))continue e}N&&N.push(k),b.push(R)}}return b}function baseInvoke(t,a,c){var h=null==(t=parent(t,a=castPath(a,t)))?t:t[toKey(last(a))];return null==h?m:apply(h,t,c)}function baseIsArguments(t){return isObjectLike(t)&&baseGetTag(t)==w}function baseIsEqual(t,a,c,h,g){return t===a||(null==t||null==a||!isObjectLike(t)&&!isObjectLike(a)?t!=t&&a!=a:function baseIsEqualDeep(t,a,c,h,g,I){var M=_n(t),T=_n(a),S=M?O:Ar(t),E=T?O:Ar(a),b=(S=S==w?q:S)==q,C=(E=E==w?q:E)==q,A=S==E;if(A&&Mn(t)){if(!Mn(a))return!1;M=!0,b=!1}if(A&&!b)return I||(I=new Stack),M||Cn(t)?equalArrays(t,a,c,h,g,I):function equalByTag(t,a,c,m,h,g,I){switch(c){case K:if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case z:return!(t.byteLength!=a.byteLength||!g(new at(t),new at(a)));case P:case x:case B:return eq(+t,+a);case V:return t.name==a.name&&t.message==a.message;case j:case $:return t==a+"";case U:var M=mapToArray;case H:var T=1&m;if(M||(M=setToArray),t.size!=a.size&&!T)return!1;var S=I.get(t);if(S)return S==a;m|=2,I.set(t,a);var E=equalArrays(M(t),M(a),m,h,g,I);return I.delete(t),E;case Y:if(pr)return pr.call(t)==pr.call(a)}return!1}(t,a,S,c,h,g,I);if(!(1&c)){var N=b&&Ke.call(t,"__wrapped__"),R=C&&Ke.call(a,"__wrapped__");if(N||R){var k=N?t.value():t,L=R?a.value():a;return I||(I=new Stack),g(k,L,c,h,I)}}if(!A)return!1;return I||(I=new Stack),function equalObjects(t,a,c,h,g,I){var M=1&c,T=getAllKeys(t),S=T.length,E=getAllKeys(a).length;if(S!=E&&!M)return!1;var b=S;for(;b--;){var C=T[b];if(!(M?C in a:Ke.call(a,C)))return!1}var A=I.get(t),N=I.get(a);if(A&&N)return A==a&&N==t;var R=!0;I.set(t,a),I.set(a,t);var k=M;for(;++b<S;){var w=t[C=T[b]],O=a[C];if(h)var P=M?h(O,w,C,a,t,I):h(w,O,C,t,a,I);if(!(P===m?w===O||g(w,O,c,h,I):P)){R=!1;break}k||(k="constructor"==C)}if(R&&!k){var x=t.constructor,V=a.constructor;x==V||!("constructor"in t)||!("constructor"in a)||"function"==typeof x&&x instanceof x&&"function"==typeof V&&V instanceof V||(R=!1)}return I.delete(t),I.delete(a),R}(t,a,c,h,g,I)}(t,a,c,h,baseIsEqual,g))}function baseIsMatch(t,a,c,h){var g=c.length,I=g,M=!h;if(null==t)return!I;for(t=Be(t);g--;){var T=c[g];if(M&&T[2]?T[1]!==t[T[0]]:!(T[0]in t))return!1}for(;++g<I;){var S=(T=c[g])[0],E=t[S],b=T[1];if(M&&T[2]){if(E===m&&!(S in t))return!1}else{var C=new Stack;if(h)var A=h(E,b,S,t,a,C);if(!(A===m?baseIsEqual(b,E,3,h,C):A))return!1}}return!0}function baseIsNative(t){return!(!isObject(t)||function isMasked(t){return!!Je&&Je in t}(t))&&(isFunction(t)?tt:Oe).test(toSource(t))}function baseIteratee(t){return"function"==typeof t?t:null==t?identity:"object"==typeof t?_n(t)?baseMatchesProperty(t[0],t[1]):baseMatches(t):property(t)}function baseKeys(t){if(!isPrototype(t))return $t(t);var a=[];for(var c in Be(t))Ke.call(t,c)&&"constructor"!=c&&a.push(c);return a}function baseKeysIn(t){if(!isObject(t))return function nativeKeysIn(t){var a=[];if(null!=t)for(var c in Be(t))a.push(c);return a}(t);var a=isPrototype(t),c=[];for(var m in t)("constructor"!=m||!a&&Ke.call(t,m))&&c.push(m);return c}function baseLt(t,a){return t<a}function baseMap(t,c){var m=-1,h=isArrayLike(t)?a(t.length):[];return fr(t,(function(t,a,g){h[++m]=c(t,a,g)})),h}function baseMatches(t){var a=getMatchData(t);return 1==a.length&&a[0][2]?matchesStrictComparable(a[0][0],a[0][1]):function(c){return c===t||baseIsMatch(c,t,a)}}function baseMatchesProperty(t,a){return isKey(t)&&isStrictComparable(a)?matchesStrictComparable(toKey(t),a):function(c){var h=get(c,t);return h===m&&h===a?hasIn(c,t):baseIsEqual(a,h,3)}}function baseMerge(t,a,c,h,g){t!==a&&vr(a,(function(I,M){if(g||(g=new Stack),isObject(I))!function baseMergeDeep(t,a,c,h,g,I,M){var T=safeGet(t,c),S=safeGet(a,c),E=M.get(S);if(E)return void assignMergeValue(t,c,E);var b=I?I(T,S,c+"",t,a,M):m,C=b===m;if(C){var A=_n(S),N=!A&&Mn(S),R=!A&&!N&&Cn(S);b=S,A||N||R?_n(T)?b=T:isArrayLikeObject(T)?b=copyArray(T):N?(C=!1,b=cloneBuffer(S,!0)):R?(C=!1,b=cloneTypedArray(S,!0)):b=[]:isPlainObject(S)||yn(S)?(b=T,yn(T)?b=toPlainObject(T):isObject(T)&&!isFunction(T)||(b=initCloneObject(S))):C=!1}C&&(M.set(S,b),g(b,S,h,I,M),M.delete(S));assignMergeValue(t,c,b)}(t,a,M,c,baseMerge,h,g);else{var T=h?h(safeGet(t,M),I,M+"",t,a,g):m;T===m&&(T=I),assignMergeValue(t,M,T)}}),keysIn)}function baseNth(t,a){var c=t.length;if(c)return isIndex(a+=a<0?c:0,c)?t[a]:m}function baseOrderBy(t,a,c){a=a.length?arrayMap(a,(function(t){return _n(t)?function(a){return baseGet(a,1===t.length?t[0]:t)}:t})):[identity];var m=-1;a=arrayMap(a,baseUnary(getIteratee()));var h=baseMap(t,(function(t,c,h){var g=arrayMap(a,(function(a){return a(t)}));return{criteria:g,index:++m,value:t}}));return function baseSortBy(t,a){var c=t.length;for(t.sort(a);c--;)t[c]=t[c].value;return t}(h,(function(t,a){return function compareMultiple(t,a,c){var m=-1,h=t.criteria,g=a.criteria,I=h.length,M=c.length;for(;++m<I;){var T=compareAscending(h[m],g[m]);if(T)return m>=M?T:T*("desc"==c[m]?-1:1)}return t.index-a.index}(t,a,c)}))}function basePickBy(t,a,c){for(var m=-1,h=a.length,g={};++m<h;){var I=a[m],M=baseGet(t,I);c(M,I)&&baseSet(g,castPath(I,t),M)}return g}function basePullAll(t,a,c,m){var h=m?baseIndexOfWith:baseIndexOf,g=-1,I=a.length,M=t;for(t===a&&(a=copyArray(a)),c&&(M=arrayMap(t,baseUnary(c)));++g<I;)for(var T=0,S=a[g],E=c?c(S):S;(T=h(M,E,T,m))>-1;)M!==t&&lt.call(M,T,1),lt.call(t,T,1);return t}function basePullAt(t,a){for(var c=t?a.length:0,m=c-1;c--;){var h=a[c];if(c==m||h!==g){var g=h;isIndex(h)?lt.call(t,h,1):baseUnset(t,h)}}return t}function baseRandom(t,a){return t+Rt(Qt()*(a-t+1))}function baseRepeat(t,a){var c="";if(!t||a<1||a>A)return c;do{a%2&&(c+=t),(a=Rt(a/2))&&(t+=t)}while(a);return c}function baseRest(t,a){return wr(overRest(t,a,identity),t+"")}function baseSample(t){return arraySample(values(t))}function baseSampleSize(t,a){var c=values(t);return shuffleSelf(c,baseClamp(a,0,c.length))}function baseSet(t,a,c,h){if(!isObject(t))return t;for(var g=-1,I=(a=castPath(a,t)).length,M=I-1,T=t;null!=T&&++g<I;){var S=toKey(a[g]),E=c;if("__proto__"===S||"constructor"===S||"prototype"===S)return t;if(g!=M){var b=T[S];(E=h?h(b,S,T):m)===m&&(E=isObject(b)?b:isIndex(a[g+1])?[]:{})}assignValue(T,S,E),T=T[S]}return t}var _r=ar?function(t,a){return ar.set(t,a),t}:identity,Ir=gt?function(t,a){return gt(t,"toString",{configurable:!0,enumerable:!1,value:constant(a),writable:!0})}:identity;function baseShuffle(t){return shuffleSelf(values(t))}function baseSlice(t,c,m){var h=-1,g=t.length;c<0&&(c=-c>g?0:g+c),(m=m>g?g:m)<0&&(m+=g),g=c>m?0:m-c>>>0,c>>>=0;for(var I=a(g);++h<g;)I[h]=t[h+c];return I}function baseSome(t,a){var c;return fr(t,(function(t,m,h){return!(c=a(t,m,h))})),!!c}function baseSortedIndex(t,a,c){var m=0,h=null==t?m:t.length;if("number"==typeof a&&a==a&&h<=2147483647){for(;m<h;){var g=m+h>>>1,I=t[g];null!==I&&!isSymbol(I)&&(c?I<=a:I<a)?m=g+1:h=g}return h}return baseSortedIndexBy(t,a,identity,c)}function baseSortedIndexBy(t,a,c,h){var g=0,I=null==t?0:t.length;if(0===I)return 0;for(var M=(a=c(a))!=a,T=null===a,S=isSymbol(a),E=a===m;g<I;){var b=Rt((g+I)/2),C=c(t[b]),A=C!==m,N=null===C,R=C==C,k=isSymbol(C);if(M)var w=h||R;else w=E?R&&(h||A):T?R&&A&&(h||!N):S?R&&A&&!N&&(h||!k):!N&&!k&&(h?C<=a:C<a);w?g=b+1:I=b}return Wt(I,4294967294)}function baseSortedUniq(t,a){for(var c=-1,m=t.length,h=0,g=[];++c<m;){var I=t[c],M=a?a(I):I;if(!c||!eq(M,T)){var T=M;g[h++]=0===I?0:I}}return g}function baseToNumber(t){return"number"==typeof t?t:isSymbol(t)?N:+t}function baseToString(t){if("string"==typeof t)return t;if(_n(t))return arrayMap(t,baseToString)+"";if(isSymbol(t))return mr?mr.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a}function baseUniq(t,a,c){var m=-1,h=arrayIncludes,g=t.length,I=!0,M=[],T=M;if(c)I=!1,h=arrayIncludesWith;else if(g>=200){var S=a?null:Sr(t);if(S)return setToArray(S);I=!1,h=cacheHas,T=new SetCache}else T=a?[]:M;e:for(;++m<g;){var E=t[m],b=a?a(E):E;if(E=c||0!==E?E:0,I&&b==b){for(var C=T.length;C--;)if(T[C]===b)continue e;a&&T.push(b),M.push(E)}else h(T,b,c)||(T!==M&&T.push(b),M.push(E))}return M}function baseUnset(t,a){return null==(t=parent(t,a=castPath(a,t)))||delete t[toKey(last(a))]}function baseUpdate(t,a,c,m){return baseSet(t,a,c(baseGet(t,a)),m)}function baseWhile(t,a,c,m){for(var h=t.length,g=m?h:-1;(m?g--:++g<h)&&a(t[g],g,t););return c?baseSlice(t,m?0:g,m?g+1:h):baseSlice(t,m?g+1:0,m?h:g)}function baseWrapperValue(t,a){var c=t;return c instanceof LazyWrapper&&(c=c.value()),arrayReduce(a,(function(t,a){return a.func.apply(a.thisArg,arrayPush([t],a.args))}),c)}function baseXor(t,c,m){var h=t.length;if(h<2)return h?baseUniq(t[0]):[];for(var g=-1,I=a(h);++g<h;)for(var M=t[g],T=-1;++T<h;)T!=g&&(I[g]=baseDifference(I[g]||M,t[T],c,m));return baseUniq(baseFlatten(I,1),c,m)}function baseZipObject(t,a,c){for(var h=-1,g=t.length,I=a.length,M={};++h<g;){var T=h<I?a[h]:m;c(M,t[h],T)}return M}function castArrayLikeObject(t){return isArrayLikeObject(t)?t:[]}function castFunction(t){return"function"==typeof t?t:identity}function castPath(t,a){return _n(t)?t:isKey(t,a)?[t]:Or(toString(t))}var Mr=baseRest;function castSlice(t,a,c){var h=t.length;return c=c===m?h:c,!a&&c>=h?t:baseSlice(t,a,c)}var Tr=Tt||function(t){return At.clearTimeout(t)};function cloneBuffer(t,a){if(a)return t.slice();var c=t.length,m=it?it(c):new t.constructor(c);return t.copy(m),m}function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new at(a).set(new at(t)),a}function cloneTypedArray(t,a){var c=a?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.length)}function compareAscending(t,a){if(t!==a){var c=t!==m,h=null===t,g=t==t,I=isSymbol(t),M=a!==m,T=null===a,S=a==a,E=isSymbol(a);if(!T&&!E&&!I&&t>a||I&&M&&S&&!T&&!E||h&&M&&S||!c&&S||!g)return 1;if(!h&&!I&&!E&&t<a||E&&c&&g&&!h&&!I||T&&c&&g||!M&&g||!S)return-1}return 0}function composeArgs(t,c,m,h){for(var g=-1,I=t.length,M=m.length,T=-1,S=c.length,E=Yt(I-M,0),b=a(S+E),C=!h;++T<S;)b[T]=c[T];for(;++g<M;)(C||g<I)&&(b[m[g]]=t[g]);for(;E--;)b[T++]=t[g++];return b}function composeArgsRight(t,c,m,h){for(var g=-1,I=t.length,M=-1,T=m.length,S=-1,E=c.length,b=Yt(I-T,0),C=a(b+E),A=!h;++g<b;)C[g]=t[g];for(var N=g;++S<E;)C[N+S]=c[S];for(;++M<T;)(A||g<I)&&(C[N+m[M]]=t[g++]);return C}function copyArray(t,c){var m=-1,h=t.length;for(c||(c=a(h));++m<h;)c[m]=t[m];return c}function copyObject(t,a,c,h){var g=!c;c||(c={});for(var I=-1,M=a.length;++I<M;){var T=a[I],S=h?h(c[T],t[T],T,c,t):m;S===m&&(S=t[T]),g?baseAssignValue(c,T,S):assignValue(c,T,S)}return c}function createAggregator(t,a){return function(c,m){var h=_n(c)?arrayAggregator:baseAggregator,g=a?a():{};return h(c,t,getIteratee(m,2),g)}}function createAssigner(t){return baseRest((function(a,c){var h=-1,g=c.length,I=g>1?c[g-1]:m,M=g>2?c[2]:m;for(I=t.length>3&&"function"==typeof I?(g--,I):m,M&&isIterateeCall(c[0],c[1],M)&&(I=g<3?m:I,g=1),a=Be(a);++h<g;){var T=c[h];T&&t(a,T,h,I)}return a}))}function createBaseEach(t,a){return function(c,m){if(null==c)return c;if(!isArrayLike(c))return t(c,m);for(var h=c.length,g=a?h:-1,I=Be(c);(a?g--:++g<h)&&!1!==m(I[g],g,I););return c}}function createBaseFor(t){return function(a,c,m){for(var h=-1,g=Be(a),I=m(a),M=I.length;M--;){var T=I[t?M:++h];if(!1===c(g[T],T,g))break}return a}}function createCaseFirst(t){return function(a){var c=hasUnicode(a=toString(a))?stringToArray(a):m,h=c?c[0]:a.charAt(0),g=c?castSlice(c,1).join(""):a.slice(1);return h[t]()+g}}function createCompounder(t){return function(a){return arrayReduce(words(deburr(a).replace(pt,"")),t,"")}}function createCtor(t){return function(){var a=arguments;switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3]);case 5:return new t(a[0],a[1],a[2],a[3],a[4]);case 6:return new t(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new t(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var c=hr(t.prototype),m=t.apply(c,a);return isObject(m)?m:c}}function createFind(t){return function(a,c,h){var g=Be(a);if(!isArrayLike(a)){var I=getIteratee(c,3);a=keys(a),c=function(t){return I(g[t],t,g)}}var M=t(a,c,h);return M>-1?g[I?a[M]:M]:m}}function createFlow(t){return flatRest((function(a){var c=a.length,g=c,I=LodashWrapper.prototype.thru;for(t&&a.reverse();g--;){var M=a[g];if("function"!=typeof M)throw new je(h);if(I&&!T&&"wrapper"==getFuncName(M))var T=new LodashWrapper([],!0)}for(g=T?g:c;++g<c;){var S=getFuncName(M=a[g]),E="wrapper"==S?Er(M):m;T=E&&isLaziable(E[0])&&424==E[1]&&!E[4].length&&1==E[9]?T[getFuncName(E[0])].apply(T,E[3]):1==M.length&&isLaziable(M)?T[S]():T.thru(M)}return function(){var t=arguments,m=t[0];if(T&&1==t.length&&_n(m))return T.plant(m).value();for(var h=0,g=c?a[h].apply(this,t):m;++h<c;)g=a[h].call(this,g);return g}}))}function createHybrid(t,c,h,g,I,M,T,S,b,C){var A=c&E,N=1&c,R=2&c,k=24&c,w=512&c,O=R?m:createCtor(t);return function wrapper(){for(var m=arguments.length,E=a(m),P=m;P--;)E[P]=arguments[P];if(k)var x=getHolder(wrapper),V=countHolders(E,x);if(g&&(E=composeArgs(E,g,I,k)),M&&(E=composeArgsRight(E,M,T,k)),m-=V,k&&m<C){var L=replaceHolders(E,x);return createRecurry(t,c,createHybrid,wrapper.placeholder,h,E,L,S,b,C-m)}var D=N?h:this,U=R?D[t]:t;return m=E.length,S?E=reorder(E,S):w&&m>1&&E.reverse(),A&&b<m&&(E.length=b),this&&this!==At&&this instanceof wrapper&&(U=O||createCtor(U)),U.apply(D,E)}}function createInverter(t,a){return function(c,m){return function baseInverter(t,a,c,m){return baseForOwn(t,(function(t,h,g){a(m,c(t),h,g)})),m}(c,t,a(m),{})}}function createMathOperation(t,a){return function(c,h){var g;if(c===m&&h===m)return a;if(c!==m&&(g=c),h!==m){if(g===m)return h;"string"==typeof c||"string"==typeof h?(c=baseToString(c),h=baseToString(h)):(c=baseToNumber(c),h=baseToNumber(h)),g=t(c,h)}return g}}function createOver(t){return flatRest((function(a){return a=arrayMap(a,baseUnary(getIteratee())),baseRest((function(c){var m=this;return t(a,(function(t){return apply(t,m,c)}))}))}))}function createPadding(t,a){var c=(a=a===m?" ":baseToString(a)).length;if(c<2)return c?baseRepeat(a,t):a;var h=baseRepeat(a,Nt(t/stringSize(a)));return hasUnicode(a)?castSlice(stringToArray(h),0,t).join(""):h.slice(0,t)}function createRange(t){return function(c,h,g){return g&&"number"!=typeof g&&isIterateeCall(c,h,g)&&(h=g=m),c=toFinite(c),h===m?(h=c,c=0):h=toFinite(h),function baseRange(t,c,m,h){for(var g=-1,I=Yt(Nt((c-t)/(m||1)),0),M=a(I);I--;)M[h?I:++g]=t,t+=m;return M}(c,h,g=g===m?c<h?1:-1:toFinite(g),t)}}function createRelationalOperation(t){return function(a,c){return"string"==typeof a&&"string"==typeof c||(a=toNumber(a),c=toNumber(c)),t(a,c)}}function createRecurry(t,a,c,h,g,I,M,E,b,C){var A=8&a;a|=A?T:S,4&(a&=~(A?S:T))||(a&=-4);var N=[t,a,g,A?I:m,A?M:m,A?m:I,A?m:M,E,b,C],R=c.apply(m,N);return isLaziable(t)&&Rr(R,N),R.placeholder=h,setWrapToString(R,t,a)}function createRound(t){var a=Fe[t];return function(t,c){if(t=toNumber(t),(c=null==c?0:Wt(toInteger(c),292))&&Ft(t)){var m=(toString(t)+"e").split("e");return+((m=(toString(a(m[0]+"e"+(+m[1]+c)))+"e").split("e"))[0]+"e"+(+m[1]-c))}return a(t)}}var Sr=tr&&1/setToArray(new tr([,-0]))[1]==C?function(t){return new tr(t)}:noop;function createToPairs(t){return function(a){var c=Ar(a);return c==U?mapToArray(a):c==H?setToPairs(a):function baseToPairs(t,a){return arrayMap(a,(function(a){return[a,t[a]]}))}(a,t(a))}}function createWrap(t,c,g,C,A,N,R,k){var w=2&c;if(!w&&"function"!=typeof t)throw new je(h);var O=C?C.length:0;if(O||(c&=-97,C=A=m),R=R===m?R:Yt(toInteger(R),0),k=k===m?k:toInteger(k),O-=A?A.length:0,c&S){var P=C,x=A;C=A=m}var V=w?m:Er(t),L=[t,c,g,C,A,P,x,N,R,k];if(V&&function mergeData(t,a){var c=t[1],m=a[1],h=c|m,g=h<131,M=m==E&&8==c||m==E&&c==b&&t[7].length<=a[8]||384==m&&a[7].length<=a[8]&&8==c;if(!g&&!M)return t;1&m&&(t[2]=a[2],h|=1&c?0:4);var T=a[3];if(T){var S=t[3];t[3]=S?composeArgs(S,T,a[4]):T,t[4]=S?replaceHolders(t[3],I):a[4]}(T=a[5])&&(S=t[5],t[5]=S?composeArgsRight(S,T,a[6]):T,t[6]=S?replaceHolders(t[5],I):a[6]);(T=a[7])&&(t[7]=T);m&E&&(t[8]=null==t[8]?a[8]:Wt(t[8],a[8]));null==t[9]&&(t[9]=a[9]);return t[0]=a[0],t[1]=h,t}(L,V),t=L[0],c=L[1],g=L[2],C=L[3],A=L[4],!(k=L[9]=L[9]===m?w?0:t.length:Yt(L[9]-O,0))&&24&c&&(c&=-25),c&&1!=c)D=8==c||c==M?function createCurry(t,c,h){var g=createCtor(t);return function wrapper(){for(var I=arguments.length,M=a(I),T=I,S=getHolder(wrapper);T--;)M[T]=arguments[T];var E=I<3&&M[0]!==S&&M[I-1]!==S?[]:replaceHolders(M,S);return(I-=E.length)<h?createRecurry(t,c,createHybrid,wrapper.placeholder,m,M,E,m,m,h-I):apply(this&&this!==At&&this instanceof wrapper?g:t,this,M)}}(t,c,k):c!=T&&33!=c||A.length?createHybrid.apply(m,L):function createPartial(t,c,m,h){var g=1&c,I=createCtor(t);return function wrapper(){for(var c=-1,M=arguments.length,T=-1,S=h.length,E=a(S+M),b=this&&this!==At&&this instanceof wrapper?I:t;++T<S;)E[T]=h[T];for(;M--;)E[T++]=arguments[++c];return apply(b,g?m:this,E)}}(t,c,g,C);else var D=function createBind(t,a,c){var m=1&a,h=createCtor(t);return function wrapper(){return(this&&this!==At&&this instanceof wrapper?h:t).apply(m?c:this,arguments)}}(t,c,g);return setWrapToString((V?_r:Rr)(D,L),t,c)}function customDefaultsAssignIn(t,a,c,h){return t===m||eq(t,Ye[c])&&!Ke.call(h,c)?a:t}function customDefaultsMerge(t,a,c,h,g,I){return isObject(t)&&isObject(a)&&(I.set(a,t),baseMerge(t,a,m,customDefaultsMerge,I),I.delete(a)),t}function customOmitClone(t){return isPlainObject(t)?m:t}function equalArrays(t,a,c,h,g,I){var M=1&c,T=t.length,S=a.length;if(T!=S&&!(M&&S>T))return!1;var E=I.get(t),b=I.get(a);if(E&&b)return E==a&&b==t;var C=-1,A=!0,N=2&c?new SetCache:m;for(I.set(t,a),I.set(a,t);++C<T;){var R=t[C],k=a[C];if(h)var w=M?h(k,R,C,a,t,I):h(R,k,C,t,a,I);if(w!==m){if(w)continue;A=!1;break}if(N){if(!arraySome(a,(function(t,a){if(!cacheHas(N,a)&&(R===t||g(R,t,c,h,I)))return N.push(a)}))){A=!1;break}}else if(R!==k&&!g(R,k,c,h,I)){A=!1;break}}return I.delete(t),I.delete(a),A}function flatRest(t){return wr(overRest(t,m,flatten),t+"")}function getAllKeys(t){return baseGetAllKeys(t,keys,br)}function getAllKeysIn(t){return baseGetAllKeys(t,keysIn,Cr)}var Er=ar?function(t){return ar.get(t)}:noop;function getFuncName(t){for(var a=t.name+"",c=ir[a],m=Ke.call(ir,a)?c.length:0;m--;){var h=c[m],g=h.func;if(null==g||g==t)return h.name}return a}function getHolder(t){return(Ke.call(lodash,"placeholder")?lodash:t).placeholder}function getIteratee(){var t=lodash.iteratee||iteratee;return t=t===iteratee?baseIteratee:t,arguments.length?t(arguments[0],arguments[1]):t}function getMapData(t,a){var c=t.__data__;return function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t}(a)?c["string"==typeof a?"string":"hash"]:c.map}function getMatchData(t){for(var a=keys(t),c=a.length;c--;){var m=a[c],h=t[m];a[c]=[m,h,isStrictComparable(h)]}return a}function getNative(t,a){var c=function getValue(t,a){return null==t?m:t[a]}(t,a);return baseIsNative(c)?c:m}var br=wt?function(t){return null==t?[]:(t=Be(t),arrayFilter(wt(t),(function(a){return ct.call(t,a)})))}:stubArray,Cr=wt?function(t){for(var a=[];t;)arrayPush(a,br(t)),t=ot(t);return a}:stubArray,Ar=baseGetTag;function hasPath(t,a,c){for(var m=-1,h=(a=castPath(a,t)).length,g=!1;++m<h;){var I=toKey(a[m]);if(!(g=null!=t&&c(t,I)))break;t=t[I]}return g||++m!=h?g:!!(h=null==t?0:t.length)&&isLength(h)&&isIndex(I,h)&&(_n(t)||yn(t))}function initCloneObject(t){return"function"!=typeof t.constructor||isPrototype(t)?{}:hr(ot(t))}function isFlattenable(t){return _n(t)||yn(t)||!!(ut&&t&&t[ut])}function isIndex(t,a){var c=typeof t;return!!(a=null==a?A:a)&&("number"==c||"symbol"!=c&&xe.test(t))&&t>-1&&t%1==0&&t<a}function isIterateeCall(t,a,c){if(!isObject(c))return!1;var m=typeof a;return!!("number"==m?isArrayLike(c)&&isIndex(a,c.length):"string"==m&&a in c)&&eq(c[a],t)}function isKey(t,a){if(_n(t))return!1;var c=typeof t;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=t&&!isSymbol(t))||(ge.test(t)||!fe.test(t)||null!=a&&t in Be(a))}function isLaziable(t){var a=getFuncName(t),c=lodash[a];if("function"!=typeof c||!(a in LazyWrapper.prototype))return!1;if(t===c)return!0;var m=Er(c);return!!m&&t===m[0]}(Xt&&Ar(new Xt(new ArrayBuffer(1)))!=K||Zt&&Ar(new Zt)!=U||er&&Ar(er.resolve())!=G||tr&&Ar(new tr)!=H||rr&&Ar(new rr)!=W)&&(Ar=function(t){var a=baseGetTag(t),c=a==q?t.constructor:m,h=c?toSource(c):"";if(h)switch(h){case or:return K;case sr:return U;case cr:return G;case lr:return H;case ur:return W}return a});var Nr=We?isFunction:stubFalse;function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||Ye)}function isStrictComparable(t){return t==t&&!isObject(t)}function matchesStrictComparable(t,a){return function(c){return null!=c&&(c[t]===a&&(a!==m||t in Be(c)))}}function overRest(t,c,h){return c=Yt(c===m?t.length-1:c,0),function(){for(var m=arguments,g=-1,I=Yt(m.length-c,0),M=a(I);++g<I;)M[g]=m[c+g];g=-1;for(var T=a(c+1);++g<c;)T[g]=m[g];return T[c]=h(M),apply(t,this,T)}}function parent(t,a){return a.length<2?t:baseGet(t,baseSlice(a,0,-1))}function reorder(t,a){for(var c=t.length,h=Wt(a.length,c),g=copyArray(t);h--;){var I=a[h];t[h]=isIndex(I,c)?g[I]:m}return t}function safeGet(t,a){if(("constructor"!==a||"function"!=typeof t[a])&&"__proto__"!=a)return t[a]}var Rr=shortOut(_r),kr=Ct||function(t,a){return At.setTimeout(t,a)},wr=shortOut(Ir);function setWrapToString(t,a,c){var m=a+"";return wr(t,function insertWrapDetails(t,a){var c=a.length;if(!c)return t;var m=c-1;return a[m]=(c>1?"& ":"")+a[m],a=a.join(c>2?", ":" "),t.replace(Te,"{\n/* [wrapped with "+a+"] */\n")}(m,function updateWrapDetails(t,a){return arrayEach(k,(function(c){var m="_."+c[0];a&c[1]&&!arrayIncludes(t,m)&&t.push(m)})),t.sort()}(function getWrapDetails(t){var a=t.match(Se);return a?a[1].split(Ee):[]}(m),c)))}function shortOut(t){var a=0,c=0;return function(){var h=zt(),g=16-(h-c);if(c=h,g>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(m,arguments)}}function shuffleSelf(t,a){var c=-1,h=t.length,g=h-1;for(a=a===m?h:a;++c<a;){var I=baseRandom(c,g),M=t[I];t[I]=t[c],t[c]=M}return t.length=a,t}var Or=function memoizeCapped(t){var a=memoize(t,(function(t){return 500===c.size&&c.clear(),t})),c=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(ve,(function(t,c,m,h){a.push(m?h.replace(Ae,"$1"):c||t)})),a}));function toKey(t){if("string"==typeof t||isSymbol(t))return t;var a=t+"";return"0"==a&&1/t==-1/0?"-0":a}function toSource(t){if(null!=t){try{return ze.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function wrapperClone(t){if(t instanceof LazyWrapper)return t.clone();var a=new LodashWrapper(t.__wrapped__,t.__chain__);return a.__actions__=copyArray(t.__actions__),a.__index__=t.__index__,a.__values__=t.__values__,a}var Pr=baseRest((function(t,a){return isArrayLikeObject(t)?baseDifference(t,baseFlatten(a,1,isArrayLikeObject,!0)):[]})),xr=baseRest((function(t,a){var c=last(a);return isArrayLikeObject(c)&&(c=m),isArrayLikeObject(t)?baseDifference(t,baseFlatten(a,1,isArrayLikeObject,!0),getIteratee(c,2)):[]})),Vr=baseRest((function(t,a){var c=last(a);return isArrayLikeObject(c)&&(c=m),isArrayLikeObject(t)?baseDifference(t,baseFlatten(a,1,isArrayLikeObject,!0),m,c):[]}));function findIndex(t,a,c){var m=null==t?0:t.length;if(!m)return-1;var h=null==c?0:toInteger(c);return h<0&&(h=Yt(m+h,0)),baseFindIndex(t,getIteratee(a,3),h)}function findLastIndex(t,a,c){var h=null==t?0:t.length;if(!h)return-1;var g=h-1;return c!==m&&(g=toInteger(c),g=c<0?Yt(h+g,0):Wt(g,h-1)),baseFindIndex(t,getIteratee(a,3),g,!0)}function flatten(t){return(null==t?0:t.length)?baseFlatten(t,1):[]}function head(t){return t&&t.length?t[0]:m}var Lr=baseRest((function(t){var a=arrayMap(t,castArrayLikeObject);return a.length&&a[0]===t[0]?baseIntersection(a):[]})),Dr=baseRest((function(t){var a=last(t),c=arrayMap(t,castArrayLikeObject);return a===last(c)?a=m:c.pop(),c.length&&c[0]===t[0]?baseIntersection(c,getIteratee(a,2)):[]})),Ur=baseRest((function(t){var a=last(t),c=arrayMap(t,castArrayLikeObject);return(a="function"==typeof a?a:m)&&c.pop(),c.length&&c[0]===t[0]?baseIntersection(c,m,a):[]}));function last(t){var a=null==t?0:t.length;return a?t[a-1]:m}var Fr=baseRest(pullAll);function pullAll(t,a){return t&&t.length&&a&&a.length?basePullAll(t,a):t}var Br=flatRest((function(t,a){var c=null==t?0:t.length,m=baseAt(t,a);return basePullAt(t,arrayMap(a,(function(t){return isIndex(t,c)?+t:t})).sort(compareAscending)),m}));function reverse(t){return null==t?t:Jt.call(t)}var qr=baseRest((function(t){return baseUniq(baseFlatten(t,1,isArrayLikeObject,!0))})),Gr=baseRest((function(t){var a=last(t);return isArrayLikeObject(a)&&(a=m),baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),getIteratee(a,2))})),jr=baseRest((function(t){var a=last(t);return a="function"==typeof a?a:m,baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),m,a)}));function unzip(t){if(!t||!t.length)return[];var a=0;return t=arrayFilter(t,(function(t){if(isArrayLikeObject(t))return a=Yt(t.length,a),!0})),baseTimes(a,(function(a){return arrayMap(t,baseProperty(a))}))}function unzipWith(t,a){if(!t||!t.length)return[];var c=unzip(t);return null==a?c:arrayMap(c,(function(t){return apply(a,m,t)}))}var Hr=baseRest((function(t,a){return isArrayLikeObject(t)?baseDifference(t,a):[]})),$r=baseRest((function(t){return baseXor(arrayFilter(t,isArrayLikeObject))})),Yr=baseRest((function(t){var a=last(t);return isArrayLikeObject(a)&&(a=m),baseXor(arrayFilter(t,isArrayLikeObject),getIteratee(a,2))})),Wr=baseRest((function(t){var a=last(t);return a="function"==typeof a?a:m,baseXor(arrayFilter(t,isArrayLikeObject),m,a)})),zr=baseRest(unzip);var Kr=baseRest((function(t){var a=t.length,c=a>1?t[a-1]:m;return c="function"==typeof c?(t.pop(),c):m,unzipWith(t,c)}));function chain(t){var a=lodash(t);return a.__chain__=!0,a}function thru(t,a){return a(t)}var Qr=flatRest((function(t){var a=t.length,c=a?t[0]:0,h=this.__wrapped__,interceptor=function(a){return baseAt(a,t)};return!(a>1||this.__actions__.length)&&h instanceof LazyWrapper&&isIndex(c)?((h=h.slice(c,+c+(a?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:m}),new LodashWrapper(h,this.__chain__).thru((function(t){return a&&!t.length&&t.push(m),t}))):this.thru(interceptor)}));var Jr=createAggregator((function(t,a,c){Ke.call(t,c)?++t[c]:baseAssignValue(t,c,1)}));var Xr=createFind(findIndex),Zr=createFind(findLastIndex);function forEach(t,a){return(_n(t)?arrayEach:fr)(t,getIteratee(a,3))}function forEachRight(t,a){return(_n(t)?arrayEachRight:gr)(t,getIteratee(a,3))}var en=createAggregator((function(t,a,c){Ke.call(t,c)?t[c].push(a):baseAssignValue(t,c,[a])}));var tn=baseRest((function(t,c,m){var h=-1,g="function"==typeof c,I=isArrayLike(t)?a(t.length):[];return fr(t,(function(t){I[++h]=g?apply(c,t,m):baseInvoke(t,c,m)})),I})),rn=createAggregator((function(t,a,c){baseAssignValue(t,c,a)}));function map(t,a){return(_n(t)?arrayMap:baseMap)(t,getIteratee(a,3))}var nn=createAggregator((function(t,a,c){t[c?0:1].push(a)}),(function(){return[[],[]]}));var an=baseRest((function(t,a){if(null==t)return[];var c=a.length;return c>1&&isIterateeCall(t,a[0],a[1])?a=[]:c>2&&isIterateeCall(a[0],a[1],a[2])&&(a=[a[0]]),baseOrderBy(t,baseFlatten(a,1),[])})),sn=bt||function(){return At.Date.now()};function ary(t,a,c){return a=c?m:a,a=t&&null==a?t.length:a,createWrap(t,E,m,m,m,m,a)}function before(t,a){var c;if("function"!=typeof a)throw new je(h);return t=toInteger(t),function(){return--t>0&&(c=a.apply(this,arguments)),t<=1&&(a=m),c}}var cn=baseRest((function(t,a,c){var m=1;if(c.length){var h=replaceHolders(c,getHolder(cn));m|=T}return createWrap(t,m,a,c,h)})),ln=baseRest((function(t,a,c){var m=3;if(c.length){var h=replaceHolders(c,getHolder(ln));m|=T}return createWrap(a,m,t,c,h)}));function debounce(t,a,c){var g,I,M,T,S,E,b=0,C=!1,A=!1,N=!0;if("function"!=typeof t)throw new je(h);function invokeFunc(a){var c=g,h=I;return g=I=m,b=a,T=t.apply(h,c)}function leadingEdge(t){return b=t,S=kr(timerExpired,a),C?invokeFunc(t):T}function shouldInvoke(t){var c=t-E;return E===m||c>=a||c<0||A&&t-b>=M}function timerExpired(){var t=sn();if(shouldInvoke(t))return trailingEdge(t);S=kr(timerExpired,function remainingWait(t){var c=a-(t-E);return A?Wt(c,M-(t-b)):c}(t))}function trailingEdge(t){return S=m,N&&g?invokeFunc(t):(g=I=m,T)}function debounced(){var t=sn(),c=shouldInvoke(t);if(g=arguments,I=this,E=t,c){if(S===m)return leadingEdge(E);if(A)return Tr(S),S=kr(timerExpired,a),invokeFunc(E)}return S===m&&(S=kr(timerExpired,a)),T}return a=toNumber(a)||0,isObject(c)&&(C=!!c.leading,M=(A="maxWait"in c)?Yt(toNumber(c.maxWait)||0,a):M,N="trailing"in c?!!c.trailing:N),debounced.cancel=function cancel(){S!==m&&Tr(S),b=0,g=E=I=S=m},debounced.flush=function flush(){return S===m?T:trailingEdge(sn())},debounced}var un=baseRest((function(t,a){return baseDelay(t,1,a)})),dn=baseRest((function(t,a,c){return baseDelay(t,toNumber(a)||0,c)}));function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new je(h);var memoized=function(){var c=arguments,m=a?a.apply(this,c):c[0],h=memoized.cache;if(h.has(m))return h.get(m);var g=t.apply(this,c);return memoized.cache=h.set(m,g)||h,g};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(t){if("function"!=typeof t)throw new je(h);return function(){var a=arguments;switch(a.length){case 0:return!t.call(this);case 1:return!t.call(this,a[0]);case 2:return!t.call(this,a[0],a[1]);case 3:return!t.call(this,a[0],a[1],a[2])}return!t.apply(this,a)}}memoize.Cache=MapCache;var pn=Mr((function(t,a){var c=(a=1==a.length&&_n(a[0])?arrayMap(a[0],baseUnary(getIteratee())):arrayMap(baseFlatten(a,1),baseUnary(getIteratee()))).length;return baseRest((function(m){for(var h=-1,g=Wt(m.length,c);++h<g;)m[h]=a[h].call(this,m[h]);return apply(t,this,m)}))})),mn=baseRest((function(t,a){var c=replaceHolders(a,getHolder(mn));return createWrap(t,T,m,a,c)})),hn=baseRest((function(t,a){var c=replaceHolders(a,getHolder(hn));return createWrap(t,S,m,a,c)})),fn=flatRest((function(t,a){return createWrap(t,b,m,m,m,a)}));function eq(t,a){return t===a||t!=t&&a!=a}var gn=createRelationalOperation(baseGt),vn=createRelationalOperation((function(t,a){return t>=a})),yn=baseIsArguments(function(){return arguments}())?baseIsArguments:function(t){return isObjectLike(t)&&Ke.call(t,"callee")&&!ct.call(t,"callee")},_n=a.isArray,In=Pt?baseUnary(Pt):function baseIsArrayBuffer(t){return isObjectLike(t)&&baseGetTag(t)==z};function isArrayLike(t){return null!=t&&isLength(t.length)&&!isFunction(t)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}var Mn=Ot||stubFalse,Tn=xt?baseUnary(xt):function baseIsDate(t){return isObjectLike(t)&&baseGetTag(t)==x};function isError(t){if(!isObjectLike(t))return!1;var a=baseGetTag(t);return a==V||"[object DOMException]"==a||"string"==typeof t.message&&"string"==typeof t.name&&!isPlainObject(t)}function isFunction(t){if(!isObject(t))return!1;var a=baseGetTag(t);return a==L||a==D||"[object AsyncFunction]"==a||"[object Proxy]"==a}function isInteger(t){return"number"==typeof t&&t==toInteger(t)}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=A}function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)}function isObjectLike(t){return null!=t&&"object"==typeof t}var Sn=Vt?baseUnary(Vt):function baseIsMap(t){return isObjectLike(t)&&Ar(t)==U};function isNumber(t){return"number"==typeof t||isObjectLike(t)&&baseGetTag(t)==B}function isPlainObject(t){if(!isObjectLike(t)||baseGetTag(t)!=q)return!1;var a=ot(t);if(null===a)return!0;var c=Ke.call(a,"constructor")&&a.constructor;return"function"==typeof c&&c instanceof c&&ze.call(c)==Ze}var En=Lt?baseUnary(Lt):function baseIsRegExp(t){return isObjectLike(t)&&baseGetTag(t)==j};var bn=Dt?baseUnary(Dt):function baseIsSet(t){return isObjectLike(t)&&Ar(t)==H};function isString(t){return"string"==typeof t||!_n(t)&&isObjectLike(t)&&baseGetTag(t)==$}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&baseGetTag(t)==Y}var Cn=Ut?baseUnary(Ut):function baseIsTypedArray(t){return isObjectLike(t)&&isLength(t.length)&&!!It[baseGetTag(t)]};var An=createRelationalOperation(baseLt),Nn=createRelationalOperation((function(t,a){return t<=a}));function toArray(t){if(!t)return[];if(isArrayLike(t))return isString(t)?stringToArray(t):copyArray(t);if(dt&&t[dt])return function iteratorToArray(t){for(var a,c=[];!(a=t.next()).done;)c.push(a.value);return c}(t[dt]());var a=Ar(t);return(a==U?mapToArray:a==H?setToArray:values)(t)}function toFinite(t){return t?(t=toNumber(t))===C||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function toInteger(t){var a=toFinite(t),c=a%1;return a==a?c?a-c:a:0}function toLength(t){return t?baseClamp(toInteger(t),0,R):0}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return N;if(isObject(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=isObject(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=baseTrim(t);var c=we.test(t);return c||Pe.test(t)?Et(t.slice(2),c?2:8):ke.test(t)?N:+t}function toPlainObject(t){return copyObject(t,keysIn(t))}function toString(t){return null==t?"":baseToString(t)}var Rn=createAssigner((function(t,a){if(isPrototype(a)||isArrayLike(a))copyObject(a,keys(a),t);else for(var c in a)Ke.call(a,c)&&assignValue(t,c,a[c])})),kn=createAssigner((function(t,a){copyObject(a,keysIn(a),t)})),wn=createAssigner((function(t,a,c,m){copyObject(a,keysIn(a),t,m)})),On=createAssigner((function(t,a,c,m){copyObject(a,keys(a),t,m)})),Pn=flatRest(baseAt);var xn=baseRest((function(t,a){t=Be(t);var c=-1,h=a.length,g=h>2?a[2]:m;for(g&&isIterateeCall(a[0],a[1],g)&&(h=1);++c<h;)for(var I=a[c],M=keysIn(I),T=-1,S=M.length;++T<S;){var E=M[T],b=t[E];(b===m||eq(b,Ye[E])&&!Ke.call(t,E))&&(t[E]=I[E])}return t})),Vn=baseRest((function(t){return t.push(m,customDefaultsMerge),apply(Bn,m,t)}));function get(t,a,c){var h=null==t?m:baseGet(t,a);return h===m?c:h}function hasIn(t,a){return null!=t&&hasPath(t,a,baseHasIn)}var Ln=createInverter((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=Xe.call(a)),t[a]=c}),constant(identity)),Dn=createInverter((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=Xe.call(a)),Ke.call(t,a)?t[a].push(c):t[a]=[c]}),getIteratee),Un=baseRest(baseInvoke);function keys(t){return isArrayLike(t)?arrayLikeKeys(t):baseKeys(t)}function keysIn(t){return isArrayLike(t)?arrayLikeKeys(t,!0):baseKeysIn(t)}var Fn=createAssigner((function(t,a,c){baseMerge(t,a,c)})),Bn=createAssigner((function(t,a,c,m){baseMerge(t,a,c,m)})),qn=flatRest((function(t,a){var c={};if(null==t)return c;var m=!1;a=arrayMap(a,(function(a){return a=castPath(a,t),m||(m=a.length>1),a})),copyObject(t,getAllKeysIn(t),c),m&&(c=baseClone(c,7,customOmitClone));for(var h=a.length;h--;)baseUnset(c,a[h]);return c}));var Gn=flatRest((function(t,a){return null==t?{}:function basePick(t,a){return basePickBy(t,a,(function(a,c){return hasIn(t,c)}))}(t,a)}));function pickBy(t,a){if(null==t)return{};var c=arrayMap(getAllKeysIn(t),(function(t){return[t]}));return a=getIteratee(a),basePickBy(t,c,(function(t,c){return a(t,c[0])}))}var jn=createToPairs(keys),Hn=createToPairs(keysIn);function values(t){return null==t?[]:baseValues(t,keys(t))}var $n=createCompounder((function(t,a,c){return a=a.toLowerCase(),t+(c?capitalize(a):a)}));function capitalize(t){return Xn(toString(t).toLowerCase())}function deburr(t){return(t=toString(t))&&t.replace(Ve,Bt).replace(mt,"")}var Yn=createCompounder((function(t,a,c){return t+(c?"-":"")+a.toLowerCase()})),Wn=createCompounder((function(t,a,c){return t+(c?" ":"")+a.toLowerCase()})),zn=createCaseFirst("toLowerCase");var Kn=createCompounder((function(t,a,c){return t+(c?"_":"")+a.toLowerCase()}));var Qn=createCompounder((function(t,a,c){return t+(c?" ":"")+Xn(a)}));var Jn=createCompounder((function(t,a,c){return t+(c?" ":"")+a.toUpperCase()})),Xn=createCaseFirst("toUpperCase");function words(t,a,c){return t=toString(t),(a=c?m:a)===m?function hasUnicodeWord(t){return vt.test(t)}(t)?function unicodeWords(t){return t.match(ft)||[]}(t):function asciiWords(t){return t.match(be)||[]}(t):t.match(a)||[]}var Zn=baseRest((function(t,a){try{return apply(t,m,a)}catch(t){return isError(t)?t:new Me(t)}})),ea=flatRest((function(t,a){return arrayEach(a,(function(a){a=toKey(a),baseAssignValue(t,a,cn(t[a],t))})),t}));function constant(t){return function(){return t}}var ta=createFlow(),ra=createFlow(!0);function identity(t){return t}function iteratee(t){return baseIteratee("function"==typeof t?t:baseClone(t,1))}var na=baseRest((function(t,a){return function(c){return baseInvoke(c,t,a)}})),aa=baseRest((function(t,a){return function(c){return baseInvoke(t,c,a)}}));function mixin(t,a,c){var m=keys(a),h=baseFunctions(a,m);null!=c||isObject(a)&&(h.length||!m.length)||(c=a,a=t,t=this,h=baseFunctions(a,keys(a)));var g=!(isObject(c)&&"chain"in c&&!c.chain),I=isFunction(t);return arrayEach(h,(function(c){var m=a[c];t[c]=m,I&&(t.prototype[c]=function(){var a=this.__chain__;if(g||a){var c=t(this.__wrapped__),h=c.__actions__=copyArray(this.__actions__);return h.push({func:m,args:arguments,thisArg:t}),c.__chain__=a,c}return m.apply(t,arrayPush([this.value()],arguments))})})),t}function noop(){}var ia=createOver(arrayMap),oa=createOver(arrayEvery),sa=createOver(arraySome);function property(t){return isKey(t)?baseProperty(toKey(t)):function basePropertyDeep(t){return function(a){return baseGet(a,t)}}(t)}var ca=createRange(),la=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var ua=createMathOperation((function(t,a){return t+a}),0),da=createRound("ceil"),pa=createMathOperation((function(t,a){return t/a}),1),ma=createRound("floor");var ha,fa=createMathOperation((function(t,a){return t*a}),1),ga=createRound("round"),va=createMathOperation((function(t,a){return t-a}),0);return lodash.after=function after(t,a){if("function"!=typeof a)throw new je(h);return t=toInteger(t),function(){if(--t<1)return a.apply(this,arguments)}},lodash.ary=ary,lodash.assign=Rn,lodash.assignIn=kn,lodash.assignInWith=wn,lodash.assignWith=On,lodash.at=Pn,lodash.before=before,lodash.bind=cn,lodash.bindAll=ea,lodash.bindKey=ln,lodash.castArray=function castArray(){if(!arguments.length)return[];var t=arguments[0];return _n(t)?t:[t]},lodash.chain=chain,lodash.chunk=function chunk(t,c,h){c=(h?isIterateeCall(t,c,h):c===m)?1:Yt(toInteger(c),0);var g=null==t?0:t.length;if(!g||c<1)return[];for(var I=0,M=0,T=a(Nt(g/c));I<g;)T[M++]=baseSlice(t,I,I+=c);return T},lodash.compact=function compact(t){for(var a=-1,c=null==t?0:t.length,m=0,h=[];++a<c;){var g=t[a];g&&(h[m++]=g)}return h},lodash.concat=function concat(){var t=arguments.length;if(!t)return[];for(var c=a(t-1),m=arguments[0],h=t;h--;)c[h-1]=arguments[h];return arrayPush(_n(m)?copyArray(m):[m],baseFlatten(c,1))},lodash.cond=function cond(t){var a=null==t?0:t.length,c=getIteratee();return t=a?arrayMap(t,(function(t){if("function"!=typeof t[1])throw new je(h);return[c(t[0]),t[1]]})):[],baseRest((function(c){for(var m=-1;++m<a;){var h=t[m];if(apply(h[0],this,c))return apply(h[1],this,c)}}))},lodash.conforms=function conforms(t){return function baseConforms(t){var a=keys(t);return function(c){return baseConformsTo(c,t,a)}}(baseClone(t,1))},lodash.constant=constant,lodash.countBy=Jr,lodash.create=function create(t,a){var c=hr(t);return null==a?c:baseAssign(c,a)},lodash.curry=function curry(t,a,c){var h=createWrap(t,8,m,m,m,m,m,a=c?m:a);return h.placeholder=curry.placeholder,h},lodash.curryRight=function curryRight(t,a,c){var h=createWrap(t,M,m,m,m,m,m,a=c?m:a);return h.placeholder=curryRight.placeholder,h},lodash.debounce=debounce,lodash.defaults=xn,lodash.defaultsDeep=Vn,lodash.defer=un,lodash.delay=dn,lodash.difference=Pr,lodash.differenceBy=xr,lodash.differenceWith=Vr,lodash.drop=function drop(t,a,c){var h=null==t?0:t.length;return h?baseSlice(t,(a=c||a===m?1:toInteger(a))<0?0:a,h):[]},lodash.dropRight=function dropRight(t,a,c){var h=null==t?0:t.length;return h?baseSlice(t,0,(a=h-(a=c||a===m?1:toInteger(a)))<0?0:a):[]},lodash.dropRightWhile=function dropRightWhile(t,a){return t&&t.length?baseWhile(t,getIteratee(a,3),!0,!0):[]},lodash.dropWhile=function dropWhile(t,a){return t&&t.length?baseWhile(t,getIteratee(a,3),!0):[]},lodash.fill=function fill(t,a,c,h){var g=null==t?0:t.length;return g?(c&&"number"!=typeof c&&isIterateeCall(t,a,c)&&(c=0,h=g),function baseFill(t,a,c,h){var g=t.length;for((c=toInteger(c))<0&&(c=-c>g?0:g+c),(h=h===m||h>g?g:toInteger(h))<0&&(h+=g),h=c>h?0:toLength(h);c<h;)t[c++]=a;return t}(t,a,c,h)):[]},lodash.filter=function filter(t,a){return(_n(t)?arrayFilter:baseFilter)(t,getIteratee(a,3))},lodash.flatMap=function flatMap(t,a){return baseFlatten(map(t,a),1)},lodash.flatMapDeep=function flatMapDeep(t,a){return baseFlatten(map(t,a),C)},lodash.flatMapDepth=function flatMapDepth(t,a,c){return c=c===m?1:toInteger(c),baseFlatten(map(t,a),c)},lodash.flatten=flatten,lodash.flattenDeep=function flattenDeep(t){return(null==t?0:t.length)?baseFlatten(t,C):[]},lodash.flattenDepth=function flattenDepth(t,a){return(null==t?0:t.length)?baseFlatten(t,a=a===m?1:toInteger(a)):[]},lodash.flip=function flip(t){return createWrap(t,512)},lodash.flow=ta,lodash.flowRight=ra,lodash.fromPairs=function fromPairs(t){for(var a=-1,c=null==t?0:t.length,m={};++a<c;){var h=t[a];m[h[0]]=h[1]}return m},lodash.functions=function functions(t){return null==t?[]:baseFunctions(t,keys(t))},lodash.functionsIn=function functionsIn(t){return null==t?[]:baseFunctions(t,keysIn(t))},lodash.groupBy=en,lodash.initial=function initial(t){return(null==t?0:t.length)?baseSlice(t,0,-1):[]},lodash.intersection=Lr,lodash.intersectionBy=Dr,lodash.intersectionWith=Ur,lodash.invert=Ln,lodash.invertBy=Dn,lodash.invokeMap=tn,lodash.iteratee=iteratee,lodash.keyBy=rn,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=function mapKeys(t,a){var c={};return a=getIteratee(a,3),baseForOwn(t,(function(t,m,h){baseAssignValue(c,a(t,m,h),t)})),c},lodash.mapValues=function mapValues(t,a){var c={};return a=getIteratee(a,3),baseForOwn(t,(function(t,m,h){baseAssignValue(c,m,a(t,m,h))})),c},lodash.matches=function matches(t){return baseMatches(baseClone(t,1))},lodash.matchesProperty=function matchesProperty(t,a){return baseMatchesProperty(t,baseClone(a,1))},lodash.memoize=memoize,lodash.merge=Fn,lodash.mergeWith=Bn,lodash.method=na,lodash.methodOf=aa,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=function nthArg(t){return t=toInteger(t),baseRest((function(a){return baseNth(a,t)}))},lodash.omit=qn,lodash.omitBy=function omitBy(t,a){return pickBy(t,negate(getIteratee(a)))},lodash.once=function once(t){return before(2,t)},lodash.orderBy=function orderBy(t,a,c,h){return null==t?[]:(_n(a)||(a=null==a?[]:[a]),_n(c=h?m:c)||(c=null==c?[]:[c]),baseOrderBy(t,a,c))},lodash.over=ia,lodash.overArgs=pn,lodash.overEvery=oa,lodash.overSome=sa,lodash.partial=mn,lodash.partialRight=hn,lodash.partition=nn,lodash.pick=Gn,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=function propertyOf(t){return function(a){return null==t?m:baseGet(t,a)}},lodash.pull=Fr,lodash.pullAll=pullAll,lodash.pullAllBy=function pullAllBy(t,a,c){return t&&t.length&&a&&a.length?basePullAll(t,a,getIteratee(c,2)):t},lodash.pullAllWith=function pullAllWith(t,a,c){return t&&t.length&&a&&a.length?basePullAll(t,a,m,c):t},lodash.pullAt=Br,lodash.range=ca,lodash.rangeRight=la,lodash.rearg=fn,lodash.reject=function reject(t,a){return(_n(t)?arrayFilter:baseFilter)(t,negate(getIteratee(a,3)))},lodash.remove=function remove(t,a){var c=[];if(!t||!t.length)return c;var m=-1,h=[],g=t.length;for(a=getIteratee(a,3);++m<g;){var I=t[m];a(I,m,t)&&(c.push(I),h.push(m))}return basePullAt(t,h),c},lodash.rest=function rest(t,a){if("function"!=typeof t)throw new je(h);return baseRest(t,a=a===m?a:toInteger(a))},lodash.reverse=reverse,lodash.sampleSize=function sampleSize(t,a,c){return a=(c?isIterateeCall(t,a,c):a===m)?1:toInteger(a),(_n(t)?arraySampleSize:baseSampleSize)(t,a)},lodash.set=function set(t,a,c){return null==t?t:baseSet(t,a,c)},lodash.setWith=function setWith(t,a,c,h){return h="function"==typeof h?h:m,null==t?t:baseSet(t,a,c,h)},lodash.shuffle=function shuffle(t){return(_n(t)?arrayShuffle:baseShuffle)(t)},lodash.slice=function slice(t,a,c){var h=null==t?0:t.length;return h?(c&&"number"!=typeof c&&isIterateeCall(t,a,c)?(a=0,c=h):(a=null==a?0:toInteger(a),c=c===m?h:toInteger(c)),baseSlice(t,a,c)):[]},lodash.sortBy=an,lodash.sortedUniq=function sortedUniq(t){return t&&t.length?baseSortedUniq(t):[]},lodash.sortedUniqBy=function sortedUniqBy(t,a){return t&&t.length?baseSortedUniq(t,getIteratee(a,2)):[]},lodash.split=function split(t,a,c){return c&&"number"!=typeof c&&isIterateeCall(t,a,c)&&(a=c=m),(c=c===m?R:c>>>0)?(t=toString(t))&&("string"==typeof a||null!=a&&!En(a))&&!(a=baseToString(a))&&hasUnicode(t)?castSlice(stringToArray(t),0,c):t.split(a,c):[]},lodash.spread=function spread(t,a){if("function"!=typeof t)throw new je(h);return a=null==a?0:Yt(toInteger(a),0),baseRest((function(c){var m=c[a],h=castSlice(c,0,a);return m&&arrayPush(h,m),apply(t,this,h)}))},lodash.tail=function tail(t){var a=null==t?0:t.length;return a?baseSlice(t,1,a):[]},lodash.take=function take(t,a,c){return t&&t.length?baseSlice(t,0,(a=c||a===m?1:toInteger(a))<0?0:a):[]},lodash.takeRight=function takeRight(t,a,c){var h=null==t?0:t.length;return h?baseSlice(t,(a=h-(a=c||a===m?1:toInteger(a)))<0?0:a,h):[]},lodash.takeRightWhile=function takeRightWhile(t,a){return t&&t.length?baseWhile(t,getIteratee(a,3),!1,!0):[]},lodash.takeWhile=function takeWhile(t,a){return t&&t.length?baseWhile(t,getIteratee(a,3)):[]},lodash.tap=function tap(t,a){return a(t),t},lodash.throttle=function throttle(t,a,c){var m=!0,g=!0;if("function"!=typeof t)throw new je(h);return isObject(c)&&(m="leading"in c?!!c.leading:m,g="trailing"in c?!!c.trailing:g),debounce(t,a,{leading:m,maxWait:a,trailing:g})},lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=jn,lodash.toPairsIn=Hn,lodash.toPath=function toPath(t){return _n(t)?arrayMap(t,toKey):isSymbol(t)?[t]:copyArray(Or(toString(t)))},lodash.toPlainObject=toPlainObject,lodash.transform=function transform(t,a,c){var m=_n(t),h=m||Mn(t)||Cn(t);if(a=getIteratee(a,4),null==c){var g=t&&t.constructor;c=h?m?new g:[]:isObject(t)&&isFunction(g)?hr(ot(t)):{}}return(h?arrayEach:baseForOwn)(t,(function(t,m,h){return a(c,t,m,h)})),c},lodash.unary=function unary(t){return ary(t,1)},lodash.union=qr,lodash.unionBy=Gr,lodash.unionWith=jr,lodash.uniq=function uniq(t){return t&&t.length?baseUniq(t):[]},lodash.uniqBy=function uniqBy(t,a){return t&&t.length?baseUniq(t,getIteratee(a,2)):[]},lodash.uniqWith=function uniqWith(t,a){return a="function"==typeof a?a:m,t&&t.length?baseUniq(t,m,a):[]},lodash.unset=function unset(t,a){return null==t||baseUnset(t,a)},lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=function update(t,a,c){return null==t?t:baseUpdate(t,a,castFunction(c))},lodash.updateWith=function updateWith(t,a,c,h){return h="function"==typeof h?h:m,null==t?t:baseUpdate(t,a,castFunction(c),h)},lodash.values=values,lodash.valuesIn=function valuesIn(t){return null==t?[]:baseValues(t,keysIn(t))},lodash.without=Hr,lodash.words=words,lodash.wrap=function wrap(t,a){return mn(castFunction(a),t)},lodash.xor=$r,lodash.xorBy=Yr,lodash.xorWith=Wr,lodash.zip=zr,lodash.zipObject=function zipObject(t,a){return baseZipObject(t||[],a||[],assignValue)},lodash.zipObjectDeep=function zipObjectDeep(t,a){return baseZipObject(t||[],a||[],baseSet)},lodash.zipWith=Kr,lodash.entries=jn,lodash.entriesIn=Hn,lodash.extend=kn,lodash.extendWith=wn,mixin(lodash,lodash),lodash.add=ua,lodash.attempt=Zn,lodash.camelCase=$n,lodash.capitalize=capitalize,lodash.ceil=da,lodash.clamp=function clamp(t,a,c){return c===m&&(c=a,a=m),c!==m&&(c=(c=toNumber(c))==c?c:0),a!==m&&(a=(a=toNumber(a))==a?a:0),baseClamp(toNumber(t),a,c)},lodash.clone=function clone(t){return baseClone(t,4)},lodash.cloneDeep=function cloneDeep(t){return baseClone(t,5)},lodash.cloneDeepWith=function cloneDeepWith(t,a){return baseClone(t,5,a="function"==typeof a?a:m)},lodash.cloneWith=function cloneWith(t,a){return baseClone(t,4,a="function"==typeof a?a:m)},lodash.conformsTo=function conformsTo(t,a){return null==a||baseConformsTo(t,a,keys(a))},lodash.deburr=deburr,lodash.defaultTo=function defaultTo(t,a){return null==t||t!=t?a:t},lodash.divide=pa,lodash.endsWith=function endsWith(t,a,c){t=toString(t),a=baseToString(a);var h=t.length,g=c=c===m?h:baseClamp(toInteger(c),0,h);return(c-=a.length)>=0&&t.slice(c,g)==a},lodash.eq=eq,lodash.escape=function escape(t){return(t=toString(t))&&de.test(t)?t.replace(le,qt):t},lodash.escapeRegExp=function escapeRegExp(t){return(t=toString(t))&&_e.test(t)?t.replace(ye,"\\$&"):t},lodash.every=function every(t,a,c){var h=_n(t)?arrayEvery:baseEvery;return c&&isIterateeCall(t,a,c)&&(a=m),h(t,getIteratee(a,3))},lodash.find=Xr,lodash.findIndex=findIndex,lodash.findKey=function findKey(t,a){return baseFindKey(t,getIteratee(a,3),baseForOwn)},lodash.findLast=Zr,lodash.findLastIndex=findLastIndex,lodash.findLastKey=function findLastKey(t,a){return baseFindKey(t,getIteratee(a,3),baseForOwnRight)},lodash.floor=ma,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=function forIn(t,a){return null==t?t:vr(t,getIteratee(a,3),keysIn)},lodash.forInRight=function forInRight(t,a){return null==t?t:yr(t,getIteratee(a,3),keysIn)},lodash.forOwn=function forOwn(t,a){return t&&baseForOwn(t,getIteratee(a,3))},lodash.forOwnRight=function forOwnRight(t,a){return t&&baseForOwnRight(t,getIteratee(a,3))},lodash.get=get,lodash.gt=gn,lodash.gte=vn,lodash.has=function has(t,a){return null!=t&&hasPath(t,a,baseHas)},lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=function includes(t,a,c,m){t=isArrayLike(t)?t:values(t),c=c&&!m?toInteger(c):0;var h=t.length;return c<0&&(c=Yt(h+c,0)),isString(t)?c<=h&&t.indexOf(a,c)>-1:!!h&&baseIndexOf(t,a,c)>-1},lodash.indexOf=function indexOf(t,a,c){var m=null==t?0:t.length;if(!m)return-1;var h=null==c?0:toInteger(c);return h<0&&(h=Yt(m+h,0)),baseIndexOf(t,a,h)},lodash.inRange=function inRange(t,a,c){return a=toFinite(a),c===m?(c=a,a=0):c=toFinite(c),function baseInRange(t,a,c){return t>=Wt(a,c)&&t<Yt(a,c)}(t=toNumber(t),a,c)},lodash.invoke=Un,lodash.isArguments=yn,lodash.isArray=_n,lodash.isArrayBuffer=In,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=function isBoolean(t){return!0===t||!1===t||isObjectLike(t)&&baseGetTag(t)==P},lodash.isBuffer=Mn,lodash.isDate=Tn,lodash.isElement=function isElement(t){return isObjectLike(t)&&1===t.nodeType&&!isPlainObject(t)},lodash.isEmpty=function isEmpty(t){if(null==t)return!0;if(isArrayLike(t)&&(_n(t)||"string"==typeof t||"function"==typeof t.splice||Mn(t)||Cn(t)||yn(t)))return!t.length;var a=Ar(t);if(a==U||a==H)return!t.size;if(isPrototype(t))return!baseKeys(t).length;for(var c in t)if(Ke.call(t,c))return!1;return!0},lodash.isEqual=function isEqual(t,a){return baseIsEqual(t,a)},lodash.isEqualWith=function isEqualWith(t,a,c){var h=(c="function"==typeof c?c:m)?c(t,a):m;return h===m?baseIsEqual(t,a,m,c):!!h},lodash.isError=isError,lodash.isFinite=function isFinite(t){return"number"==typeof t&&Ft(t)},lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=Sn,lodash.isMatch=function isMatch(t,a){return t===a||baseIsMatch(t,a,getMatchData(a))},lodash.isMatchWith=function isMatchWith(t,a,c){return c="function"==typeof c?c:m,baseIsMatch(t,a,getMatchData(a),c)},lodash.isNaN=function isNaN(t){return isNumber(t)&&t!=+t},lodash.isNative=function isNative(t){if(Nr(t))throw new Me("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(t)},lodash.isNil=function isNil(t){return null==t},lodash.isNull=function isNull(t){return null===t},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=En,lodash.isSafeInteger=function isSafeInteger(t){return isInteger(t)&&t>=-9007199254740991&&t<=A},lodash.isSet=bn,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Cn,lodash.isUndefined=function isUndefined(t){return t===m},lodash.isWeakMap=function isWeakMap(t){return isObjectLike(t)&&Ar(t)==W},lodash.isWeakSet=function isWeakSet(t){return isObjectLike(t)&&"[object WeakSet]"==baseGetTag(t)},lodash.join=function join(t,a){return null==t?"":Ht.call(t,a)},lodash.kebabCase=Yn,lodash.last=last,lodash.lastIndexOf=function lastIndexOf(t,a,c){var h=null==t?0:t.length;if(!h)return-1;var g=h;return c!==m&&(g=(g=toInteger(c))<0?Yt(h+g,0):Wt(g,h-1)),a==a?function strictLastIndexOf(t,a,c){for(var m=c+1;m--;)if(t[m]===a)return m;return m}(t,a,g):baseFindIndex(t,baseIsNaN,g,!0)},lodash.lowerCase=Wn,lodash.lowerFirst=zn,lodash.lt=An,lodash.lte=Nn,lodash.max=function max(t){return t&&t.length?baseExtremum(t,identity,baseGt):m},lodash.maxBy=function maxBy(t,a){return t&&t.length?baseExtremum(t,getIteratee(a,2),baseGt):m},lodash.mean=function mean(t){return baseMean(t,identity)},lodash.meanBy=function meanBy(t,a){return baseMean(t,getIteratee(a,2))},lodash.min=function min(t){return t&&t.length?baseExtremum(t,identity,baseLt):m},lodash.minBy=function minBy(t,a){return t&&t.length?baseExtremum(t,getIteratee(a,2),baseLt):m},lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=function stubObject(){return{}},lodash.stubString=function stubString(){return""},lodash.stubTrue=function stubTrue(){return!0},lodash.multiply=fa,lodash.nth=function nth(t,a){return t&&t.length?baseNth(t,toInteger(a)):m},lodash.noConflict=function noConflict(){return At._===this&&(At._=et),this},lodash.noop=noop,lodash.now=sn,lodash.pad=function pad(t,a,c){t=toString(t);var m=(a=toInteger(a))?stringSize(t):0;if(!a||m>=a)return t;var h=(a-m)/2;return createPadding(Rt(h),c)+t+createPadding(Nt(h),c)},lodash.padEnd=function padEnd(t,a,c){t=toString(t);var m=(a=toInteger(a))?stringSize(t):0;return a&&m<a?t+createPadding(a-m,c):t},lodash.padStart=function padStart(t,a,c){t=toString(t);var m=(a=toInteger(a))?stringSize(t):0;return a&&m<a?createPadding(a-m,c)+t:t},lodash.parseInt=function parseInt(t,a,c){return c||null==a?a=0:a&&(a=+a),Kt(toString(t).replace(Ie,""),a||0)},lodash.random=function random(t,a,c){if(c&&"boolean"!=typeof c&&isIterateeCall(t,a,c)&&(a=c=m),c===m&&("boolean"==typeof a?(c=a,a=m):"boolean"==typeof t&&(c=t,t=m)),t===m&&a===m?(t=0,a=1):(t=toFinite(t),a===m?(a=t,t=0):a=toFinite(a)),t>a){var h=t;t=a,a=h}if(c||t%1||a%1){var g=Qt();return Wt(t+g*(a-t+St("1e-"+((g+"").length-1))),a)}return baseRandom(t,a)},lodash.reduce=function reduce(t,a,c){var m=_n(t)?arrayReduce:baseReduce,h=arguments.length<3;return m(t,getIteratee(a,4),c,h,fr)},lodash.reduceRight=function reduceRight(t,a,c){var m=_n(t)?arrayReduceRight:baseReduce,h=arguments.length<3;return m(t,getIteratee(a,4),c,h,gr)},lodash.repeat=function repeat(t,a,c){return a=(c?isIterateeCall(t,a,c):a===m)?1:toInteger(a),baseRepeat(toString(t),a)},lodash.replace=function replace(){var t=arguments,a=toString(t[0]);return t.length<3?a:a.replace(t[1],t[2])},lodash.result=function result(t,a,c){var h=-1,g=(a=castPath(a,t)).length;for(g||(g=1,t=m);++h<g;){var I=null==t?m:t[toKey(a[h])];I===m&&(h=g,I=c),t=isFunction(I)?I.call(t):I}return t},lodash.round=ga,lodash.runInContext=runInContext,lodash.sample=function sample(t){return(_n(t)?arraySample:baseSample)(t)},lodash.size=function size(t){if(null==t)return 0;if(isArrayLike(t))return isString(t)?stringSize(t):t.length;var a=Ar(t);return a==U||a==H?t.size:baseKeys(t).length},lodash.snakeCase=Kn,lodash.some=function some(t,a,c){var h=_n(t)?arraySome:baseSome;return c&&isIterateeCall(t,a,c)&&(a=m),h(t,getIteratee(a,3))},lodash.sortedIndex=function sortedIndex(t,a){return baseSortedIndex(t,a)},lodash.sortedIndexBy=function sortedIndexBy(t,a,c){return baseSortedIndexBy(t,a,getIteratee(c,2))},lodash.sortedIndexOf=function sortedIndexOf(t,a){var c=null==t?0:t.length;if(c){var m=baseSortedIndex(t,a);if(m<c&&eq(t[m],a))return m}return-1},lodash.sortedLastIndex=function sortedLastIndex(t,a){return baseSortedIndex(t,a,!0)},lodash.sortedLastIndexBy=function sortedLastIndexBy(t,a,c){return baseSortedIndexBy(t,a,getIteratee(c,2),!0)},lodash.sortedLastIndexOf=function sortedLastIndexOf(t,a){if(null==t?0:t.length){var c=baseSortedIndex(t,a,!0)-1;if(eq(t[c],a))return c}return-1},lodash.startCase=Qn,lodash.startsWith=function startsWith(t,a,c){return t=toString(t),c=null==c?0:baseClamp(toInteger(c),0,t.length),a=baseToString(a),t.slice(c,c+a.length)==a},lodash.subtract=va,lodash.sum=function sum(t){return t&&t.length?baseSum(t,identity):0},lodash.sumBy=function sumBy(t,a){return t&&t.length?baseSum(t,getIteratee(a,2)):0},lodash.template=function template(t,a,c){var h=lodash.templateSettings;c&&isIterateeCall(t,a,c)&&(a=m),t=toString(t),a=wn({},a,h,customDefaultsAssignIn);var g,I,M=wn({},a.imports,h.imports,customDefaultsAssignIn),T=keys(M),S=baseValues(M,T),E=0,b=a.interpolate||Le,C="__p += '",A=qe((a.escape||Le).source+"|"+b.source+"|"+(b===he?Ne:Le).source+"|"+(a.evaluate||Le).source+"|$","g"),N="//# sourceURL="+(Ke.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++_t+"]")+"\n";t.replace(A,(function(a,c,m,h,M,T){return m||(m=h),C+=t.slice(E,T).replace(De,escapeStringChar),c&&(g=!0,C+="' +\n__e("+c+") +\n'"),M&&(I=!0,C+="';\n"+M+";\n__p += '"),m&&(C+="' +\n((__t = ("+m+")) == null ? '' : __t) +\n'"),E=T+a.length,a})),C+="';\n";var R=Ke.call(a,"variable")&&a.variable;if(R){if(Ce.test(R))throw new Me("Invalid `variable` option passed into `_.template`")}else C="with (obj) {\n"+C+"\n}\n";C=(I?C.replace(ie,""):C).replace(oe,"$1").replace(se,"$1;"),C="function("+(R||"obj")+") {\n"+(R?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(g?", __e = _.escape":"")+(I?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+C+"return __p\n}";var k=Zn((function(){return Ue(T,N+"return "+C).apply(m,S)}));if(k.source=C,isError(k))throw k;return k},lodash.times=function times(t,a){if((t=toInteger(t))<1||t>A)return[];var c=R,m=Wt(t,R);a=getIteratee(a),t-=R;for(var h=baseTimes(m,a);++c<t;)a(c);return h},lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=function toLower(t){return toString(t).toLowerCase()},lodash.toNumber=toNumber,lodash.toSafeInteger=function toSafeInteger(t){return t?baseClamp(toInteger(t),-9007199254740991,A):0===t?t:0},lodash.toString=toString,lodash.toUpper=function toUpper(t){return toString(t).toUpperCase()},lodash.trim=function trim(t,a,c){if((t=toString(t))&&(c||a===m))return baseTrim(t);if(!t||!(a=baseToString(a)))return t;var h=stringToArray(t),g=stringToArray(a);return castSlice(h,charsStartIndex(h,g),charsEndIndex(h,g)+1).join("")},lodash.trimEnd=function trimEnd(t,a,c){if((t=toString(t))&&(c||a===m))return t.slice(0,trimmedEndIndex(t)+1);if(!t||!(a=baseToString(a)))return t;var h=stringToArray(t);return castSlice(h,0,charsEndIndex(h,stringToArray(a))+1).join("")},lodash.trimStart=function trimStart(t,a,c){if((t=toString(t))&&(c||a===m))return t.replace(Ie,"");if(!t||!(a=baseToString(a)))return t;var h=stringToArray(t);return castSlice(h,charsStartIndex(h,stringToArray(a))).join("")},lodash.truncate=function truncate(t,a){var c=30,h="...";if(isObject(a)){var g="separator"in a?a.separator:g;c="length"in a?toInteger(a.length):c,h="omission"in a?baseToString(a.omission):h}var I=(t=toString(t)).length;if(hasUnicode(t)){var M=stringToArray(t);I=M.length}if(c>=I)return t;var T=c-stringSize(h);if(T<1)return h;var S=M?castSlice(M,0,T).join(""):t.slice(0,T);if(g===m)return S+h;if(M&&(T+=S.length-T),En(g)){if(t.slice(T).search(g)){var E,b=S;for(g.global||(g=qe(g.source,toString(Re.exec(g))+"g")),g.lastIndex=0;E=g.exec(b);)var C=E.index;S=S.slice(0,C===m?T:C)}}else if(t.indexOf(baseToString(g),T)!=T){var A=S.lastIndexOf(g);A>-1&&(S=S.slice(0,A))}return S+h},lodash.unescape=function unescape(t){return(t=toString(t))&&ue.test(t)?t.replace(ce,Gt):t},lodash.uniqueId=function uniqueId(t){var a=++Qe;return toString(t)+a},lodash.upperCase=Jn,lodash.upperFirst=Xn,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(ha={},baseForOwn(lodash,(function(t,a){Ke.call(lodash.prototype,a)||(ha[a]=t)})),ha),{chain:!1}),lodash.VERSION="4.17.21",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){lodash[t].placeholder=lodash})),arrayEach(["drop","take"],(function(t,a){LazyWrapper.prototype[t]=function(c){c=c===m?1:Yt(toInteger(c),0);var h=this.__filtered__&&!a?new LazyWrapper(this):this.clone();return h.__filtered__?h.__takeCount__=Wt(c,h.__takeCount__):h.__views__.push({size:Wt(c,R),type:t+(h.__dir__<0?"Right":"")}),h},LazyWrapper.prototype[t+"Right"]=function(a){return this.reverse()[t](a).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(t,a){var c=a+1,m=1==c||3==c;LazyWrapper.prototype[t]=function(t){var a=this.clone();return a.__iteratees__.push({iteratee:getIteratee(t,3),type:c}),a.__filtered__=a.__filtered__||m,a}})),arrayEach(["head","last"],(function(t,a){var c="take"+(a?"Right":"");LazyWrapper.prototype[t]=function(){return this[c](1).value()[0]}})),arrayEach(["initial","tail"],(function(t,a){var c="drop"+(a?"":"Right");LazyWrapper.prototype[t]=function(){return this.__filtered__?new LazyWrapper(this):this[c](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(t){return this.filter(t).head()},LazyWrapper.prototype.findLast=function(t){return this.reverse().find(t)},LazyWrapper.prototype.invokeMap=baseRest((function(t,a){return"function"==typeof t?new LazyWrapper(this):this.map((function(c){return baseInvoke(c,t,a)}))})),LazyWrapper.prototype.reject=function(t){return this.filter(negate(getIteratee(t)))},LazyWrapper.prototype.slice=function(t,a){t=toInteger(t);var c=this;return c.__filtered__&&(t>0||a<0)?new LazyWrapper(c):(t<0?c=c.takeRight(-t):t&&(c=c.drop(t)),a!==m&&(c=(a=toInteger(a))<0?c.dropRight(-a):c.take(a-t)),c)},LazyWrapper.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(R)},baseForOwn(LazyWrapper.prototype,(function(t,a){var c=/^(?:filter|find|map|reject)|While$/.test(a),h=/^(?:head|last)$/.test(a),g=lodash[h?"take"+("last"==a?"Right":""):a],I=h||/^find/.test(a);g&&(lodash.prototype[a]=function(){var a=this.__wrapped__,M=h?[1]:arguments,T=a instanceof LazyWrapper,S=M[0],E=T||_n(a),interceptor=function(t){var a=g.apply(lodash,arrayPush([t],M));return h&&b?a[0]:a};E&&c&&"function"==typeof S&&1!=S.length&&(T=E=!1);var b=this.__chain__,C=!!this.__actions__.length,A=I&&!b,N=T&&!C;if(!I&&E){a=N?a:new LazyWrapper(this);var R=t.apply(a,M);return R.__actions__.push({func:thru,args:[interceptor],thisArg:m}),new LodashWrapper(R,b)}return A&&N?t.apply(this,M):(R=this.thru(interceptor),A?h?R.value()[0]:R.value():R)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(t){var a=He[t],c=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",m=/^(?:pop|shift)$/.test(t);lodash.prototype[t]=function(){var t=arguments;if(m&&!this.__chain__){var h=this.value();return a.apply(_n(h)?h:[],t)}return this[c]((function(c){return a.apply(_n(c)?c:[],t)}))}})),baseForOwn(LazyWrapper.prototype,(function(t,a){var c=lodash[a];if(c){var m=c.name+"";Ke.call(ir,m)||(ir[m]=[]),ir[m].push({name:a,func:c})}})),ir[createHybrid(m,2).name]=[{name:"wrapper",func:m}],LazyWrapper.prototype.clone=function lazyClone(){var t=new LazyWrapper(this.__wrapped__);return t.__actions__=copyArray(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=copyArray(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=copyArray(this.__views__),t},LazyWrapper.prototype.reverse=function lazyReverse(){if(this.__filtered__){var t=new LazyWrapper(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},LazyWrapper.prototype.value=function lazyValue(){var t=this.__wrapped__.value(),a=this.__dir__,c=_n(t),m=a<0,h=c?t.length:0,g=function getView(t,a,c){var m=-1,h=c.length;for(;++m<h;){var g=c[m],I=g.size;switch(g.type){case"drop":t+=I;break;case"dropRight":a-=I;break;case"take":a=Wt(a,t+I);break;case"takeRight":t=Yt(t,a-I)}}return{start:t,end:a}}(0,h,this.__views__),I=g.start,M=g.end,T=M-I,S=m?M:I-1,E=this.__iteratees__,b=E.length,C=0,A=Wt(T,this.__takeCount__);if(!c||!m&&h==T&&A==T)return baseWrapperValue(t,this.__actions__);var N=[];e:for(;T--&&C<A;){for(var R=-1,k=t[S+=a];++R<b;){var w=E[R],O=w.iteratee,P=w.type,x=O(k);if(2==P)k=x;else if(!x){if(1==P)continue e;break e}}N[C++]=k}return N},lodash.prototype.at=Qr,lodash.prototype.chain=function wrapperChain(){return chain(this)},lodash.prototype.commit=function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.next=function wrapperNext(){this.__values__===m&&(this.__values__=toArray(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?m:this.__values__[this.__index__++]}},lodash.prototype.plant=function wrapperPlant(t){for(var a,c=this;c instanceof baseLodash;){var h=wrapperClone(c);h.__index__=0,h.__values__=m,a?g.__wrapped__=h:a=h;var g=h;c=c.__wrapped__}return g.__wrapped__=t,a},lodash.prototype.reverse=function wrapperReverse(){var t=this.__wrapped__;if(t instanceof LazyWrapper){var a=t;return this.__actions__.length&&(a=new LazyWrapper(this)),(a=a.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:m}),new LodashWrapper(a,this.__chain__)}return this.thru(reverse)},lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.first=lodash.prototype.head,dt&&(lodash.prototype[dt]=function wrapperToIterator(){return this}),lodash}();Rt?((Rt.exports=jt)._=jt,Nt._=jt):At._=jt}).call(a)})),Dy={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatConversationFields(t,a){return a&&a.length>0?map$6(a).call(a,(function(a){return formatConversationField(t,a)})):[]}function formatLastMessageFromMessage(t,a,c,m){var h,g;void 0===c&&(c=Wl.V2NIM_MESSAGE_STATUS_DEFAULT);var I=a=formatMessageAttachment(a,t),M=I.messageType,T=I.subType,S=I.text,E=I.attachment,b=I.serverExtension,C="";if(a.senderId!==t.account){C=Ly.get(a,"fromNick");var A=null===(g=null===(h=t.V2NIMFriendService)||void 0===h?void 0:h.model)||void 0===g?void 0:g.getFriend(a.senderId);A&&A.alias&&(C=A.alias)}return JSON.parse(Uc({lastMessageState:c,messageRefer:formatMessageRefer(t,a),messageType:M,subType:T,text:S,attachment:E,serverExtension:b,callbackExtension:a.callbackExtension,sendingState:m,senderName:C}))}function formatLastMessageFromNotification(t,a){var c=a.messageRefer,m=a.revokeAccountId,h=a.revokeType,g=a.callbackExtension,I=a.serverExtension,M=a.postscript,T=function calcSenderNameFromNotification(t,a,c,m){var h,g,I,M,T,S;if(a!==t.account){var E=null===(g=null===(h=t.V2NIMFriendService)||void 0===h?void 0:h.model)||void 0===g?void 0:g.getFriend(a);if(E&&E.alias)return E.alias;if(c===Yl.V2NIM_CONVERSATION_TYPE_TEAM){var b=null===(M=null===(I=t.V2NIMTeamService)||void 0===I?void 0:I.memberModel)||void 0===M?void 0:M.getById(m,Iu.V2NIM_TEAM_TYPE_ADVANCED,a);if(b&&b.teamNick)return b.teamNick}else if(c===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){var C=null===(S=null===(T=t.V2NIMTeamService)||void 0===T?void 0:T.memberModel)||void 0===S?void 0:S.getById(m,Iu.V2NIM_TEAM_TYPE_ADVANCED,a);if(C&&C.teamNick)return C.teamNick}var A=t.V2NIMUserService.model.getUser(a);return A&&A.name?A.name:void 0}}(t,a.revokeAccountId,a.messageRefer.conversationType,a.messageRefer.receiverId)||"";return JSON.parse(Uc({lastMessageState:Wl.V2NIM_MESSAGE_STATUS_REVOKE,messageRefer:c,revokeAccountId:m,revokeType:h,callbackExtension:g,serverExtension:I,text:M||"",senderName:T}))}function formatConversationField(t,a){var c=format(Dy,a);if(c.groupIds?c.groupIds=JSON.parse(c.groupIds):delete c.groupIds,"string"==typeof c.lastMessage)if(""===c.lastMessage);else if(c.lastMessageState===Wl.V2NIM_MESSAGE_STATUS_REVOKE){var m=formatRevokeMessage(t,deserialize(JSON.parse(c.lastMessage),invertSerializeItem(Wg)));c.lastMessage=formatLastMessageFromNotification(t,m)}else if(c.lastMessageState===Wl.V2NIM_MESSAGE_STATUS_DEFAULT){var h=deserialize(JSON.parse(c.lastMessage),invertSerializeItem(Bg));c.lastMessage=formatLastMessageFromMessage(t,h,c.lastMessageState,h.senderId===t.account?cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED:void 0)}else c.lastMessageState===Wl.V2NIM_MESSAGE_STATUS_BACKFILL&&delete c.lastMessage;return c}function formatConversationByField(t){var a=t.version,c=t.deleteFlag;return{conversation:__rest(t,["version","deleteFlag"]),version:a,deleteFlag:c}}!function(t){t[t.createConversation=1]="createConversation",t[t.deleteConversation=2]="deleteConversation",t[t.updateConversation=3]="updateConversation",t[t.setConversationTop=4]="setConversationTop",t[t.clearConversationUnread=5]="clearConversationUnread",t[t.addConversationToGroup=6]="addConversationToGroup",t[t.removeConversationFromGroup=7]="removeConversationFromGroup",t[t.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",t[t.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",t[t.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",t[t.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",t[t.oneClickClearConversationUnread=12]="oneClickClearConversationUnread"}(xy||(xy={}));var Uy={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function formatConversationNotify(t){return format(Uy,t)}var Fy=function(){function V2NIMConversationVersionCacheImpl(t,a){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=t,this.service=a}var t=V2NIMConversationVersionCacheImpl.prototype;return t.reset=function reset(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},t.doSync=function doSync(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t,a,c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),h.prev=2,h.next=5,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 5:t=h.sent,h.next=18;break;case 8:if(h.prev=8,h.t0=h.catch(2),(a=h.t0).code!==Lu.V2NIM_ERROR_CODE_CANCELLED){h.next=13;break}return h.abrupt("return");case 13:return this.isSyncing=!1,this.service.emit("onSyncFailed",a),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Hl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,error:a,subType:"conversationSync"}),this.processTempPacket(),h.abrupt("return");case 18:c=0===zp(Rs(t,"content.info.syncType")),m=Rs(t,"content.info.nextCursor"),this.doSyncAndSuccess(c,m);case 21:case"end":return h.stop()}}),_callee,this,[[2,8]])})))},t.doSyncAndSuccess=function doSyncAndSuccess(t,a){var c;t&&sort(c=this.service.model).call(c);this.isSyncing=!1,this.nextCursor=zp(a)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Hl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,subType:"conversationSync"}),this.processTempPacket()},t.setBackFillIds=function setBackFillIds(t){var a=this;return forEach$1(t).call(t,(function(t){var c;if(t.lastMessageState===Wl.V2NIM_MESSAGE_STATUS_BACKFILL&&(null===(c=a.core.V2NIMMessageService)||void 0===c?void 0:c.model)){a.conversationIdsForBackFill[t.conversationId]=!0;var m=a.core.V2NIMMessageService.model.getLastMessageOfConversation(t.conversationId);t.lastMessage=m?formatLastMessageFromMessage(a.core,m,t.lastMessageState,m.sendingState):""}else a.conversationIdsForBackFill[t.conversationId]=!1;delete t.lastMessageState})),t},t.recvConversationFromSyncAction=function recvConversationFromSyncAction(t){var a=this,c=Rs(t,"content.info").syncType,m=formatConversationFields(this.core,Rs(t,"content.datas"));0===(c=zp(c))?(forEach$1(m).call(m,(function(t){a.initFieldVersion(t.conversationId,t.version)})),m=this.setBackFillIds(m),this.setModel(m)):(m=this.setBackFillIds(m),this.recvConversationForCreated(m)<m.length&&this.recvConversationForChanged(m))},t.recvConversation=function recvConversation(t){var a=this;if(this.isSyncing)this.tempPacket.push(t);else{var c=formatConversationFields(this.core,Rs(t,"content.datas")),m=filter(c).call(c,(function(t){return!!t.conversationId})),h=formatConversationNotify(Rs(t,"content.info"));if(this.core.logger.log("V2NIMConversation::recvConversation:"+xy[h.type],h,m),h.type===xy.deleteConversation){var g=map$6(m).call(m,(function(t){return delete a.fieldVersion[t.conversationId],a.service.model.deleteById(t.conversationId),t.conversationId}));return this.service.emit("onConversationDeleted",g),void this.service.unread.digestUnreadCountChange()}if(h.type!==xy.oneClickClearConversationUnread)h.type,xy.modifyConversationOnRecallMessage,m=this.setBackFillIds(m),this.recvConversationForCreated(m)<m.length&&this.recvConversationForChanged(m);else this.compareAndClearUnreadInModel(h.oneClickClearUnreadVersion,h.oneClickClearUnreadType,{conversationGroupIds:h.oneClickClearUnreadGroupId?[h.oneClickClearUnreadGroupId]:void 0,conversationTypes:h.oneClickClearUnreadConversationType})}},t.recvConversationForCreated=function recvConversationForCreated(t){var a=this,c=filter(t).call(t,(function(t){return!a.fieldVersion[t.conversationId]})),m=reduce(c).call(c,(function(t,c){if(!a.fieldVersion[c.conversationId]){a.initFieldVersion(c.conversationId,c.version),t=!!a.updateModel(c)||t;var m=a.service.model.getById(c.conversationId);return m&&a.service.triggerConversationCreated(m),t}return t}),!1);return m&&this.service.unread.digestUnreadCountChange(),c.length},t.recvConversationForChanged=function recvConversationForChanged(t){var a,c=this,m=this.bulkCompare(t);if(0!==m.length){this.bulkUpdateModel(m);var h=filter(a=map$6(m).call(m,(function(t){return c.service.model.getById(t.conversationId)}))).call(a,(function(t){return!!t}));this.service.triggerConversationChanged(h)}},t.processTempPacket=function processTempPacket(){var t,a=this;forEach$1(t=this.tempPacket).call(t,(function(t){a.recvConversation(t)})),this.tempPacket=[]},t.bulkCompare=function bulkCompare(t){var a,c=this;return filter(a=map$6(t).call(t,(function(t){return c.compare(t)}))).call(a,(function(t){return!!t}))},t.compare=function compare(t){var a=this,c=t.version,m=t.conversationId,h=t.deleteFlag,g=t.type,I=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],M={},T=0;return forEach$1(I).call(I,(function(h){var g=h;if(void 0!==t[g]){var I=a.fieldVersion[m];I&&"number"==typeof I[g]&&I[g]>=c||(a.fieldVersion[m]=a.fieldVersion[m]||{},a.fieldVersion[m][g]=c,M[g]=t[g],T+=1)}})),T?qt(qt({},M),{conversationId:m,deleteFlag:h,version:c,type:g}):void 0},t.bulkUpdateModel=function bulkUpdateModel(t){var a=this,c=!1;forEach$1(t).call(t,(function(t){a.updateModel(t)&&(c=!0)})),c&&this.service.unread.digestUnreadCountChange()},t.initFieldVersion=function initFieldVersion(t,a){this.fieldVersion[t]={stickTop:a,groupIds:a,serverExtension:a,lastMessage:a,lastMessageState:a,unreadCount:a,sortOrder:a,createTime:a,updateTime:a}},t.initConversation=function initConversation(t,a){var c=Ri();return qt({conversationId:t,type:this.core.V2NIMConversationIdUtil.parseConversationType(t),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:c,updateTime:c,sortOrder:c},a)},t.updateModel=function updateModel(t){var a=formatConversationByField(t),c=a.deleteFlag,m=a.conversation;if(c){var h=this.service.model.deleteById(m.conversationId);return!!(h&&h.unreadCount>0)}return this.service.model.upsert(m)},t.setModel=function setModel(t){var a,c=map$6(a=filter(t).call(t,(function(t){return!t.deleteFlag}))).call(a,(function(t){return formatConversationByField(t).conversation}));this.service.model.set(c)},t.updateModelWithLastMessage=function updateModelWithLastMessage(t,a,c,m){var h=this.service.model.getById(t),g=a?formatLastMessageFromMessage(this.core,a,c,m):void 0;if(!Vy(null==h?void 0:h.lastMessage,g))if(h){var I=qt(qt({},h),{sortOrder:g?h.stickTop?g.messageRefer.createTime+1e15:g.messageRefer.createTime:h.sortOrder,lastMessage:g});this.service.model.upsert(I),this.service.triggerConversationChanged([I])}else{this.initFieldVersion(t,-1);var M=this.initConversation(t,{lastMessage:g});this.service.model.upsert(M),this.service.triggerConversationCreated(M)}},t.updateModelByRevoke=function updateModelByRevoke(t){var a=this,c=[];forEach$1(t).call(t,(function(t){var m=t.postscript,h=t.messageRefer,g=__rest(t,["postscript","messageRefer"]),I=h.conversationId,M=a.service.model.getById(I);M&&M.lastMessage&&M.lastMessage.messageRefer.messageClientId===h.messageClientId&&M.lastMessage.lastMessageState!==Wl.V2NIM_MESSAGE_STATUS_REVOKE&&(M.lastMessage.lastMessageState=Wl.V2NIM_MESSAGE_STATUS_REVOKE,m&&(M.lastMessage.text=m),qt(M.lastMessage,g),a.service.model.upsert(M),c.push(M))})),c.length>0&&this.service.triggerConversationChanged(c)},t.compareAndUpdateModel=function compareAndUpdateModel(t){var a=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",map$6(t).call(t,(function(t){return t.conversationId})));var c=!1,m=[];forEach$1(t).call(t,(function(t){var h=a.compare(t);if(h){var g=a.service.model.getById(t.conversationId);a.updateModel(h)&&(c=!0);var I=a.service.model.getById(t.conversationId);I&&(g?m.push(I):a.service.triggerConversationCreated(I))}})),m.length>0&&this.service.triggerConversationChanged(m),c&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteModel=function compareAndDeleteModel(t){var a=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",t);var c=reduce(t).call(t,(function(t,c){delete a.fieldVersion[c];var m=a.service.model.deleteById(c);return!!!!(m&&m.unreadCount>0)||t}),!1);this.service.emit("onConversationDeleted",t),c&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteGroupInModel=function compareAndDeleteGroupInModel(t,a){var c,m=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",t,a);var h=[];forEach$1(c=mn(this.fieldVersion)).call(c,(function(c){var g=m.fieldVersion[c];if(void 0===g.groupIds||t>g.groupIds){g.groupIds=t;var I=m.service.model.getById(c);if(I&&I.groupIds&&I.groupIds.length>0){var M,T=filter(M=I.groupIds).call(M,(function(t){return t!==a}));if(T.length!==I.groupIds.length){var S=qt(qt({},I),{groupIds:T});m.service.model.upsert(S),S&&h.push(S)}}}})),h.length>0&&this.service.triggerConversationChanged(h)},t.compareAndClearUnreadInModel=function compareAndClearUnreadInModel(t,a,c){var m=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",t,a,c);var h=[],g=[];if(1===a)g=this.service.model.getAll();else if(c){var I=this.service.model.count();g=this.service.model.getByOption(0,I,c).conversationList}forEach$1(g).call(g,(function(a){var c=a.conversationId,g=m.fieldVersion[c];if(void 0===g.unreadCount||t>g.unreadCount){g.unreadCount=t;var I=a.unreadCount,M=qt(qt({},a),{unreadCount:0});m.service.model.upsert(M),I>0&&h.push(M)}})),h.length>0&&this.service.triggerConversationChanged(h),this.service.unread.digestUnreadCountChange()},t.backfillLastMsg=function backfillLastMsg(t,a){var c=this,m=t=Um(t);(a||(m=filter(t).call(t,(function(t){return c.conversationIdsForBackFill[t]})),0!==m.length))&&forEach$1(m).call(m,(function(t){var a=c.service.model.getById(t),m=Rs(a,"lastMessage.messageRefer.messageClientId"),h=c.core.V2NIMMessageService.model.getLastMessageOfConversation(t);(h&&h.messageClientId)!==m&&(c.conversationIdsForBackFill[t]=!1,h?c.updateModelWithLastMessage(t,h,Wl.V2NIM_MESSAGE_STATUS_BACKFILL,h.sendingState):c.updateModelWithLastMessage(t,void 0,Wl.V2NIM_MESSAGE_STATUS_BACKFILL,cu.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN))}))},V2NIMConversationVersionCacheImpl}(),By={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread"},qy="V2NIMConversationService",Gy={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},jy={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},Hy={v2ConversationCreate:{sid:28,cid:1,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationDelete:{sid:28,cid:2,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationUpdate:{sid:28,cid:3,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationSetTop:{sid:28,cid:4,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationGet:{sid:28,cid:6,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Gy)}]},v2ConversationGetByIds:{sid:28,cid:7,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:qy,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:qy,response:[{type:"Property",name:"info",reflectMapper:Ch(jy)},{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:qy,response:[{type:"Property",name:"info",reflectMapper:Ch(jy)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:Ch(jy)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:qy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:Ch(jy)}]}},$y=function(){function V2NIMConversationUnreadImpl(t,a){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=t,this.service=a}var t=V2NIMConversationUnreadImpl.prototype;return t.reset=function reset(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function getTotalUnreadCount(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function resetTotalAfterSyncDone(){var t,a=reduce(t=this.service.model.getAll()).call(t,(function(t,a){return t+(a.unreadCount||0)}),0),c=this.totalUnreadCount;return void 0!==c&&c===a||(this.totalUnreadCount=a,this.service.emit("onTotalUnreadCountChanged",a)),a},t.digestUnreadCountChange=function digestUnreadCountChange(){this._digest()},t._digest=function _digest(){var t,a=this,c=this.totalUnreadCount,m=reduce(t=this.service.model.getAll()).call(t,(function(t,a){return t+(a.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+c+", newUnreadCount "+m),c!==m&&(this.totalUnreadCount=m,this.service.emit("onTotalUnreadCountChanged",m));var h=mn(this.unreadCountByFilter);forEach$1(h).call(h,(function(t){var c=JSON.parse(t),m=a.getUnreadCountByFilter(c),h=a.unreadCountByFilter[t];a.unreadCountByFilter[t]=m,c.equals=bind$1(equals).call(equals,c),h!==m&&a.service.emit("onUnreadCountChangedByFilter",c,m)}))},t.getUnreadCountByIds=function getUnreadCountByIds(t){var a=this;return reduce(t).call(t,(function(t,c){var m=a.service.model.getById(c);return t+(m&&m.unreadCount||0)}),0)},t.getUnreadCountByFilter=function getUnreadCountByFilter(t){var a,c=this.service.model.count(),m=this.service.model.getByOption(0,c,{conversationTypes:t.conversationTypes,conversationGroupIds:t.conversationGroupId?[t.conversationGroupId]:void 0,ignoreMuted:t.ignoreMuted});return reduce(a=m.conversationList).call(a,(function(t,a){return t+(a.unreadCount||0)}),0)},t.addFilter=function addFilter(t){var a=generateFilterKey(t);if(void 0!==this.unreadCountByFilter[a])throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var c=JSON.parse(a),m=this.getUnreadCountByFilter(c);this.unreadCountByFilter[a]=m,this.service.emit("onUnreadCountChangedByFilter",c,m)},t.deleteFilter=function deleteFilter(t){var a=generateFilterKey(t);if(void 0===this.unreadCountByFilter[a])throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[a]},V2NIMConversationUnreadImpl}();function generateFilterKey(t){var a=t.conversationTypes;return a&&(a=sort(a).call(a)),Uc({conversationGroupId:t.conversationGroupId,conversationTypes:a,ignoreMuted:t.ignoreMuted})}function equals(t){return Uc(this)===generateFilterKey(t)}var Yy={createTime:{type:"number"},updateTime:{type:"number"}};function formatConversationGroups(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatConversationGroup(t)})):[]}function formatConversationGroup(t){return format(Yy,t)}function formatFailedMap(t){var a,c=JSON.parse(t);return map$6(a=mn(c)).call(a,(function(t){return{conversationId:t,error:new Fu({code:c[t]})}}))}var Wy,zy={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function formatConversationGroupNotify(t){return format(zy,t)}!function(t){t[t.createConversationGroup=1]="createConversationGroup",t[t.deleteConversationGroup=2]="deleteConversationGroup",t[t.updateConversationGroup=3]="updateConversationGroup",t[t.addConversationToGroup=4]="addConversationToGroup",t[t.removeConversationFromGroup=5]="removeConversationFromGroup"}(Wy||(Wy={}));var Ky=function(t){function V2NIMConversationServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMConversationService",a)||this).config={},m.core.V2NIMConversationIdUtil=new Py(m.core),m.model=new Cy,m.versionCache=new Fy(m.core,Qe(m)),m.unread=new $y(m.core,Qe(m)),"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:By,cmdConfig:Hy}),m.setOptions(c),m.setListener(),m)}wt(V2NIMConversationServiceImpl,t);var a=V2NIMConversationServiceImpl.prototype;return a.setOptions=function setOptions(t){this.config=qt(this.config,t)},a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.versionCache.doSync()})),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",(function(a,c){var m;!1!==(null===(m=null==c?void 0:c.messageConfig)||void 0===m?void 0:m.lastMessageUpdateEnabled)&&(a.content.info=deserialize(a.content.info,Ch(jy)),a.content.data=deserialize(a.content.data,Ch(Gy)),c&&(a.content.data.lastMessage=formatLastMessageFromMessage(t.core,c,Wl.V2NIM_MESSAGE_STATUS_DEFAULT)),a.content.datas=[a.content.data],t.v2ConversationNotifySyncOnlineHandler.call(t,a))})),this.core.eventBus.on("V2NIMConversationService/sendMessage",(function(a,c){var m,h;c===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED&&!0===(null===(m=a.messageConfig)||void 0===m?void 0:m.historyEnabled)||!1!==(null===(h=null==a?void 0:a.messageConfig)||void 0===h?void 0:h.lastMessageUpdateEnabled)&&t.versionCache.updateModelWithLastMessage(a.conversationId,a,Wl.V2NIM_MESSAGE_STATUS_BACKFILL,c)})),this.core.eventBus.on("V2NIMConversationService/deleteMessages",(function(a){var c=map$6(a).call(a,(function(t){return t.messageRefer.conversationId}));t.versionCache.backfillLastMsg(c,!0)})),this.core.eventBus.on("V2NIMConversationService/revokeMessages",(function(a){t.versionCache.updateModelByRevoke(a)})),this.core.eventBus.on("V2NIMConversationService/checkBackFill",(function(a){t.versionCache.backfillLastMsg(a,!1)})),this.core.eventBus.on("V2NIMConversationService/setMute",(function(a,c){var m=t.model.getById(a);m&&m.mute!==c&&(m.mute=c,t.model.upsert(m),t.emit("onConversationChanged",[m]))}))},a.reset=function reset(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},a.getConversationList=function getConversationList(t,a){this.checkV2(),validate({offset:{type:"number",min:0}},{offset:t},"",!0),validate({limit:{type:"number",min:1}},{limit:a},"",!0),this.core.V2NIMLoginService.checkIllegalState();var c=this.model.getByOption(t,a,{});return c.conversationList=this.computedFieldForConversations(c.conversationList),Mi.resolve(c)},a.getConversationListByOption=function getConversationListByOption(t,a,c){this.checkV2(),validate({offset:{type:"number",min:0}},{offset:t},"",!0),validate({limit:{type:"number",min:1}},{limit:a},"",!0),validate({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:c},"",!0),this.core.V2NIMLoginService.checkIllegalState();var m=this.model.getByOption(t,a,c);return m.conversationList=this.computedFieldForConversations(m.conversationList),Mi.resolve(m)},a.getConversation=function getConversation(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validateConversationId(this.core.account,t),this.core.V2NIMLoginService.checkIllegalState(),!(a=this.model.getById(t))){c.next=8;break}return c.abrupt("return",this.computedFieldForConversation(a));case 8:throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return c.stop()}}),_callee,this)})))},a.getConversationListByIds=function getConversationListByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m=this;return Lc.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),c=filter(a=map$6(t).call(t,(function(t){return m.model.getById(t)}))).call(a,(function(t){return!!t})),c=this.computedFieldForConversations(c),h.abrupt("return",c);case 6:case"end":return h.stop()}}),_callee2,this)})))},a.createConversation=function createConversation(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h;return Lc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),g.next=4,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:t}});case 4:if(a=g.sent,c=Rs(a,"content.data"),m=formatConversationField(this.core,c),this.versionCache.compareAndUpdateModel([m]),!(h=this.model.getById(t))){g.next=13;break}return g.abrupt("return",this.computedFieldForConversation(h));case 13:throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 14:case"end":return g.stop()}}),_callee3,this)})))},a.deleteConversation=function deleteConversation(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({clearMessage:{type:"boolean",required:!1}},{clearMessage:a},"",!0),c.prev=3,c.next=6,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:t,clearMessage:Number(a||!1)}});case 6:c.next=13;break;case 8:if(c.prev=8,c.t0=c.catch(3),c.t0.code===Lu.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST&&this.model.getById(t)){c.next=13;break}throw c.t0;case 13:a&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[t]),this.versionCache.compareAndDeleteModel([t]);case 15:case"end":return c.stop()}}),_callee4,this,[[3,8]])})))},a.deleteConversationListByIds=function deleteConversationListByIds(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var c,m,h,g=this;return Lc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),validate({clearMessage:{type:"boolean",required:!1}},{clearMessage:a},"",!0),I.next=5,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:Uc(t),clearMessage:Number(a||!1)}});case 5:return c=I.sent,m=formatFailedMap(Rs(c,"content.info.failedMap")),h=filter(m).call(m,(function(t){return t.error.code!==Lu.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!g.model.getById(t.conversationId)})),a&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",t),this.versionCache.compareAndDeleteModel(t),I.abrupt("return",h);case 11:case"end":return I.stop()}}),_callee5,this)})))},a.stickTopConversation=function stickTopConversation(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var c,m,h;return Lc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({stickTop:{type:"boolean"}},{stickTop:a},"",!0),g.next=5,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:t,stickTop:Number(a)}});case 5:c=g.sent,m=Rs(c,"content.data"),h=formatConversationField(this.core,m),this.versionCache.compareAndUpdateModel([h]);case 9:case"end":return g.stop()}}),_callee6,this)})))},a.updateConversation=function updateConversation(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var c,m,h;return Lc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:a},"",!0),g.next=5,this.core.sendCmd("v2ConversationUpdate",{tag:qt({conversationId:t},a)});case 5:c=g.sent,m=Rs(c,"content.data"),h=formatConversationField(this.core,m),this.versionCache.compareAndUpdateModel([h]);case 9:case"end":return g.stop()}}),_callee7,this)})))},a.updateConversationLocalExtension=function updateConversationLocalExtension(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var c,m;return Lc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:if(this.checkV2(),validateConversationId(this.core.account,t),validate({localExtension:{type:"string"}},{localExtension:a},"",!0),c=this.model.getById(t)){h.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(c.localExtension!==a){h.next=8;break}return h.abrupt("return");case 8:m=qt(qt({},c),{localExtension:a}),this.model.upsert(m),this.triggerConversationChanged([m]);case 11:case"end":return h.stop()}}),_callee8,this)})))},a.getTotalUnreadCount=function getTotalUnreadCount(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},a.getUnreadCountByIds=function getUnreadCountByIds(t){this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0);var a=this.unread.getUnreadCountByIds(t);return Mi.resolve(a)},a.getUnreadCountByFilter=function getUnreadCountByFilter(t){this.checkV2(),this.valiteFilter(t);var a=this.unread.getUnreadCountByFilter(t);return Mi.resolve(a)},a.clearTotalUnreadCount=function clearTotalUnreadCount(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var t,a;return Lc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),c.next=3,this.core.sendCmd("v2ConversationClearTotalUnread");case 3:t=c.sent,a=formatConversationNotify(Rs(t,"content.info")),this.versionCache.compareAndClearUnreadInModel(a.oneClickClearUnreadVersion,a.oneClickClearUnreadType);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.clearUnreadCountByIds=function clearUnreadCountByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a,c,m;return Lc.wrap((function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:t},"",!0),h.next=4,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:Uc(t)}});case 4:return a=h.sent,c=formatConversationFields(this.core,Rs(a,"content.datas")),m=formatFailedMap(Rs(a,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(c),h.abrupt("return",m);case 9:case"end":return h.stop()}}),_callee10,this)})))},a.clearUnreadCountByGroupId=function clearUnreadCountByGroupId(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate({groupId:{type:"string"}},{groupId:t},"",!0),a.next=4,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:t}});case 4:case"end":return a.stop()}}),_callee11,this)})))},a.clearUnreadCountByTypes=function clearUnreadCountByTypes(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c;return Lc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({types:{type:"array",itemType:"number",min:1}},{types:t},"",!0),m.next=4,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:Uc(t)}});case 4:a=m.sent,c=formatConversationNotify(Rs(a,"content.info")),this.versionCache.compareAndClearUnreadInModel(c.oneClickClearUnreadVersion,c.oneClickClearUnreadType,{conversationTypes:c.oneClickClearUnreadConversationType});case 7:case"end":return m.stop()}}),_callee12,this)})))},a.subscribeUnreadCountByFilter=function subscribeUnreadCountByFilter(t){var a;if(this.checkV2(),this.valiteFilter(t),this.core.V2NIMLoginService.getLoginStatus()!==eu.V2NIM_LOGIN_STATUS_LOGINED)throw new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE});0===(null===(a=t.conversationTypes)||void 0===a?void 0:a.length)&&delete t.conversationTypes,this.unread.addFilter(t)},a.unsubscribeUnreadCountByFilter=function unsubscribeUnreadCountByFilter(t){var a;if(this.checkV2(),this.valiteFilter(t),this.core.V2NIMLoginService.getLoginStatus()!==eu.V2NIM_LOGIN_STATUS_LOGINED)throw new Fu({code:Lu.V2NIM_ERROR_CODE_ILLEGAL_STATE});0===(null===(a=t.conversationTypes)||void 0===a?void 0:a.length)&&delete t.conversationTypes,this.unread.deleteFilter(t)},a.v2ConversationNotifySyncHandler=function v2ConversationNotifySyncHandler(t){this.versionCache.recvConversationFromSyncAction(t)},a.v2ConversationNotifySyncOnlineHandler=function v2ConversationNotifySyncOnlineHandler(t){this.versionCache.recvConversation(t)},a.valiteFilter=function valiteFilter(t){if(validate({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:t},"",!0),void 0===t.conversationTypes&&void 0===t.conversationGroupId&&!0!==t.ignoreMuted)throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},a.computedFieldForConversations=function computedFieldForConversations(t){var a=this;return map$6(t).call(t,(function(t){return a.computedFieldForConversation(t)}))},a.computedFieldForConversation=function computedFieldForConversation(t){var a,c,m,h;if(t.type===Yl.V2NIM_CONVERSATION_TYPE_UNKNOWN)return t;var g=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),M={};if((null===(a=this.core.V2NIMSettingService)||void 0===a?void 0:a.name)&&(M.mute=this.core.V2NIMSettingService.getConversationMuteStatus(t.conversationId)),g===Yl.V2NIM_CONVERSATION_TYPE_P2P&&(null===(c=this.core.V2NIMUserService)||void 0===c?void 0:c.name)){var T=this.core.V2NIMUserService.model.getUser(I),S=this.core.V2NIMFriendService.model.getFriend(I);M.name=(null==S?void 0:S.alias)||(null==T?void 0:T.name)||I,M.avatar=(null==T?void 0:T.avatar)||""}else if(g===Yl.V2NIM_CONVERSATION_TYPE_TEAM&&(null===(m=this.core.V2NIMTeamService)||void 0===m?void 0:m.name)){var E=this.core.V2NIMTeamService.model.getById(I,Iu.V2NIM_TEAM_TYPE_ADVANCED);M.name=(null==E?void 0:E.name)||I,M.avatar=(null==E?void 0:E.avatar)||""}else if(g===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM&&(null===(h=this.core.V2NIMTeamService)||void 0===h?void 0:h.name)){var b=this.core.V2NIMTeamService.model.getById(I,Iu.V2NIM_TEAM_TYPE_SUPER);M.name=(null==b?void 0:b.name)||I,M.avatar=(null==b?void 0:b.avatar)||""}return qt(t,M),t},a.triggerConversationChanged=function triggerConversationChanged(t){t=this.computedFieldForConversations(t),t=JSON.parse(Uc(t)),forEach$1(t).call(t,(function(t){t.lastMessage||(t.lastMessage=void 0),delete t.lastMessageState})),this.emit("onConversationChanged",t)},a.triggerConversationCreated=function triggerConversationCreated(t){t=this.computedFieldForConversation(t),delete(t=JSON.parse(Uc(t))).lastMessageState,this.emit("onConversationCreated",t)},V2NIMConversationServiceImpl}(ch),Qy={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},Jy="V2NIMConversationGroupService",Xy={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},Zy={v2ConversationGroupCreate:{sid:28,cid:9,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Xy)},{type:"PropertyArray",name:"conversations",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Xy)}]},v2ConversationGroupGet:{sid:28,cid:12,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:Ch(Xy)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Xy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:Jy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Xy)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:Jy,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Gy)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:Jy,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:Ch(Xy)}]}},e_=function(t){function V2NIMConversationGroupServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMConversationGroupService",a)||this).config={},"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Qy,cmdConfig:Zy}),m.setOptions(c),m)}wt(V2NIMConversationGroupServiceImpl,t);var a=V2NIMConversationGroupServiceImpl.prototype;return a.setOptions=function setOptions(t){this.config=qt(this.config,t)},a.createConversationGroup=function createConversationGroup(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var m,h,g,I,M,T=this;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate({name:{type:"string",allowEmpty:!1}},{name:t},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:a},"",!0),validate({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:c},"",!0),S.next=6,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:t,serverExtension:a||"",conversationIds:c&&Uc(c)}});case 6:return m=S.sent,h=formatConversationGroup(Rs(m,"content.data")),g=formatConversationFields(this.core,Rs(m,"content.conversations")),I=formatFailedMap(Rs(m,"content.info.failedMap")),this.emit("onConversationGroupCreated",h),g.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsAddedToGroup",h.groupId,filter(M=map$6(g).call(g,(function(t){return T.core.V2NIMConversationService.model.getById(t.conversationId)}))).call(M,(function(t){return!!t})))),S.abrupt("return",{group:h,failedList:I});case 13:case"end":return S.stop()}}),_callee,this)})))},a.deleteConversationGroup=function deleteConversationGroup(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c;return Lc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),m.next=4,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:t}});case 4:a=m.sent,c=formatConversationGroupNotify(Rs(a,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(c.deleteVersion,t),this.emit("onConversationGroupDeleted",t);case 8:case"end":return m.stop()}}),_callee2,this)})))},a.updateConversationGroup=function updateConversationGroup(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var m,h;return Lc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({name:{type:"string",required:!1}},{name:a},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:c},"",!0),void 0!==a||void 0!==c){g.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return g.next=8,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:t,name:a,serverExtension:c}});case 8:m=g.sent,h=formatConversationGroup(Rs(m,"content.data")),this.emit("onConversationGroupChanged",h);case 11:case"end":return g.stop()}}),_callee3,this)})))},a.addConversationsToGroup=function addConversationsToGroup(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var c,m,h,g,I,M,T=this;return Lc.wrap((function _callee4$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:a},"",!0),S.next=5,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:t,conversationIds:Uc(a)}});case 5:return m=S.sent,h=Rs(m,"content.info.failedMap")||"",g=[],h&&(g=formatFailedMap(h)),I=formatConversationFields(this.core,Rs(m,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(I),(M=filter(c=map$6(I).call(I,(function(t){return T.core.V2NIMConversationService.model.getById(t.conversationId)}))).call(c,(function(t){return!!t}))).length>0&&this.emit("onConversationsAddedToGroup",t,M),S.abrupt("return",g);case 14:case"end":return S.stop()}}),_callee4,this)})))},a.removeConversationsFromGroup=function removeConversationsFromGroup(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var c,m,h,g;return Lc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),validate({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:a},"",!0),I.next=5,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:t,conversationIds:Uc(a)}});case 5:return c=I.sent,m=Rs(c,"content.info.failedMap")||"",h=[],m&&(h=formatFailedMap(m)),g=formatConversationFields(this.core,Rs(c,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(g),this.emit("onConversationsRemovedFromGroup",t,map$6(g).call(g,(function(t){return t.conversationId}))),I.abrupt("return",h);case 13:case"end":return I.stop()}}),_callee5,this)})))},a.getConversationGroup=function getConversationGroup(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a;return Lc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate({groupId:{type:"string",allowEmpty:!1}},{groupId:t},"",!0),c.next=4,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:t}});case 4:return a=c.sent,c.abrupt("return",formatConversationGroup(Rs(a,"content.data")));case 6:case"end":return c.stop()}}),_callee6,this)})))},a.getConversationGroupList=function getConversationGroupList(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var t;return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this.core.sendCmd("v2ConversationGroupListGet");case 3:return t=a.sent,a.abrupt("return",formatConversationGroups(Rs(t,"content.datas")));case 5:case"end":return a.stop()}}),_callee7,this)})))},a.getConversationGroupListByIds=function getConversationGroupListByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a,c,m;return Lc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:t},"",!0),h.next=4,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:t&&Uc(t)}});case 4:return c=h.sent,m=formatConversationGroups(Rs(c,"content.datas")),h.abrupt("return",filter(a=map$6(t).call(t,(function(t){return filter(m).call(m,(function(a){return a.groupId===t}))[0]}))).call(a,(function(t){return!!t})));case 7:case"end":return h.stop()}}),_callee8,this)})))},a.v2ConversationGroupNotifySyncOnlineHandler=function v2ConversationGroupNotifySyncOnlineHandler(t){var a,c=this,m=formatConversationGroupNotify(Rs(t,"content.info")),h=m.type,g=m.deleteVersion,I=m.conversationIds,M=formatConversationGroup(Rs(t,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",m,M),h===Wy.createConversationGroup)this.emit("onConversationGroupCreated",M),I&&I.length>0&&this.emit("onConversationsAddedToGroup",M.groupId,filter(a=map$6(I).call(I,(function(t){return c.core.V2NIMConversationService.model.getById(t)}))).call(a,(function(t){return!!t})));else if(h===Wy.deleteConversationGroup)this.emit("onConversationGroupDeleted",M.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(g,M.groupId);else if(h===Wy.updateConversationGroup)this.emit("onConversationGroupChanged",M);else if(h===Wy.addConversationToGroup){var T,S=filter(T=map$6(I).call(I,(function(t){return c.core.V2NIMConversationService.model.getById(t)}))).call(T,(function(t){return!!t}));this.emit("onConversationsAddedToGroup",M.groupId,S)}else h===Wy.removeConversationFromGroup&&this.emit("onConversationsRemovedFromGroup",M.groupId,I)},V2NIMConversationGroupServiceImpl}(ch),t_=function(){function V2NIMMessageModel(){this.messages=new Il,this.maxSize=2e3}var t=V2NIMMessageModel.prototype;return t.reset=function reset(){this.messages.clear()},t.getMessageById=function getMessageById(t){if(t)return this.messages.get(t)},t.getMessagesByConversationId=function getMessagesByConversationId(t){var a,c=[];return forEach$1(a=this.messages).call(a,(function(a){a.conversationId===t&&c.push(a)})),c},t.getLastMessageOfConversation=function getLastMessageOfConversation(t){var a=this.getMessagesByConversationId(t);if(0!==a.length)return reduce(a).call(a,(function(t,a){return a.createTime>t.createTime?a:t}),a[0])},t.upsertMessages=function upsertMessages(t){var a,c,m,h=this;forEach$1(t).call(t,(function(t){h.messages.set(t.messageClientId,t)}));var g=this.messages.size;if(!(g<=this.maxSize))for(var I=sort(a=filter(c=Yc(values(m=this.messages).call(m))).call(c,(function(t){return t.sendingState!==cu.V2NIM_MESSAGE_SENDING_STATE_SENDING}))).call(a,(function(t,a){return t.createTime-a.createTime})),M=g-this.maxSize>100?g-this.maxSize:100,T=0;T<M;T++){var S=I[T];S&&this.messages.delete(S.messageClientId)}},t.deleteMessage=function deleteMessage(t){this.messages.delete(t)},t.deleteMessages=function deleteMessages(t,a){var c,m=this;forEach$1(c=this.messages).call(c,(function(c){t===c.conversationId&&(!a||a&&c.createTime<a)&&m.messages.delete(c.messageClientId)}))},V2NIMMessageModel}(),r_={messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:getEnumValues(Yl)},createTime:{type:"number"}},n_={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}}},antiSpamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}}},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}}},a_={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:getEnumValues(iu)},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:n_,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:getEnumValues(Yl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},i_={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:getEnumValues(iu)},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:n_}},o_={message:{type:"object",rules:r_},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},s_={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(iu)},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:getEnumValues(lu),required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},c_={conversationType:{type:"enum",values:getEnumValues(Yl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},l_={messageRefers:{type:"array",required:!0,rules:c_}},u_={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:getEnumValues(Yl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},d_={messages:{type:"array",rules:u_}},p_={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1}},m_={serverExtension:{type:"string",required:!1}},h_={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Yl.V2NIM_CONVERSATION_TYPE_P2P]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},f_={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Yl.V2NIM_CONVERSATION_TYPE_TEAM]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},g_={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},v_={message:{type:"object",rules:{conversationType:{type:"enum",values:getEnumValues(Yl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},y_={messages:{type:"array",rules:{conversationType:{type:"enum",values:getEnumValues(Yl)},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},__={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},I_={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},M_={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},T_={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:getEnumValues(lu)},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},S_={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:getEnumValues(hu),required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(iu)},messageSubtypes:{type:"array",required:!1,itemType:"number"}},E_={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Yl.V2NIM_CONVERSATION_TYPE_TEAM]}}}},b_={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[Yl.V2NIM_CONVERSATION_TYPE_TEAM]}},min:1}},C_={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},A_=qt(qt({},C_),{duration:{type:"number",required:!1}}),N_=qt(qt({},A_),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),R_=qt(qt({},C_),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),k_={messageRefer:{type:"object",required:!0,rules:c_},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:getEnumValues(lu),required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},w_=function(){function ReceiptUtil(t,a){this.p2pMessageReceipts={},this.core=t,this.service=a}var t=ReceiptUtil.prototype;return t.sendP2PMessageReceipt=function sendP2PMessageReceipt(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(validate(h_,t,"",!0),t.senderId!==this.core.account){a.next=3;break}throw new qu({detail:{reason:"sendP2PMessageReceipt. sender: "+t.senderId+" is not allowed to send msg receipt"}});case 3:if(!(this.p2pMessageReceipts[t.conversationId]>t.createTime)){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:t.senderId,messageClientId:t.messageClientId,createTime:t.createTime}});case 7:this.p2pMessageReceipts[t.conversationId]=t.createTime;case 8:case"end":return a.stop()}}),_callee,this)})))},t.isPeerRead=function isPeerRead(t){if(t.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_P2P)return!1;if(t.senderId!==this.core.account)return!1;if(t.senderId===this.core.account&&t.receiverId===this.core.account)return!0;var a=this.core.V2NIMConversationIdUtil.messageConversationId(t),c=this.p2pMessageReceipts[a]||0;return t.createTime<=c},t.getP2PMessageReceipt=function getP2PMessageReceipt(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validateConversationId(this.core.account,t),this.core.V2NIMConversationIdUtil.parseConversationType(t)===Yl.V2NIM_CONVERSATION_TYPE_P2P){a.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return a.abrupt("return",{conversationId:t,timestamp:this.p2pMessageReceipts[t]||0});case 5:case"end":return a.stop()}}),_callee2,this)})))},t.getTeamMessageReceipts=function getTeamMessageReceipts(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m=this;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(validate(b_,{messages:t},"",!0),!some(t).call(t,(function(t){return t.senderId!==m.core.account}))){h.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!some(t).call(t,(function(a){return a.receiverId!==t[0].receiverId}))){h.next=5;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return h.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:t});case 7:return c=h.sent,h.abrupt("return",map$6(a=c.content.data).call(a,(function(t){return qt(qt({},t),{conversationId:m.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId)})})));case 9:case"end":return h.stop()}}),_callee3,this)})))},t.getTeamMessageReceiptDetail=function getTeamMessageReceiptDetail(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(validate(E_,{message:t},"",!0),t.senderId===this.core.account){c.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+t.senderId+" incorrect"}});case 3:return c.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:t});case 5:return a=c.sent,c.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId),messageClientId:t.messageClientId,messageServerId:t.messageServerId,readCount:a.content.readAccountList.length,unreadCount:a.content.unreadAccountList.length},readAccountList:a.content.readAccountList,unreadAccountList:a.content.unreadAccountList});case 7:case"end":return c.stop()}}),_callee4,this)})))},t.sendTeamMessageReceipts=function sendTeamMessageReceipts(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a=this;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:if(validate(f_,{messages:t},"",!0),!some(t).call(t,(function(t){return t.senderId===a.core.account}))){c.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!some(t).call(t,(function(a){return a.receiverId!==t[0].receiverId}))){c.next=5;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return c.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:t});case 7:return c.abrupt("return");case 8:case"end":return c.stop()}}),_callee5,this)})))},t.syncP2PMessagReceiptsHandler=function syncP2PMessagReceiptsHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){var a=c.core.V2NIMConversationIdUtil.p2pConversationId(t.senderId),m=t.createTime;return c.p2pMessageReceipts[a]=m,{conversationId:a,timestamp:m}}));this.service.emit("onReceiveP2PMessageReadReceipts",m)},t.onP2PMessageReceiptsHandler=function onP2PMessageReceiptsHandler(t){var a=this.core.V2NIMConversationIdUtil.p2pConversationId(t.content.data.senderId),c=t.content.data.createTime;this.p2pMessageReceipts[a]=c,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:a,timestamp:c}])},t.onTeamMessageReceiptsHandler=function onTeamMessageReceiptsHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return{conversationId:c.core.V2NIMConversationIdUtil.teamConversationId(t.receiverId),messageServerId:t.messageServerId,messageClientId:t.messageClientId,readCount:t.readCount,unreadCount:t.unreadCount,latestReadAccount:t.latestReadAccount}}));this.service.emit("onReceiveTeamMessageReadReceipts",m)},ReceiptUtil}(),O_=function(){function FileUtil(t,a){this.core=t,this.service=a}var t=FileUtil.prototype;return t.doSendFile=function doSendFile(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I,M,T,S;return Lc.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return c=t.attachment,E.prev=1,E.next=4,this.core.V2NIMStorageService._uploadFile({taskId:t.messageClientId,uploadParams:{fileObj:(null==c?void 0:c.file)||(null==c?void 0:c.path),sceneName:null==c?void 0:c.sceneName}},a,{fileType:t.messageType});case 4:for(T in(h=E.sent)[0],g=h[1],I=qt(qt({},c),{uploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS}),g.w&&(I.width=I.width||g.w),g.h&&(I.height=I.height||g.h),g.dur&&(I.duration=I.duration||g.dur),I.ext=I.ext&&-1===indexOf(m=I.ext).call(m,".")?"."+I.ext:I.ext,M=["w","h","dur","ext","name"],g)includes(M).call(M,T)||(I[T]=g[T]);I.raw,I.file,I.path,S=__rest(I,["raw","file","path"]),t.attachment=JSON.parse(Uc(S)),t.attachment&&(t.attachment.raw=attachmentToRaw(t.messageType,t.attachment)),E.next=23;break;case 19:throw E.prev=19,E.t0=E.catch(1),t.attachment&&(t.attachment.uploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED),E.t0;case 23:case"end":return E.stop()}}),_callee,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messageClientId:{type:"string",allowEmpty:!1}},t,"",!0),includes(a=[iu.V2NIM_MESSAGE_TYPE_AUDIO,iu.V2NIM_MESSAGE_TYPE_FILE,iu.V2NIM_MESSAGE_TYPE_IMAGE,iu.V2NIM_MESSAGE_TYPE_VIDEO]).call(a,t.messageType)){c.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+t.messageType+" incorrect"}});case 3:if(t.sendingState!==cu.V2NIM_MESSAGE_SENDING_STATE_FAILED&&t.sendingState!==cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){c.next=5;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return c.next=7,this.core.V2NIMStorageService._cancelUploadFile(t.messageClientId);case 7:case"end":return c.stop()}}),_callee2,this)})))},FileUtil}(),P_=function(){function SendUtil(t,a){this.uploadingMessageInfo={},this.core=t,this.service=a}var t=SendUtil.prototype;return t.sendAndReplyMessage=function sendAndReplyMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I,M,T,S,E,b,C;return Lc.wrap((function _callee$(A){for(;;)switch(A.prev=A.next){case 0:if(a=this.core.timeOrigin.getTimeNode(),c=t.message,m=t.conversationId,h=t.params,g=t.progress,I=t.replyMessage,c.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_TEAM||!h.robotConfig||h.robotConfig.accountId){A.next=4;break}throw new qu({detail:{reason:'When "scene" equals "team", account is required in robotInfo account is required'}});case 4:return M=this.checkIfResend(c),T=this.checkIfAntispam(h,c),S=T.clientAntispamResult,E=T.text,c.text=E,b=this.generateSendMessage({message:c,params:h,resend:M,clientAntispamResult:S,conversationId:m,replyMessage:I}),A.next=10,this.doSendMessage(a,b,S,g);case 10:return C=A.sent,A.abrupt("return",C);case 12:case"end":return A.stop()}}),_callee,this)})))},t.checkIfAntispam=function checkIfAntispam(t,a){var c,m=a.text;if(t.clientAntispamEnabled&&a.messageType!==iu.V2NIM_MESSAGE_TYPE_CUSTOM&&a.text)if((c=this.core.V2NIMClientAntispamUtil.checkTextAntispam(a.text||"",t.clientAntispamReplace)).operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE)m=c.replacedText;else if(c.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD)throw new Fu({code:Lu.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:c,text:m}},t.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.senderId!==this.core.account){var c=Rs(t,"__clientExt.statistics.apiCallingTime")||0,m=Rs(t,"__clientExt.statistics.sendTime")||0,h=Rs(t,"__clientExt.statistics.attachUploadDuration")||0,g=this.core.timeOrigin.getNTPTime(),I=t.createTime,M=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):g;this.core.reporter.report("msgReceive",{msgId:t.messageServerId,clientId:t.messageClientId,serverTime:t.createTime,receiveTime:M,fromAccid:t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?t.senderId:"",toAccid:t.receiverId,type:conversationTypeV2ToV1(t.conversationType),tid:t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?"":t.receiverId,apiCallingTime:c,sendTime:m,attachUploadDuration:h,callbackTime:g,preHandleTime:g,result:200,failReason:"",rt:g-I})}},t.checkIfResend=function checkIfResend(t){var a=this.service.model.getMessageById(t.messageClientId),c=!1;if(t.messageServerId||t.sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED)throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if((null==a?void 0:a.sendingState)===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED)throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return a&&(c=!0),c},t.doSendMessage=function doSendMessage(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var h,g,I,M,T,S;return Lc.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:if(h={},a.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_P2P){E.next=5;break}g="v2SendP2pMessage",E.next=14;break;case 5:if(a.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_TEAM){E.next=9;break}g="v2SendTeamMessage",E.next=14;break;case 9:if(a.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM){E.next=13;break}g="v2SendSuperTeamMessage",E.next=14;break;case 13:throw new qu({detail:{reason:"conversationType: "+a.conversationType+" is not supported"}});case 14:if(this.service.sendMessageHandler(a),this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",a),!a.attachment||!("uploadState"in a.attachment)||a.attachment.url||a.attachment.uploadState!==su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN&&a.attachment.uploadState!==su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED){E.next=41;break}return I=Ri(),E.prev=18,a.attachmentUploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,a.attachment.uploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,this.service.emit("onSendMessage",a),E.next=24,this.service.fileUtil.doSendFile(a,m);case 24:a.attachmentUploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,a.attachment.uploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,this.service.emit("onSendMessage",a),E.next=38;break;case 29:throw E.prev=29,E.t0=E.catch(18),a.attachmentUploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,a.attachment.uploadState=su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,a.sendingState=cu.V2NIM_MESSAGE_SENDING_STATE_FAILED,this.service.emit("onSendMessage",a),h.attachUploadDuration=Ri()-I,this.doSendMessageFailed(t,h,a,E.t0),E.t0;case 38:h.attachUploadDuration=Ri()-I,E.next=42;break;case 41:this.service.emit("onSendMessage",a);case 42:return this.core.timeOrigin.checkNodeReliable(t)&&(h.apiCallingTime=this.core.timeOrigin.getNTPTime(t),h.sendTime=this.core.timeOrigin.getNTPTime(),a.__clientExt={statistics:h}),E.prev=43,E.next=46,this.core.sendCmd(g,{tag:a});case 46:M=E.sent,E.next=55;break;case 49:throw E.prev=49,E.t1=E.catch(43),this.doSendMessageFailed(t,h,a,E.t1),a.sendingState=cu.V2NIM_MESSAGE_SENDING_STATE_FAILED,this.service.emit("onSendMessage",a),E.t1;case 55:return T=qt(qt(qt({},a),M.content.data),{sendingState:cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED}),this.service.sendMessageHandler(T),this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",T),this.doMsgSendReport(t,h,a),(S=T.antispamResult)&&(T.sendingState=cu.V2NIM_MESSAGE_SENDING_STATE_FAILED),delete T.antispamResult,this.service.emit("onSendMessage",T),E.abrupt("return",qt(qt({message:T},S?{antispamResult:S}:{}),c?{clientAntispamResult:c}:{}));case 64:case"end":return E.stop()}}),_callee2,this,[[18,29],[43,49]])})))},t.doSendMessageFailed=function doSendMessageFailed(t,a,c,m){var h=qt(qt({},c),{sendingState:cu.V2NIM_MESSAGE_SENDING_STATE_FAILED});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",h),this.service.sendMessageHandler(h),this.doMsgSendReport(t,a,c,m)},t.doMsgSendReport=function doMsgSendReport(t,a,c,m){a.apiCallingTime=this.core.timeOrigin.getNTPTime(t),a.sendTime=this.core.timeOrigin.getNTPTime();var h=this.core.timeOrigin.getNTPTime(),g=Rs(m,"detail.reason");this.core.reporter.report("msgSend",{msgId:c.messageServerId,clientId:c.messageClientId,msgTime:c.createTime,fromAccid:c.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?c.senderId:"",toAccid:c.receiverId,type:conversationTypeV2ToV1(c.conversationType),tid:c.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?"":c.receiverId,result:m?m.code:200,failReason:g||(null==m?void 0:m.message)||"",rt:h-a.apiCallingTime,apiCallingTime:a.apiCallingTime,sendTime:a.sendTime,attachUploadDuration:a.attachUploadDuration,apiCallbackTime:h})},t.generateSendMessage=function generateSendMessage(t){var a=t.conversationId,c=t.replyMessage,m=t.resend,h=t.clientAntispamResult,g=t.message,I=t.params,M={};if(c){var T=c.threadRoot;M={threadReply:{senderId:c.senderId,receiverId:c.receiverId,messageServerId:c.messageServerId,createTime:c.createTime,messageClientId:c.messageClientId,conversationType:c.conversationType,conversationId:c.conversationId},threadRoot:{senderId:T?T.senderId:c.senderId,receiverId:T?T.receiverId:c.receiverId,messageServerId:T?T.messageServerId:c.messageServerId,createTime:T?T.createTime:c.createTime,messageClientId:T?T.messageClientId:c.messageClientId,conversationType:T?T.conversationType:c.conversationType,conversationId:T?T.conversationId:c.conversationId}}}var S=this.core.V2NIMConversationIdUtil.parseConversationType(a),E=this.core.V2NIMConversationIdUtil.parseConversationTargetId(a);I.pushConfig&&!0!==I.pushConfig.forcePush&&(delete I.pushConfig.forcePushContent,delete I.pushConfig.forcePushAccountIds);var b=this.core.V2NIMUserService.model.getUser(this.core.account),C=(null==b?void 0:b.updateTime)||0;return qt(qt(qt(qt(qt({},g),M),{messageConfig:qt(qt({},g.messageConfig),I.messageConfig),routeConfig:qt(qt({},g.routeConfig),I.routeConfig),pushConfig:qt(qt({},g.pushConfig),I.pushConfig),antispamConfig:qt(qt({},g.antispamConfig),I.antispamConfig),robotConfig:qt(qt({},g.robotConfig),I.robotConfig),attachment:qt({},g.attachment),resend:m,senderId:this.core.account,conversationType:S,receiverId:E,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:S,senderId:this.core.account,receiverId:E})}),C?{userUpdateTime:C}:{}),{sendingState:cu.V2NIM_MESSAGE_SENDING_STATE_SENDING,clientAntispamHit:!!h&&h.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD})},SendUtil}(),x_=entryVirtual("Array").keys,V_=Array.prototype,L_={DOMTokenList:!0,NodeList:!0},keys=function(t){var a=t.keys;return t===V_||$(V_,t)&&a===V_.keys||de(L_,Mr(t))?x_:a},D_=function(){function V2NIMClientAntispamUtilImpl(t){this.core=t}var t=V2NIMClientAntispamUtilImpl.prototype;return t.reset=function reset(t){t===fg.Destroy&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function downloadLocalAntiSpamVocabs(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t;return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.vocabInfo){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 5:t=a.sent,this.vocabInfo=qt(qt({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(2),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",a.t0);case 12:case"end":return a.stop()}}),_callee,this,[[2,9]])})))},t.checkTextAntispam=function checkTextAntispam(t,a){if(void 0===a&&(a="**"),validate({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:t,replace:a},"",!0),!this.vocabInfo)return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t};for(var c=t,m=0;m<this.vocabInfo.thesaurus.length;m++){var h=this.filterContent(c,this.vocabInfo.thesaurus[m],a);if(c=h.replacedText,h.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||h.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD)return h}return{operateType:c===t?mu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:c}},t.filterContent=function filterContent(t,a,c){for(var m=0;m<keys(a).length;m++){var h=keys(a)[m],g=h.match||a.match,I=h.operate||a.operate,M=void 0;try{M=this.matchContent(t,h.key,g,I,c)}catch(t){}if(M&&(t=M.replacedText,M.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||M.operateType===mu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD))return M}return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t}},t.matchContent=function matchContent(t,a,c,m,h){var g=!1,I="";if(1===c)indexOf(t).call(t,a)>=0&&(g=!0,I=a);else if(2===c){new RegExp(a,"g").test(t)&&(g=!0)}if(g&&""!==I)switch(m){case 1:return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t.replace(I,h)};case 2:return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD,replacedText:t};case 3:return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD,replacedText:t}}return{operateType:mu.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t}},V2NIMClientAntispamUtilImpl}();function getFileOrPath(t){var a="object"==typeof t?t:void 0,c="string"==typeof t?t:void 0;if(!a&&!c)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof c)if(0===indexOf(c).call(c,"nim-external")){var m=document.getElementById(c);if(!(m&&m.files&&m.files[0]))throw new Fu({code:Lu.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+c}});a=m.files[0]}else if("BROWSER"===_p.platform)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+c}});if("object"==typeof a&&void 0===a.size)throw new Fu({code:Lu.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:a,path:c}}var U_=function(t){function V2NIMMessageCreatorImpl(a){var c;return(c=t.call(this,"V2NIMMessageCreator",a)||this).name="V2NIMMessageCreator",c.defaultNosSceneName="nim_default_im",c.core=a,c}wt(V2NIMMessageCreatorImpl,t);var a=V2NIMMessageCreatorImpl.prototype;return a.createMessage=function createMessage(t,a){return qt(qt(qt({messageClientId:mm(),messageType:t,createTime:Ri(),sendingState:cu.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN,isSelf:!0},a),a.attachment?{attachment:qt(qt({},a.attachment),{raw:attachmentToRaw(t,a.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:qt({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},a.messageConfig),pushConfig:qt({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},a.pushConfig),routeConfig:qt({routeEnabled:!0},a.routeConfig),antispamConfig:qt({antispamEnabled:!0},a.antispamConfig)})},a.createTextMessage=function createTextMessage(t){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(iu.V2NIM_MESSAGE_TYPE_TEXT,{text:t})},a.createImageMessage=function createImageMessage(t,a,c,m,h){this.checkV2(),validate(R_,{name:a,sceneName:c,width:m,height:h},"",!0);var g=this.createGenericFileMessageAttachment(t,a,c,void 0,m,h);return this.createMessage(iu.V2NIM_MESSAGE_TYPE_IMAGE,{attachment:g,attachmentUploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createAudioMessage=function createAudioMessage(t,a,c,m){this.checkV2(),validate(A_,{name:a,sceneName:c,duration:m},"",!0);var h=this.createGenericFileMessageAttachment(t,a,c,m);return this.createMessage(iu.V2NIM_MESSAGE_TYPE_AUDIO,{attachment:h,attachmentUploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createVideoMessage=function createVideoMessage(t,a,c,m,h,g){this.checkV2(),validate(N_,{name:a,sceneName:c,duration:m,width:h,height:g},"",!0);var I=this.createGenericFileMessageAttachment(t,a,c,m,h,g);return this.createMessage(iu.V2NIM_MESSAGE_TYPE_VIDEO,{attachment:I,attachmentUploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createFileMessage=function createFileMessage(t,a,c){this.checkV2(),validate(C_,{name:a,sceneName:c},"",!0);var m=this.createGenericFileMessageAttachment(t,a,c);return this.createMessage(iu.V2NIM_MESSAGE_TYPE_FILE,{attachment:m,attachmentUploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},a.createGenericFileMessageAttachment=function createGenericFileMessageAttachment(t,a,c,m,h,g){if(c=c||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene(c))throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+c+" has not been added"}});var I=getFileOrPath(t),M=I.file,T=I.path,S=qt(qt(qt({name:a,uploadState:su.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN,sceneName:c||this.defaultNosSceneName},m?{duration:m}:{}),h?{width:h}:{}),g?{height:g}:{});if(M){var E,b=lastIndexOf(E=M.name).call(E,"."),C=-1===b?M.name:M.name.substring(0,b);S.name=S.name||C,S.size=M.size,S.ext=getFileExtension(M.name)}else if(T){var A=lastIndexOf(T).call(T,"/"),N=lastIndexOf(T).call(T,"."),R=-1===N?T.substring(A+1):T.substring(A+1,N);S.name=S.name||R,S.ext=getFileExtension(T)}return S=JSON.parse(Uc(S)),T?S.path=T:M&&(S.file=M),S},a.createLocationMessage=function createLocationMessage(t,a,c){return this.checkV2(),validate({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:t,longitude:a,address:c},"",!0),this.createMessage(iu.V2NIM_MESSAGE_TYPE_LOCATION,{attachment:{latitude:t,longitude:a,address:c}})},a.createCustomMessage=function createCustomMessage(t,a){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),validate({rawAttachment:{type:"string"}},{rawAttachment:a},"",!0),this.createMessage(iu.V2NIM_MESSAGE_TYPE_CUSTOM,{text:t,attachment:{raw:a}})},a.createCallMessage=function createCallMessage(t,a,c,m,h){return this.checkV2(),validate({type:{type:"number",allowEmpty:!1}},{type:t},"",!0),validate({channelId:{type:"string",allowEmpty:!1}},{channelId:a},"",!0),validate({status:{type:"number",allowEmpty:!1}},{status:c},"",!0),validate({durations:{type:"array",allowEmpty:!1}},{durations:m},"",!0),this.createMessage(iu.V2NIM_MESSAGE_TYPE_CALL,{text:h||"",attachment:{type:t,channelId:a,durations:m,status:c}})},a.createForwardMessage=function createForwardMessage(t){this.checkV2();var a=[iu.V2NIM_MESSAGE_TYPE_ROBOT,iu.V2NIM_MESSAGE_TYPE_NOTIFICATION,iu.V2NIM_MESSAGE_TYPE_AVCHAT,iu.V2NIM_MESSAGE_TYPE_TIPS];if(!t||includes(a).call(a,t.messageType))return null;var c={messageClientId:mm(),messageType:t.messageType};return t.text&&(c.text=t.text),t.attachment&&(c.attachment=t.attachment),t.attachment&&"uploadState"in t.attachment&&(c.attachmentUploadState=t.attachment.uploadState),this.createMessage(t.messageType,c)},a.createTipsMessage=function createTipsMessage(t){return this.checkV2(),validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(iu.V2NIM_MESSAGE_TYPE_TIPS,{text:t})},V2NIMMessageCreatorImpl}(ch),F_="V2NIMMessageExtendUtil",B_={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","33_1":"v2GetThreadMessageList"},q_={conversationType:{id:1,converter:conversationTypeV2ToV1,retConverter:conversationTypeV1ToV2,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},G_={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:conversationTypeV1ToV2},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:boolToInt,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:boolToInt,retType:"number"},updateTime:{id:10,converter:boolToInt,retType:"number"}},j_={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:boolToInt},needBadge:{id:6,access:"pushConfig.needBadge",converter:boolToInt},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},H_={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},$_={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},Y_={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function converter(t){return 0===t?2:1}},p2pAccountIds:{id:7,converter:function converter(t){return t.join(",")}},teamIds:{id:8,converter:function converter(t){return t.join(",")}},senderAccountIds:{id:9,converter:function converter(t){return t.join(",")}},messageTypes:{id:10,converter:function converter(t){return t.join(",")}},messageSubtypes:{id:11,converter:function converter(t){return t.join(",")}}},W_=qt(qt({},Y_),{conversationLimit:4}),z_={v2PinMessage:{sid:33,cid:15,service:F_,params:[{type:"Property",name:"msg",reflectMapper:Bg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:H_}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:F_,params:[{type:"Property",name:"msg",reflectMapper:Bg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:H_}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:F_,params:[{type:"Property",name:"msg",reflectMapper:Bg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:H_}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:F_,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(G_)}]},v2VoiceToText:{sid:29,cid:5,service:F_,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:F_,params:[{type:"Property",name:"message",reflectMapper:Bg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:j_}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:F_,params:[{type:"Property",name:"message",reflectMapper:Bg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:j_}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:F_,response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"quickComment",reflectMapper:invertSerializeItem(j_)}]},onRemoveQuickComment:{sid:23,cid:6,service:F_,response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"quickComment",reflectMapper:invertSerializeItem(j_)}]},v2GetQuickComment:{sid:33,cid:7,service:F_,params:[{type:"PropertyArray",name:"tag",reflectMapper:q_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(q_)}]},onPinMessage:{sid:23,cid:18,service:F_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(H_)}]},onUpdatePinMessage:{sid:23,cid:19,service:F_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(H_)}]},onUnpinMessage:{sid:23,cid:20,service:F_,response:[{type:"Property",name:"msg",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"pinInfo",reflectMapper:invertSerializeItem(H_)}]},v2AddCollection:{sid:33,cid:8,service:F_,params:[{type:"Property",name:"tag",reflectMapper:$_}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem($_)}]},v2RemoveCollections:{sid:33,cid:9,service:F_,params:[{type:"PropertyArray",name:"tag",reflectMapper:$_,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:F_,params:[{type:"Property",name:"tag",reflectMapper:$_}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem($_)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:F_,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem($_)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:F_,params:[{type:"Property",name:"tag",reflectMapper:W_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2SearchCloudMessages:{sid:30,cid:27,service:F_,params:[{type:"Property",name:"tag",reflectMapper:Y_}],response:[{type:"PropertyArray",name:"data",reflectMapper:invertSerializeItem(Bg)}]},v2GetThreadMessageList:{sid:33,cid:1,service:F_,params:[{type:"Property",name:"messageRefer",reflectMapper:Bg},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:invertSerializeItem(Bg)},{type:"Property",name:"replyResult",reflectMapper:invertSerializeItem({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:invertSerializeItem(Bg)}]}},K_=function(t){function V2NIMMessageExtendUtil(a){var c;return(c=t.call(this,"V2NIMMessageExtendService",a)||this).core=a,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:B_,cmdConfig:z_}),c)}wt(V2NIMMessageExtendUtil,t);var a=V2NIMMessageExtendUtil.prototype;return a.pinMessage=function pinMessage(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(c_,t,"message",!0),validate(m_,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2PinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:du.V2NIM_MESSAGE_PIN_STATE_PINNED,message:t,serverExtension:a,createTime:c.content.timetag,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee,this)})))},a.unpinMessage=function unpinMessage(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c;return Lc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(c_,t,"messageRefer",!0),validate(m_,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2UnpinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:du.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED,message:t,serverExtension:a,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee2,this)})))},a.updatePinMessage=function updatePinMessage(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c;return Lc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(c_,t,"message",!0),validate(m_,{serverExtension:a},"",!0),m.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:t,msgPin:{serverExtension:a}});case 5:c=m.sent,this.emitPinNotification({pinState:du.V2NIM_MESSAGE_PIN_STATE_UPDATED,message:t,serverExtension:a,updateTime:c.content.timetag,operatorId:this.core.account});case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getPinnedMessageList=function getPinnedMessageList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c,m,h,g=this;return Lc.wrap((function _callee4$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){I.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return validateConversationId(this.core.account,t),m=(m=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(t)).replace("superTeam","super_team"),I.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:m,timetag:0}});case 8:return h=I.sent,I.abrupt("return",sort(a=map$6(c=h.content.data).call(c,(function(t){return qt(qt({},t),{messageRefer:qt(qt({},t.messageRefer),{conversationId:g.core.V2NIMConversationIdUtil.messageConversationId(t.messageRefer)})})}))).call(a,(function(t,a){return a.updateTime-t.updateTime})));case 10:case"end":return I.stop()}}),_callee4,this)})))},a.addQuickComment=function addQuickComment(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var h,g;return Lc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(v_,{message:t,index:a,serverExtension:c,pushConfig:m},"",!0),I.next=4,this.core.sendCmd("v2AddQuickComment",{message:t,quickComment:{index:a,serverExtension:c,pushConfig:m}});case 4:h=I.sent,g={operationType:pu.V2NIM_QUICK_COMMENT_STATE_ADD,quickComment:{messageRefer:formatMessageRefer(this.core,t),createTime:h.content.timetag,index:a,serverExtension:c||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",g);case 7:case"end":return I.stop()}}),_callee5,this)})))},a.removeQuickComment=function removeQuickComment(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var m,h;return Lc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(c_,t,"messageRefer",!0),validate({index:{type:"number",min:1}},{index:a},"",!0),validate({serverExtension:{type:"string",required:!1}},{serverExtension:c},"",!0),g.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:t,quickComment:{index:a,serverExtension:c}});case 6:m=g.sent,h={operationType:pu.V2NIM_QUICK_COMMENT_STATE_REMOVE,quickComment:{messageRefer:formatMessageRefer(this.core,t),createTime:m.content.timetag,index:a,serverExtension:c||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",h);case 9:case"end":return g.stop()}}),_callee6,this)})))},a.getQuickCommentList=function getQuickCommentList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var a,c,m,h=this;return Lc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(y_,{messages:t},"",!0),c={},g.next=5,this.core.sendCmd("v2GetQuickComment",{tag:map$6(t).call(t,(function(t){return{messageRefer:t}}))});case 5:return m=g.sent,forEach$1(a=m.content.data).call(a,(function(t){var a,m;try{if(!t.detail)return void(c[a=t.messageRefer.messageClientId]||(c[a]=[]));var g=JSON.parse(t.detail);c[m=t.messageRefer.messageClientId]||(c[m]=[]),forEach$1(g).call(g,(function(a){c[t.messageRefer.messageClientId].push({messageRefer:qt(qt({},t.messageRefer),{conversationId:h.core.V2NIMConversationIdUtil.messageConversationId(t.messageRefer)}),operatorId:a[1],index:zp(a[2]),createTime:zp(a[3]),serverExtension:a[4]})}))}catch(a){h.logger.error("getQuickCommentList JSON Parse Error",t.detail,a)}})),g.abrupt("return",c);case 8:case"end":return g.stop()}}),_callee7,this)})))},a.voiceToText=function voiceToText(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a,c,m,h,g,I,M,T,S,E,b;return Lc.wrap((function _callee8$(C){for(;;)switch(C.prev=C.next){case 0:if(this.checkV2(),validate(g_,t,"",!0),t.voicePath||t.voiceUrl||t.file){C.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePath、voiceUrl、file cannot be empty at the same time"}});case 4:if(a=t.voicePath,c=t.file,m=t.mimeType,h=t.sampleRate,g=t.duration,I=t.sceneName,M=I?this.core.V2NIMStorageService.getStorageScene(I):null,T=t.voiceUrl){C.next=14;break}return S={},c?S.file=c:0===(null==a?void 0:indexOf(a).call(a,"nim-external"))?S.fileInput=a:S.filePath=a,C.next=12,this.core.cloudStorage.uploadFile(qt({type:"audio",nosScenes:M?M.sceneName:void 0,nosSurvivalTime:M?M.expireTime:void 0},S));case 12:E=C.sent,T=E.url;case 14:return C.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:T,mimeType:m,sampleRate:h,duration:g}});case 16:return b=C.sent,C.abrupt("return",b.content.data);case 18:case"end":return C.stop()}}),_callee8,this)})))},a.onPinMessageHandler=function onPinMessageHandler(t){return this.pinMessageChangeHandler(t,du.V2NIM_MESSAGE_PIN_STATE_PINNED)},a.onUnpinMessageHandler=function onUnpinMessageHandler(t){return this.pinMessageChangeHandler(t,du.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED)},a.onUpdatePinMessageHandler=function onUpdatePinMessageHandler(t){return this.pinMessageChangeHandler(t,du.V2NIM_MESSAGE_PIN_STATE_UPDATED)},a.pinMessageChangeHandler=function pinMessageChangeHandler(t,a){var c=t.content.msg,m=t.content.pinInfo;c.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(c),this.emitPinNotification({pinState:a,message:c,serverExtension:m.serverExtension,createTime:m.createTime,updateTime:m.updateTime,operatorId:m.accid})},a.emitPinNotification=function emitPinNotification(t){var a={pinState:t.pinState,pin:qt(qt({serverExtension:t.serverExtension||"",operatorId:t.operatorId},t.createTime?{createTime:t.createTime}:{}),{updateTime:t.updateTime,messageRefer:formatMessageRefer(this.core,t.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",a)},a.onAddQuickCommentHandler=function onAddQuickCommentHandler(t){return this.onQuickCommentNotificationHandler(t,pu.V2NIM_QUICK_COMMENT_STATE_ADD)},a.onRemoveQuickCommentHandler=function onRemoveQuickCommentHandler(t){return this.onQuickCommentNotificationHandler(t,pu.V2NIM_QUICK_COMMENT_STATE_REMOVE)},a.onQuickCommentNotificationHandler=function onQuickCommentNotificationHandler(t,a){var c={operationType:a,quickComment:qt({messageRefer:qt(qt({},t.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(t.content.message)})},t.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",c)},a.addCollection=function addCollection(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a;return Lc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(__,{params:t},"",!0),c.next=4,this.core.sendCmd("v2AddCollection",{tag:t});case 4:return a=c.sent,c.abrupt("return",a.content.data);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.removeCollections=function removeCollections(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a;return Lc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(I_,{collections:t},"",!0),c.next=4,this.core.sendCmd("v2RemoveCollections",{tag:t});case 4:return a=c.sent,c.abrupt("return",a.content.data);case 6:case"end":return c.stop()}}),_callee10,this)})))},a.updateCollectionExtension=function updateCollectionExtension(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var c;return Lc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(M_,{collection:t,serverExtension:a},"",!0),m.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:qt(qt({},t),{serverExtension:a})});case 4:return c=m.sent,m.abrupt("return",c.content.data);case 6:case"end":return m.stop()}}),_callee11,this)})))},a.getCollectionListByOption=function getCollectionListByOption(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var m,h,g,I,M;return Lc.wrap((function _callee12$(T){for(;;)switch(T.prev=T.next){case 0:if(this.checkV2(),validate(T_,t,"",!0),m=t.beginTime||0,h=t.endTime||0,!(0!==m&&0!==h&&m>h)){T.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: beginTime cannot be greater than endTime"}});case 6:if(g=void 0===t.direction?lu.V2NIM_QUERY_DIRECTION_DESC:t.direction,void 0===(null===(a=t.anchorCollection)||void 0===a?void 0:a.collectionId)){T.next=23;break}if(t.direction!==lu.V2NIM_QUERY_DIRECTION_DESC){T.next=17;break}if(0!==h){T.next=13;break}h=t.anchorCollection.createTime,T.next=15;break;case 13:if(h===t.anchorCollection.createTime){T.next=15;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 15:T.next=23;break;case 17:if(0!==m){T.next=21;break}m=t.anchorCollection.createTime,T.next=23;break;case 21:if(m===t.anchorCollection.createTime){T.next=23;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 23:return(I={beginTime:m,endTime:h,direction:g,limit:t.limit,collectionType:t.collectionType,excludeId:(null===(c=t.anchorCollection)||void 0===c?void 0:c.collectionId)?t.anchorCollection.collectionId:0}).collectionType||delete I.collectionType,T.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:I});case 27:return M=T.sent,T.abrupt("return",M.content.data);case 29:case"end":return T.stop()}}),_callee12,this)})))},a.searchCloudMessages=function searchCloudMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a,c,m,h,g,I,M,T,S=this;return Lc.wrap((function _callee13$(E){for(;;)switch(E.prev=E.next){case 0:if(this.checkV2(),validate(S_,t,"",!0),c=t.beginTime||0,m=t.endTime||0,!(0!==c&&0!==m&&c>m)){E.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return h=void 0===t.sortOrder?hu.V2NIM_SORT_ORDER_DESC:t.sortOrder,g=t.conversationLimit||0,I=t.messageLimit||10,M=g>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",E.next=12,this.core.sendCmd(M,{tag:qt(qt({},t),{beginTime:c,endTime:m,sortOrder:h,conversationLimit:g,messageLimit:I})});case 12:return T=E.sent,E.abrupt("return",map$6(a=T.content.data).call(a,(function(t){return qt(qt({},t),{conversationId:S.core.V2NIMConversationIdUtil.messageConversationId(t)})})));case 14:case"end":return E.stop()}}),_callee13,this)})))},a.getThreadMessageList=function getThreadMessageList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var a,c,m,h,g,I=this;return Lc.wrap((function _callee14$(M){for(;;)switch(M.prev=M.next){case 0:if(validate(k_,t,"getThreadMessageList",!0),t.beginTime=t.beginTime||0,!(t.endTime&&t.beginTime>t.endTime)){M.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return M.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:t.messageRefer,tag:{beginTime:t.beginTime,endTime:t.endTime,limit:t.limit,reverse:t.direction===lu.V2NIM_QUERY_DIRECTION_ASC?1:0,excludeMessageServerId:t.excludeMessageServerId}});case 6:return a=M.sent,c=a.content,m=c.message,h=c.replyResult,g=c.replyList,M.abrupt("return",{message:completeMessage(this.core,m),timestamp:h.timestamp,replyCount:h.total,replyList:map$6(g).call(g,(function(t){return completeMessage(I.core,t)}))});case 9:case"end":return M.stop()}}),_callee14,this)})))},V2NIMMessageExtendUtil}(ch),Q_=Zr.find,J_="find",X_=!0;J_ in[]&&Array(1).find((function(){X_=!1})),_export({target:"Array",proto:!0,forced:X_},{find:function find(t){return Q_(this,t,arguments.length>1?arguments[1]:void 0)}});var Z_,eI,tI,rI,nI,aI,iI=entryVirtual("Array").find,oI=Array.prototype,find=function(t){var a=t.find;return t===oI||$(oI,t)&&a===oI.find?iI:a},sI=function(t){function V2NIMMessageLogUtil(a,c){var m;return(m=t.call(this,"V2NIMMessageLogUtil",a)||this).clearHistoryMessageHandler=function(t){var a=formatClearHistoryNotification(m.core,t);m.emitClearHistoryMessage([a])},m.core=a,m.service=c,"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Jg,cmdConfig:ev}),m.setListener(),m)}wt(V2NIMMessageLogUtil,t);var a=V2NIMMessageLogUtil.prototype;return a.setListener=function setListener(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageHandler)},a.getMessageListByRefers=function getMessageListByRefers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I,M=this;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(this.checkV2(),validate(l_,{messageRefers:t},"",!0),0!==t.length){T.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(m=[],h=map$6(t).call(t,(function(t){var a=M.service.model.getMessageById(t.messageClientId);return!a&&t.messageServerId&&"0"!==t.messageServerId&&m.push(t),a})),g=[],!(m.length>0)){T.next=12;break}return T.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:m});case 10:I=T.sent,g=I.content.msgs;case 12:return T.abrupt("return",map$6(a=filter(c=map$6(h).call(h,(function(a,c){if(a)return a;var m=t[c],h=find(g).call(g,(function(t){return t.messageServerId===m.messageServerId}));return h?completeMessage(M.core,h):void 0}))).call(c,(function(t){return void 0!==t}))).call(a,(function(t){return formatMessageAttachment(t,M.core)})));case 13:case"end":return T.stop()}}),_callee,this)})))},a.getMessageList=function getMessageList(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m,h,g,I,M,T,S,E,b,C,A,N,R=this;return Lc.wrap((function _callee2$(k){for(;;)switch(k.prev=k.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){k.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(validate(s_,t,"",!0),validateConversationId(this.core.account,t.conversationId),g=this.core.V2NIMConversationIdUtil.parseConversationType(t.conversationId),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t.conversationId),M=g===Yl.V2NIM_CONVERSATION_TYPE_P2P?"v2GetMessageList":g===Yl.V2NIM_CONVERSATION_TYPE_TEAM?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",T=t.beginTime||0,S=t.endTime||0,!(0!==T&&0!==S&&T>S)){k.next=12;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(E=void 0===t.direction?lu.V2NIM_QUERY_DIRECTION_DESC:t.direction,!t.anchorMessage){k.next=29;break}if(t.direction!==lu.V2NIM_QUERY_DIRECTION_DESC){k.next=23;break}if(0!==S){k.next=19;break}S=t.anchorMessage.createTime,k.next=21;break;case 19:if(S===t.anchorMessage.createTime){k.next=21;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:k.next=29;break;case 23:if(0!==T){k.next=27;break}T=t.anchorMessage.createTime,k.next=29;break;case 27:if(T===t.anchorMessage.createTime){k.next=29;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return b=null===(a=t.anchorMessage)||void 0===a?void 0:a.messageServerId,k.next=32,this.core.sendCmd(M,{beginTime:T,endTime:S,lastMsgId:b||0,limit:t.limit||50,direction:E,msgTypes:t.messageTypes?slice(c=t.messageTypes).call(c):[],to:I});case 32:return C=k.sent,A=C.content,N=[],N=map$6(m=A.msgs).call(m,(function(t){return completeMessage(R.core,t)})),b&&(N=filter(N).call(N,(function(t){return t.messageServerId!==b}))),k.abrupt("return",map$6(h=this.getMessageListMonkeyPatch(N,t)).call(h,(function(t){return formatMessageAttachment(t,R.core)})));case 38:case"end":return k.stop()}}),_callee2,this)})))},a.getMessageListMonkeyPatch=function getMessageListMonkeyPatch(t,a){var c=a.conversationId,m=t,h=reduce(m).call(m,(function(t,a){return t[a.messageClientId]=!0,t}),{}),g=this.core.V2NIMMessageService.model.getMessagesByConversationId(c);g=sort(g).call(g,(function(t,c){return a.direction===lu.V2NIM_QUERY_DIRECTION_ASC?t.createTime-c.createTime:c.createTime-t.createTime}));var I=0,M=a.beginTime||0,T=a.endTime||0;a.anchorMessage&&(a.direction===lu.V2NIM_QUERY_DIRECTION_DESC?T=a.anchorMessage.createTime:M=a.anchorMessage.createTime,I=findIndex$1(g).call(g,(function(t){var c;return t.messageClientId===(null===(c=a.anchorMessage)||void 0===c?void 0:c.messageClientId)})),I+=1);for(var S=I;S<g.length;S++){var E,b=g[S],C=!h[b.messageClientId],A=void 0===b.sendingState||b.sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,N=b.conversationId===c,R=b.createTime>M&&(b.createTime<T||0===T),k=!a.messageTypes||includes(E=a.messageTypes).call(E,b.messageType);C&&A&&N&&R&&k&&m.push(g[S])}return m=sort(m).call(m,(function(t,c){return a.direction===lu.V2NIM_QUERY_DIRECTION_ASC?t.createTime-c.createTime:c.createTime-t.createTime})),slice(m).call(m,0,a.limit||50)},a.clearHistoryMessage=function clearHistoryMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h,g,I,M,T;return Lc.wrap((function _callee3$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validate(p_,t,"",!0),validateConversationId(this.core.account,t.conversationId),a=t.conversationId,c=t.deleteRoam,m=t.onlineSync,h=t.serverExtension,g=this.core.V2NIMConversationIdUtil.parseConversationType(a),I=this.core.V2NIMConversationIdUtil.parseConversationTargetId(a),M={deleteRoam:c,onlineSync:m,serverExtension:h,conversationType:g},g===Yl.V2NIM_CONVERSATION_TYPE_P2P?M.receiverId=I:M.teamId=I,S.next=10,this.core.sendCmd("v2ClearHistoryMessage",{tag:M});case 10:T=S.sent,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",qt(qt({},M),{deleteTime:T.content.timetag})),this.emitClearHistoryMessage([{deleteTime:T.content.timetag,serverExtension:h,conversationId:a}]);case 13:case"end":return S.stop()}}),_callee3,this)})))},a.syncClearHistoryMessageHandler=function syncClearHistoryMessageHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return formatClearHistoryNotification(c.core,t)}));this.emitClearHistoryMessage(m)},a.onClearHistoryMessageHandler=function onClearHistoryMessageHandler(t){var a=formatClearHistoryNotification(this.core,t.content.data);this.emitClearHistoryMessage([a])},a.emitClearHistoryMessage=function emitClearHistoryMessage(t){var a=this;forEach$1(t).call(t,(function(t){a.core.V2NIMMessageService.model.deleteMessages(t.conversationId,t.deleteTime)})),this.core.V2NIMMessageService.emit("onClearHistoryNotifications",t)},V2NIMMessageLogUtil}(ch);!function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(Z_||(Z_={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(eI||(eI={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(tI||(tI={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(rI||(rI={})),function(t){t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER=0]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT=1]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED=2]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED=3]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED=4]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED=5]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED=6]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED=7]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED=8]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED=9]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED=10]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE=11]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED=12]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED=13]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED=14]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED=15]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE=16]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE=17]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE=18]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE"}(nI||(nI={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(aI||(aI={})),_export({target:"Number",stat:!0},{isNaN:function isNaN(t){return t!=t}});var cI,lI=H.Number.isNaN;function formatUser(t){var a=qt({},t);return a.createTime&&(a.createTime=+a.createTime),a.updateTime&&(a.updateTime=+a.updateTime),a.gender&&(a.gender=cI[+a.gender]),a}function _createForOfIteratorHelperLoose$6(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$6(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$6(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$6(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$6(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}!function(t){t[t.unknown=0]="unknown",t[t.male=1]="male",t[t.female=2]="female"}(cI||(cI={}));var uI={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:nv,robotInfo:av,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},dI={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function getSessionId(t,a){return Hp[t.scene]+"-"+(t.to===a?t.from:t.to)}function msgFlow(t,a){return t.from===a?t.to===a?"in":"out":"in"}function formatMsg$1(t,a){var c=a.account,m=a.featureValue,h=a.statusValue,g=a.sessionAck,I=a.msgReceiptTime,M=Hp[t.scene],T=t.to===c?t.from:t.to,S=Wp.default,E=Yp.unread;zp(t.isInBlackList)>0?(E=Yp.refused,delete t.isInBlackList):E=t.from===c?I&&I>=+t.time?Yp.receipt:Yp.sent:g&&g>=+t.time?Yp.read:Yp.unread;var b=qt(qt({},format(uI,t)),{scene:M,type:jp[t.type],fromClientType:$p[t.fromClientType],flow:msgFlow(t,c),target:T,to:t.to,from:t.from,time:t.time?+t.time:void 0,userUpdateTime:t.userUpdateTime?+t.userUpdateTime:void 0,idClient:t.idClient,sessionId:M+"-"+T,status:Yp[h||E],feature:Wp[m||S]});if("string"==typeof b.attach)try{b.attach=JSON.parse(b.attach)}catch(t){}return"notification"===b.type&&(b.attach=b.attach?function formatNotificationAttach(t){var a,c={};if(c.type=dI[t.id]||t.id,!t.data)return c;var m,h={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},g=t.data;return forEach$1(a=mn(h)).call(a,(function(t){void 0!==g[t]&&(c[h[t]]=g[t])})),g.tinfo&&(c.team=formatTeam(deserialize(g.tinfo,Iv.team))),g.uinfos&&(c.users=map$6(m=g.uinfos).call(m,(function(t){return formatUser(deserialize(t,gv.user))}))),void 0!==g.mute&&(c.mute=1===zp(g.mute)),c}(b.attach):{}),b}function formatMsgs$1(t,a){return t&&t.length>0?removeDupMsgsByIdClient(map$6(t).call(t,(function(t){return formatMsg$1(t,a)}))):[]}function removeDupMsgsByIdClient(t){for(var a,c,m={},h=_createForOfIteratorHelperLoose$6(t);!(c=h()).done;){var g=c.value,I=m[g.idClient];I&&I.time>g.time||(m[g.idClient]=g)}return map$6(a=mn(m)).call(a,(function(t){return m[t]}))}function processPushInfoInMsg(t,a){void 0===a&&(a=!0);var c=qt({},t);if(c.pushInfo&&a){for(var m in c.pushInfo)"boolean"==typeof c.pushInfo[m]?c[m]=c.pushInfo[m]?1:0:c[m]=c.pushInfo[m];delete c.pushInfo}return c.scene===Hp.team&&c.needForcePush&&(c.forcePushContent=c.forcePushContent||c.pushContent,c.forcePushIDsList=c.forcePushIDsList?c.forcePushIDsList:"#%@all@%#"),c}function generatorMsgForCmd$1(t,a,c,m){t.onSendBefore,t.onUploadStart,t.onUploadDone;var h=t.replyMsg,g=__rest(t,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),I=qt(qt({},formatReverse(uI,g)),{scene:Hp[t.scene],type:jp[t.type],from:a,fromClientType:16,fromDeviceId:c,fromNick:null==m?void 0:m.nick,userUpdateTime:null==m?void 0:m.updateTime,status:Yp[Yp.sending]});if(I.idClient=I.resendFlag?t.idClient:mm(),!I.idClient)throw new Gu("idClient is required to resend a message","idClient","required");return I=processPushInfoInMsg(I,!1),h&&(I.replyMsgFromAccount=h.from,I.replyMsgToAccount=h.to,I.replyMsgTime=+h.time,I.replyMsgIdServer=h.idServer,I.replyMsgIdClient=h.idClient,I.threadMsgFromAccount=h.from,I.threadMsgToAccount=h.to,I.threadMsgTime=+h.time,I.threadMsgIdServer=h.idServer,I.threadMsgIdClient=h.idClient,h.threadMessageInfo&&h.threadMessageInfo.threadMsgIdServer&&(I.threadMsgFromAccount=h.threadMessageInfo.threadMsgFromAccount,I.threadMsgToAccount=h.threadMessageInfo.threadMsgToAccount,I.threadMsgTime=h.threadMessageInfo.threadMsgTime,I.threadMsgIdServer=h.threadMessageInfo.threadMsgIdServer,I.threadMsgIdClient=h.threadMessageInfo.threadMsgIdClient)),I}function formatDeletedMsgs(t,a){return map$6(t).call(t,(function(t){var c;return c=a||(lI(zp(t.scene))?t.scene:1===zp(t.scene)?"p2p":"team"),{deletedTime:zp(t.time),from:t.from,idClient:t.deletedIdClient||t.idClient,idServer:t.deletedIdServer||t.idServer,scene:c,time:zp(t.deletedMsgCreateTime),to:t.to,ext:"string"==typeof t.ext?t.ext:null}}))}var pI=function(){function DataStructureConverterImpl(t){this.core=t}var t=DataStructureConverterImpl.prototype;return t.messageConvertToV1=function messageConvertToV1(t){var a,c=deserialize(serialize(t,Bg),Ch(ov)),m=getSessionId(c,this.core.account),h=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:m});return formatMsg$1(c,h?{account:this.core.account,sessionAck:h.ack,msgReceiptTime:h.msgReceiptTime}:{account:this.core.account})},t.messageConvertToV2=function messageConvertToV2(t){var a=deserialize(serialize(generatorMsgForCmd$1(t,t.from,t.fromDeviceId),ov),qg);return(a=completeMessage(this.core,a)).sendingState="sending"===t.status?Z_.V2NIM_MESSAGE_SENDING_STATE_SENDING:"sendFailed"===t.status?Z_.V2NIM_MESSAGE_SENDING_STATE_FAILED:Z_.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED,a},DataStructureConverterImpl}(),mI=function(){function V2NIMMessageConverterImpl(t){this.core=t}var t=V2NIMMessageConverterImpl.prototype;return t.messageSerialization=function messageSerialization(t){if(!t)return null;var a=serialize(t,Bg);return Uc(a)},t.messageDeserialization=function messageDeserialization(t){var a,c,m,h,g,I,M,T,S,E,b,C,A,N,R,k,w,O,P,x,V,L,D;if(!t)return null;try{var U,B,q,G,j=deserialize(JSON.parse(t),qg);return j.sendingState=Z_.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN,j.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_P2P||j.senderId!==this.core.account&&j.receiverId!==this.core.account?j.conversationType===Yl.V2NIM_CONVERSATION_TYPE_TEAM?j.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(j.receiverId):j.conversationType===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM&&(j.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(j.receiverId)):j.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(j.senderId===this.core.account?j.receiverId:j.senderId),includes(U=Ci(Yl)).call(U,j.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+j.conversationType),j.senderId&&"string"!=typeof j.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+j.senderId),j.receiverId&&"string"!=typeof j.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+j.receiverId),"createTime"in j&&isNaN(j.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+j.createTime),includes(B=Ci(iu)).call(B,j.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+j.messageType),"subType"in j&&isNaN(j.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+j.subType),j.messageClientId&&"string"!=typeof j.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+j.messageClientId),j.messageServerId&&"string"!=typeof j.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+j.messageServerId),j.attachment&&"object"!=typeof j.attachment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+j.attachment),j.text&&"string"!=typeof j.text&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+j.text),j.serverExtension&&"string"!=typeof j.serverExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+j.serverExtension),j.callbackExtension&&"string"!=typeof j.callbackExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+j.callbackExtension),(null===(a=j.pushConfig)||void 0===a?void 0:a.pushContent)&&"string"!=typeof j.pushConfig.pushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+j.pushConfig.pushContent),(null===(c=j.pushConfig)||void 0===c?void 0:c.pushPayload)&&"string"!=typeof j.pushConfig.pushPayload&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+j.pushConfig.pushPayload),(null===(m=j.pushConfig)||void 0===m?void 0:m.forcePushContent)&&"string"!=typeof j.pushConfig.forcePushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+j.pushConfig.forcePushContent),(null===(h=j.pushConfig)||void 0===h?void 0:h.forcePushAccountIds)&&!jc(j.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+j.pushConfig.forcePushAccountIds),(null===(g=j.routeConfig)||void 0===g?void 0:g.routeEnvironment)&&"string"!=typeof j.routeConfig.routeEnvironment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+j.routeConfig.routeEnvironment),(null===(I=j.antispamConfig)||void 0===I?void 0:I.antispamBusinessId)&&"string"!=typeof j.antispamConfig.antispamBusinessId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+j.antispamConfig.antispamBusinessId),(null===(M=j.antispamConfig)||void 0===M?void 0:M.antispamCustomMessage)&&"string"!=typeof j.antispamConfig.antispamCustomMessage&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+j.antispamConfig.antispamCustomMessage),(null===(T=j.antispamConfig)||void 0===T?void 0:T.antispamCheating)&&"string"!=typeof j.antispamConfig.antispamCheating&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+j.antispamConfig.antispamCheating),(null===(S=j.antispamConfig)||void 0===S?void 0:S.antispamExtension)&&"string"!=typeof j.antispamConfig.antispamExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+j.antispamConfig.antispamExtension),(null===(E=j.robotConfig)||void 0===E?void 0:E.accountId)&&"string"!=typeof j.robotConfig.accountId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+j.robotConfig.accountId),(null===(b=j.robotConfig)||void 0===b?void 0:b.topic)&&"string"!=typeof j.robotConfig.topic&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+j.robotConfig.topic),(null===(C=j.robotConfig)||void 0===C?void 0:C.function)&&"string"!=typeof j.robotConfig.function&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+j.robotConfig.function),(null===(A=j.robotConfig)||void 0===A?void 0:A.customContent)&&"string"!=typeof j.robotConfig.customContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+j.robotConfig.customContent),(null===(N=j.threadRoot)||void 0===N?void 0:N.senderId)&&"string"!=typeof j.threadRoot.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+j.threadRoot.senderId),(null===(R=j.threadRoot)||void 0===R?void 0:R.receiverId)&&"string"!=typeof j.threadRoot.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+j.threadRoot.receiverId),(null===(k=j.threadRoot)||void 0===k?void 0:k.messageClientId)&&"string"!=typeof j.threadRoot.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+j.threadRoot.messageClientId),(null===(w=j.threadRoot)||void 0===w?void 0:w.messageServerId)&&"string"!=typeof j.threadRoot.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+j.threadRoot.messageServerId),j.threadRoot&&"createTime"in j.threadRoot&&isNaN(j.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+j.threadRoot.createTime),j.threadRoot&&!includes(q=Ci(Yl)).call(q,j.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+j.threadRoot.conversationType),(null===(O=j.threadRoot)||void 0===O?void 0:O.conversationId)&&"string"!=typeof j.threadRoot.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+j.threadRoot.conversationId),(null===(P=j.threadReply)||void 0===P?void 0:P.senderId)&&"string"!=typeof j.threadReply.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+j.threadReply.senderId),(null===(x=j.threadReply)||void 0===x?void 0:x.receiverId)&&"string"!=typeof j.threadReply.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+j.threadReply.receiverId),(null===(V=j.threadReply)||void 0===V?void 0:V.messageClientId)&&"string"!=typeof j.threadReply.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+j.threadReply.messageClientId),(null===(L=j.threadReply)||void 0===L?void 0:L.messageServerId)&&"string"!=typeof j.threadReply.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+j.threadReply.messageServerId),j.threadReply&&"createTime"in j.threadReply&&isNaN(j.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+j.threadReply.createTime),j.threadReply&&!includes(G=Ci(Yl)).call(G,j.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+j.threadReply.conversationType),(null===(D=j.threadReply)||void 0===D?void 0:D.conversationId)&&"string"!=typeof j.threadReply.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+j.threadReply.conversationId),delete j.__clientExt,delete j.userUpdateTime,j}catch(a){return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+t),null}},V2NIMMessageConverterImpl}(),hI=function(t){function V2NIMMessageServiceImpl(a,c){var m;return void 0===c&&(c={}),(m=t.call(this,"V2NIMMessageService",a)||this).config={compatibleWithV1:!0},m.emitRevokeMessage=function(t){var a=map$6(t).call(t,(function(t){return formatRevokeMessage(m.core,t)}));forEach$1(a).call(a,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageRevokeNotifications",a),m.core.eventBus.emit("V2NIMConversationService/revokeMessages",a)},m.sendMessageHandler=function(t){if(t.msgAckSnapshot){var a=t.msgAckSnapshot,c={conversationId:t.conversationId,messageServerId:t.messageServerId,messageClientId:t.messageClientId,readCount:0,unreadCount:Number(a)};delete t.msgAckSnapshot,m.emit("onReceiveTeamMessageReadReceipts",[c])}t=formatMessageAttachment(t,m.core),m.model.upsertMessages([t]),m.core.eventBus.emit("V2NIMConversationService/sendMessage",t,t.sendingState)},m.revokeMessagesHandler=function(t){forEach$1(t).call(t,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageRevokeNotifications",t),m.core.eventBus.emit("V2NIMConversationService/revokeMessages",t)},m.deleteMessagesHandler=function(t){forEach$1(t).call(t,(function(t){m.model.deleteMessage(t.messageRefer.messageClientId)})),m.emit("onMessageDeletedNotifications",t),m.core.eventBus.emit("V2NIMConversationService/deleteMessages",t)},m.core.V2NIMMessageCreator=new U_(m.core),m.core.V2NIMMessageLogUtil=new sI(m.core,Qe(m)),m.core.V2NIMMessageExtendUtil=new K_(m.core),m.core.V2NIMClientAntispamUtil=new D_(m.core),m.core.V2NIMMessageConverter=new mI(m.core),m.core.DataStructureConverter=new pI(m.core),m.receiptUtil=new w_(m.core,Qe(m)),m.fileUtil=new O_(m.core,Qe(m)),m.sendUtil=new P_(m.core,Qe(m)),m.model=new t_,"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:Fg,cmdConfig:Kg}),m.setOptions(c),m.setListener(),m)}wt(V2NIMMessageServiceImpl,t);var a=V2NIMMessageServiceImpl.prototype;return a.setOptions=function setOptions(t){var a;(null===(a=this.core.msg)||void 0===a?void 0:a.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=qt(this.config,t)},a.setListener=function setListener(){var t=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",this.sendMessageHandler),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",this.emitRevokeMessage),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",this.deleteMessagesHandler),this.core.eventBus.on("V2NIMConversationService/deleteConversation",(function(a){forEach$1(a).call(a,(function(a){return t.model.deleteMessages(a)}))}))},a.reset=function reset(){this.model.reset()},a.getMessageList=function getMessageList(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.getMessageList(t)},a.getMessageListByRefers=function getMessageListByRefers(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(t)},a.clearHistoryMessage=function clearHistoryMessage(t){return this.checkV2(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(t)},a.pinMessage=function pinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.pinMessage(t,a)},a.unpinMessage=function unpinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.unpinMessage(t,a)},a.updatePinMessage=function updatePinMessage(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.updatePinMessage(t,a)},a.voiceToText=function voiceToText(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.voiceToText(t)},a.getPinnedMessageList=function getPinnedMessageList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(t)},a.addQuickComment=function addQuickComment(t,a,c,m){return this.checkV2(),this.core.V2NIMMessageExtendUtil.addQuickComment(t,a,c,m)},a.removeQuickComment=function removeQuickComment(t,a,c){return this.checkV2(),this.core.V2NIMMessageExtendUtil.removeQuickComment(t,a,c)},a.getQuickCommentList=function getQuickCommentList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(t)},a.addCollection=function addCollection(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.addCollection(t)},a.removeCollections=function removeCollections(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.removeCollections(t)},a.updateCollectionExtension=function updateCollectionExtension(t,a){return this.checkV2(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(t,a)},a.getCollectionListByOption=function getCollectionListByOption(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(t)},a.searchCloudMessages=function searchCloudMessages(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(t)},a.getThreadMessageList=function getThreadMessageList(t){return this.checkV2(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(t)},a.sendP2PMessageReceipt=function sendP2PMessageReceipt(t){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(t)},a.isPeerRead=function isPeerRead(t){return this.checkV2(),this.receiptUtil.isPeerRead(t)},a.getP2PMessageReceipt=function getP2PMessageReceipt(t){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(t)},a.getTeamMessageReceipts=function getTeamMessageReceipts(t){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(t)},a.getTeamMessageReceiptDetail=function getTeamMessageReceiptDetail(t){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(t)},a.sendTeamMessageReceipts=function sendTeamMessageReceipts(t){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(t)},a.revokeMessage=function revokeMessage(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I,M,T;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(o_,{message:t,params:a},"",!0),validateConversationId(this.core.account,t.conversationId),t.conversationType!==Yl.V2NIM_CONVERSATION_TYPE_P2P||t.senderId===this.core.account){S.next=7;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 7:if(t.messageServerId&&"0"!==t.messageServerId){S.next=9;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+t.messageServerId}});case 9:return h=t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(c={})[Yl.V2NIM_CONVERSATION_TYPE_P2P]=fu.P2P_DELETE_MSG,c[Yl.V2NIM_CONVERSATION_TYPE_TEAM]=fu.TEAM_DELETE_MSG,c[Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=fu.SUPERTEAM_DELETE_MSG,g=c,I=qt(qt(qt({},t),a),{attach:a&&a.serverExtension,sysMsgType:g[t.conversationType],opeAccount:this.core.account}),S.next=14,this.core.sendCmd(h,{tag:I});case 14:(m={})[Yl.V2NIM_CONVERSATION_TYPE_P2P]=uu.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY,m[Yl.V2NIM_CONVERSATION_TYPE_TEAM]=uu.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY,m[Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=uu.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY,M=m,T=[JSON.parse(Uc({postscript:a&&a.postscript,revokeType:M[t.conversationType],revokeAccountId:this.core.account,serverExtension:a&&a.serverExtension,messageRefer:formatMessageRefer(this.core,t)}))],this.revokeMessagesHandler(T),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",I);case 18:case"end":return S.stop()}}),_callee,this)})))},a.deleteMessage=function deleteMessage(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m,h,g;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),validate(u_,t,"",!0),t.sendingState!==cu.V2NIM_MESSAGE_SENDING_STATE_SENDING){I.next=6;break}this.fileUtil.cancelMessageAttachmentUpload(t),I.next=8;break;case 6:if(!t.sendingState||t.sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){I.next=8;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 8:if(c={messageRefer:formatMessageRefer(this.core,t),serverExtension:a},m=Ri(),!t.messageServerId||"0"===t.messageServerId){I.next=15;break}return I.next=13,this.core.sendCmd("v2DeleteMessage",{tag:c});case 13:h=I.sent,m=h.content.timetag;case 15:g=[{serverExtension:a,messageRefer:formatMessageRefer(this.core,t),deleteTime:m}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[qt(qt({},c),{deleteTime:m})]),this.deleteMessagesHandler(g);case 18:case"end":return I.stop()}}),_callee2,this)})))},a.deleteMessages=function deleteMessages(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c,m,h,g,I,M,T,S,E,b,C=this;return Lc.wrap((function _callee3$(A){for(;;)switch(A.prev=A.next){case 0:if(this.checkV2(),validate(d_,{messages:t},"",!0),m=[],h=[],0!==t.length){A.next=8;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 8:g=t[0].conversationId,I=0;case 10:if(!(I<t.length)){A.next=23;break}if(t[I].sendingState!==cu.V2NIM_MESSAGE_SENDING_STATE_SENDING){A.next=15;break}this.fileUtil.cancelMessageAttachmentUpload(t[I]),A.next=17;break;case 15:if(!t[I].sendingState||t[I].sendingState===cu.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){A.next=17;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+I}});case 17:if(!(I>=1&&t[I].conversationId!==g)){A.next=19;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 19:t[I].messageServerId&&"0"!==t[I].messageServerId?m.push(t[I]):h.push(t[I]);case 20:I++,A.next=10;break;case 23:if(M=Ri(),T=concat(c=[]).call(c,h),A.prev=25,!(m.length>0)){A.next=32;break}return A.next=29,this.core.sendCmd("v2DeleteMessages",{tag:map$6(m).call(m,(function(t){return{messageRefer:t,serverExtension:a}}))});case 29:E=A.sent,M=E.content.timetag,T=concat(S=[]).call(S,T,m);case 32:A.next=41;break;case 34:if(A.prev=34,A.t0=A.catch(25),0!==h.length){A.next=40;break}throw A.t0;case 40:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 41:b=map$6(T).call(T,(function(t){return{serverExtension:a,messageRefer:formatMessageRefer(C.core,t),deleteTime:M}})),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",map$6(T).call(T,(function(t){return{messageRefer:t,serverExtension:a,deleteTime:M}}))),this.deleteMessagesHandler(b);case 44:case"end":return A.stop()}}),_callee3,this,[[25,34]])})))},a.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(t)},a.markMsgsAck=function markMsgsAck(t){var a=this;if(t&&t.length>0){var c=[],m=[];forEach$1(t).call(t,(function(t){t.senderId===a.core.account&&t.senderId!==t.receiverId||(t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_P2P?c.push(t):t.conversationType===Yl.V2NIM_CONVERSATION_TYPE_TEAM&&m.push(t))})),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:map$6(c).call(c,(function(t){return t.messageServerId}))}),m.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:map$6(m).call(m,(function(t){return t.messageServerId}))})}},a.onMsgHandler=function onMsgHandler(t){var a=t.content.msg,c=a._conversationOnlineSyncNotify,m=a._conversationOnlineSyncData,h=__rest(a,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),g=completeMessage(this.core,h),I=formatMessageAttachment(g,this.core);I.messageType!==iu.V2NIM_MESSAGE_TYPE_NOTIFICATION&&this.core.V2NIMUserService.checkUserUpdate(I,I.userUpdateTime),!this.config.compatibleWithV1&&this.sendUtil.doMsgReceiveReport(I,t),delete I.__clientExt,this.emit("onReceiveMessages",[I]),this.model.upsertMessages([I]),!this.config.compatibleWithV1&&this.markMsgsAck([I]),c&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(c),data:JSON.parse(m)}},I),I.messageType===iu.V2NIM_MESSAGE_TYPE_NOTIFICATION&&this.core.eventBus.emit("V2NIMTeamService/notification",g)},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a=this,c=t.content.data,m=0;c=map$6(c).call(c,(function(t){return t.createTime>m&&(m=t.createTime),formatMessageAttachment(completeMessage(a.core,t),a.core)})),!this.config.compatibleWithV1&&this.markMsgsAck(c),this.emit("onReceiveMessages",c),this.model.upsertMessages(c),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",map$6(c).call(c,(function(t){return t.conversationId})))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a=this,c=t.content.data;c=map$6(c).call(c,(function(t){return formatMessageAttachment(completeMessage(a.core,t),a.core)})),this.emit("onReceiveMessages",c),this.model.upsertMessages(c),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",map$6(c).call(c,(function(t){return t.conversationId})))},a.onP2PMessageReceiptsHandler=function onP2PMessageReceiptsHandler(t){this.receiptUtil.onP2PMessageReceiptsHandler(t)},a.onTeamMessageReceiptsHandler=function onTeamMessageReceiptsHandler(t){this.receiptUtil.onTeamMessageReceiptsHandler(t)},a.syncP2PMessagReceiptsHandler=function syncP2PMessagReceiptsHandler(t){this.receiptUtil.syncP2PMessagReceiptsHandler(t)},a.syncRevokeMessageHandler=function syncRevokeMessageHandler(t){this.emitRevokeMessage(t.content.datas)},a.onRevokeMessageHandler=function onRevokeMessageHandler(t){this.emitRevokeMessage([t.content.data])},a.onDeleteMessageHandler=function onDeleteMessageHandler(t){var a=t.content.data,c={serverExtension:a.serverExtension,deleteTime:a.deleteTime,messageRefer:completeMessageRefer(this.core,a.messageRefer)};this.deleteMessagesHandler([c])},a.onDeleteMessagesHandler=function onDeleteMessagesHandler(t){var a,c=this,m=map$6(a=t.content.data).call(a,(function(t){return{serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:completeMessageRefer(c.core,t.messageRefer)}}));this.deleteMessagesHandler(m)},a.syncOnDeleteMessagesHandler=function syncOnDeleteMessagesHandler(t){var a=this,c=t.content.datas,m=map$6(c).call(c,(function(t){return{serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:completeMessageRefer(a.core,t.messageRefer)}}));this.emit("onMessageDeletedNotifications",m)},a.sendMessage=function sendMessage(t,a,c,m){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var h;return Lc.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate({message:{type:"object"}},{message:t},"",!0),t.messageClientId=t.messageClientId||mm(),!t.conversationId||t.conversationId===a){g.next=5;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:return validate(i_,{conversationId:a,message:t,params:c},"",!0),validateConversationId(this.core.account,a),g.next=9,this.sendUtil.sendAndReplyMessage({message:t,conversationId:a,params:c,progress:m});case 9:return(h=g.sent).message.senderId===h.message.receiverId&&this.markMsgsAck([h.message]),g.abrupt("return",h);case 12:case"end":return g.stop()}}),_callee4,this)})))},a.replyMessage=function replyMessage(t,a,c,m){return void 0===c&&(c={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var h;return Lc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate({message:{type:"object"}},{message:t},"",!0),t.messageClientId=t.messageClientId||mm(),validate(a_,{message:t,replyMessage:a,params:c},"",!0),validateConversationId(this.core.account,a.conversationId),g.next=7,this.sendUtil.sendAndReplyMessage({message:t,conversationId:a.conversationId,params:c,progress:m,replyMessage:a});case 7:return(h=g.sent).message.senderId===h.message.receiverId&&this.markMsgsAck([h.message]),g.abrupt("return",h);case 10:case"end":return g.stop()}}),_callee5,this)})))},V2NIMMessageServiceImpl}(ch),fI={joinMode:{type:"enum",values:getEnumValues(Mu),required:!1},agreeMode:{type:"enum",values:getEnumValues(Tu),required:!1},inviteMode:{type:"enum",values:getEnumValues(Su),required:!1},updateInfoMode:{type:"enum",values:getEnumValues(Eu),required:!1},updateExtensionMode:{type:"enum",values:getEnumValues(Cu),required:!1},chatBannedMode:{type:"enum",values:[bu.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN,bu.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL],required:!1}},gI={type:"object",required:!0,rules:qt({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER]},memberLimit:{type:"number",min:1,required:!1}},fI)},vI={type:"array",min:1,itemType:"string"},yI={type:"boolean"},_I={type:"string"},MI={type:"string",allowEmpty:!1},TI={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},SI={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},EI={teamIds:{type:"array",itemType:"string",regExp:/^[1-9]\d*$/,min:1,allowEmpty:!1}},bI={teamType:{type:"enum",values:[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER]}},CI={teamTypes:{type:"array",itemType:"enum",values:[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER],required:!1}},AI={updateTeamInfoParams:{type:"object",required:!0,rules:qt({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},fI)}},NI={type:"enum",values:[Nu.V2NIM_TEAM_MEMBER_ROLE_NORMAL,Nu.V2NIM_TEAM_MEMBER_ROLE_MANAGER]},RI={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}};getEnumValues(Au);var kI,wI={chatBannedMode:{type:"enum",values:getEnumValues(bu)}},OI={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:getEnumValues(_u)},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:getEnumValues(yu),required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},PI={teamId:SI.teamId,teamType:{type:"enum",values:[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER]},operatorAccountId:{type:"string",allowEmpty:!1}},xI={actionType:{type:"enum",values:[Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION]}},VI={actionType:{type:"enum",values:[Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION]}},LI={types:{type:"array",itemType:"enum",values:getEnumValues(Ru),required:!1},status:{type:"array",itemType:"enum",values:getEnumValues(ku),required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},DI=function(){function V2NIMTeamModelImpl(){this.teamMap=new Il,this.superTeamMap=new Il}var t=V2NIMTeamModelImpl.prototype;return t.set=function set(t){var a=this;forEach$1(t).call(t,(function(t){a.chooseMap(t.teamType).set(t.teamId,t)}))},t.reset=function reset(){this.teamMap.clear(),this.superTeamMap.clear()},t.count=function count(t,a){void 0===a&&(a=!0);var c=this.chooseMap(t),count=0;return forEach$1(c).call(c,(function(t){a&&t.isValidTeam&&count++,a||count++})),count},t.chooseMap=function chooseMap(t){return t===Iu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMap:t===Iu.V2NIM_TEAM_TYPE_ADVANCED?this.teamMap:new Il},t.getById=function getById(t,a,c){void 0===c&&(c=!0);var m=this.chooseMap(a).get(t);if(m){if(c&&m.isValidTeam)return m;if(!c)return m}},t.getAll=function getAll(t,a){void 0===a&&(a=!0);var c=this.chooseMap(t),m=Yc(values(c).call(c)),h=filter(m).call(m,(function(t){return!(!a||!t.isValidTeam)||(!a||void 0)}));return sort(h).call(h,(function(t,a){return a.updateTime-t.updateTime}))},t.upsert=function upsert(t){var a=t.teamId,c=t.teamType,m=this.chooseMap(c),h=m.get(a)||{},g=qt({},h,t);return m.set(a,g),g},t.deleteById=function deleteById(t,a){var c=this.getById(t,a);if(c)return c.isValidTeam=!1,c},V2NIMTeamModelImpl}(),UI=function(){function V2NIMTeamMemberModelImpl(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var t=V2NIMTeamMemberModelImpl.prototype;return t.reset=function reset(){this.teamMembers=[],this.superTeamMembers=[]},t.setData=function setData(t){var a=this;forEach$1(t).call(t,(function(t){a.chooseList(t.teamType).push(t)}))},t.chooseList=function chooseList(t){return t===Iu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMembers:t===Iu.V2NIM_TEAM_TYPE_ADVANCED?this.teamMembers:[]},t.getById=function getById(t,a,c){var m=this.chooseList(a);return find(m).call(m,(function(a){return a.teamId===t&&a.accountId===c}))},t.upsert=function upsert(t){var a=t.teamType,c=t.teamId,m=this.chooseList(a),h=findIndex$1(m).call(m,(function(a){return a.teamId===c&&a.accountId===t.accountId}));-1===h?m.push(t):m[h]=qt(qt({},m[h]),t),m.length>this.maxSize&&m.shift()},t.deleteByAccount=function deleteByAccount(t,a,c){var m=this.chooseList(a),h=findIndex$1(m).call(m,(function(a){return a.teamId===t&&a.accountId===c}));if(-1!==h){var g=m[h];return g.inTeam=!1,splice$1(m).call(m,h,1),g}},t.deleteByTeamId=function deleteByTeamId(t,a){var c=this.chooseList(a),m=filter(c).call(c,(function(a){return a.teamId!==t}));a===Iu.V2NIM_TEAM_TYPE_SUPER?this.superTeamMembers=m:this.teamMembers=m},V2NIMTeamMemberModelImpl}(),FI=function(){function V2NIMTeamNotificationImpl(t,a){this.core=t,this.service=a}var t=V2NIMTeamNotificationImpl.prototype;return t.processNotification=function processNotification(t){var a=this,c=t.attachment,m=t.senderId,h=t.receiverId,g=c.id,I=c.data,M=g>400?Iu.V2NIM_TEAM_TYPE_SUPER:Iu.V2NIM_TEAM_TYPE_ADVANCED,T=formatTeamNotificationAttachData(I,M),S=T.id,E=T.ids,b=T.tinfo,C=T.mute,A=this.service.model.getById(h,M);switch(this.core.logger.log("v2Team::processNotification, notificationType:",g,I),g){case kI.SUPER_TEAM_INVITATION:case kI.TEAM_INVITATION:includes(E).call(E,this.core.account)&&this.onTeamJoined(b),this.onTeamMembersJoined(b,filter(E).call(E,(function(t){return t!==a.core.account})));break;case kI.SUPER_TEAM_INVITE_ACCEPT:case kI.TEAM_INVITE_ACCEPT:m===this.core.account?this.onTeamJoined(b):this.onTeamMemberJoined(b,m);break;case kI.SUPER_TEAM_APPLY_ACCEPT:case kI.TEAM_APPLY_ACCEPT:S===this.core.account?this.onTeamJoined(b):this.onTeamMemberJoined(b,S);break;case kI.SUPER_TEAM_ADD_MANAGER:case kI.TEAM_ADD_MANAGER:this.updateTeamMemberRole(h,M,E,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_MANAGER});break;case kI.SUPER_TEAM_REMOVE_MANAGER:case kI.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(h,M,E,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_NORMAL});break;case kI.SUPER_TEAM_KICK:case kI.TEAM_KICK:this.onTeamInfoUpdated(b),forEach$1(E).call(E,(function(t){t===a.core.account?a.onTeamLeft(h,M,!0):a.onTeamMemberKicked(m,b.teamId,b.teamType,t)}));break;case kI.SUPER_TEAM_LEAVE:case kI.TEAM_LEAVE:b?this.onTeamInfoUpdated(b):A&&m===this.core.account&&(A.isValidTeam=!1,this.onTeamInfoUpdated(A)),m===this.core.account?this.onTeamLeft(h,M,!1):this.onTeamMemberLeft(h,M,m);break;case kI.SUPER_TEAM_DISMISS:case kI.TEAM_DISMISS:this.onTeamDismissed(h,M);break;case kI.SUPER_TEAM_UPDATE:case kI.TEAM_UPDATED:this.onTeamInfoUpdated(b);break;case kI.SUPER_TEAM_TRANSFER_OWNER:case kI.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(b),this.updateTeamMemberRole(h,M,[m,b.ownerAccountId],[{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_NORMAL},{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_OWNER}]);break;case kI.SUPER_TEAM_MEMBER_MUTE:case kI.TEAM_MEMBER_MUTE:this.service.model.upsert(b),this.updateTeamMemberRole(h,M,S?[S]:E,{chatBanned:C!==gu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF})}},t.onTeamJoined=function onTeamJoined(t){if(this.service.model.upsert(t),this.service.emit("onTeamJoined",t),!this.service.memberModel.getById(t.teamId,t.teamType,this.core.account)){var a=t.updateTime||t.createTime,c=generateMemberByTeamId(t.teamId,t.teamType,this.core.account,{joinTime:a,updateTime:a});this.service.memberModel.upsert(c)}},t.onTeamLeft=function onTeamLeft(t,a,c){var m=this.service.model.deleteById(t,a)||generateTeamByTeamId(t,a,{isValidTeam:!1});this.service.memberModel.deleteByAccount(t,a,this.core.account),this.service.emit("onTeamLeft",m,c)},t.onTeamDismissed=function onTeamDismissed(t,a){var c=this.service.model.deleteById(t,a);c||(c=generateTeamByTeamId(t,a,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(t,a),this.service.emit("onTeamDismissed",c)},t.onTeamInfoUpdated=function onTeamInfoUpdated(t){var a=this.service.model.upsert(t);this.service.emit("onTeamInfoUpdated",a)},t.onTeamMemberJoined=function onTeamMemberJoined(t,a){this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t);var c=t.updateTime||t.createTime,m=generateMemberByTeamId(t.teamId,t.teamType,a,{joinTime:c,updateTime:c});this.service.memberModel.upsert(m),this.service.emit("onTeamMemberJoined",[m])},t.onTeamMembersJoined=function onTeamMembersJoined(t,a){var c=this,m=t.updateTime||t.createTime,h=map$6(a).call(a,(function(a){return generateMemberByTeamId(t.teamId,t.teamType,a,{joinTime:m,updateTime:m})}));0!==h.length&&(this.service.model.upsert(t),this.service.emit("onTeamInfoUpdated",t),forEach$1(h).call(h,(function(t){return c.service.memberModel.upsert(t)})),this.service.emit("onTeamMemberJoined",h))},t.onTeamMemberLeft=function onTeamMemberLeft(t,a,c){var m=this.service.memberModel.deleteByAccount(t,a,c);m||(m=generateMemberByTeamId(t,a,c,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[m])},t.onTeamMemberKicked=function onTeamMemberKicked(t,a,c,m){var h=this.service.memberModel.deleteByAccount(a,c,m);h||(h=generateMemberByTeamId(a,c,m,{inTeam:!1})),this.service.emit("onTeamMemberKicked",t,[h])},t.onTeamMemberInfoUpdated=function onTeamMemberInfoUpdated(t){var a=this;forEach$1(t).call(t,(function(t){var c;if(t.accountId===a.core.account&&(null===(c=a.core.V2NIMSettingService)||void 0===c?void 0:c.name)){var m=t.teamType===Iu.V2NIM_TEAM_TYPE_ADVANCED?a.core.V2NIMConversationIdUtil.teamConversationId(t.teamId):a.core.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),h=a.core.V2NIMSettingService.getConversationMuteStatus(m);a.core.eventBus.emit("V2NIMConversationService/setMute",m,h)}})),this.service.emit("onTeamMemberInfoUpdated",t)},t.updateTeamMemberRole=function updateTeamMemberRole(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var h,g,I,M,T=this;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(!((g=filter(c).call(c,(function(c,h){var g=T.service.memberModel.getById(t,a,c);return g&&T.service.memberModel.upsert(qt(qt({},g),jc(m)?m[h]:m)),!g}))).length>0)){S.next=12;break}return S.prev=2,S.next=5,this.service.getTeamMemberListByIds(t,a,g);case 5:I=S.sent,forEach$1(I).call(I,(function(t){return T.service.memberModel.upsert(t)})),S.next=12;break;case 9:S.prev=9,S.t0=S.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",S.t0);case 12:(M=filter(h=map$6(c).call(c,(function(c){return T.service.memberModel.getById(t,a,c)}))).call(h,(function(t){return!!t}))).length>0&&this.onTeamMemberInfoUpdated(M);case 14:case"end":return S.stop()}}),_callee,this,[[2,9]])})))},t.processSysNotification=function processSysNotification(t){var a=t.receiverId,c=t.postscript,m=t.senderId,h=t.timestamp;t.idServer;var g={actionType:{0:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION,1:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION,2:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION,3:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION,15:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION,16:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION,17:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION,18:Ru.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION}[t.type],teamId:a,teamType:t.type>=15?Iu.V2NIM_TEAM_TYPE_SUPER:Iu.V2NIM_TEAM_TYPE_ADVANCED,operatorAccountId:m,postscript:c,timestamp:h,actionStatus:ku.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT};this.core.logger.log("v2Team::processSysNotification, type:",t.type,g),this.service.notificationModel.create(g),this.service.emit("onReceiveTeamJoinActionInfo",g)},t.updateTeamActionStatus=function updateTeamActionStatus(t,a){this.service.notificationModel.update({teamId:t.teamId,teamType:t.teamType,operatorAccountId:t.operatorAccountId,actionType:t.actionType,actionStatus:a})},t.checkIfExpired=function checkIfExpired(t){return!!t&&(509===t||!(t>=500&&t<=599)&&!(t>=19e4))},V2NIMTeamNotificationImpl}();!function(t){t[t.TEAM_INVITATION=0]="TEAM_INVITATION",t[t.TEAM_KICK=1]="TEAM_KICK",t[t.TEAM_LEAVE=2]="TEAM_LEAVE",t[t.TEAM_UPDATED=3]="TEAM_UPDATED",t[t.TEAM_DISMISS=4]="TEAM_DISMISS",t[t.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",t[t.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",t[t.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",t[t.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",t[t.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",t[t.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",t[t.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",t[t.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",t[t.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",t[t.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",t[t.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",t[t.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",t[t.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",t[t.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",t[t.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",t[t.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",t[t.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(kI||(kI={}));var BI=function(){function V2NIMTeamNotificationModelImpl(){this.list=[],this.maxCount=1e3}var t=V2NIMTeamNotificationModelImpl.prototype;return t.reset=function reset(){this.list=[]},t.create=function create(t){this.list.push(t),this.list.length>this.maxCount&&this.list.shift()},t.update=function update(t){var a;forEach$1(a=this.list).call(a,(function(a){a.teamId===t.teamId&&a.teamType===t.teamType&&a.actionType===t.actionType&&a.operatorAccountId===t.operatorAccountId&&a.actionStatus===ku.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT&&qt(a,t)}))},t.getByOption=function getByOption(t){var a,c=t.types,m=t.status,h=t.offset,g=void 0===h?0:h,I=t.limit,M=void 0===I?50:I,T=[];forEach$1(a=this.list).call(a,(function(t){c&&c.length>0&&!includes(c).call(c,t.actionType)||m&&m.length>0&&!includes(m).call(m,t.actionStatus)||T.push(t)})),T=sort(T).call(T,(function(t,a){return a.timestamp-t.timestamp}));var S=0;g>0&&(S=findIndexWithinTargetValue(T,"timestamp",g),T[S]&&T[S].timestamp===g&&(S+=1));var E=slice(T).call(T,S).length;return(T=slice(T).call(T,S,S+M)).length>0?{offset:E>M?T[T.length-1].timestamp:0,finished:!(E>M),infos:T}:{offset:0,finished:!0,infos:T}},V2NIMTeamNotificationModelImpl}(),qI=function(t){function V2NIMTeamServiceImpl(a){var c;return(c=t.call(this,"V2NIMTeamService",a)||this).notification=new FI(a,Qe(c)),c.model=new DI,c.memberModel=new UI,c.notificationModel=new BI,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:wg,cmdConfig:Dg}),c.setListener(),c)}wt(V2NIMTeamServiceImpl,t);var a=V2NIMTeamServiceImpl.prototype;return a.setListener=function setListener(){var t,a,c,m=this;this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",(function(t){m.model.upsert(t);var a=generateMemberByTeamId(t.teamId,t.teamType,m.core.account,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_OWNER});m.memberModel.upsert(a),m.emit("onTeamCreated",t)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",(function(t){m.memberModel.upsert(t),m.emit("onTeamInfoUpdated",[t])})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",bind$1(t=this.notification.updateTeamActionStatus).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",bind$1(a=this.notification.processSysNotification).call(a,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",bind$1(c=this.notification.processNotification).call(c,this.notification)),this.core.eventBus.on("V2NIMTeamService/onSyncStarted",(function(){m.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",(function(){m.emit("onSyncFinished")})),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",(function(t){m.emit("onSyncFailed",t)}))},a.reset=function reset(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},a.createTeam=function createTeam(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var h,g,I,M;return Lc.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:return this.checkV2(),validate({createTeamParams:gI},{createTeamParams:t},"",!0),validate({inviteeAccountIds:qt(qt({},vI),{min:0,required:!1})},{inviteeAccountIds:a},"",!0),validate({antispamConfig:TI},{antispamConfig:m},"",!0),h=t.teamType===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamCreate":"v2TeamCreate",T.next=7,this.core.sendCmd(h,{team:t,inviteeAccountIds:a||[],postscript:c||"",antispamConfig:m});case 7:return g=T.sent,I=g.content.team,this.model.upsert(I),M=generateMemberByTeamId(I.teamId,I.teamType,this.core.account,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_OWNER}),this.memberModel.upsert(M),this.emit("onTeamCreated",I),T.abrupt("return",{team:I,failedList:g.content.failedList});case 14:case"end":return T.stop()}}),_callee,this)})))},a.updateTeamInfo=function updateTeamInfo(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var h,g;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate(AI,{updateTeamInfoParams:c},"",!0),validate({antispamConfig:TI},{antispamConfig:m},"",!0),h=qt({teamId:t,teamType:a},c),g=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",I.next=9,this.core.sendCmd(g,{team:h,antispamConfig:m});case 9:this.model.upsert(h);case 10:case"end":return I.stop()}}),_callee2,this)})))},a.leaveTeam=function leaveTeam(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c;return Lc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),c=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamLeave":"v2TeamLeave",m.next=6,this.core.sendCmd(c,{teamId:t});case 6:this.model.deleteById(t,a);case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getTeamInfo=function getTeamInfo(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var c,m,h,g;return Lc.wrap((function _callee4$(I){for(;;)switch(I.prev=I.next){case 0:if(this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),c=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(m=this.model.getById(t,a,!1))){I.next=7;break}return I.abrupt("return",m);case 7:return I.next=9,this.core.sendCmd(c,{teamId:t});case 9:return h=I.sent,g=h.content.team,this.model.upsert(g),I.abrupt("return",g);case 13:case"end":return I.stop()}}),_callee4,this)})))},a.getJoinedTeamList=function getJoinedTeamList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c=this;return Lc.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(CI,{teamTypes:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),t&&0!==t.length||(t=[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER]),a=[],forEach$1(t).call(t,(function(t){a=concat(a).call(a,c.model.getAll(t))})),m.abrupt("return",sort(a).call(a,(function(t,a){return t.createTime-a.createTime})));case 7:case"end":return m.stop()}}),_callee5,this)})))},a.getJoinedTeamCount=function getJoinedTeamCount(t){var a=this;this.checkV2(),validate(CI,{teamTypes:t},"",!0),this.core.V2NIMLoginService.checkIllegalState(),t&&0!==t.length||(t=[Iu.V2NIM_TEAM_TYPE_ADVANCED,Iu.V2NIM_TEAM_TYPE_SUPER]);var c=0;return forEach$1(t).call(t,(function(t){c+=a.model.count(t)})),c},a.getTeamInfoByIds=function getTeamInfoByIds(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var c,m,h,g,I,M,T=this;return Lc.wrap((function _callee6$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(EI,{teamIds:t},"",!0),validate(bI,{teamType:a},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetByIds":"v2TeamGetByIds",h=map$6(t).call(t,(function(t){return T.model.getById(t,a,!1)})),0!==(g=filter(t).call(t,(function(t,a){return!h[a]}))).length){S.next=8;break}return S.abrupt("return",h);case 8:return S.next=10,this.core.sendCmd(m,{teamIds:g});case 10:return I=S.sent,M=I.content.teams,S.abrupt("return",filter(c=map$6(h).call(h,(function(a,c){if(a)return a;var m=t[c],h=find(M).call(M,(function(t){return t.teamId===m}));return h&&T.model.upsert(h),h}))).call(c,(function(t){return!!t})));case 13:case"end":return S.stop()}}),_callee6,this)})))},a.dismissTeam=function dismissTeam(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var c;return Lc.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),c=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamDismiss":"v2TeamDismiss",m.next=6,this.core.sendCmd(c,{teamId:t});case 6:case"end":return m.stop()}}),_callee7,this)})))},a.inviteMember=function inviteMember(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var h,g;return Lc.wrap((function _callee8$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({inviteeAccountIds:vI},{inviteeAccountIds:c},"",!0),validate({postscript:qt(qt({},_I),{required:!1})},{postscript:m},"",!0),h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",I.next=8,this.core.sendCmd(h,{teamId:t,accounts:c,ps:m||""});case 8:return g=I.sent,I.abrupt("return",g.content.abortedAccidList);case 10:case"end":return I.stop()}}),_callee8,this)})))},a.acceptInvitation=function acceptInvitation(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a,c,m,h,g,I;return Lc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(PI,t,"invitationInfo",!0),validate(xI,t,"invitationInfo",!0),a=t.teamType,c=t.teamId,m=t.operatorAccountId,h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",M.prev=5,M.next=8,this.core.sendCmd(h,{teamId:c,from:m});case 8:return g=M.sent,this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED),M.abrupt("return",g.content.team);case 13:throw M.prev=13,M.t0=M.catch(5),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 18:case"end":return M.stop()}}),_callee9,this,[[5,13]])})))},a.rejectInvitation=function rejectInvitation(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var c,m,h,g,I;return Lc.wrap((function _callee10$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(PI,t,"invitationInfo",!0),validate(xI,t,"invitationInfo",!0),validate({postscript:qt(qt({},_I),{required:!1})},{postscript:a},"",!0),c=t.teamType,m=t.teamId,h=t.operatorAccountId,g=c===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",M.prev=6,M.next=9,this.core.sendCmd(g,{teamId:m,from:h,ps:a||""});case 9:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED),M.next=17;break;case 12:throw M.prev=12,M.t0=M.catch(6),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 17:case"end":return M.stop()}}),_callee10,this,[[6,12]])})))},a.kickMember=function kickMember(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var m;return Lc.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({memberAccountIds:vI},{memberAccountIds:c},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamKickMembers":"v2TeamKickMembers",h.next=7,this.core.sendCmd(m,{teamId:t,accounts:c});case 7:case"end":return h.stop()}}),_callee11,this)})))},a.applyJoinTeam=function applyJoinTeam(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var m,h;return Lc.wrap((function _callee12$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",g.next=6,this.core.sendCmd(m,{teamId:t,ps:c||""});case 6:return h=g.sent,g.abrupt("return",h.content.team);case 8:case"end":return g.stop()}}),_callee12,this)})))},a.acceptJoinApplication=function acceptJoinApplication(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a,c,m,h,g;return Lc.wrap((function _callee13$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate(PI,t,"applicationInfo",!0),validate(VI,t,"applicationInfo",!0),a=t.teamType,c=t.teamId,m=t.operatorAccountId,h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",I.prev=5,I.next=8,this.core.sendCmd(h,{teamId:c,from:m});case 8:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED),I.next=16;break;case 11:throw I.prev=11,I.t0=I.catch(5),g=I.t0,this.notification.checkIfExpired(g.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),I.t0;case 16:case"end":return I.stop()}}),_callee13,this,[[5,11]])})))},a.rejectJoinApplication=function rejectJoinApplication(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var c,m,h,g,I;return Lc.wrap((function _callee14$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(PI,t,"applicationInfo",!0),validate(VI,t,"applicationInfo",!0),validate({postscript:qt(qt({},_I),{required:!1})},{postscript:a},"",!0),c=t.teamType,m=t.teamId,h=t.operatorAccountId,g=c===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",M.prev=6,M.next=9,this.core.sendCmd(g,{teamId:m,from:h,ps:a||""});case 9:this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED),M.next=17;break;case 12:throw M.prev=12,M.t0=M.catch(6),I=M.t0,this.notification.checkIfExpired(I.code)&&this.notification.updateTeamActionStatus(t,ku.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED),M.t0;case 17:case"end":return M.stop()}}),_callee14,this,[[6,12]])})))},a.updateTeamMemberRole=function updateTeamMemberRole(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){var h;return Lc.wrap((function _callee15$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({memberAccountIds:vI},{memberAccountIds:c},"",!0),validate({memberRole:NI},{memberRole:m},"",!0),h=m===Nu.V2NIM_TEAM_MEMBER_ROLE_MANAGER?"AddManagers":"RemoveManagers",h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeam"+h:"v2Team"+h,g.next=9,this.core.sendCmd(h,{teamId:t,accounts:c});case 9:case"end":return g.stop()}}),_callee15,this)})))},a.transferTeamOwner=function transferTeamOwner(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var h;return Lc.wrap((function _callee16$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({accountId:MI},{accountId:c},"",!0),validate({leave:{type:"boolean",required:!1}},{leave:m},"",!0),h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",g.next=8,this.core.sendCmd(h,{teamId:t,account:c,leave:m||!1});case 8:case"end":return g.stop()}}),_callee16,this)})))},a.updateSelfTeamMemberInfo=function updateSelfTeamMemberInfo(t,a,c){var m;return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){var h,g,I,M,T;return Lc.wrap((function _callee17$(S){for(;;)switch(S.prev=S.next){case 0:if(this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate(RI,{memberInfoParams:c},"",!0),void 0!==c.teamNick||void 0!==c.serverExtension){S.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",g=qt(qt({},c),{teamId:t,accountId:this.core.account}),S.next=10,this.core.sendCmd(h,{teamMember:g});case 10:return S.next=12,this.notification.updateTeamMemberRole(t,a,[this.core.account],g);case 12:I=this.memberModel.getById(t,a,this.core.account),(null===(m=this.core.V2NIMSettingService)||void 0===m?void 0:m.name)&&(M=a===Iu.V2NIM_TEAM_TYPE_ADVANCED?this.core.V2NIMConversationIdUtil.teamConversationId(t):this.core.V2NIMConversationIdUtil.superTeamConversationId(t),T=this.core.V2NIMSettingService.getConversationMuteStatus(M),this.core.eventBus.emit("V2NIMConversationService/setMute",M,T)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",I);case 15:case"end":return S.stop()}}),_callee17,this)})))},a.updateTeamMemberNick=function updateTeamMemberNick(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){var h;return Lc.wrap((function _callee18$(g){for(;;)switch(g.prev=g.next){case 0:if(this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({accountId:MI},{accountId:c},"",!0),validate({nick:_I},{nick:m},"",!0),c!==this.core.account){g.next=7;break}return g.abrupt("return",this.updateSelfTeamMemberInfo(t,a,{teamNick:m}));case 7:return h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",g.next=10,this.core.sendCmd(h,{teamMember:{teamNick:m,teamId:t,accountId:c}});case 10:case"end":return g.stop()}}),_callee18,this)})))},a.setTeamChatBannedMode=function setTeamChatBannedMode(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var m;return Lc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate(wI,{chatBannedMode:c},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",h.next=7,this.core.sendCmd(m,{teamId:t,chatBannedMode:c});case 7:this.model.upsert({teamId:t,teamType:a,chatBannedMode:c});case 8:case"end":return h.stop()}}),_callee19,this)})))},a.setTeamMemberChatBannedStatus=function setTeamMemberChatBannedStatus(t,a,c,m){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){var h;return Lc.wrap((function _callee20$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({accountId:MI},{accountId:c},"",!0),validate({chatBanned:yI},{chatBanned:m},"",!0),h=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",g.next=8,this.core.sendCmd(h,{teamId:t,accountId:a===Iu.V2NIM_TEAM_TYPE_SUPER?[c]:c,chatBanned:m?1:0});case 8:case"end":return g.stop()}}),_callee20,this)})))},a.getTeamMemberList=function getTeamMemberList(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var m,h;return Lc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate(OI,{queryOption:c},"",!0),m=(m=void 0===c.direction?yu.V2NIM_QUERY_DIRECTION_DESC:c.direction)===yu.V2NIM_QUERY_DIRECTION_DESC?1:0,g.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:qt(qt({teamId:t,teamType:a,onlyChatBanned:!1,nextToken:"",limit:100},c),{direction:m})});case 8:return h=g.sent,g.abrupt("return",{nextToken:h.content.pageInfo.nextToken||"",finished:!+h.content.pageInfo.hasMore,memberList:processTeamMembers(h.content.datas,a)});case 10:case"end":return g.stop()}}),_callee21,this)})))},a.getTeamMemberListByIds=function getTeamMemberListByIds(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var m,h,g,I,M,T,S,E=this;return Lc.wrap((function _callee22$(b){for(;;)switch(b.prev=b.next){case 0:this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({accountIds:vI},{accountIds:c},"",!0),g=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",I=map$6(m=filter(c).call(c,(function(c){return!E.memberModel.getById(t,a,c)}))).call(m,(function(a){return t+"|"+a})),M=0;case 7:if(!(M<I.length)){b.next=16;break}return b.next=10,this.core.sendCmd(g,{tag:slice(I).call(I,M,M+20)});case 10:T=b.sent,S=processTeamMembers(T.content.datas,a),forEach$1(S).call(S,(function(t){return E.memberModel.upsert(t)}));case 13:M+=20,b.next=7;break;case 16:return b.abrupt("return",filter(h=map$6(c).call(c,(function(c){return E.memberModel.getById(t,a,c)}))).call(h,(function(t){return!!t})));case 17:case"end":return b.stop()}}),_callee22,this)})))},a.getTeamMemberInvitor=function getTeamMemberInvitor(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){var m,h;return Lc.wrap((function _callee23$(g){for(;;)switch(g.prev=g.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate({accountIds:vI},{accountIds:c},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",g.next=7,this.core.sendCmd(m,{teamId:t,accounts:c});case 7:return h=g.sent,g.abrupt("return",h.content.accountsMap);case 9:case"end":return g.stop()}}),_callee23,this)})))},a.getTeamJoinActionInfoList=function getTeamJoinActionInfoList(t){return this.checkV2(),validate(LI,t,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),Mi.resolve(this.notificationModel.getByOption(t))},a.v2TeamSyncHandler=function v2TeamSyncHandler(t){this.model.set(t.content.datas)},a.v2SuperTeamSyncHandler=function v2SuperTeamSyncHandler(t){this.model.set(t.content.datas)},a.v2TeamCreateMultiSyncHandler=function v2TeamCreateMultiSyncHandler(t){var a=t.content.data;this.model.upsert(a);var c=generateMemberByTeamId(a.teamId,a.teamType,this.core.account,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_OWNER});this.memberModel.upsert(c),this.emit("onTeamCreated",a)},a.v2SuperTeamCreateMultiSyncHandler=function v2SuperTeamCreateMultiSyncHandler(t){var a=t.content.data;this.model.upsert(a);var c=generateMemberByTeamId(a.teamId,a.teamType,this.core.account,{memberRole:Nu.V2NIM_TEAM_MEMBER_ROLE_OWNER});this.memberModel.upsert(c),this.emit("onTeamCreated",a)},a.v2TeamMemberUpdateMultiSyncHandler=function v2TeamMemberUpdateMultiSyncHandler(t){var a=t.content.data;a.teamType=Iu.V2NIM_TEAM_TYPE_ADVANCED;var c=this.memberModel.getById(a.teamId,a.teamType,a.accountId);this.notification.updateTeamMemberRole(a.teamId,a.teamType,[a.accountId],a),a.accountId===this.core.account&&c&&c.bits!==a.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",a.teamId,a.teamType,a.bits)},a.v2SuperTeamMemberUpdateMultiSyncHandler=function v2SuperTeamMemberUpdateMultiSyncHandler(t){var a=t.content.data;a.teamType=Iu.V2NIM_TEAM_TYPE_SUPER;var c=this.memberModel.getById(a.teamId,a.teamType,a.accountId);this.notification.updateTeamMemberRole(a.teamId,a.teamType,[a.accountId],a),a.accountId===this.core.account&&c&&c.bits!==a.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",a.teamId,a.teamType,a.bits)},a.v2TeamMembersOfSelfInSyncHandler=function v2TeamMembersOfSelfInSyncHandler(t){var a=t.content.datas;forEach$1(a).call(a,(function(t){t.teamType=Iu.V2NIM_TEAM_TYPE_ADVANCED})),this.memberModel.setData(a)},a.v2SuperTeamMembersOfSelfInSyncHandler=function v2SuperTeamMembersOfSelfInSyncHandler(t){var a=t.content.datas;forEach$1(a).call(a,(function(t){t.teamType=Iu.V2NIM_TEAM_TYPE_SUPER})),this.memberModel.setData(a)},V2NIMTeamServiceImpl}(ch);collection("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),cl);var GI=H.Set;_export({target:"Set",stat:!0,forced:!0},{from:dl}),_export({target:"Set",stat:!0,forced:!0},{of:pl});_export({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function addAll(){for(var t=anObject(this),a=aCallable(t.add),c=0,m=arguments.length;c<m;c++)w(a,t,arguments[c]);return t}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:ml});var jI=getIterator;_export({target:"Set",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=jI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c){if(!m(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{difference:function difference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),m=aCallable(c.delete);return iterate(t,(function(t){w(m,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=jI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(h.add);return iterate(c,(function(t){m(t,t,a)&&w(g,h,t)}),{IS_ITERATOR:!0}),h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=jI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(m(t,t,a))return c(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function intersection(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set"))),m=aCallable(a.has),h=aCallable(c.add);return iterate(t,(function(t){w(m,a,t)&&w(h,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function isDisjointFrom(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,m){if(!0===w(c,a,t))return m()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function isSubsetOf(t){var a=getIterator(this),c=anObject(t),m=c.has;return isCallable(m)||(c=new(getBuiltIn("Set"))(t),m=aCallable(c.has)),!iterate(a,(function(t,a){if(!1===w(m,c,t))return a()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function isSupersetOf(t){var a=anObject(this),c=aCallable(a.has);return!iterate(t,(function(t,m){if(!1===w(c,a,t))return m()}),{INTERRUPTED:!0}).stopped}});var HI=N([].join),$I=[].push;_export({target:"Set",proto:!0,real:!0,forced:!0},{join:function join(t){var a=anObject(this),c=jI(a),m=void 0===t?",":toString$1(t),h=[];return iterate(c,$I,{that:h,IS_ITERATOR:!0}),HI(h,m)}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function map(t){var a=anObject(this),c=jI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),g=aCallable(h.add);return iterate(c,(function(t){w(g,h,m(t,t,a))}),{IS_ITERATOR:!0}),h}});var YI=TypeError;_export({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=jI(a),m=arguments.length<2,h=m?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c){m?(m=!1,h=c):h=t(h,c,c,a)}),{IS_ITERATOR:!0}),m)throw YI("Reduce of empty set with no initial value");return h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=jI(a),m=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c){if(m(t,t,a))return c()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function symmetricDifference(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a),m=aCallable(c.delete),h=aCallable(c.add);return iterate(t,(function(t){w(m,c,t)||w(h,c,t)})),c}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{union:function union(t){var a=anObject(this),c=new(speciesConstructor(a,getBuiltIn("Set")))(a);return iterate(t,aCallable(c.add),{that:c}),c}});var WI=GI,zI=function(){function V2NIMUserModelImpl(){this.muteList=new WI,this.userMap=new Il,this.blockList=[]}var t=V2NIMUserModelImpl.prototype;return t.reset=function reset(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},t.setAccountMuteMode=function setAccountMuteMode(t,a){a===vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON?this.muteList.add(t):this.muteList.delete(t)},t.setUser=function setUser(t){this.userMap.set(t.accountId,t)},t.getUser=function getUser(t){return this.userMap.get(t)},t.getUserListBySearchOption=function getUserListBySearchOption(t){var a,c;return filter(a=Yc(values(c=this.userMap).call(c))).call(a,(function(a){var c,m,h;return!(void 0!==t.searchName&&!t.searchName||!includes(c=a.name).call(c,t.keyword))||(!(!t.searchAccountId||!includes(m=a.accountId).call(m,t.keyword))||!!(a.mobile&&t.searchMobile&&includes(h=a.mobile).call(h,t.keyword)))}))},t.addToBlockList=function addToBlockList(t){var a=this;forEach$1(t).call(t,(function(t){var c;includes(c=a.blockList).call(c,t)||a.blockList.push(t)}))},t.removeFromBlockList=function removeFromBlockList(t){var a=this;forEach$1(t).call(t,(function(t){var c,m,h=indexOf(c=a.blockList).call(c,t);-1!==h&&splice$1(m=a.blockList).call(m,h,1)}))},V2NIMUserModelImpl}(),KI={type:"string",required:!0,allowEmpty:!1},QI={type:"string",required:!1,allowEmpty:!0},JI={name:{type:"string",required:!1,allowEmpty:!0},avatar:QI,sign:QI,email:QI,birthday:QI,mobile:QI,gender:{type:"number",required:!1},serverExtension:QI};function _createForOfIteratorHelperLoose$5(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$5(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$5(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$5(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$5(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var XI=function(t){function V2NIMUserServiceImpl(a){var c;return c=t.call(this,"V2NIMUserService",a)||this,registerParser({cmdMap:Av,cmdConfig:Rv}),c.model=new zI,"v2"!==c.core.options.apiVersion?Qe(c):(c.setListener(),c)}wt(V2NIMUserServiceImpl,t);var a=V2NIMUserServiceImpl.prototype;return a.reset=function reset(){this.model.reset()},a.setListener=function setListener(){var t=this;this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(function(a,c){c?t.model.addToBlockList([a]):t.model.removeFromBlockList([a]),c?t.emitBlockListAdded(a):t.emit("onBlockListRemoved",a)})),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",(function(a){t.updateUserProfileInMemory(a)}))},a.getUserList=function getUserList(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I=this;return Lc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:if(this.checkV2(),validate({accountIds:vI},{accountIds:t},"",!0),c=[],forEach$1(t).call(t,(function(t){I.model.getUser(t)||c.push(t)})),m=null,!(c.length>0)){M.next=9;break}return M.next=8,this.core.sendCmd("v2GetUserList",{accountIds:c});case 8:m=M.sent;case 9:return h=(null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.data)||[],forEach$1(h).call(h,(function(t){I.model.setUser(t)})),g=[],forEach$1(t).call(t,(function(t){var a=I.model.getUser(t);a&&g.push(a)})),M.abrupt("return",g);case 14:case"end":return M.stop()}}),_callee,this)})))},a.getUserListFromCloud=function getUserListFromCloud(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g=this;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return this.checkV2(),validate({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:t},"",!0),I.next=4,this.core.sendCmd("v2GetUserList",{accountIds:t});case 4:return a=I.sent,c=a.content.data||[],m=[],forEach$1(c).call(c,(function(t){var a=g.model.getUser(t.accountId);g.compareUserForUpdate(a,t)&&m.push(t),g.model.setUser(t)})),h=reduce(t).call(t,(function(t,a){var c=g.model.getUser(a);return c&&t.push(c),t}),[]),m.length>0&&this.emit("onUserProfileChanged",m),I.abrupt("return",h);case 11:case"end":return I.stop()}}),_callee2,this)})))},a.compareUserForUpdate=function compareUserForUpdate(t,a){return!t||!("number"==typeof t.updateTime&&"number"==typeof a.updateTime&&t.updateTime>=a.updateTime)},a.updateSelfUserProfile=function updateSelfUserProfile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(JI,t,"",!0),c.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:qt(qt({},t),{accountId:this.core.account})});case 4:return a=c.sent,c.next=7,this.updateUserProfileInMemory(qt({updateTime:a.content.updateTime},t));case 7:case"end":return c.stop()}}),_callee3,this)})))},a.addUserToBlockList=function addUserToBlockList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),t!==this.core.account){a.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return validate({accountId:KI},{accountId:t},"",!0),a.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:t,addToBlockList:!0});case 6:this.model.addToBlockList([t]),this.emitBlockListAdded(t);case 8:case"end":return a.stop()}}),_callee4,this)})))},a.removeUserFromBlockList=function removeUserFromBlockList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),t!==this.core.account){a.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return validate({accountId:KI},{accountId:t},"",!0),a.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:t,addToBlockList:!1});case 6:this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t);case 8:case"end":return a.stop()}}),_callee5,this)})))},a.searchUserByOption=function searchUserByOption(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},t,"",!0),!1!==(void 0===t.searchName||t.searchName)||t.searchAccountId||t.searchMobile){a.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return a.abrupt("return",this.model.getUserListBySearchOption(t));case 7:case"end":return a.stop()}}),_callee6,this)})))},a.getBlockList=function getBlockList(){return this.checkV2(),Mi.resolve(this.model.blockList)},a.updateUserProfileInMemory=function updateUserProfileInMemory(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var a,c;return Lc.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:if(!(a=this.model.getUser(this.core.account))){m.next=6;break}qt(a,t),this.model.setUser(a),m.next=10;break;case 6:return m.next=8,this.getUserList([this.core.account]);case 8:c=m.sent,a=c[0];case 10:a&&this.emit("onUserProfileChanged",[a]);case 11:case"end":return m.stop()}}),_callee7,this)})))},a.onUpdateUserProfileHandler=function onUpdateUserProfileHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return a=t.content.data,c.next=3,this.updateUserProfileInMemory(a);case 3:case"end":return c.stop()}}),_callee8,this)})))},a.onUpdateBlockListHandler=function onUpdateBlockListHandler(t){var a=t.content.accountId;t.content.addToBlockList?(this.model.addToBlockList([a]),this.emitBlockListAdded(a)):(this.model.removeFromBlockList([a]),this.emit("onBlockListRemoved",a))},a.syncBlockAndMuteListHandler=function syncBlockAndMuteListHandler(t){var a=this,c=t.content.data;forEach$1(c).call(c,(function(t){t.isBlock?a.model.addToBlockList([t.accountId]):a.model.setAccountMuteMode(t.accountId,t.isMute?vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:vu.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF)}))},a.v2SyncSelfUserInfoHandler=function v2SyncSelfUserInfoHandler(t){var a=t.content.user;this.model.setUser(a)},a.checkUserUpdate=function checkUserUpdate(t,a){var c=t.senderId;if(c!==this.core.account){var m=this.model.getUser(c);if(m){var h=m.updateTime;"number"==typeof h&&"number"==typeof a&&!isNaN(h)&&!isNaN(a)&&h<a&&this.refreshUserInfo(c)}else this.refreshUserInfo(c)}},a.refreshUserInfo=function refreshUserInfo(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var c,m,h,g,I;return Lc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.core.sendCmd("v2GetUserList",{accountIds:[t]});case 2:for(c=M.sent,m=(null===(a=null==c?void 0:c.content)||void 0===a?void 0:a.data)||[],h=_createForOfIteratorHelperLoose$5(m);!(g=h()).done;)I=g.value,this.model.setUser(I),this.emit("onUserProfileChanged",[I]);case 5:case"end":return M.stop()}}),_callee9,this)})))},a.emitBlockListAdded=function emitBlockListAdded(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a;return Lc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.getUserList([t]);case 2:1===(a=c.sent).length&&this.emit("onBlockListAdded",a[0]);case 4:case"end":return c.stop()}}),_callee10,this)})))},a.v2OnUpdateMuteListHandler=function v2OnUpdateMuteListHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var a,c,m,h;return Lc.wrap((function _callee11$(g){for(;;)switch(g.prev=g.next){case 0:a=t.content,c=a.accountId,m=a.mute,h=m?vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:vu.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF,this.core.eventBus.emit("v2NIMUserService/updateMuteList",c,h);case 3:case"end":return g.stop()}}),_callee11,this)})))},V2NIMUserServiceImpl}(ch),ZI="V2NIMFriendService",eM={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},tM={accountId:4,source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},rM={v2AddFriend:{sid:35,cid:1,service:ZI,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:ZI,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:boolToInt}}}]},v2SetFriendInfo:{sid:35,cid:3,service:ZI,params:[{type:"Property",name:"tag",reflectMapper:tM}]},v2OnAddFriend:{sid:12,cid:101,service:ZI,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:invertSerializeItem({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:ZI,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:ZI,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(tM)}]},v2SyncFriendList:{sid:12,cid:5,service:ZI,response:[{type:"PropertyArray",name:"friends",reflectMapper:invertSerializeItem(tM)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:ZI,response:[{type:"PropertyArray",name:"users",reflectMapper:invertSerializeItem(Nv)}]},v2IncFriendInfo:{sid:35,cid:4,service:ZI,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:invertSerializeItem(tM)},{type:"Long",name:"timetag"}]}},nM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:getEnumValues(zl)},postscript:{type:"string",required:!1,allowEmpty:!0}}}},aM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},iM={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},oM={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!0,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:getEnumValues(Ql)},timestamp:{type:"number",required:!1}},sM={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:getEnumValues(Ql)}},cM=function(){function V2NIMFriendNotificationImpl(t,a){this.core=t,this.service=a}return V2NIMFriendNotificationImpl.prototype.processSysNotification=function processSysNotification(t){if(6===t.type){var a=t.senderId;this.core.V2NIMFriendService.handleDeleteFriend(a,Jl.V2NIM_FRIEND_DELETION_TYPE_BY_PEER)}else if(5===t.type)try{var c=JSON.parse(t.content);if((null==c?void 0:c.vt)===Xl.V2NIM_FRIEND_VERIFY_TYPE_ADD){this.core.V2NIMFriendService.handleAddFriend(t.senderId,t.timestamp);var m={applicantAccountId:t.senderId,recipientAccountId:t.receiverId,operatorAccountId:t.senderId,postscript:t.postscript,timestamp:t.timestamp,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD,read:!0};this.service.model.appendFriendAddApplication(m),this.service.model.updateFriendAddApplicationStatus(m.applicantAccountId,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD,m.applicantAccountId)}else if((null==c?void 0:c.vt)===Xl.V2NIM_FRIEND_VERIFY_TYPE_APPLY){var h={applicantAccountId:t.senderId,recipientAccountId:t.receiverId,operatorAccountId:t.senderId,postscript:t.postscript,timestamp:t.timestamp,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT,read:!1};this.service.handleApplyFriend(h),this.core.V2NIMFriendService.model.appendFriendAddApplication(h)}else if((null==c?void 0:c.vt)===Xl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT){this.core.V2NIMFriendService.handleAddFriend(t.senderId,t.timestamp);var g={applicantAccountId:t.receiverId,recipientAccountId:t.senderId,operatorAccountId:t.senderId,timestamp:t.timestamp,postscript:t.postscript,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,read:!0};this.core.V2NIMFriendService.model.appendFriendAddApplication(g)}else if((null==c?void 0:c.vt)===Xl.V2NIM_FRIEND_VERIFY_TYPE_REJECT){var I={applicantAccountId:t.receiverId,recipientAccountId:t.senderId,operatorAccountId:t.senderId,timestamp:t.timestamp,postscript:t.postscript,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,read:!0};this.core.V2NIMFriendService.model.appendFriendAddApplication(I),this.service.emit("onFriendAddRejected",I)}}catch(t){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",t)}},V2NIMFriendNotificationImpl}();function _createForOfIteratorHelperLoose$4(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$4(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$4(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$4(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$4(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var lM=function(){function V2NIMFriendModelImpl(){this.validFriendIds=new WI,this.friendMap=new Il,this.applicationInfoList=[],this.friendTimetag=0}var t=V2NIMFriendModelImpl.prototype;return t.getAddApplicationList=function getAddApplicationList(t){var a,c,m=void 0===t.offset||0===t.offset?Ot:t.offset,h=filter(a=this.applicationInfoList).call(a,(function(a){if(a.timestamp>=m)return!1;var c=t.status||[];return 0===c.length||!!includes(c).call(c,a.status)})),g=t.limit||50,I=Math.min(g,h.length),M=slice(c=reverse$1(h).call(h)).call(c,0,I),T=m;return M.length>0&&(T=M[M.length-1].timestamp),{infos:M,finished:I>=h.length,offset:I>=h.length?0:T}},t.reset=function reset(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},t.setAddApplicationRead=function setAddApplicationRead(){for(var t,a=_createForOfIteratorHelperLoose$4(this.applicationInfoList);!(t=a()).done;){t.value.read=!0}},t.getAddApplicationUnreadCount=function getAddApplicationUnreadCount(){for(var t,a=new WI,c=_createForOfIteratorHelperLoose$4(this.applicationInfoList);!(t=c()).done;){var m=t.value;m.read||m.status!==Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT||a.add(m.applicantAccountId)}return a.size},t.appendFriendAddApplication=function appendFriendAddApplication(t){this.applicationInfoList.push(t)},t.updateFriendAddApplicationStatus=function updateFriendAddApplicationStatus(t,a,c){if(a!==Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT)for(var m,h=_createForOfIteratorHelperLoose$4(this.applicationInfoList);!(m=h()).done;){var g=m.value;g.applicantAccountId===t&&g.status===Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT&&(g.status=a,g.operatorAccountId=c,g.read=!0)}},t.upsertFriend=function upsertFriend(t,a){var c=this.friendMap.get(t)||{},m=qt({accountId:t},c,a);return this.friendMap.set(t,m),this.validFriendIds.add(t),m},t.addFriend=function addFriend(t){this.validFriendIds.add(t)},t.deleteFriend=function deleteFriend(t){this.validFriendIds.delete(t)},t.getFriend=function getFriend(t){return this.validFriendIds.has(t)?this.friendMap.get(t):void 0},t.getFriendList=function getFriendList(){var t,a,c,m=this;return filter(t=map$6(a=Yc(values(c=this.validFriendIds).call(c))).call(a,(function(t){return m.getFriend(t)}))).call(t,(function(t){return!!t}))},t.getFriendListBySearchOption=function getFriendListBySearchOption(t){var a,c,m,h=this;return filter(a=map$6(c=Yc(values(m=this.validFriendIds).call(m))).call(c,(function(t){return h.getFriend(t)}))).call(a,(function(a){var c,m,h=void 0===t.searchAlias||t.searchAlias;return void 0!==a&&(!!(h&&a.alias&&includes(c=a.alias).call(c,t.keyword))||!(!t.searchAccountId||!includes(m=a.accountId).call(m,t.keyword)))}))},t.getFriendByIds=function getFriendByIds(t){var a,c=this;return filter(a=map$6(t).call(t,(function(t){return c.getFriend(t)}))).call(a,(function(t){return!!t}))},t.setFriendTimetag=function setFriendTimetag(t){this.friendTimetag=t},t.getFriendTimetag=function getFriendTimetag(){return this.friendTimetag},V2NIMFriendModelImpl}(),uM=function(t){function V2NIMUFriendServiceImpl(a){var c;return(c=t.call(this,"V2NIMFriendService",a)||this).notification=new cM(c.core,Qe(c)),c.model=new lM,"v2"!==c.core.options.apiVersion?Qe(c):(registerParser({cmdMap:eM,cmdConfig:rM}),c.setListener(),c)}wt(V2NIMUFriendServiceImpl,t);var a=V2NIMUFriendServiceImpl.prototype;return a.reset=function reset(){this.model.reset()},a.setListener=function setListener(){var t,a,c,m,h,g;this.core.eventBus.on("V2NIMFriendService/sysNotification",bind$1(t=this.notification.processSysNotification).call(t,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",bind$1(a=this.handleAddFriend).call(a,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",bind$1(c=this.handleDeleteFriend).call(c,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",bind$1(m=this.handleSetFriendInfo).call(m,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",bind$1(h=this.handlePassFriendApply).call(h,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",bind$1(g=this.handleRejectFriendApply).call(g,this))},a.addFriend=function addFriend(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),t!==this.core.account){c.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return validate(nM,{accountId:t,params:a},"",!0),c.next=6,this.core.sendCmd("v2AddFriend",{accountId:t,verifyType:a.addMode,postscript:a.postscript||""});case 6:if(a.addMode!==zl.V2NIM_FRIEND_MODE_TYPE_ADD){c.next=9;break}return c.next=9,this.handleAddFriend(t);case 9:case"end":return c.stop()}}),_callee,this)})))},a.deleteFriend=function deleteFriend(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),t!==this.core.account){c.next=3;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return validate(aM,{accountId:t,params:a},"",!0),c.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:t,params:a});case 6:a.deleteAlias&&this.model.upsertFriend(t,{alias:""}),this.handleDeleteFriend(t);case 8:case"end":return c.stop()}}),_callee2,this)})))},a.acceptAddApplication=function acceptAddApplication(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate(oM,t,"",!0),a.prev=2,a.next=5,this.core.sendCmd("v2AddFriend",{accountId:t.applicantAccountId,verifyType:Xl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT,postscript:""});case 5:this.handlePassFriendApply(t.applicantAccountId),a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(2),this.handlePassFriendApply(t.applicantAccountId,a.t0),a.t0;case 12:case"end":return a.stop()}}),_callee3,this,[[2,8]])})))},a.rejectAddApplication=function rejectAddApplication(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate(oM,t,"",!0),c.prev=2,c.next=5,this.core.sendCmd("v2AddFriend",{accountId:t.applicantAccountId,verifyType:Xl.V2NIM_FRIEND_VERIFY_TYPE_REJECT,postscript:a||""});case 5:this.handleRejectFriendApply({applicantAccountId:t.applicantAccountId,recipientAccountId:t.recipientAccountId,operatorAccountId:this.core.account,postscript:a||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED}),c.next=12;break;case 8:throw c.prev=8,c.t0=c.catch(2),this.handleRejectFriendApply({applicantAccountId:t.applicantAccountId,recipientAccountId:t.recipientAccountId,operatorAccountId:this.core.account,postscript:a||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED},c.t0),c.t0;case 12:case"end":return c.stop()}}),_callee4,this,[[2,8]])})))},a.setFriendInfo=function setFriendInfo(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validate(iM,{accountId:t,params:a},"",!0),t!==this.core.account){c.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return c.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:qt({accountId:t},a)});case 6:this.handleSetFriendInfo(t,a);case 7:case"end":return c.stop()}}),_callee5,this)})))},a.getFriendList=function getFriendList(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),t.abrupt("return",Mi.resolve(this.computedFields(this.model.getFriendList())));case 3:case"end":return t.stop()}}),_callee6,this)})))},a.getFriendByIds=function getFriendByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:t},"",!0),a.abrupt("return",Mi.resolve(this.computedFields(this.model.getFriendByIds(t))));case 4:case"end":return a.stop()}}),_callee7,this)})))},a.checkFriend=function checkFriend(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a,c=this;return Lc.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:t},"",!0),a={},forEach$1(t).call(t,(function(t){a[t]=!!c.model.getFriend(t)})),m.abrupt("return",Mi.resolve(a));case 6:case"end":return m.stop()}}),_callee8,this)})))},a.getAddApplicationList=function getAddApplicationList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){return Lc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate(sM,t,"",!0),a.abrupt("return",Mi.resolve(this.model.getAddApplicationList(t)));case 4:case"end":return a.stop()}}),_callee9,this)})))},a.setAddApplicationRead=function setAddApplicationRead(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(t){for(;;)switch(t.prev=t.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return t.stop()}}),_callee10,this)})))},a.getAddApplicationUnreadCount=function getAddApplicationUnreadCount(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),t.abrupt("return",Mi.resolve(this.model.getAddApplicationUnreadCount()));case 3:case"end":return t.stop()}}),_callee11,this)})))},a.searchFriendByOption=function searchFriendByOption(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){return Lc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),validate({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},t,"",!0),void 0===t.searchAlias||t.searchAlias||t.searchAccountId){a.next=6;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return a.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(t)));case 7:case"end":return a.stop()}}),_callee12,this)})))},a.v2OnAddFriendHandler=function v2OnAddFriendHandler(t){var a=t.content,c=a.accountId,m=a.verifyType,h=a.postscript;if(m===Xl.V2NIM_FRIEND_VERIFY_TYPE_ADD)this.handleAddFriend(c);else if(m===Xl.V2NIM_FRIEND_VERIFY_TYPE_APPLY){var g={applicantAccountId:this.core.account,recipientAccountId:c,operatorAccountId:this.core.account,postscript:h,timestamp:this.core.timeOrigin.getNTPTime(),status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT,read:!1};this.handleApplyFriend(g)}else if(m===Xl.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT)this.handlePassFriendApply(c);else if(m===Xl.V2NIM_FRIEND_VERIFY_TYPE_REJECT){var I={applicantAccountId:c,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:h,timestamp:this.core.timeOrigin.getNTPTime(),status:Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,read:!0};this.handleRejectFriendApply(I)}},a.v2OnDeleteFriendHandler=function v2OnDeleteFriendHandler(t){var a=t.content.accountId;this.handleDeleteFriend(a)},a.v2OnUpdateFriendInfoHandler=function v2OnUpdateFriendInfoHandler(t){var a=t.content.data,c=this.model.upsertFriend(a.accountId,a);this.emit("onFriendInfoChanged",c)},a.v2SyncFriendListHandler=function v2SyncFriendListHandler(t){var a=this,c=t.content,m=c.friends,h=c.timetag;this.model.setFriendTimetag(h),forEach$1(m).call(m,(function(t){t.serverExtension||(t.serverExtension=""),t.customerExtension||(t.customerExtension=""),a.model.upsertFriend(t.accountId,t)}))},a.v2SyncFriendUserListHandler=function v2SyncFriendUserListHandler(t){var a=this,c=t.content.users;forEach$1(c).call(c,(function(t){a.core.V2NIMUserService.model.setUser(t)}))},a.handleApplyFriend=function handleApplyFriend(t){this.emit("onFriendAddApplication",t)},a.handleAddFriend=function handleAddFriend(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a;return Lc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return this.model.addFriend(t),c.next=3,this.incrementSyncFriend();case 3:(a=this.model.getFriend(t))&&this.emit("onFriendAdded",this.computedField(a));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.handleDeleteFriend=function handleDeleteFriend(t,a){a=void 0===a?Jl.V2NIM_FRIEND_DELETION_TYPE_BY_SELF:a,this.emit("onFriendDeleted",t,a),this.model.deleteFriend(t)},a.handleSetFriendInfo=function handleSetFriendInfo(t,a){var c=this.model.upsertFriend(t,a);this.emit("onFriendInfoChanged",this.computedField(c))},a.handlePassFriendApply=function handlePassFriendApply(t,a){var c=a?null==a?void 0:a.code:200;if(!(c>=19e4||c===Lu.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===c||c===Lu.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(t,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,this.core.account),this.handleAddFriend(t);else{if(c>=500&&c<=599&&509!==c)return;this.model.updateFriendAddApplicationStatus(t,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED,this.core.account)}},a.handleRejectFriendApply=function handleRejectFriendApply(t,a){var c=a?null==a?void 0:a.code:200;if(!(c>=19e4||c===Lu.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===c)this.emit("onFriendAddRejected",t),this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED,this.core.account);else if(c===Lu.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED,this.core.account);else{if(c>=500&&c<=599&&509!==c)return;this.model.updateFriendAddApplicationStatus(t.applicantAccountId,Ql.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED,this.core.account)}},a.incrementSyncFriend=function incrementSyncFriend(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var t,a,c,m,h=this;return Lc.wrap((function _callee14$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:t=g.sent,a=t.content,c=a.friends,m=a.timetag,this.model.setFriendTimetag(m),forEach$1(c).call(c,(function(t){h.model.upsertFriend(t.accountId,t)}));case 6:case"end":return g.stop()}}),_callee14,this)})))},a.computedFields=function computedFields(t){var a=this;return map$6(t).call(t,(function(t){return a.computedField(t)}))},a.computedField=function computedField(t){var a,c,m=null===(c=null===(a=this.core.V2NIMUserService)||void 0===a?void 0:a.model)||void 0===c?void 0:c.getUser(t.accountId);return m?qt({},t,{userProfile:m}):t},V2NIMUFriendServiceImpl}(ch),dM={muteMode:{type:"enum",values:getEnumValues(gu)}},pM={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:getEnumValues(vu)}},mM={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},hM={config:{type:"object",required:!0,rules:{apns:mM,hwPush:mM,miPush:mM,vivoPush:mM,oppoPush:mM,honorPush:mM,fcmPush:mM,mzPush:mM}}},fM="V2NIMSettingService",gM={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},vM={v2SetDeviceToken:{sid:34,cid:1,service:fM,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:fM,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:fM,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function converter(t){return t?2:1}}}}]}},yM=yM||function(t){var a;"undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),void 0!==ji&&ji.crypto&&(a=ji.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&"undefined"!=typeof global&&global.crypto&&(a=global.crypto);var c=function cryptoSecureRandomInt(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=vt||function(){function F(){}return function(t){var a;return F.prototype=t,a=new F,F.prototype=null,a}}(),h={},g=h.lib={},I=g.Base={extend:function extend(t){var a=m(this);return t&&a.mixIn(t),a.hasOwnProperty("init")&&this.init!==a.init||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function create(){var t=this.extend();return t.init.apply(t,arguments),t},init:function init(){},mixIn:function mixIn(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function clone(){return this.init.prototype.extend(this)}},M=g.WordArray=I.extend({init:function init(t,a){t=this.words=t||[],this.sigBytes=null!=a?a:4*t.length},toString:function toString(t){return(t||S).stringify(this)},concat:function concat(t){var a=this.words,c=t.words,m=this.sigBytes,h=t.sigBytes;if(this.clamp(),m%4)for(var g=0;g<h;g++){var I=c[g>>>2]>>>24-g%4*8&255;a[m+g>>>2]|=I<<24-(m+g)%4*8}else for(var M=0;M<h;M+=4)a[m+M>>>2]=c[M>>>2];return this.sigBytes+=h,this},clamp:function clamp(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=t.ceil(c/4)},clone:function clone(){var t,clone=I.clone.call(this);return clone.words=slice(t=this.words).call(t,0),clone},random:function random(t){for(var a=[],m=0;m<t;m+=4)a.push(c());return new M.init(a,t)}}),T=h.enc={},S=T.Hex={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,m=[],h=0;h<c;h++){var g=a[h>>>2]>>>24-h%4*8&255;m.push((g>>>4).toString(16)),m.push((15&g).toString(16))}return m.join("")},parse:function parse(t){for(var a=t.length,c=[],m=0;m<a;m+=2)c[m>>>3]|=zp(t.substr(m,2),16)<<24-m%8*4;return new M.init(c,a/2)}},E=T.Latin1={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,m=[],h=0;h<c;h++){var g=a[h>>>2]>>>24-h%4*8&255;m.push(String.fromCharCode(g))}return m.join("")},parse:function parse(t){for(var a=t.length,c=[],m=0;m<a;m++)c[m>>>2]|=(255&t.charCodeAt(m))<<24-m%4*8;return new M.init(c,a)}},b=T.Utf8={stringify:function stringify(t){try{return decodeURIComponent(escape(E.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function parse(t){return E.parse(unescape(encodeURIComponent(t)))}},C=g.BufferedBlockAlgorithm=I.extend({reset:function reset(){this._data=new M.init,this._nDataBytes=0},_append:function _append(t){var a;"string"==typeof t&&(t=b.parse(t)),concat(a=this._data).call(a,t),this._nDataBytes+=t.sigBytes},_process:function _process(a){var c,m=this._data,h=m.words,g=m.sigBytes,I=this.blockSize,T=g/(4*I),S=(T=a?t.ceil(T):t.max((0|T)-this._minBufferSize,0))*I,E=t.min(4*S,g);if(S){for(var b=0;b<S;b+=I)this._doProcessBlock(h,b);c=splice$1(h).call(h,0,S),m.sigBytes-=E}return new M.init(c,E)},clone:function clone(){var clone=I.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0});g.Hasher=C.extend({cfg:I.extend(),init:function init(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function reset(){C.reset.call(this),this._doReset()},update:function update(t){return this._append(t),this._process(),this},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(t){return function(a,c){return new t.init(c).finalize(a)}},_createHmacHelper:function _createHmacHelper(t){return function(a,c){return new A.HMAC.init(t,c).finalize(a)}}});var A=h.algo={};return h}(Math),_M=yM.enc.Utf8,IM=yM,MM=IM.lib,TM=MM.WordArray,SM=MM.Hasher,EM=IM.algo,bM=[],CM=EM.SHA1=SM.extend({_doReset:function _doReset(){this._hash=new TM.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=this._hash.words,m=c[0],h=c[1],g=c[2],I=c[3],M=c[4],T=0;T<80;T++){if(T<16)bM[T]=0|t[a+T];else{var S=bM[T-3]^bM[T-8]^bM[T-14]^bM[T-16];bM[T]=S<<1|S>>>31}var E=(m<<5|m>>>27)+M+bM[T];E+=T<20?1518500249+(h&g|~h&I):T<40?1859775393+(h^g^I):T<60?(h&g|h&I|g&I)-1894007588:(h^g^I)-899497514,M=I,I=g,g=h<<30|h>>>2,h=m,m=E}c[0]=c[0]+m|0,c[1]=c[1]+h|0,c[2]=c[2]+g|0,c[3]=c[3]+I|0,c[4]=c[4]+M|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,m=8*t.sigBytes;return a[m>>>5]|=128<<24-m%32,a[14+(m+64>>>9<<4)]=Math.floor(c/4294967296),a[15+(m+64>>>9<<4)]=c,t.sigBytes=4*a.length,this._process(),this._hash},clone:function clone(){var clone=SM.clone.call(this);return clone._hash=this._hash.clone(),clone}});IM.SHA1=SM._createHelper(CM),IM.HmacSHA1=SM._createHmacHelper(CM),yM.SHA1,function(t){var a=t,c=a.lib.Base,m=a.enc.Utf8;a.algo.HMAC=c.extend({init:function init(t,a){t=this._hasher=new t.init,"string"==typeof a&&(a=m.parse(a));var c=t.blockSize,h=4*c;a.sigBytes>h&&(a=t.finalize(a)),a.clamp();for(var g=this._oKey=a.clone(),I=this._iKey=a.clone(),M=g.words,T=I.words,S=0;S<c;S++)M[S]^=1549556828,T[S]^=909522486;g.sigBytes=I.sigBytes=h,this.reset()},reset:function reset(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function update(t){return this._hasher.update(t),this},finalize:function finalize(t){var a,c=this._hasher,m=c.finalize(t);return c.reset(),c.finalize(concat(a=this._oKey.clone()).call(a,m))}})}(yM);var AM=yM,NM=AM.lib,RM=NM.Base,kM=NM.WordArray,wM=AM.algo,OM=wM.MD5,PM=wM.EvpKDF=RM.extend({cfg:RM.extend({keySize:4,hasher:OM,iterations:1}),init:function init(t){this.cfg=this.cfg.extend(t)},compute:function compute(t,a){for(var c,m=this.cfg,h=m.hasher.create(),g=kM.create(),I=g.words,M=m.keySize,T=m.iterations;I.length<M;){c&&h.update(c),c=h.update(t).finalize(a),h.reset();for(var S=1;S<T;S++)c=h.finalize(c),h.reset();concat(g).call(g,c)}return g.sigBytes=4*M,g}});AM.EvpKDF=function(t,a,c){return PM.create(c).compute(t,a)},yM.EvpKDF;var xM=yM,VM=xM.lib.WordArray;xM.enc.Base64={stringify:function stringify(t){var a=t.words,c=t.sigBytes,m=this._map;t.clamp();for(var h=[],g=0;g<c;g+=3)for(var I=(a[g>>>2]>>>24-g%4*8&255)<<16|(a[g+1>>>2]>>>24-(g+1)%4*8&255)<<8|a[g+2>>>2]>>>24-(g+2)%4*8&255,M=0;M<4&&g+.75*M<c;M++)h.push(m.charAt(I>>>6*(3-M)&63));var T=m.charAt(64);if(T)for(;h.length%4;)h.push(T);return h.join("")},parse:function parse(t){var a=t.length,c=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var h=0;h<c.length;h++)m[c.charCodeAt(h)]=h}var g=c.charAt(64);if(g){var I=indexOf(t).call(t,g);-1!==I&&(a=I)}return function parseLoop(t,a,c){for(var m=[],h=0,g=0;g<a;g++)if(g%4){var I=c[t.charCodeAt(g-1)]<<g%4*2|c[t.charCodeAt(g)]>>>6-g%4*2;m[h>>>2]|=I<<24-h%4*8,h++}return VM.create(m,h)}(t,a,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},yM.enc.Base64;var LM=yM,DM=LM.lib,UM=DM.WordArray,FM=DM.Hasher,BM=LM.algo,qM=[];!function(){for(var t=0;t<64;t++)qM[t]=4294967296*Math.abs(Math.sin(t+1))|0}();var GM=BM.MD5=FM.extend({_doReset:function _doReset(){this._hash=new UM.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=0;c<16;c++){var m=a+c,h=t[m];t[m]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}var g=this._hash.words,I=t[a+0],M=t[a+1],T=t[a+2],S=t[a+3],E=t[a+4],b=t[a+5],C=t[a+6],A=t[a+7],N=t[a+8],R=t[a+9],k=t[a+10],w=t[a+11],O=t[a+12],P=t[a+13],x=t[a+14],V=t[a+15],L=g[0],D=g[1],U=g[2],B=g[3];L=FF(L,D,U,B,I,7,qM[0]),B=FF(B,L,D,U,M,12,qM[1]),U=FF(U,B,L,D,T,17,qM[2]),D=FF(D,U,B,L,S,22,qM[3]),L=FF(L,D,U,B,E,7,qM[4]),B=FF(B,L,D,U,b,12,qM[5]),U=FF(U,B,L,D,C,17,qM[6]),D=FF(D,U,B,L,A,22,qM[7]),L=FF(L,D,U,B,N,7,qM[8]),B=FF(B,L,D,U,R,12,qM[9]),U=FF(U,B,L,D,k,17,qM[10]),D=FF(D,U,B,L,w,22,qM[11]),L=FF(L,D,U,B,O,7,qM[12]),B=FF(B,L,D,U,P,12,qM[13]),U=FF(U,B,L,D,x,17,qM[14]),L=GG(L,D=FF(D,U,B,L,V,22,qM[15]),U,B,M,5,qM[16]),B=GG(B,L,D,U,C,9,qM[17]),U=GG(U,B,L,D,w,14,qM[18]),D=GG(D,U,B,L,I,20,qM[19]),L=GG(L,D,U,B,b,5,qM[20]),B=GG(B,L,D,U,k,9,qM[21]),U=GG(U,B,L,D,V,14,qM[22]),D=GG(D,U,B,L,E,20,qM[23]),L=GG(L,D,U,B,R,5,qM[24]),B=GG(B,L,D,U,x,9,qM[25]),U=GG(U,B,L,D,S,14,qM[26]),D=GG(D,U,B,L,N,20,qM[27]),L=GG(L,D,U,B,P,5,qM[28]),B=GG(B,L,D,U,T,9,qM[29]),U=GG(U,B,L,D,A,14,qM[30]),L=HH(L,D=GG(D,U,B,L,O,20,qM[31]),U,B,b,4,qM[32]),B=HH(B,L,D,U,N,11,qM[33]),U=HH(U,B,L,D,w,16,qM[34]),D=HH(D,U,B,L,x,23,qM[35]),L=HH(L,D,U,B,M,4,qM[36]),B=HH(B,L,D,U,E,11,qM[37]),U=HH(U,B,L,D,A,16,qM[38]),D=HH(D,U,B,L,k,23,qM[39]),L=HH(L,D,U,B,P,4,qM[40]),B=HH(B,L,D,U,I,11,qM[41]),U=HH(U,B,L,D,S,16,qM[42]),D=HH(D,U,B,L,C,23,qM[43]),L=HH(L,D,U,B,R,4,qM[44]),B=HH(B,L,D,U,O,11,qM[45]),U=HH(U,B,L,D,V,16,qM[46]),L=II(L,D=HH(D,U,B,L,T,23,qM[47]),U,B,I,6,qM[48]),B=II(B,L,D,U,A,10,qM[49]),U=II(U,B,L,D,x,15,qM[50]),D=II(D,U,B,L,b,21,qM[51]),L=II(L,D,U,B,O,6,qM[52]),B=II(B,L,D,U,S,10,qM[53]),U=II(U,B,L,D,k,15,qM[54]),D=II(D,U,B,L,M,21,qM[55]),L=II(L,D,U,B,N,6,qM[56]),B=II(B,L,D,U,V,10,qM[57]),U=II(U,B,L,D,C,15,qM[58]),D=II(D,U,B,L,P,21,qM[59]),L=II(L,D,U,B,E,6,qM[60]),B=II(B,L,D,U,w,10,qM[61]),U=II(U,B,L,D,T,15,qM[62]),D=II(D,U,B,L,R,21,qM[63]),g[0]=g[0]+L|0,g[1]=g[1]+D|0,g[2]=g[2]+U|0,g[3]=g[3]+B|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,m=8*t.sigBytes;a[m>>>5]|=128<<24-m%32;var h=Math.floor(c/4294967296),g=c;a[15+(m+64>>>9<<4)]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),a[14+(m+64>>>9<<4)]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),t.sigBytes=4*(a.length+1),this._process();for(var I=this._hash,M=I.words,T=0;T<4;T++){var S=M[T];M[T]=16711935&(S<<8|S>>>24)|4278255360&(S<<24|S>>>8)}return I},clone:function clone(){var clone=FM.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(t,a,c,m,h,g,I){var M=t+(a&c|~a&m)+h+I;return(M<<g|M>>>32-g)+a}function GG(t,a,c,m,h,g,I){var M=t+(a&m|c&~m)+h+I;return(M<<g|M>>>32-g)+a}function HH(t,a,c,m,h,g,I){var M=t+(a^c^m)+h+I;return(M<<g|M>>>32-g)+a}function II(t,a,c,m,h,g,I){var M=t+(c^(a|~m))+h+I;return(M<<g|M>>>32-g)+a}LM.MD5=FM._createHelper(GM),LM.HmacMD5=FM._createHmacHelper(GM),yM.MD5,function(t){t.lib.Cipher||function(){var a=t,c=a.lib,m=c.Base,h=c.WordArray,g=c.BufferedBlockAlgorithm,I=a.enc;I.Utf8;var M=I.Base64,T=a.algo.EvpKDF,S=c.Cipher=g.extend({cfg:m.extend(),createEncryptor:function createEncryptor(t,a){return this.create(this._ENC_XFORM_MODE,t,a)},createDecryptor:function createDecryptor(t,a){return this.create(this._DEC_XFORM_MODE,t,a)},init:function init(t,a,c){this.cfg=this.cfg.extend(c),this._xformMode=t,this._key=a,this.reset()},reset:function reset(){g.reset.call(this),this._doReset()},process:function process(t){return this._append(t),this._process()},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(t){return"string"==typeof t?O:k}return function(t){return{encrypt:function encrypt(a,c,m){return selectCipherStrategy(c).encrypt(t,a,c,m)},decrypt:function decrypt(a,c,m){return selectCipherStrategy(c).decrypt(t,a,c,m)}}}}()});c.StreamCipher=S.extend({_doFinalize:function _doFinalize(){return this._process(!0)},blockSize:1});var E=a.mode={},b=c.BlockCipherMode=m.extend({createEncryptor:function createEncryptor(t,a){return this.Encryptor.create(t,a)},createDecryptor:function createDecryptor(t,a){return this.Decryptor.create(t,a)},init:function init(t,a){this._cipher=t,this._iv=a}}),C=E.CBC=function(){var t=b.extend();function xorBlock(t,a,c){var m,h=this._iv;h?(m=h,this._iv=void 0):m=this._prevBlock;for(var g=0;g<c;g++)t[a+g]^=m[g]}return t.Encryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,m=c.blockSize;xorBlock.call(this,t,a,m),c.encryptBlock(t,a),this._prevBlock=slice(t).call(t,a,a+m)}}),t.Decryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,m=c.blockSize,h=slice(t).call(t,a,a+m);c.decryptBlock(t,a),xorBlock.call(this,t,a,m),this._prevBlock=h}}),t}(),A=(a.pad={}).Pkcs7={pad:function pad(t,a){for(var c=4*a,m=c-t.sigBytes%c,g=m<<24|m<<16|m<<8|m,I=[],M=0;M<m;M+=4)I.push(g);var T=h.create(I,m);concat(t).call(t,T)},unpad:function unpad(t){var a=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=a}};c.BlockCipher=S.extend({cfg:S.cfg.extend({mode:C,padding:A}),reset:function reset(){var t;S.reset.call(this);var a=this.cfg,c=a.iv,m=a.mode;this._xformMode==this._ENC_XFORM_MODE?t=m.createEncryptor:(t=m.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,c&&c.words):(this._mode=t.call(m,this,c&&c.words),this._mode.__creator=t)},_doProcessBlock:function _doProcessBlock(t,a){this._mode.processBlock(t,a)},_doFinalize:function _doFinalize(){var t,a=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(a.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),a.unpad(t)),t},blockSize:4});var N=c.CipherParams=m.extend({init:function init(t){this.mixIn(t)},toString:function toString(t){return(t||this.formatter).stringify(this)}}),R=(a.format={}).OpenSSL={stringify:function stringify(t){var a,c,m,g=t.ciphertext,I=t.salt;I?a=concat(c=concat(m=h.create([1398893684,1701076831])).call(m,I)).call(c,g):a=g;return a.toString(M)},parse:function parse(t){var a,c=M.parse(t),m=c.words;return 1398893684==m[0]&&1701076831==m[1]&&(a=h.create(slice(m).call(m,2,4)),splice$1(m).call(m,0,4),c.sigBytes-=16),N.create({ciphertext:c,salt:a})}},k=c.SerializableCipher=m.extend({cfg:m.extend({format:R}),encrypt:function encrypt(t,a,c,m){m=this.cfg.extend(m);var h=t.createEncryptor(c,m),g=h.finalize(a),I=h.cfg;return N.create({ciphertext:g,key:c,iv:I.iv,algorithm:t,mode:I.mode,padding:I.padding,blockSize:t.blockSize,formatter:m.format})},decrypt:function decrypt(t,a,c,m){return m=this.cfg.extend(m),a=this._parse(a,m.format),t.createDecryptor(c,m).finalize(a.ciphertext)},_parse:function _parse(t,a){return"string"==typeof t?a.parse(t,this):t}}),w=(a.kdf={}).OpenSSL={execute:function execute(t,a,c,m){var g;m||(m=h.random(8));var I=T.create({keySize:a+c}).compute(t,m),M=h.create(slice(g=I.words).call(g,a),4*c);return I.sigBytes=4*a,N.create({key:I,iv:M,salt:m})}},O=c.PasswordBasedCipher=k.extend({cfg:k.cfg.extend({kdf:w}),encrypt:function encrypt(t,a,c,m){var h=(m=this.cfg.extend(m)).kdf.execute(c,t.keySize,t.ivSize);m.iv=h.iv;var g=k.encrypt.call(this,t,a,h.key,m);return g.mixIn(h),g},decrypt:function decrypt(t,a,c,m){m=this.cfg.extend(m),a=this._parse(a,m.format);var h=m.kdf.execute(c,t.keySize,t.ivSize,a.salt);return m.iv=h.iv,k.decrypt.call(this,t,a,h.key,m)}})}()}(yM);var jM=yM,HM=jM.lib.StreamCipher,$M=jM.algo,YM=$M.RC4=HM.extend({_doReset:function _doReset(){for(var t=this._key,a=t.words,c=t.sigBytes,m=this._S=[],h=0;h<256;h++)m[h]=h;h=0;for(var g=0;h<256;h++){var I=h%c,M=a[I>>>2]>>>24-I%4*8&255;g=(g+m[h]+M)%256;var T=m[h];m[h]=m[g],m[g]=T}this._i=this._j=0},_doProcessBlock:function _doProcessBlock(t,a){t[a]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var t=this._S,a=this._i,c=this._j,m=0,h=0;h<4;h++){c=(c+t[a=(a+1)%256])%256;var g=t[a];t[a]=t[c],t[c]=g,m|=t[(t[a]+t[c])%256]<<24-8*h}return this._i=a,this._j=c,m}jM.RC4=HM._createHelper(YM);var WM=$M.RC4Drop=YM.extend({cfg:YM.cfg.extend({drop:192}),_doReset:function _doReset(){YM._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)generateKeystreamWord.call(this)}});jM.RC4Drop=HM._createHelper(WM);var zM=yM.RC4,KM=function(t){function V2NIMSettingServiceImpl(a){var c;return(c=t.call(this,"V2NIMSettingService",a)||this).offlinePushPlugin=void 0,c.offlinePushConfig=void 0,c.appBackgroundOptions={badge:0,isBackground:!1},c.p2pMessageMuteModeChangeHandler=function(t,a){c.emit("onP2PMessageMuteModeChanged",t,a),c.core.V2NIMUserService.model.setAccountMuteMode(t,a);var m=c.core.V2NIMConversationIdUtil.p2pConversationId(t),h=a===vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON;c.core.eventBus.emit("V2NIMConversationService/setMute",m,h)},c.setTokenAndBackgroundStateAfterLogin=function(t){c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),c.offlinePushPlugin&&(c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),c.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",t&&t.pushType),c.regToken(t),c.core.sendCmd("v2SetAppBackground",{isBackground:c.appBackgroundOptions.isBackground,badge:c.appBackgroundOptions.badge||0}))},"v2"!==c.core.options.apiVersion?Qe(c):(c.setListener(),registerParser({cmdMap:gM,cmdConfig:vM}),c)}wt(V2NIMSettingServiceImpl,t);var a=V2NIMSettingServiceImpl.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMSettingService/updateBits",(function(a,c,m){t.emit("onTeamMessageMuteModeChanged",a,c,m)})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},a.getConversationMuteStatus=function getConversationMuteStatus(t){if("string"!=typeof t)return!1;var a=this.core.V2NIMConversationIdUtil.parseConversationType(t),c=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t);return a===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?this.getTeamMessageMuteMode(c,Iu.V2NIM_TEAM_TYPE_SUPER)!==gu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:a===Yl.V2NIM_CONVERSATION_TYPE_TEAM?this.getTeamMessageMuteMode(c,Iu.V2NIM_TEAM_TYPE_ADVANCED)!==gu.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF:a===Yl.V2NIM_CONVERSATION_TYPE_P2P&&!!this.core.V2NIMUserService.model.muteList.has(c)},a.setTeamMessageMuteMode=function setTeamMessageMuteMode(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var m,h,g,I;return Lc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return this.checkV2(),validate(SI,{teamId:t},"",!0),validate(bI,{teamType:a},"",!0),validate(dM,{muteMode:c},"",!0),m=a===Iu.V2NIM_TEAM_TYPE_SUPER?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",h={teamId:t,teamType:a,accountId:this.core.account,bits:c},M.next=8,this.core.sendCmd(m,{teamMember:h});case 8:this.core.V2NIMTeamService.memberModel.upsert(h),this.emit("onTeamMessageMuteModeChanged",t,a,c),g=a===Iu.V2NIM_TEAM_TYPE_ADVANCED?this.core.V2NIMConversationIdUtil.teamConversationId(t):this.core.V2NIMConversationIdUtil.superTeamConversationId(t),I=this.core.V2NIMSettingService.getConversationMuteStatus(g),this.core.eventBus.emit("V2NIMConversationService/setMute",g,I);case 13:case"end":return M.stop()}}),_callee,this)})))},a.getTeamMessageMuteMode=function getTeamMessageMuteMode(t,a){var c;return"string"!=typeof t||"number"!=typeof a?0:3&((null===(c=this.core.V2NIMTeamService.memberModel.getById(t,a,this.core.account))||void 0===c?void 0:c.bits)||0)},a.setP2PMessageMuteMode=function setP2PMessageMuteMode(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),validate(pM,{accountId:t,muteMode:a},"",!0),t!==this.core.account){c.next=4;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return c.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:t,muteMode:a===vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON});case 6:this.p2pMessageMuteModeChangeHandler(t,a);case 7:case"end":return c.stop()}}),_callee2,this)})))},a.getP2PMessageMuteMode=function getP2PMessageMuteMode(t){return validate({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:t},"",!0),this.core.V2NIMUserService.model.muteList.has(t)?vu.V2NIM_P2P_MESSAGE_MUTE_MODE_ON:vu.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF},a.getP2PMessageMuteList=function getP2PMessageMuteList(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Mi.resolve(Yc(this.core.V2NIMUserService.model.muteList)));case 1:case"end":return t.stop()}}),_callee3,this)})))},a.setAppBackground=function setAppBackground(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this.checkV2(),validate({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:t,badge:a},"",!0),this.appBackgroundOptions={isBackground:t,badge:a||0},c.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:t,badge:a||0});case 5:case"end":return c.stop()}}),_callee4,this)})))},a.setPushMobileOnDesktopOnline=function setPushMobileOnDesktopOnline(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),validate({need:{type:"boolean",required:!1}},{need:t},"",!0),t=void 0===t||t,a.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:t}});case 5:case"end":return a.stop()}}),_callee5,this)})))},a.setOfflinePushConfig=function setOfflinePushConfig(t,a){validate(hM,{config:a},"",!0),this.offlinePushPlugin=t,this.offlinePushConfig=a},a.regToken=function regToken(t){var a,c,m,h,g,I,M,T,S,E,b,C,A,N,R,k,w,O,P,x,V,L,D,U,B,q,G,j,H,$,Y,W,z,K,Q,J,X=this,Z=_p.getSystemInfo()||{},ee=Z.os?Z.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",ee),"ios"===ee||"android"===ee)if(this.offlinePushPlugin&&"function"==typeof this.offlinePushPlugin.getDeviceToken){var te="";t&&t.pushType?te=t.pushType:"ios"===ee?te="":"android"===ee&&(te="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+te);var re={xmAppId:null===(c=null===(a=this.offlinePushConfig)||void 0===a?void 0:a.miPush)||void 0===c?void 0:c.appId,xmAppKey:null===(h=null===(m=this.offlinePushConfig)||void 0===m?void 0:m.miPush)||void 0===h?void 0:h.appKey,xmCertificateName:null===(I=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.miPush)||void 0===I?void 0:I.certificateName,hwAppId:null===(T=null===(M=this.offlinePushConfig)||void 0===M?void 0:M.hwPush)||void 0===T?void 0:T.appId,hwCertificateName:null===(E=null===(S=this.offlinePushConfig)||void 0===S?void 0:S.hwPush)||void 0===E?void 0:E.certificateName,oppoAppId:null===(C=null===(b=this.offlinePushConfig)||void 0===b?void 0:b.oppoPush)||void 0===C?void 0:C.appId,oppoAppKey:null===(N=null===(A=this.offlinePushConfig)||void 0===A?void 0:A.oppoPush)||void 0===N?void 0:N.appKey,oppoAppSecret:null===(k=null===(R=this.offlinePushConfig)||void 0===R?void 0:R.oppoPush)||void 0===k?void 0:k.secret,oppoCertificateName:null===(O=null===(w=this.offlinePushConfig)||void 0===w?void 0:w.oppoPush)||void 0===O?void 0:O.certificateName,vivoAppId:null===(x=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.vivoPush)||void 0===x?void 0:x.appId,vivoAppKey:null===(L=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.vivoPush)||void 0===L?void 0:L.appKey,vivoCertificateName:null===(U=null===(D=this.offlinePushConfig)||void 0===D?void 0:D.vivoPush)||void 0===U?void 0:U.certificateName,fcmCertificateName:null===(q=null===(B=this.offlinePushConfig)||void 0===B?void 0:B.fcmPush)||void 0===q?void 0:q.certificateName,mzAppId:null===(j=null===(G=this.offlinePushConfig)||void 0===G?void 0:G.mzPush)||void 0===j?void 0:j.appId,mzAppKey:null===($=null===(H=this.offlinePushConfig)||void 0===H?void 0:H.mzPush)||void 0===$?void 0:$.appKey,mzCertificateName:null===(W=null===(Y=this.offlinePushConfig)||void 0===Y?void 0:Y.mzPush)||void 0===W?void 0:W.certificateName,apnsCertificateName:null===(K=null===(z=this.offlinePushConfig)||void 0===z?void 0:z.apns)||void 0===K?void 0:K.certificateName,honorCertificateName:null===(J=null===(Q=this.offlinePushConfig)||void 0===Q?void 0:Q.honorPush)||void 0===J?void 0:J.certificateName};this.logger.log("OfflinePushService push config",Uc(re,null,2)),this.offlinePushPlugin.getDeviceToken({suggestPushType:te,config:re},(function(t){t?(X.logger.log("OfflinePushService:: token is :"+t),X.pushTokenToServer(te,t)):X.logger.warn("OfflinePushService:: token is empty. Please check your parameters")}))}else this.logger.warn("OfflinePushService: plugin.getDeviceToken is not a function");else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},a.pushTokenToServer=function pushTokenToServer(t,a){var c,m,h,g,I,M,T,S,E="",b=this.offlinePushConfig;switch(t){case"5":E=null===(c=null==b?void 0:b.miPush)||void 0===c?void 0:c.certificateName;break;case"6":E=null===(m=null==b?void 0:b.hwPush)||void 0===m?void 0:m.certificateName;break;case"7":E=null===(h=null==b?void 0:b.mzPush)||void 0===h?void 0:h.certificateName;break;case"8":E=null===(g=null==b?void 0:b.fcmPush)||void 0===g?void 0:g.certificateName;break;case"9":E=null===(I=null==b?void 0:b.vivoPush)||void 0===I?void 0:I.certificateName;break;case"10":E=null===(M=null==b?void 0:b.oppoPush)||void 0===M?void 0:M.certificateName;break;case"11":E=null===(T=null==b?void 0:b.honorPush)||void 0===T?void 0:T.certificateName;break;default:E=null===(S=null==b?void 0:b.apns)||void 0===S?void 0:S.certificateName}if(""===E||void 0===E)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",t);else try{var C=_M.parse("557d1e3cafa43e2589a588270c53d56f"),A=_M.stringify(zM.decrypt(a,C));this.logger.log("OfflinePushService:: token",A),this.core.sendCmd("v2SetDeviceToken",{certificateName:E,pushDeviceToken:A,pushkit:0})}catch(t){return this.logger.log("OfflinePushService:: decrypt error",t),void this.logger.warn("OfflinePushService:: token before decrypt",a)}},V2NIMSettingServiceImpl}(ch),QM=Array.prototype.reverse;var JM,XM,ZM,eT=function reverse(t){return null==t?t:QM.call(t)},tT=function(){function ModuleService(t){this.core=t}return ModuleService.prototype.processBroadcastMsg=function processBroadcastMsg(t){var a=map$6(t).call(t,(function(t){return qt(qt({},t),{time:zp(t.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:map$6(a).call(a,(function(t){return t.id}))}),a},ModuleService}();!function(t){t[t.none=0]="none",t[t.pass=1]="pass",t[t.decline=2]="decline",t[t.read=3]="read",t[t.deleted=4]="deleted",t[t.invalid=5]="invalid"}(JM||(JM={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(XM||(XM={})),function(t){t[t.applyTeam=0]="applyTeam",t[t.rejectTeamApply=1]="rejectTeamApply",t[t.teamInvite=2]="teamInvite",t[t.rejectTeamInvite=3]="rejectTeamInvite",t[t.friendRequest=5]="friendRequest",t[t.deleteFriend=6]="deleteFriend",t[t.recallMsgP2p=7]="recallMsgP2p",t[t.recallMsgTeam=8]="recallMsgTeam",t[t.recallMsgSuperTeam=12]="recallMsgSuperTeam",t[t.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",t[t.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",t[t.applySuperTeam=15]="applySuperTeam",t[t.rejectSuperTeamApply=16]="rejectSuperTeamApply",t[t.superTeamInvite=17]="superTeamInvite",t[t.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",t[t.customP2p=100]="customP2p",t[t.customTeam=101]="customTeam",t[t.customSuperTeam=103]="customSuperTeam"}(ZM||(ZM={}));var rT={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var nT={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:tv,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function formatSystemMessage(t,a,c){var m=+t.type,h=getEnumKeyByEnumValue(ZM,m);c=c||XM.default;var g=qt(qt({},format(nT,t)),{type:h,time:+t.time,to:t.to,from:t.from,idServer:t.idServer,state:JM[JM.none],feature:XM[c]});if("0"===g.idServer&&g.setting&&(g.setting.needSaveOffline=!1),"string"==typeof g.attach)try{g.attach=JSON.parse(g.attach)}catch(t){a.error("formatSystemMessage: "+g.idServer+" parse attach error",t&&t.message)}return 5===m&&g.attach?(g.attach.type=rT[+g.attach.vt],"passFriendApply"===g.attach.type?g.state=JM[JM.pass]:"rejectFriendApply"===g.attach.type&&(g.state=JM[JM.decline])):m<=3&&g.attach&&(g.attach=function formatTeamAttach(t){var a=t.attach,c=t.tinfo,m=__rest(t,["attach","tinfo"]);return m.ext=a,void 0!==c&&(m.team=formatTeam(deserialize(t.tinfo,Iv.team))),m}(g.attach)),g}function generatorSysMsgForCmd$1(t){var a=qt({},t);return qt(qt({},formatReverse(nT,a)),{type:ZM[a.type],to:a.to,attach:a.attach})}function getSceneFromRecallSysMsg(t){return t===ZM.recallMsgP2p?"p2p":t===ZM.recallMsgTeam?"team":t===ZM.recallMsgSuperTeam?"superTeam":""}var aT=function(t){function MsgService(a){var c;return(c=t.call(this,"msg",a)||this).onV2SendMessage=function(t){var a=formatMsg$1(t,{account:c.core.account,featureValue:Wp.default});a.status=t.status,c.core.eventBus.emit("session/updateForNewMsg",a)},c.onV2RecallMsg=function(t){var a=formatDeletedMsgs([t],getSceneFromRecallSysMsg(+t.type));c.core.eventBus.emit("session/updateForDeletedMsg",a)},c.onV2DeleteSelfMsgs=function(t){var a=formatDeletedMsgs(t);c.core.eventBus.emit("session/updateForDeletedMsg",a)},c.service=new tT(a),registerParser({cmdMap:iv,cmdConfig:lv}),c.registerListener(),c}wt(MsgService,t);var a=MsgService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},a.sendTextMsg=function sendTextMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"text"}))},a.sendTipMsg=function sendTipMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"tip"}))},a.sendGeoLocationMsg=function sendGeoLocationMsg(t){return validate({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},t),this.sendMsg(qt(qt({},t),{type:"geo",attach:Uc(t.attach)}))},a.sendCustomMsg=function sendCustomMsg(t){return validate({attach:{type:"string",allowEmpty:!1}},t),this.sendMsg(qt(qt({},t),{type:"custom"}))},a.sendMsg=function sendMsg(t){var a,c=this;if(validate({scene:{type:"enum",values:getEnumKeys(Hp)},type:{type:"enum",values:getEnumKeys(jp)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:nv},robotInfo:{type:"object",required:!1,rules:av},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},t),"team"===t.scene&&t.robotInfo&&!t.robotInfo.account)throw new Bu('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var m,h="p2p"===t.scene?"sendMsg":"team"===t.scene?"sendTeamMsg":"sendSuperTeamMsg",g=generatorMsgForCmd$1(t,this.core.account,this.core.config.deviceId,null===(a=this.core.user)||void 0===a?void 0:a.myInfo),I=formatMsg$1(qt(qt({},g),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Wp.default,statusValue:Yp.sending});try{t.onSendBefore&&t.onSendBefore(I)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return this.core.eventBus.emit("session/updateForNewMsg",I),this.core.eventBus.emit("forwardSend/msg/sendMsg",g),this.core.sendCmd(h,{msg:g}).then((function(a){var h=a.content,M=a.error;if(m=h.msg,M)throw M;var T=formatMsg$1(qt(qt({},g),h.msg),{account:c.core.account,featureValue:Wp.default,statusValue:Yp.sent});return T.from===T.to&&c.markMsgsAck([T]),c.core.eventBus.emit("session/updateForNewMsg",T),c.core.eventBus.emit("forwardSend/msg/sendMsg",qt(qt({},generatorMsgForCmd$1(T,T.from,T.fromDeviceId)),{idClient:T.idClient,status:"sent"})),c.core.reporter.report("msgSend",{msgId:T.idServer,clientId:T.idClient,msgTime:T.time,fromAccid:"p2p"===t.scene?c.core.account:"",toAccid:T.to,type:Hp[T.scene],roomId:"",tid:"p2p"===t.scene?"":T.to,result:200,failReason:"",rt:Ri()-I.time}),T})).catch((function(a){var h=formatMsg$1(qt(qt(qt({},g),{time:(new Date).getTime()}),m),{account:c.core.account,featureValue:Wp.default,statusValue:7101===a.code?Yp.refused:Yp.sendFailed});throw a.msg=h,c.core.eventBus.emit("session/updateForNewMsg",h),c.core.eventBus.emit("forwardSend/msg/sendMsg",qt(qt({},generatorMsgForCmd$1(h,h.from,h.fromDeviceId)),{status:"sendFailed"})),c.core.reporter.report("msgSend",{msgId:h.idServer,clientId:h.idClient,msgTime:h.time,fromAccid:"p2p"===t.scene?c.core.account:"",toAccid:h.to,type:Hp[h.scene],roomId:"",tid:"p2p"===t.scene?"":h.to,result:null==a?void 0:a.code,failReason:(null==a?void 0:a.message)||"",rt:Ri()-I.time}),a}))},a.resendMsg=function resendMsg(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},t),a=t.msg,c=qt(qt({},a),{attach:a.attach?Uc(a.attach):void 0,setting:{resendFlag:!0}}),a.from===this.core.account){m.next=5;break}throw new Error("You can only resend messages that you sent: "+a.idClient);case 5:return m.abrupt("return",this.sendMsg(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.forwardMsg=function forwardMsg(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c;return Lc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:getEnumKeys(Hp)},to:{type:"string",allowEmpty:!1}},t),a=t.msg,c=qt(qt({},a),{scene:t.scene,to:t.to,attach:a.attach?Uc(a.attach):void 0}),m.abrupt("return",this.sendMsg(c));case 4:case"end":return m.stop()}}),_callee2,this)})))},a.sendImageMsg=function sendImageMsg(t){return this.doSendFile(qt(qt({},t),{type:"image"}))},a.sendFileMsg=function sendFileMsg(t){return this.doSendFile(qt(qt({},t),{type:"file"}))},a.sendAudioMsg=function sendAudioMsg(t){return this.doSendFile(qt(qt({},t),{type:"audio"}))},a.sendVideoMsg=function sendVideoMsg(t){return this.doSendFile(qt(qt({},t),{type:"video"}))},a.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({scene:{type:"enum",values:getEnumKeys(Hp)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){c.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){c.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return c.prev=5,c.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=c.sent,c.next=15;break;case 11:throw c.prev=11,c.t0=c.catch(5),this.logger.error("sendFile:: upload File error or abort.",c.t0),c.t0;case 15:return c.abrupt("return",this.sendMsg(qt(qt({},t),{attach:Uc(a),type:t.type})));case 16:case"end":return c.stop()}}),_callee3,this,[[5,11]])})))},a.recallMsg=function recallMsg(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c,m,h,g,I;return Lc.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:getEnumKeys(Hp)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:tv},ps:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msg,c={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},m={p2p:7,team:8,superTeam:12},h=processPushInfoInMsg({time:a.time,type:m[a.scene],to:a.to,from:a.from,ps:t.ps,attach:t.attach,deletedIdClient:a.idClient,deletedIdServer:a.idServer,opeAccount:a.from,env:t.env,pushInfo:t.pushInfo}),M.next=7,this.core.sendCmd(c[a.scene],{recallMsgTag:h});case 7:return g=qt({},a,{deletedMsgCreateTime:a.time}),I=formatDeletedMsgs([g]),this.core.eventBus.emit("session/updateForDeletedMsg",I),this.core.eventBus.emit("forwardSend/msg/recallMsg",h),M.abrupt("return",a);case 12:case"end":return M.stop()}}),_callee4,this)})))},a.deleteSelfMsgs=function deleteSelfMsgs(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c,m,h,g;return Lc.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:return validate({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msgs,c=map$6(a).call(a,(function(a){return{scene:"p2p"===a.scene?1:2,from:a.from,to:a.to,idServer:a.idServer,idClient:a.idClient,deletedMsgCreateTime:a.time,ext:t.ext}})),I.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:c});case 5:return m=I.sent,h=map$6(c).call(c,(function(t){var a;return qt({},t,{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})})),g=formatDeletedMsgs(h),this.core.eventBus.emit("session/updateForDeletedMsg",g),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",map$6(c).call(c,(function(t){var a;return qt(qt({},t),{time:null===(a=null==m?void 0:m.content)||void 0===a?void 0:a.timetag})}))),I.abrupt("return",g);case 11:case"end":return I.stop()}}),_callee5,this)})))},a.sendMsgReceipt=function sendMsgReceipt(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var m,h,g,I;return Lc.wrap((function _callee6$(M){for(;;)switch(M.prev=M.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),"p2p"===(m=t.msg).scene&&"in"===m.flow){M.next=5;break}return this.logger.warn("Msg scene: "+m.scene+", flow: "+m.flow+" is not allowed to send msg receipt"),M.abrupt("return",void 0);case 5:return h={to:m.target,idClient:m.idClient,time:m.time},M.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:h});case 8:return g=M.sent,I=zp(null===(c=null===(a=g.content)||void 0===a?void 0:a.msgReceiptTag)||void 0===c?void 0:c.time),M.abrupt("return",qt(qt({},h),{time:I?Math.min(I,h.time):h.time}));case 11:case"end":return M.stop()}}),_callee6,this)})))},a.sendTeamMsgReceipt=function sendTeamMsgReceipt(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var a;return Lc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},t),a=t.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:a}),c.abrupt("return",void 0);case 4:case"end":return c.stop()}}),_callee7,this)})))},a.getTeamMsgReads=function getTeamMsgReads(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var c,m,h;return Lc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),c=t.teamMsgReceipts,g.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:c});case 4:return m=g.sent,h=(h=null===(a=m.content)||void 0===a?void 0:a.teamMsgReceipts)?map$6(h).call(h,(function(t){return qt(qt({},t),{read:zp(t.read),unread:zp(t.unread)})})):[],g.abrupt("return",h);case 8:case"end":return g.stop()}}),_callee8,this)})))},a.getTeamMsgReadAccounts=function getTeamMsgReadAccounts(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a,c;return Lc.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),a=t.teamMsgReceipt,m.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:a});case 4:return c=m.sent,m.abrupt("return",c.content);case 6:case"end":return m.stop()}}),_callee9,this)})))},a.markMsgsAck=function markMsgsAck(t){if(t&&t.length>0){var a=[],c=[];forEach$1(t).call(t,(function(t){"p2p"===t.scene&&"in"===t.flow?a.push(t):"team"===t.scene&&"in"===t.flow&&c.push(t)})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:map$6(a).call(a,(function(t){return t.idServer}))}),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:map$6(c).call(c,(function(t){return t.idServer}))})}},a.onMsgHandler=function onMsgHandler(t){var a;if(t.error)this.logger.error("msgHandler::recvError",t.error);else{var c="number"==typeof Rs(t,"raw.r[0]")?""+t.raw.r[0]:void 0,m=t.content.msg;m.idServer=m.idServer||c;var h=getSessionId(m,this.core.account),g=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:h}),I=formatMsg$1(m,g?{account:this.core.account,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:this.core.account});"debug"===this.core.options.debugLevel?this.logger.debug("msgHandler::recvMsg",I.idClient,I.idServer,I):this.logger.log("msgHandler::recvMsg",I.idClient,I.idServer),this.markMsgsAck([I]),this.core.eventBus.emit("session/updateForNewMsg",I),"superTeam"===I.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:I.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:I.time}),this.core.emit("msg",I),"notification"===I.type?this.core.eventBus.emit("team/onNotification",I):"out"!==I.flow&&this.doMsgReceiveReport(I,t),"notification"!==I.type&&this.core.user.checkUserUpdate(I)}},a.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.from!==this.core.account){var c="p2p"===t.scene,m=Rs(t,"__clientExt.statistics.apiCallingTime")||0,h=Rs(t,"__clientExt.statistics.sendTime")||0,g=Rs(t,"__clientExt.statistics.attachUploadDuration")||0,I=this.core.timeOrigin.getNTPTime(),M=t.time,T=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):I;this.core.reporter.report("msgReceive",{msgId:t.idServer,clientId:t.idClient,serverTime:M,receiveTime:T,fromAccid:c?t.from:"",toAccid:t.to,type:Hp[t.scene],tid:c?"":t.to,apiCallingTime:m,sendTime:h,attachUploadDuration:g,callbackTime:I,preHandleTime:I,result:200,failReason:"",rt:I-M})}},a.nimOnTeamMsgsHandler=function nimOnTeamMsgsHandler(t){var a,c=this;forEach$1(a=t.content.datas).call(a,(function(a){c.onMsgHandler(qt({},t,{content:{msg:a}}))}))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a,c,m=t.content.msgs||[];if(0!==m.length){var h=getSessionId(m[0],this.core.account),g=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:h}),I=(m=formatMsgs$1(m,g?{account:this.core.account,featureValue:Wp.roam,sessionAck:g.ack,msgReceiptTime:g.msgReceiptTime}:{account:this.core.account,featureValue:Wp.roam}))[0].time,M={timetag:I,sessionId:h,msgs:eT(m)};(null===(c=this.core.sync)||void 0===c?void 0:c.getSyncDoneFlag())||this.core.eventBus.emit("session/syncMsgs",M),this.core.emit("syncRoamingMsgs",M),"superTeam"===m[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:I}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:I})}},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a,c=this,m=t.content.msgs||[];if(0!==m.length){var h={},g=[];forEach$1(m).call(m,(function(t){var a=getSessionId(t,c.core.account),m=c.core.session.getSessionWithUncomplete({id:a}),I=formatMsg$1(t,m?{account:c.core.account,featureValue:Wp.leave,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:c.core.account,featureValue:Wp.leave});g.push(I),h[I.sessionId]?h[I.sessionId].push(I):h[I.sessionId]=[I]})),this.markMsgsAck(g);var I=0;forEach$1(a=mn(h)).call(a,(function(t){var a,m=sort(a=h[t]).call(a,(function(t,a){return a.time-t.time}));(m=removeDupMsgsByIdClient(m))[0].time>I&&(I=m[0].time);var g={timetag:m[0].time,sessionId:t,msgs:m};c.core.eventBus.emit("session/syncMsgs",g),c.core.emit("syncOfflineMsgs",g)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:I})}},a.syncDeleteSelfMsgsHandler=function syncDeleteSelfMsgsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.deletedMsgs;c&&c.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var m=c[c.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:m})},a.onDeleteSelfMsgHandler=function onDeleteSelfMsgHandler(t){var a=formatDeletedMsgs([t.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onDeleteSelfMsgsHandler=function onDeleteSelfMsgsHandler(t){var a=formatDeletedMsgs(t.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.msg,c=this.service.processBroadcastMsg([a]);this.core.emit("broadcastMsgs",c)},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.msgs,c=this.service.processBroadcastMsg(a);this.core.emit("broadcastMsgs",c)},MsgService}(Mg),iT={"6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},oT={notifyDetectTag:{type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105}},sT={getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Ch(oT.notifyDetectTag)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:oT.notifyDetectTag}]}},cT={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}};var lT=function(t){function MiscService(a){var c;return(c=t.call(this,"misc",a)||this).core=a,registerParser({cmdMap:iT,cmdConfig:sT}),c.setListener(),c}wt(MiscService,t);var a=MiscService.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){t.core.timeOrigin.setOriginTimetick()}))},a.getServerTime=function getServerTime(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t;return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=a.sent,a.abrupt("return",zp(t.content.time));case 4:case"end":return a.stop()}}),_callee,this)})))},a.notifyDetectHandler=function notifyDetectHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return m=t.content.data,(a=format(cT,m)).t3=t.__receiveTimeNode.time,a.t4=Ri(),c.prev=3,c.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:a});case 6:c.next=11;break;case 8:c.prev=8,c.t0=c.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",c.t0);case 11:case"end":return c.stop()}var m}),_callee2,this,[[3,8]])})))},MiscService}(Mg);var uT=function baseSet(t,a,c,m){if(!Ao(t))return t;for(var h=-1,g=(a=Cs(a,t)).length,I=g-1,M=t;null!=M&&++h<g;){var T=As(a[h]),S=c;if("__proto__"===T||"constructor"===T||"prototype"===T)return t;if(h!=I){var E=M[T];void 0===(S=m?m(E,T,M):void 0)&&(S=Ao(E)?E:jd(a[h+1])?[]:{})}Fd(M,T,S),M=M[T]}return t};var dT=function basePickBy(t,a,c){for(var m=-1,h=a.length,g={};++m<h;){var I=a[m],M=Ns(t,I);c(M,I)&&uT(g,Cs(I,t),M)}return g};var pT=function basePick(t,a){return dT(t,a,(function(a,c){return Xf(t,c)}))},mT=po?po.isConcatSpreadable:void 0;var hT=function isFlattenable(t){return so(t)||_d(t)||!!(mT&&t&&t[mT])};var fT=function baseFlatten(t,a,c,m,h){var g=-1,I=t.length;for(c||(c=hT),h||(h=[]);++g<I;){var M=t[g];a>0&&c(M)?a>1?baseFlatten(M,a-1,c,m,h):pf(h,M):m||(h[h.length]=M)}return h};var gT=function flatten(t){return(null==t?0:t.length)?fT(t,1):[]};var vT=function flatRest(t){return sp(rp(t,void 0,gT),t+"")}((function(t,a){return null==t?{}:pT(t,a)}));function _createForOfIteratorHelperLoose$3(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$3(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$3(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$3(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var yT=function(t){function UserService(a){var c;return(c=t.call(this,"user",a)||this).userInfoMap=new Il,c.myInfo=formatUser({}),registerParser({cmdMap:hv,cmdConfig:vv}),c}wt(UserService,t);var a=UserService.prototype;return a.setBlack=function setBlack(t){var a=this;return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),this.core.sendCmd("setBlack",t).then((function(){a.core.eventBus.emit("forwardSend/user/updateBlackList",t.account,t.isAdd)}))},a.setMute=function setMute(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),a.next=3,this.core.sendCmd("setMute",t).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",t.account,t.isAdd);case 4:case"end":return a.stop()}}),_callee,this)})))},a.getRelations=function getRelations(){return this.core.sendCmd("syncRelations",{timetag:0})},a.getBlackList=function getBlackList(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var t;return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.blackList||[]);case 4:case"end":return a.stop()}}),_callee2,this)})))},a.getMuteList=function getMuteList(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var t;return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.muteList||[]);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.updatePushToken=function updatePushToken(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee4,this)})))},a.updateAppBackground=function updateAppBackground(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return t.stop()}}),_callee5,this)})))},a.getUsersNameCardFromServer=function getUsersNameCardFromServer(t){var a=this;return validate({accounts:{type:"array",max:150,itemType:"string"}},t),this.core.sendCmd("getUsersNameCardFromServer",vT(t,["accounts"])).then((function(c){var m,h=c.content;return a.logger.log("user:: getUsers done",t.accounts),h&&h.users?map$6(m=h.users).call(m,(function(t){return formatUser(t)})):[]}))},a.updateMyNameCard=function updateMyNameCard(t){var a=this;if(validate({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:getEnumKeys(cI),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},t),0===mn(t).length)return Mi.resolve(this.myInfo);var c=vT(t,["nick","avatar","signature","email","birth","tel","ext"]);return t.gender&&(c.gender=cI[t.gender]),this.core.sendCmd("updateMyNameCard",{user:c}).then((function(m){var h=m.content;return h&&h.timetag&&a.core.eventBus.emit("sync/updateTimetag",{myInfo:+h.timetag}),t.gender&&(c.gender=t.gender),a.myInfo=qt({},a.myInfo,c),a.core.eventBus.emit("forwardSend/user/updateUserInfo",c),a.myInfo}))},a.checkUserUpdate=function checkUserUpdate(t){var a=t.from;if(a!==this.core.account){var c=this.userInfoMap.get(a);if(c){var m=c.updateTime,h=t.userUpdateTime;!isNaN(m)&&!isNaN(h)&&"number"==typeof m&&"number"==typeof h&&m<h&&this.refreshUserInfo(a)}else this.refreshUserInfo(a)}},a.refreshUserInfo=function refreshUserInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c,m,h;return Lc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.getUsersNameCardFromServer({accounts:[t]});case 2:for(a=g.sent,c=_createForOfIteratorHelperLoose$3(a);!(m=c()).done;)h=m.value,this.userInfoMap.set(h.account,h),this.core.emit("updateUserInfo",h);case 4:case"end":return g.stop()}}),_callee6,this)})))},a.onUpdateBlackListHandler=function onUpdateBlackListHandler(t){var a=t.content;a.account?this.core.emit("updateBlackList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.onUpdateMuteListHandler=function onUpdateMuteListHandler(t){var a=t.content;a.account?this.core.emit("updateMuteList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.syncRelationsHandler=function syncRelationsHandler(t){var a=t.content,c=a.list,m=a.timetag,h={blackList:[],muteList:[]};return m&&this.core.eventBus.emit("sync/updateTimetag",{relations:m}),c&&c.length&&forEach$1(c).call(c,(function(t){var a=function formatRelationMember(t){var a={account:t.account,updateTime:+t.updateTime,createTime:+t.createTime};return"1"===t.isMuted&&(a.isMuted=!0),"1"===t.isBlack&&(a.isBlack=!0),a}(t);a.isBlack&&h.blackList.push(a),a.isMuted&&h.muteList.push(a)})),this.core.emit("relations",h),Mi.resolve(h)},a.syncMyNameCardHandler=function syncMyNameCardHandler(t){t.content.user&&(this.myInfo=formatUser(t.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:t.content.timetag}))},a.onUpdateMyNameCardHandler=function onUpdateMyNameCardHandler(t){var a=t.content.user;a?(qt(this.myInfo,formatUser(a)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},UserService}(Mg),_T=/\s/;var IT=function trimmedEndIndex(t){for(var a=t.length;a--&&_T.test(t.charAt(a)););return a},MT=/^\s+/;var TT=function baseTrim(t){return t?t.slice(0,IT(t)+1).replace(MT,""):t},ST=/^[-+]0x[0-9a-f]+$/i,ET=/^0b[01]+$/i,bT=/^0o[0-7]+$/i,CT=parseInt;var AT=function toNumber(t){if("number"==typeof t)return t;if(So(t))return NaN;if(Ao(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=Ao(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=TT(t);var c=ET.test(t);return c||bT.test(t)?CT(t.slice(2),c?2:8):ST.test(t)?NaN:+t},NT=1/0;var RT=function toFinite(t){return t?(t=AT(t))===NT||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var kT=function toInteger(t){var a=RT(t),c=a%1;return a==a?c?a-c:a:0},wT=Math.max;var OT=function findIndex(t,a,c){var m=null==t?0:t.length;if(!m)return-1;var h=null==c?0:kT(c);return h<0&&(h=wT(m+h,0)),bm(t,ng(a),h)},PT={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},xT={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},VT=invertSerializeMap(xT),LT={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:VT.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:VT.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:xT.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:xT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:VT.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:xT.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:xT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:VT.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:VT.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:VT.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:VT.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:VT.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:xT.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[{type:"PropertyArray",name:"datas",reflectMapper:{0:"scene",1:"to",2:"from",7:"time",12:"idServer"}}]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[{type:"Property",name:"context",reflectMapper:{1:"timetag",2:"type"}},{type:"PropertyArray",name:"datas",reflectMapper:VT.sessionReliableSyncTag}]}},DT={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatStickTop(t,a,c){void 0===c&&(c=!0);var m=format(DT,t);m.isStickOnTop=c,m.id=a.id,c||(m.ext="");var h=qt(qt({},a),{stickTopInfo:a.stickTopInfo?qt({},a.stickTopInfo,m):m});return void 0===h.lastMsg&&(h.lastMsg=null),h}var UT={scene:{type:"enum",values:Hp},time:{type:"number"}};var FT=function(){function StickTopService(t){this.core=t}var t=StickTopService.prototype;return t.getSession=function getSession(t){return this.core.session.getSessionWithUncomplete({id:t})||this.core.session.createSession(t)},t.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I;return Lc.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m,ext:t.ext||""}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop(h.content.data,g),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee,this)})))},t.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g,I;return Lc.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop({updateTime:h.content.timetag,ext:""},g,!1),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee2,this)})))},t.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m,h,g,I;return Lc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),c=a.scene,m=a.accid,M.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===c?"super_team":c)+"|"+m,ext:t.ext||""}});case 4:return h=M.sent,g=this.getSession(t.id),I=formatStickTop(h.content.data,g),M.abrupt("return",I);case 8:case"end":return M.stop()}}),_callee3,this)})))},t.stickTopSessionHandler=function stickTopSessionHandler(t,a){void 0===a&&(a=!0);var c=getAccountFromSessionId(t.id,"|"),m=c.scene+"-"+c.accid;return formatStickTop(t,this.getSession(m),a)},StickTopService}(),BT=function(){function UnreadModuleService(t){this.core=t,this.logger=t.logger}var t=UnreadModuleService.prototype;return t.canSessionResetUnreadCount=function canSessionResetUnreadCount(t){var a=t.id;if(void 0===t.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+a+" is not completly, lastMsg undefined");return null!==t.lastMsg||t.unread>0?!(t.ack&&t.lastMsg&&t.ack>=t.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function filterSessionForResetUnreadCount(t){var a=this,c={cmd:"markMultSuperTeamSessionsAck",params:[]},m={cmd:"markMultSessionsAck",params:[]};return forEach$1(t).call(t,(function(t){var h;try{if(!a.canSessionResetUnreadCount(t))return;var g=getAccountFromSessionId(t.id),I=g.accid,M=g.scene,T={to:I,sessionId:t.id,timetag:(null===(h=null==t?void 0:t.lastMsg)||void 0===h?void 0:h.time)||t.updateTime||0},S=function generateSceneForCmd(t){return formatReverse({scene:{type:"enum",values:Hp}},t)}({scene:M});"superTeam"===M?c.params.push(T):m.params.push(qt(qt({},T),S))}catch(t){a.logger.warn(t)}})),{superTeam:c,p2pOrTeam:m}},UnreadModuleService}(),qT=Math.ceil,GT=Math.max;var jT=function chunk(t,a,c){a=(c?lp(t,a,c):void 0===a)?1:GT(kT(a),0);var m=null==t?0:t.length;if(!m||a<1)return[];for(var h=0,g=0,I=Array(qT(m/a));h<m;)I[g++]=ig(t,h,h+=a);return I};function _createForOfIteratorHelperLoose$2(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$2(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$2(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var HT=function(t){function SessionService(a,c){var m;return(m=t.call(this,"session",a)||this).list=new Il,m.unreadCountFilterFn=function(t){return!0},m.lastMessageFilterFn=function(t){return!0},m.initEventListeners(),registerParser({cmdMap:PT,cmdConfig:LT}),m.stickTopService=new FT(a),m.unreadModule=new BT(a),c&&m.setOptions(c),m}wt(SessionService,t);var a=SessionService.prototype;return a.setOptions=function setOptions(t){"function"==typeof(null==t?void 0:t.unreadCountFilterFn)&&(this.unreadCountFilterFn=t.unreadCountFilterFn),"function"==typeof(null==t?void 0:t.lastMessageFilterFn)&&(this.lastMessageFilterFn=t.lastMessageFilterFn)},a.reset=function reset(){var t;forEach$1(t=this.list).call(t,(function(t){t.unreadMsgs=[]})),this.list.clear()},a.initEventListeners=function initEventListeners(){var t,a,c,m=this;this.core.eventBus.on("session/syncMsgs",bind$1(t=this.onSyncMsgs).call(t,this)),this.core.eventBus.on("session/updateForNewMsg",bind$1(a=this.updateSessionWithMsg).call(a,this)),this.core.eventBus.on("session/updateForClearMsg",(function(t,a){void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){m.updateSession({id:t.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},a)}))})),this.core.eventBus.on("session/updateForDeletedMsg",bind$1(c=this.updateSessionForDeletedMsg).call(c,this))},a.createSession=function createSession(t,a){try{var c=getAccountFromSessionId(t);return{id:t,scene:c.scene,to:c.accid,lastMsg:a,updateTime:a?a.time:0,unread:0,unreadMsgs:[],ack:0}}catch(a){throw this.logger.error("Failed to create session with "+t,a),new Error("Failed to create session with "+t)}},a.getSession=function getSession(t){validate({id:{type:"string",allowEmpty:!1}},t);var a=this.list.get(t.id);if(this.isSessionComplete(a))return a},a.getSessionWithUncomplete=function getSessionWithUncomplete(t){return this.list.get(t.id)},a.getAllSessions=function getAllSessions(){for(var t,a=[],c=_createForOfIteratorHelperLoose$2(this.list);!(t=c()).done;){var m=t.value;m[0];var h=m[1];this.isSessionComplete(h)&&a.push(h)}return a},a.getSessions=function getSessions(t){validate({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},t);var a=[],c=t.limit,m=void 0===c?100:c,h=t.desc,g=void 0===h||h,I=t.lastSessionId,M=0;if(g){for(var T,S,E=_createForOfIteratorHelperLoose$2(this.list);!(S=E()).done;){var b=S.value,C=b[0],A=b[1];if(I===C)break;this.isSessionComplete(A)&&a.push(A)}return reverse$1(T=slice(a).call(a,-m)).call(T)}for(var N,R=_createForOfIteratorHelperLoose$2(this.list);!(N=R()).done;){var k=N.value,w=k[0],O=k[1];if(I)w===I&&(I=void 0);else if(this.isSessionComplete(O)){if(++M>m)break;a.push(O)}}return a},a.resetSessionUnreadCount=function resetSessionUnreadCount(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I,M,T,S,E=this;return Lc.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({id:{type:"string",allowEmpty:!1}},t),validate({id:{type:"string",allowEmpty:!1}},t),c=t.id,m=this.list.get(c)){b.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+c),new Error("Session::canSessionResetUnreadCount: can not find session "+c);case 7:h=!1;try{h=this.unreadModule.canSessionResetUnreadCount(m)}catch(t){this.logger.warn(t)}if(!1!==h){b.next=11;break}return b.abrupt("return");case 11:return g=getAccountFromSessionId(c),I=g.accid,M=g.scene,T={to:I,timetag:(null===(a=null==m?void 0:m.lastMsg)||void 0===a?void 0:a.time)||m.updateTime||0},S="markSuperTeamSessionAck","superTeam"!==M&&(T.scene="p2p"===M?0:1,S="markSessionAck"),b.abrupt("return",this.core.sendCmd(S,T).then((function(){var t=E.storeUnreadByAck(c,T.timetag);t&&E.core.emit("updateSession",t)})));case 16:case"end":return b.stop()}}),_callee,this)})))},a.resetMultiSessionUnreadCount=function resetMultiSessionUnreadCount(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g,I,M,T,S,E,b,C,A,N,R=this;return Lc.wrap((function _callee2$(k){for(;;)switch(k.prev=k.next){case 0:validate({ids:{type:"array",itemType:"string",min:1}},t),m=filter(a=map$6(c=t.ids).call(c,(function(t){return R.list.get(t)}))).call(a,(function(a,c){return!!a||(R.logger.warn("Session::canSessionResetUnreadCount: can not find session "+t.ids[c]),!1)})),h=this.unreadModule.filterSessionForResetUnreadCount(m),g=h.superTeam,I=h.p2pOrTeam,M=jT(g.params,50),T=jT(I.params,50),S=_createForOfIteratorHelperLoose$2(M);case 6:if((E=S()).done){k.next=13;break}return b=E.value,k.next=10,this.core.sendCmd(g.cmd,{datas:b});case 10:forEach$1(b).call(b,(function(t){var a=R.storeUnreadByAck(t.sessionId,t.timetag);a&&R.core.emit("updateSession",a)}));case 11:k.next=6;break;case 13:C=_createForOfIteratorHelperLoose$2(T);case 14:if((A=C()).done){k.next=21;break}return N=A.value,k.next=18,this.core.sendCmd(I.cmd,{datas:N});case 18:forEach$1(N).call(N,(function(t){var a=R.storeUnreadByAck(t.sessionId,t.timetag);a&&R.core.emit("updateSession",a)}));case 19:k.next=14;break;case 21:case"end":return k.stop()}}),_callee2,this)})))},a.resetAllSessionsUnreadCount=function resetAllSessionsUnreadCount(){var t,a=[];return forEach$1(t=this.list).call(t,(function(t){a.push(t.id)})),this.resetMultiSessionUnreadCount({ids:a})},a.deleteSession=function deleteSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},t),this.list.delete(t.id),!this.core.msgLog||!t.isSyncToServer){a.next=5;break}return a.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[t.id]});case 5:case"end":return a.stop()}}),_callee3,this)})))},a.deleteAllSessionsFromLocal=function deleteAllSessionsFromLocal(){this.list.clear()},a.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.addStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee4,this)})))},a.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.deleteStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee5,this)})))},a.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a;return Lc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.stickTopService.updateStickTopSession(t);case 2:return a=c.sent,this.list.set(a.id,a),c.abrupt("return",a);case 5:case"end":return c.stop()}}),_callee6,this)})))},a.nimMultiSyncAddStickTopSessionHandler=function nimMultiSyncAddStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncDeleteStickTopSessionHandler=function nimMultiSyncDeleteStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler({id:t.content.data.id,updateTime:t.content.timetag,ext:""},!1);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncUpdateStickTopSessionHandler=function nimMultiSyncUpdateStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimSyncStickTopSessionsHandler=function nimSyncStickTopSessionsHandler(t){var a,c=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:t.content.timetag}),t.content.isThereAnyChange){var m=t.content.datas,h=[];forEach$1(a=this.list).call(a,(function(t){var a;t&&(null===(a=null==t?void 0:t.stickTopInfo)||void 0===a?void 0:a.isStickOnTop)&&h.push(t)})),forEach$1(h).call(h,(function(t){var a=t.id;if(!find(m).call(m,(function(t){var c=getAccountFromSessionId(t.id,"|");return c.scene+"-"+c.accid===a}))){var c={},h=getAccountFromSessionId(a,"-"),g=h.scene,I=h.accid;c.id=g+"|"+I,c.ext="",c.isTop=!1,m.push(c)}})),forEach$1(m).call(m,(function(t){var a;!1===t.isTop?(delete t.isTop,a=c.stickTopService.stickTopSessionHandler(t,!1)):a=c.stickTopService.stickTopSessionHandler(t),c.list.set(a.id,a)}))}},a.updateSessionWithMsg=function updateSessionWithMsg(t){var a,c,m=!0,h=!0,g="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(c=t.pushInfo)||void 0===c?void 0:c.needPushBadge);try{m=!!this.unreadCountFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",t)}try{h=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",t)}var I=this.list.get(t.sessionId)||this.createSession(t.sessionId),M=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",t.sessionId,t.idClient,t.idServer,h,m),h&&(!I.lastMsg||I.lastMsg.time<t.time||t.status===Yp[Yp.sending]||I.lastMsg.status===Yp[Yp.sending])&&(I.lastMsg=t,I.updateTime=t.time,M=!0),m&&g&&t.status===Yp[Yp.unread]&&t.time>(I.ack||0)){I.unread++;var T=I.unreadMsgs||[];T.unshift(t),sort(T).call(T,(function(t,a){return a.time-t.time})),M=!0}M&&(this.logger.log("session:updateSessionWithMsg updating ",I.id,I.unread,I.lastMsg&&I.lastMsg.idClient),this.list.set(I.id,I),this.core.emit("updateSession",I))},a.storeUnreadByAck=function storeUnreadByAck(t,a){var c=this.list.get(t)||this.createSession(t);if(!(c.ack&&a<c.ack)){var m=c.unreadMsgs||[],h=[],g=[],I=0;return c.unreadMsgs=[],m.length>0&&(forEach$1(m).call(m,(function(t){includes(g).call(g,t.idClient)||t.time>a&&(I++,g.push(t.idClient),h.push(t))})),c.unreadMsgs=sort(h).call(h,(function(t,a){return a.time-t.time}))),c.ack=a,c.unread=I,c.lastMsg&&"unread"===c.lastMsg.status&&a>=c.lastMsg.time&&(c.lastMsg.status="read"),this.list.set(t,c),c}this.logger.warn("storeUnreadByAck: not need update ack",t,a,c.ack)},a.updateSession=function updateSession(t,a){void 0===a&&(a=!0);var c=t.id,m=this.list.get(c)||this.createSession(t.id),h=qt(m,t);return this.list.set(c,h),this.logger.log("updateSession: update",a,vT(t,["id","ack","unread"]),h.lastMsg&&h.lastMsg.idClient),a&&this.core.emit("updateSession",h),h},a.isSessionComplete=function isSessionComplete(t){return!!t&&(!!(t.id&&t.scene&&t.to)&&void 0!==t.lastMsg)},a.syncSessionAckHandler=function syncSessionAckHandler(t){var a,c,m=this,h=t.content.p2p||{},g=t.content.team.m_map||{};this.logger.log("syncSessionAck::",h,g),forEach$1(a=mn(h)).call(a,(function(t){m.updateSession({id:"p2p-"+t,ack:h[t]},!1)})),forEach$1(c=mn(g)).call(c,(function(t){m.updateSession({id:"team-"+t,ack:g[t]},!1)}))},a.syncSuperTeamSessionAckHandler=function syncSuperTeamSessionAckHandler(t){var a,c=this,m=t.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",m),forEach$1(a=mn(m)).call(a,(function(t){c.updateSession({id:"superTeam-"+t,ack:m[t]},!1)}))},a.syncMarkSessionAckHandler=function syncMarkSessionAckHandler(t){var a=t.content,c=(0===a.scene?"p2p":1===a.scene?"team":"superTeam")+"-"+a.to,m=this.list.get(c);if(m&&m.ack&&a.timetag<m.ack)this.logger.warn("syncMarkSessionAckHandler: "+c+" do not need update ack",m.ack,a.timetag);else{var h=this.storeUnreadByAck(c,a.timetag);h&&this.core.emit("updateSession",h)}},a.syncMarkSuperTeamSessionAckHandler=function syncMarkSuperTeamSessionAckHandler(t){t.content.scene=5,this.syncMarkSessionAckHandler(t)},a.onSyncDone=function onSyncDone(){var t,a,c,m=this,h=[];forEach$1(t=this.list).call(t,(function(t,a){h.push(m.storeUnreadByAck(a,t.ack||0))})),this.list.clear(),forEach$1(a=sort(h).call(h,(function(t,a){return t.updateTime-a.updateTime}))).call(a,(function(t){m.list.set(t.id,t)})),(h=sort(c=filter(h).call(h,(function(t){return m.isSessionComplete(t)}))).call(c,(function(t,a){return a.updateTime-t.updateTime}))).length>0&&this.core.emit("sessions",h)},a.onSyncMsgs=function onSyncMsgs(t){var a,c=this,m=this.list.get(t.sessionId),h=[];try{var g;h=filter(g=t.msgs).call(g,(function(t){var a,m,h="boolean"!=typeof(null===(a=t.pushInfo)||void 0===a?void 0:a.needPushBadge)||(null===(m=t.pushInfo)||void 0===m?void 0:m.needPushBadge);return c.unreadCountFilterFn(JSON.parse(Uc(t)))&&h}))}catch(t){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",t)}var I,M=[];try{var T;M=filter(T=t.msgs).call(T,(function(t){return c.lastMessageFilterFn(JSON.parse(Uc(t)))}))}catch(t){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",t)}M&&M.length>0&&(I=M[M.length-1],I=M[0].time>I.time?M[0]:I);var S=I?I.time:0;m||(m=I?this.createSession(t.sessionId,I):this.createSession(t.sessionId)),m.unreadMsgs=m.unreadMsgs?filter(a=concat(h).call(h,m.unreadMsgs)).call(a,(function(t){return t.status===Yp[Yp.unread]})):filter(h).call(h,(function(t){return t.status===Yp[Yp.unread]})),m.updateTime&&m.updateTime>=S||(m.updateTime=S),m.lastMsg&&m.lastMsg.time>=S||(m.lastMsg=I),this.list.set(m.id,m)},a.updateSessionForDeletedMsg=function updateSessionForDeletedMsg(t){var a,c=this,m={};forEach$1(t).call(t,(function(t){var a,h=t.to===c.core.account?t.from:t.to,g=t.scene+"-"+h,I=c.list.get(g);if(I){var M=some(a=I.unreadMsgs).call(a,(function(a){return a.idClient===t.idClient})),T=!0;try{T=!!c.unreadCountFilterFn(t)}catch(t){c.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",t)}var S=I.ack||0;if(T&&M&&S<t.time&&t.from!==c.core.account&&I.unread>0&&(I.unread=I.unread-1,I.unreadMsgs&&I.unreadMsgs.length>0)){var E,b=OT(I.unreadMsgs,{idClient:t.idClient});b>=0&&splice$1(E=I.unreadMsgs).call(E,b,1)}I.lastMsg&&I.lastMsg.idClient===t.idClient&&(I.lastMsg=null),m[I.id]=!0}})),forEach$1(a=mn(m)).call(a,(function(t){var a=c.list.get(t);a&&c.core.emit("updateSession",a)}))},a.multiSyncMsgReceiptHandler=function multiSyncMsgReceiptHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.msgReceiptTag;if(c){this.updateSessionMsgReceiptTime([c],!0),c.msgReceiptTime=c.time,c.sessionId="p2p-"+c.from,c.time,c.from;var m=__rest(c,["time","from"]);this.core.emit("msgReceipts",[m])}},a.syncMsgReceiptsHandler=function syncMsgReceiptsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.msgReceipts;c&&this.updateSessionMsgReceiptTime(c,!1)},a.updateSessionMsgReceiptTime=function updateSessionMsgReceiptTime(t,a){var c=this;void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){var m=c.list.get("p2p-"+t.from);m||(m=c.createSession("p2p-"+t.from));var h=zp(t.time);m.msgReceiptTime&&m.msgReceiptTime>=h||(m.msgReceiptTime=h,m.lastMsg&&"sent"===m.lastMsg.status&&h>=m.lastMsg.time&&(m.lastMsg.status="receipt"),c.logger.log("session: update session "+m.id+" msgReceiptTime: "+m.msgReceiptTime),c.list.set(m.id,m),a&&c.core.emit("updateSession",m))}))},a.nimSyncSessionsWithMoreRoamingHandler=function nimSyncSessionsWithMoreRoamingHandler(t){var a=function formatMoreRoamingSession(t,a){return map$6(t).call(t,(function(t){var c=format(UT,t);return c.sessionId=getSessionId(t,a),c}))}(t.content.datas,this.core.account);this.logger.log("session:syncSessionsWithMoreRoaming",a)},SessionService}(Mg),$T=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddTeamMembers=function notifyAddTeamMembers(t,a){this.core.emit("addTeamMembers",{team:t,accounts:a,members:generatorMembersByTeam(t,a)})},t.notifyUpdateTeamManagers=function notifyUpdateTeamManagers(t,a,c,m){this.core.emit("updateTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:c,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,account:a,type:c?"manager":"normal",updateTime:m}}))})},t.notifyRemoveTeamMembers=function notifyRemoveTeamMembers(t,a){this.core.emit("removeTeamMembers",{team:t,accounts:a})},t.notifyTransferTeam=function notifyTransferTeam(t,a,c){this.core.emit("transferTeam",{team:t,from:{id:t.teamId+"-"+a,type:"normal",account:a,updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+c,type:"owner",account:c,updateTime:t.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function notifyUpdateTeamMembersMute(t,a,c){this.core.emit("updateTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:c,updateTime:t.memberUpdateTime}})),mute:c})},ModuleService}();var YT=function arrayEach(t,a){for(var c=-1,m=null==t?0:t.length;++c<m&&!1!==a(t[c],c,t););return t};var WT=function baseAssign(t,a){return t&&Bd(a,dm(a),t)};var zT=function baseAssignIn(t,a){return t&&Bd(a,Kd(a),t)};var KT=function copySymbols(t,a){return Bd(t,If(t),a)},QT=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)pf(a,If(t)),t=ud(t);return a}:gf;var JT=function copySymbolsIn(t,a){return Bd(t,QT(t),a)};var XT=function getAllKeysIn(t){return mf(t,Kd,QT)},ZT=Object.prototype.hasOwnProperty;var eS=function initCloneArray(t){var a=t.length,c=new t.constructor(a);return a&&"string"==typeof t[0]&&ZT.call(t,"index")&&(c.index=t.index,c.input=t.input),c};var tS=function cloneDataView(t,a){var c=a?ad(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.byteLength)},rS=/\w*$/;var nS=function cloneRegExp(t){var a=new t.constructor(t.source,rS.exec(t));return a.lastIndex=t.lastIndex,a},aS=po?po.prototype:void 0,iS=aS?aS.valueOf:void 0;var oS=function cloneSymbol(t){return iS?Object(iS.call(t)):{}};var sS=function initCloneByTag(t,a,c){var m=t.constructor;switch(a){case"[object ArrayBuffer]":return ad(t);case"[object Boolean]":case"[object Date]":return new m(+t);case"[object DataView]":return tS(t,c);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return id(t,c);case"[object Map]":case"[object Set]":return new m;case"[object Number]":case"[object String]":return new m(t);case"[object RegExp]":return nS(t);case"[object Symbol]":return oS(t)}};var cS=function baseIsMap(t){return To(t)&&"[object Map]"==Uf(t)},lS=xd&&xd.isMap,uS=lS?Pd(lS):cS;var dS=function baseIsSet(t){return To(t)&&"[object Set]"==Uf(t)},pS=xd&&xd.isSet,mS=pS?Pd(pS):dS,hS="[object Arguments]",fS="[object Function]",gS="[object Object]",vS={};vS[hS]=vS["[object Array]"]=vS["[object ArrayBuffer]"]=vS["[object DataView]"]=vS["[object Boolean]"]=vS["[object Date]"]=vS["[object Float32Array]"]=vS["[object Float64Array]"]=vS["[object Int8Array]"]=vS["[object Int16Array]"]=vS["[object Int32Array]"]=vS["[object Map]"]=vS["[object Number]"]=vS[gS]=vS["[object RegExp]"]=vS["[object Set]"]=vS["[object String]"]=vS["[object Symbol]"]=vS["[object Uint8Array]"]=vS["[object Uint8ClampedArray]"]=vS["[object Uint16Array]"]=vS["[object Uint32Array]"]=!0,vS["[object Error]"]=vS[fS]=vS["[object WeakMap]"]=!1;var yS=function baseClone(t,a,c,m,h,g){var I,M=1&a,T=2&a,S=4&a;if(c&&(I=h?c(t,m,h,g):c(t)),void 0!==I)return I;if(!Ao(t))return t;var E=so(t);if(E){if(I=eS(t),!M)return od(t,I)}else{var b=Uf(t),C=b==fS||"[object GeneratorFunction]"==b;if(Ed(t))return rd(t,M);if(b==gS||b==hS||C&&!h){if(I=T||C?{}:md(t),!M)return T?JT(t,zT(I,t)):KT(t,WT(I,t))}else{if(!vS[b])return h?t:{};I=sS(t,b,M)}}g||(g=new Ju);var A=g.get(t);if(A)return A;g.set(t,I),mS(t)?t.forEach((function(m){I.add(baseClone(m,a,c,m,t,g))})):uS(t)&&t.forEach((function(m,h){I.set(h,baseClone(m,a,c,h,t,g))}));var N=E?void 0:(S?T?XT:Mf:T?Kd:dm)(t);return YT(N||t,(function(m,h){N&&(m=t[h=m]),Fd(I,h,baseClone(m,a,c,h,t,g))})),I};var _S=function cloneDeep(t){return yS(t,5)},IS=function(t){function TeamService(a){var c;return(c=t.call(this,"team",a)||this).myTeamMembersMap=new Il,c.service=new $T(a),c.setListeners(),registerParser({cmdMap:yv,cmdConfig:Mv}),c}wt(TeamService,t);var a=TeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.myTeamMembersMap.clear()},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.myTeamMembersMap.get(c),h=qt({},m,t);a.myTeamMembersMap.set(c,h)}))},a.getTeamInfo=function getTeamInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,c=a.content.team,m.abrupt("return",formatTeam(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getTeams=function getTeams(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var t,a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=c.sent,a=t.content.teams,c.abrupt("return",formatTeams(a));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.getTeamsById=function getTeamsById(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c;return Lc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamIds:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("getTeamsById",{teamIds:t.teamIds});case 3:return a=m.sent,c=formatTeams(a.content.teams),m.abrupt("return",{teams:c,tids:a.content.tids});case 6:case"end":return m.stop()}}),_callee3,this)})))},a.createTeam=function createTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c,m;return Lc.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),h.next=4,this.core.sendCmd("createTeam",{team:a,accounts:t.accounts||[],ps:t.ps||""});case 4:return c=h.sent,m=formatTeam(c.content.team),this.core.eventBus.emit("forwardSend/team/created",m),h.abrupt("return",m);case 8:case"end":return h.stop()}}),_callee4,this)})))},a.dismissTeam=function dismissTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("dismissTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.leaveTeam=function leaveTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee6,this)})))},a.transferTeam=function transferTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferTeam",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateTeamInfo=function updateTeamInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateTeam(t),c.next=4,this.core.sendCmd("updateTeamInfo",{team:a});case 4:return c.abrupt("return",formatTeam(a));case 5:case"end":return c.stop()}}),_callee8,this)})))},a.getTeamMembers=function getTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var c,m;return Lc.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},t),h.next=3,this.core.sendCmd("getTeamMembers",{teamId:t.teamId,timetag:0});case 3:if(c=h.sent,m=formatTeamMembers(null===(a=c.content)||void 0===a?void 0:a.teamMembers),t.accounts&&t.accounts.length>0){h.next=7;break}return h.abrupt("return",m);case 7:return h.abrupt("return",filter(m).call(m,(function(a){var c;return null===(c=t.accounts)||void 0===c?void 0:includes(c).call(c,a.account)})));case 8:case"end":return h.stop()}}),_callee9,this)})))},a.getMutedTeamMembers=function getMutedTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a,c;return Lc.wrap((function _callee10$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:t.teamId});case 3:return a=m.sent,c=a.content,m.abrupt("return",formatTeamMembers(c.teamMembers));case 6:case"end":return m.stop()}}),_callee10,this)})))},a.addTeamMembers=function addTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.removeTeamMembers=function removeTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){return Lc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee12,this)})))},a.applyTeam=function applyTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a;return Lc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),c.next=3,this.core.sendCmd("applyTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=c.sent,c.abrupt("return",formatTeam(a.content.team));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.addTeamManagers=function addTeamManagers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){return Lc.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addTeamManagers",t);case 3:case"end":return a.stop()}}),_callee14,this)})))},a.removeTeamManagers=function removeTeamManagers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){return Lc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeTeamManagers",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a,c,m;return Lc.wrap((function _callee16$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),h.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:a});case 4:return c=formatTeamMember(qt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(c),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",m),h.abrupt("return",c);case 8:case"end":return h.stop()}}),_callee16,this)})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=_S(this.myTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){var a,c;return Lc.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:a});case 4:return c=formatTeamMember(qt({updateTime:(new Date).getTime()},a)),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee17,this)})))},a.muteTeamMember=function muteTeamMember(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){return Lc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeamMember",{teamId:t.teamId,account:t.account,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getTeamMemberInvitorAccid=function getTeamMemberInvitorAccid(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var c,m;return Lc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},t),c={teamId:t.teamId},t.accounts&&t.accounts.length>0&&(c.accounts=t.accounts),h.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",c);case 5:return m=h.sent,h.abrupt("return",(null===(a=m.content)||void 0===a?void 0:a.accountsMap)||{});case 7:case"end":return h.stop()}}),_callee19,this)})))},a.muteTeam=function muteTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){return Lc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.passTeamApply=function passTeamApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a;return Lc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("passTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee21,this,[[1,7]])})))},a.rejectTeamApply=function rejectTeamApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var a;return Lc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee22,this,[[1,7]])})))},a.acceptTeamInvite=function acceptTeamInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){var a;return Lc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("acceptTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee23,this,[[1,7]])})))},a.rejectTeamInvite=function rejectTeamInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){var a;return Lc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee24,this,[[1,7]])})))},a.notifyTeamMsgReceiptsHandler=function notifyTeamMsgReceiptsHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.teamMsgReceipts;c&&c.length>0&&(this.core.emit("teamMsgReceipts",c),this.core.emit("msgReceipts",c))},a.syncTeamsHandler=function syncTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{teams:zp(a.timetag)});var c=null==a?void 0:a.teams;if(c&&c.length){var m=formatTeams(c);this.core.emit("teams",m)}},a.syncCreateTeamHandler=function syncCreateTeamHandler(t){var a=t.content,c=formatTeam(null==a?void 0:a.team),m=generatorMemberByTeam(c,c.owner,"owner");this.core.emit("createTeam",c,m)},a.syncUpdateTeamMemberHandler=function syncUpdateTeamMemberHandler(t){var a=t.content,c=formatTeamMember(null==a?void 0:a.teamMember);c.updateTime||(c.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([c]),this.core.emit("updateTeamMember",c);var m=_S(this.myTeamMembersMap.get(c.teamId));this.core.emit("myTeamMembers",[m])},a.syncMyTeamMembersHandler=function syncMyTeamMembersHandler(t){var a,c=t.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:zp(c.timetag)});var m=null==c?void 0:map$6(a=c.teamMembers).call(a,(function(t){return formatTeamMember(t)}));this.mergeMyTeamMembers(m),this.core.emit("myTeamMembers",_S(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,c=t.scene,m=t.from,h=t.to,g=t.time,I=t.idServer,M=t.idClient,T=a.team,S=a.account,E=a.accounts,b=a.type;if("team"===c)switch("debug"===this.core.options.debugLevel?this.logger.debug("team::recvNotification",I,M,a):this.logger.log("team::recvNotification",I,M,h,b,S,E),b){case"updateTeam":T.updateTime=g,this.core.emit("updateTeam",T);break;case"addTeamMembers":this.service.notifyAddTeamMembers(T,E);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(T,[m]);break;case"passTeamApply":this.service.notifyAddTeamMembers(T,[S]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(h,E,!0,g);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(h,E,!1,g);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(T,E);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(T,[m]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:h});break;case"transferTeam":this.service.notifyTransferTeam(T,m,S);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(T,[S],a.mute)}},TeamService}(Mg),MS={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","4_101":"syncOfflineSysMsgs","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg","101_3":"onSysMsg","101_7":"sendFilterCustomSysMsg"},TS={sysMsg:qt({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},rv)},SS=invertSerializeMap(TS),ES={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:SS.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:TS.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:TS.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:TS.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:SS.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:SS.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:SS.sysMsg}]}},bS=function(t){function SystemMessageService(a){var c;return(c=t.call(this,"systemMessage",a)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},c.core.eventBus.on("logined",(function(){c.initEventListeners()})),registerParser({cmdMap:MS,cmdConfig:ES}),c}wt(SystemMessageService,t);var a=SystemMessageService.prototype;return a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"decline",type:"friendRequest"}])}))},a.doMarkSysMsgAck=function doMarkSysMsgAck(t){var a=[],c=[],m=["customSuperTeam"];forEach$1(t).call(t,(function(t){t.idServer&&(includes(m).call(m,t.type)?c.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:a}),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:c})},a.sendCustomSysMsg=function sendCustomSysMsg(t){var a=this;validate({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:tv}},t);var c="customSuperTeam"===t.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(c,{sysMsg:generatorSysMsgForCmd$1(t)}).then((function(){a.logger.log("sendCustomSysMsg success")})).catch((function(t){throw a.logger.error("sendCustomSysMsg failed",t.message),t}))},a.onSysMsgHandler=function onSysMsgHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(c){var m="number"==typeof Rs(t,"raw.r[0]")?""+t.raw.r[0]:void 0;c.idServer=c.idServer||m;var h=formatSystemMessage(c,this.logger,XM.default);this.core.emit("sysMsg",h),this.doMarkSysMsgAck([h])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncOfflineSysMsgsHandler=function syncOfflineSysMsgsHandler(t){var a,c=this;if(t.content.sysMsgs&&t.content.sysMsgs.length>0){var m=map$6(a=t.content.sysMsgs).call(a,(function(t){return formatSystemMessage(t,c.logger,XM.leave)}));this.core.emit("syncSysMsgs",m),this.doMarkSysMsgAck(m)}},a.onRecallMsgHandler=function onRecallMsgHandler(t){var a,c=null===(a=t.content)||void 0===a?void 0:a.sysMsg;if(c){var m="number"==typeof Rs(t,"raw.r[0]")?""+t.raw.r[0]:void 0;c.idServer=c.idServer||m;var h=formatDeletedMsgs([c],getSceneFromRecallSysMsg(+c.type));this.core.eventBus.emit("session/updateForDeletedMsg",h);var g=formatSystemMessage(c,this.logger,XM.default);this.core.emit("sysMsg",g),this.doMarkSysMsgAck([g])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncRecallMsgOfflineAndRoamingHandler=function syncRecallMsgOfflineAndRoamingHandler(t){var a=this,c=t.content,m=c.timetag,h=c.type,g=c.sysMsgs,I=zp(h),M=1===I?XM.leave:XM.roam,T=map$6(g).call(g,(function(t){return formatSystemMessage(t,a.logger,M)}));1===I&&this.doMarkSysMsgAck(T),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:m}),this.core.emit("syncSysMsgs",T)},SystemMessageService}(Mg);function reverseFriend(t){var a=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],c=qt({},t);return forEach$1(a).call(a,(function(t){void 0!==c[t]&&(c[t]=zp(c[t]))})),void 0!==c.relationShip&&(c.valid=1===c.relationShip),c}var CS={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var AS={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},NS={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},RS=invertSerializeMap(NS),kS={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:RS.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:NS.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:NS.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:RS.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:RS.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:RS.friendTag}]}},wS=function(t){function FriendService(a){var c;return c=t.call(this,"friend",a)||this,registerParser({cmdMap:AS,cmdConfig:kS}),c}wt(FriendService,t);var a=FriendService.prototype;return a.getFriends=function getFriends(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return a=m.sent,c=(null===(t=a.content)||void 0===t?void 0:t.friends)||[],c=map$6(c).call(c,(function(t){return reverseFriend(t)})),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee,this)})))},a.addFriend=function addFriend(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:1,ps:t.ps||""});case 3:return a=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",t.account),c.abrupt("return",{account:t.account,createTime:a,updateTime:a,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return c.stop()}}),_callee2,this)})))},a.applyFriend=function applyFriend(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:2,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee3,this)})))},a.passFriendApply=function passFriendApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a=this;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:3,ps:t.ps||""}).then((function(c){return a.core.eventBus.emit("systemMessage/passFriendApply",t),c}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account),c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",t.account,c.t0),c.t0;case 11:case"end":return c.stop()}}),_callee4,this,[[1,7]])})))},a.rejectFriendApply=function rejectFriendApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a=this;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("friendReuqest",{account:t.account,type:4,ps:t.ps||""}).then((function(c){return a.core.eventBus.emit("systemMessage/rejectFriendApply",t),c}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps),c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",t.account,t.ps,c.t0),c.t0;case 11:case"end":return c.stop()}}),_callee5,this,[[1,7]])})))},a.deleteFriend=function deleteFriend(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},t),a.next=3,this.core.sendCmd("deleteFriend",{account:t.account,delFriendParams:{delAlias:!0===t.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",t.account);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.updateFriend=function updateFriend(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:t});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",t);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.syncFriendRequestHandler=function syncFriendRequestHandler(t){var a=function formatFriendRequest(t){var a=qt({},t);try{a.ps=a.ps&&JSON.parse(a.ps)}catch(t){}if(a.type=CS[a.type],"addFriend"===a.type||"passFriendApply"===a.type){var c=(new Date).getTime();a.friend={account:t.account,alias:"",createTime:c,ext:"",updateTime:c,valid:!0}}return a}(t.content);this.core.emit("syncFriend",a)},a.syncDeleteFriendHandler=function syncDeleteFriendHandler(t){var a=t.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+a),this.core.emit("syncFriend",{type:"deleteFriend",account:a})},a.syncUpdateFriendHandler=function syncUpdateFriendHandler(t){var a=reverseFriend(t.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==a?void 0:a.account),this.core.emit("syncFriend",{type:"updateFriend",friend:a})},a.syncFriendsHandler=function syncFriendsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friends:zp(a.timetag)});var c=null==a?void 0:a.friends;if(c&&c.length){var m=map$6(c).call(c,(function(t){return reverseFriend(t)}));this.core.emit("friends",m)}},a.syncFriendUsersHandler=function syncFriendUsersHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:zp(a.timetag)});var c=null==a?void 0:a.users;if(c&&c.length){var m=map$6(c).call(c,(function(t){return formatUser(t)}));this.core.emit("users",m)}},FriendService}(Mg);function formatSubscribes(t){return t&&t.length>0?map$6(t).call(t,(function(t){return function formatSubscribe(t){var a=qt({},t),c=["subscribeTime","time"];return forEach$1(c).call(c,(function(t){a[t]&&(a[t]=zp(a[t]))})),a}(t)})):[]}function formatEvent(t){if(!t)return t;var a=t.serverExt,c=__rest(t,["serverExt"]),m=["time","type","value"];if(forEach$1(m).call(m,(function(t){c[t]&&(c[t]=zp(c[t]))})),c.clientType&&(c.clientType=getEnumKeyByEnumValue($p,c.clientType)||""),a)try{c.ext=JSON.parse(a),"string"==typeof c.ext[0]&&(c.ext=c.ext[0])}catch(t){}return c}var OS={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},PS={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},xS=invertSerializeMap(PS),VS={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:PS.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:xS.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:xS.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:PS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:PS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:PS.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:PS.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:xS.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:PS.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:xS.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:xS.msgEvent}]}},LS=function(t){function EventService(a){var c;return c=t.call(this,"event",a)||this,registerParser({cmdMap:OS,cmdConfig:VS}),c}wt(EventService,t);var a=EventService.prototype;return a.publishEvent=function publishEvent(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h;return Lc.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},t),c=qt(qt({validTime:t.validTime||604800,broadcastType:t.broadcastType||2},t),{idClient:mm(),sync:!0===t.sync?1:0}),g.next=4,this.core.sendCmd("publishEvent",{msgEvent:c});case 4:return m=g.sent,h=(null===(a=m.content)||void 0===a?void 0:a.msgEvent)||{},g.abrupt("return",formatEvent(h));case 7:case"end":return g.stop()}}),_callee,this)})))},a.subscribeEvent=function subscribeEvent(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m,h;return Lc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:return validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},t),c=qt(qt({subscribeTime:2592e3},t),{sync:!0===t.sync?1:0}),g.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:c,accounts:t.accounts});case 4:return m=g.sent,h=(null===(a=m.content)||void 0===a?void 0:a.accounts)||[],g.abrupt("return",{failedAccounts:h});case 7:case"end":return g.stop()}}),_callee2,this)})))},a.unSubscribeEvents=function unSubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c,m,h;return Lc.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),c={type:t.type},!(t.accounts&&t.accounts.length>0)){g.next=9;break}return g.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:c,accounts:t.accounts});case 5:h=g.sent,m=(null===(a=h.content)||void 0===a?void 0:a.accounts)||[],g.next=12;break;case 9:return g.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:c});case 11:m=[];case 12:return g.abrupt("return",{failedAccounts:m});case 13:case"end":return g.stop()}}),_callee3,this)})))},a.querySubscribeEvents=function querySubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var c;return Lc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),!(t.accounts&&t.accounts.length>0)){m.next=7;break}return m.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:t.type},accounts:t.accounts});case 4:c=m.sent,m.next=10;break;case 7:return m.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:t.type}});case 9:c=m.sent;case 10:return m.abrupt("return",formatSubscribes(null===(a=c.content)||void 0===a?void 0:a.msgEventSubscribes));case 11:case"end":return m.stop()}}),_callee4,this)})))},a.pushEventHandler=function pushEventHandler(t){var a,c=(null===(a=t.content)||void 0===a?void 0:a.msgEvent)||{};this.core.emit("pushEvents",[formatEvent(c)])},a.pushEventsHandler=function pushEventsHandler(t){var a,c=(null===(a=t.content)||void 0===a?void 0:a.msgEvents)||{};this.core.emit("pushEvents",function formatEvents(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatEvent(t)})):[]}(c))},EventService}(Mg);function generateThreadMsgsParams(t){var a={scene:Hp[t.scene],from:t.threadMsgFromAccount,to:t.threadMsgToAccount,time:t.threadMsgTime,idServer:t.threadMsgIdServer},c={limit:t.limit<100?t.limit:100,beginTime:"number"==typeof t.beginTime?t.beginTime:0,reverse:!0===reverse$1(t)?1:0};return t.lastMsgId&&(c.lastMsgId=t.lastMsgId),{msg:a,threadMsgReq:c}}var DS,US,FS={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},BS={msg:ov,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},qS=invertSerializeMap(BS),GS={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:BS.msg},{type:"Property",name:"threadMsgReq",reflectMapper:BS.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:qS.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:qS.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:qS.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:BS.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:qS.msg}]}},jS=function(t){function MsgExtendService(a){var c;return c=t.call(this,"msgExtend",a)||this,registerParser({cmdMap:FS,cmdConfig:GS}),c}wt(MsgExtendService,t);var a=MsgExtendService.prototype;return a.getThreadMsgs=function getThreadMsgs(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g,I,M,T;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return validate({scene:{type:"enum",values:getEnumKeys(Hp)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},t),S.next=3,this.core.sendCmd("getThreadMsgs",generateThreadMsgsParams(t));case 3:return c=S.sent,m=c.content,h=m.msgs,g=m.threadMsg,I=c.content.threadMsgsMeta,M=getSessionId(g,this.core.account),T=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:M}),h=formatMsgs$1(h,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),g=formatMsg$1(g,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),S.abrupt("return",{msgs:h,threadMsg:g,total:zp(I.total),timetag:zp(I.lastMsgTime)});case 11:case"end":return S.stop()}}),_callee,this)})))},a.getMsgsByIdServer=function getMsgsByIdServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g=this;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return validate({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:getEnumKeys(Hp)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},t),I.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:map$6(a=t.reqMsgs).call(a,(function(t){return qt(qt({},t),{scene:getEnumKeyByEnumValue(Hp,t.scene)})}))});case 3:return m=I.sent,h=map$6(c=m.content.msgs).call(c,(function(t){var a,c=getSessionId(t,g.core.account),m=null===(a=g.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c});return formatMsg$1(t,m?{account:g.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:g.core.account})})),I.abrupt("return",h);case 6:case"end":return I.stop()}}),_callee2,this)})))},MsgExtendService}(Mg);!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(DS||(DS={})),function(t){t[t.p2p=1]="p2p",t[t.team=2]="team"}(US||(US={}));var HS={type:{type:"enum",values:US},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function formatClearResult(t){var a=format(HS,t);return{sessionId:"p2p"===a.type?"p2p-"+a.otherAccid:"team-"+a.toTid,time:a.time}}var $S={orderRule:{type:"enum",values:DS}};function generateFtsTagForCmd(t){var a,c=format($S,t);jc(c.msgTypeList)&&(c.msgTypeList=map$6(a=c.msgTypeList).call(a,(function(t){return jp[t]})).join(","));var m=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return forEach$1(m).call(m,(function(t){jc(c[t])&&(c[t]=c[t].join(","))})),c}var YS=function(t){function MsgLogService(a){var c;return(c=t.call(this,"msgLog",a)||this).onV2ClearHistoryMessage=function(t){var a=formatClearResult(t);c.core.eventBus.emit("session/updateForClearMsg",[a],!0)},registerParser({cmdMap:uv,cmdConfig:mv}),c.registerListener(),c}wt(MsgLogService,t);var a=MsgLogService.prototype;return a.registerListener=function registerListener(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},a.deleteRoamingMsgs=function deleteRoamingMsgs(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:validate({ids:{type:"array",itemType:"string"}},t),a=[],m.prev=2,a=map$6(c=t.ids).call(c,(function(t){var a=getAccountFromSessionId(t);return a.scene+"|"+a.accid})),m.next=10;break;case 6:throw m.prev=6,m.t0=m.catch(2),this.logger.error("Failed to delete roaming msgs with "+t.ids,m.t0),new Error("Failed to create session with "+t.ids);case 10:return m.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:a});case 12:case"end":return m.stop()}}),_callee,this,[[2,6]])})))},a.getHistoryMsgs=function getHistoryMsgs(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var m,h,g,I,M,T,S;return Lc.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:return(null===(a=this.core.sync)||void 0===a?void 0:a.getSyncDoneFlag())||this.logger.warn("Please call getHistoryMsgs after syncdone event"),validate({scene:{type:"enum",values:getEnumKeys(Hp)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},t),h="p2p"===t.scene?"getHistoryMsgs":"team"===t.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",E.next=5,this.core.sendCmd(h,qt(qt({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},t),{msgTypes:t.msgTypes?map$6(m=t.msgTypes).call(m,(function(t){return jp[t]})):[]}));case 5:if(g=E.sent,(I=g.content).msgs&&I.msgs.length>0){E.next=9;break}return E.abrupt("return",[]);case 9:if(M=getSessionId(I.msgs[0],this.core.account),T=null===(c=this.core.session)||void 0===c?void 0:c.getSessionWithUncomplete({id:M}),S=formatMsgs$1(I.msgs,T?{account:this.core.account,sessionAck:T.ack,msgReceiptTime:T.msgReceiptTime}:{account:this.core.account}),!0!==t.asc){E.next=14;break}return E.abrupt("return",sort(S).call(S,(function(t,a){return t.time-a.time})));case 14:return E.abrupt("return",S);case 15:case"end":return E.stop()}}),_callee2,this)})))},a.clearHistoryMsgsFromServer=function clearHistoryMsgsFromServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},t),(a=qt(qt({isDeleteRoam:1},t),{type:"team"===t.scene?2:1,isSyncSelf:!0===t.isSyncSelf?1:0}))[2===a.type?"toTid":"otherAccid"]=t.to,h.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:a});case 5:return c=h.sent,m=c.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:t.scene+"-"+t.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",qt(qt({},a),{time:m.timetag})),h.abrupt("return",m);case 10:case"end":return h.stop()}}),_callee3,this)})))},a.multiSyncClearServerHistoryMsgsHandler=function multiSyncClearServerHistoryMsgsHandler(t){var a=formatClearResult(t.content.data);this.core.eventBus.emit("session/updateForClearMsg",[a],!0),this.core.emit("clearServerHistoryMsgs",[a])},a.ftsCloudMsgLogs=function ftsCloudMsgLogs(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogs"));case 1:case"end":return a.stop()}}),_callee4,this)})))},a.ftsCloudMsgLogsAggWithSession=function ftsCloudMsgLogsAggWithSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return a.stop()}}),_callee5,this)})))},a.baseFtsCloudMsgLogs=function baseFtsCloudMsgLogs(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var c,m,h,g=this;return Lc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:getEnumKeys(DS),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:getEnumKeys(jp),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},t),!(t.fromTime&&t.toTime&&t.toTime<t.fromTime)){I.next=3;break}throw new Bu("Request parameter error: toTime should be greater than fromTime",t,"");case 3:return m=generateFtsTagForCmd(t),I.next=6,this.core.sendCmd(a,{tag:m});case 6:return h=I.sent,I.abrupt("return",map$6(c=h.content.datas).call(c,(function(t){var a,c=getSessionId(t,g.core.account),m=null===(a=g.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c});return formatMsg$1(t,m?{account:g.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:g.core.account})})));case 8:case"end":return I.stop()}}),_callee6,this)})))},a.syncClearServerHistoryMsgsHandler=function syncClearServerHistoryMsgsHandler(t){var a=function formatClearResults(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatClearResult(t)})):[]}(t.content.datas);this.core.emit("clearServerHistoryMsgs",a)},MsgLogService}(Mg),WS={"22_1":"requestProxy","22_2":"onRequestProxy"},zS={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},KS=invertSerializeMap(zS),QS={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:zS.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:KS.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:KS.requestProxyMsgTag}]}},JS=function(t){function PassThroughService(a){var c;return(c=t.call(this,"passThrough",a)||this).core=a,registerParser({cmdMap:WS,cmdConfig:QS}),c}wt(PassThroughService,t);var a=PassThroughService.prototype;return a.request=function request(t){return validate({path:{type:"string",allowEmpty:!1}},t),this.core.sendCmd("requestProxy",{requestProxyTag:t}).then((function(t){return t.content.requestProxyTag}))},a.onRequestProxyHandler=function onRequestProxyHandler(t){var a=t.content.proxyMsg;a&&a.time&&(a.time=+a.time),this.core.emit("proxyMsg",a)},PassThroughService}(Mg);var XS,ZS,eE=function pickBy(t,a){if(null==t)return{};var c=Ms(XT(t),(function(t){return[t]}));return a=ng(a),dT(t,c,(function(t,c){return a(t,c[0])}))},tE=function(){function NOS(t,a){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=t,this.cloudStorage=a}var t=NOS.prototype;return t.reset=function reset(){this.nosErrorCount=0},t.getNosAccessToken=function getNosAccessToken(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return a=h.sent,c=Rs(a,"content.nosAccessTokenTag.token"),m=t.url,h.abrupt("return",{token:c,url:-1!==indexOf(m).call(m,"?")?m+"&token="+c:m+"?token="+c});case 6:case"end":return h.stop()}}),_callee,this)})))},t.deleteNosAccessToken=function deleteNosAccessToken(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return a.stop()}}),_callee2,this)})))},t.nosUpload=function nosUpload(t,a){var c,m,h,g,I,M,T,S;return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var E,b,C,A,N,R,k,w,O,P,x,V,L,D,U,B,q,G,j;return Lc.wrap((function _callee3$(H){for(;;)switch(H.prev=H.next){case 0:if(E=Rs(this.core,"config.cdn.bucket"),b={tag:t.nosScenes||E||"nim"},t.nosSurvivalTime&&(b.expireSec=t.nosSurvivalTime),C=this.core.adapters.getFileUploadInformation(t),!(!a&&!C)){H.next=18;break}return H.prev=6,H.next=9,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:b});case 9:A=H.sent,H.next=18;break;case 12:if(H.prev=12,H.t0=H.catch(6),this.core.logger.error("uploadFile:: getNosToken error",H.t0),!(H.t0 instanceof Fu)){H.next=17;break}throw H.t0;case 17:throw new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:H.t0,curProvider:1}});case 18:return N=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",C?null===(c=C.uploadInfo)||void 0===c?void 0:c.objectName:a?null==a?void 0:a.objectName:A.content.nosToken.objectName),R="",a&&a.shortUrl&&(R=a.shortUrl),(null===(g=null===(h=null===(m=null==C?void 0:C.uploadInfo)||void 0===m?void 0:m.payload)||void 0===h?void 0:h.mixStoreToken)||void 0===g?void 0:g.shortUrl)&&(R=C.uploadInfo.payload.mixStoreToken.shortUrl),k=R||N,H.prev=23,O=C?{token:null===(I=null==C?void 0:C.uploadInfo)||void 0===I?void 0:I.token,bucket:null===(M=null==C?void 0:C.uploadInfo)||void 0===M?void 0:M.bucketName,objectName:null===(T=null==C?void 0:C.uploadInfo)||void 0===T?void 0:T.objectName}:a||A.content.nosToken,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:O,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,platform:_p.platform}),P="BROWSER"===_p.platform?this.config.chunkUploadHost:this.config.commonUploadHost?this.config.commonUploadHost+"/"+(O&&O.bucket):"https://nos.netease.com/nim",this.core.reporterHookCloudStorage.update({remote_addr:P,operation_type:a?2:0}),H.next=30,this.core.adapters.uploadFile(qt(qt(qt({},t),{nosToken:O,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,maxSize:t.maxSize||this.config.chunkMaxSize}),a?{payload:{mixStoreToken:a}}:{}));case 30:w=H.sent,H.next=65;break;case 33:if(H.prev=33,H.t1=H.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",H.t1),x="v2"===Rs(this.core,"options.apiVersion"),H.t1.code!==Lu.V2NIM_ERROR_CODE_CANCELLED&&10499!==H.t1.errCode){H.next=39;break}throw new ju({code:x?Lu.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Rs(H.t1,"message")||"Request abort",rawError:H.t1,curProvider:1}});case 39:if(!x||H.t1.errCode!==Lu.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){H.next=41;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Rs(H.t1,"message")||"Read file failed",rawError:H.t1,curProvider:1}});case 41:return H.next=43,_p.net.getNetworkStatus();case 43:if(V=H.sent,!1!==V.net_connect){H.next=47;break}throw new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:H.t1,curProvider:1}});case 47:if(!a){H.next=64;break}if(0!==this.nosErrorCount){H.next=60;break}H.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),H.next=56;break;case 53:throw H.prev=53,H.t2=H.catch(49),new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:H.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=Rs(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),H.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,H.abrupt("return",this.nosUpload(t,a));case 62:H.next=65;break;case 64:throw new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:H.t1,curProvider:1}});case 65:if(L=null==w?void 0:w.type,D=L&&indexOf(L).call(L,"/")>-1?slice(L).call(L,0,indexOf(L).call(L,"/")):"",(U={image:"imageInfo",video:"vinfo",audio:"vinfo"})[D]){H.next=70;break}return H.abrupt("return",qt({url:k},w));case 70:return H.prev=70,H.next=73,this.core.adapters.request(N+"?"+U[D],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 73:B=H.sent,H.next=80;break;case 76:return H.prev=76,H.t3=H.catch(70),this.core.logger.error("uploadFile:: fetch file info error",H.t3),H.abrupt("return",qt({url:k},w));case 80:if(!B){H.next=87;break}return q=B.data,G="imageInfo"===U[D]?q:null===(S=null==q?void 0:q.GetVideoInfo)||void 0===S?void 0:S.VideoInfo,j={url:k,name:w.name,size:w.size,ext:w.ext,w:G.Width,h:G.Height,orientation:G.Orientation,dur:G.Duration,audioCodec:G.AudioCodec,videoCodec:G.VideoCodec,container:G.Container},H.abrupt("return",eE(j,(function(t,a){return void 0!==a})));case 87:return H.abrupt("return",qt({url:k},w));case 88:case"end":return H.stop()}}),_callee3,this,[[6,12],[23,33],[49,53],[70,76]])})))},t._getNosCdnHost=function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c,m,h=this;return Lc.wrap((function _callee4$(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=g.sent,g.next=10;break;case 6:return g.prev=6,g.t0=g.catch(0),this.core.logger.error("getNosCdnHost::error",g.t0),g.abrupt("return");case 10:if(a){g.next=12;break}return g.abrupt("return");case 12:c=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(m=zp(null==c?void 0:c.expire))&&c.cdnDomain?-1===m?(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix):(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){h._getNosCdnHost()}),1e3*m)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return g.stop()}}),_callee4,this,[[0,6]])})))},Ke(NOS,[{key:"config",get:function get(){return this.cloudStorage.config}}]),NOS}(),rE={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},nE={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},aE={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:nE.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Ch(nE.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:nE.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Ch(nE.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Ch(nE.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Ch(nE.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Ch(nE.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:nE.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Ch(nE.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:nE.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Ch(nE.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:nE.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Ch(nE.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:nE.nosAccessTokenTag}]}},iE={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},oE={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(XS||(XS={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(ZS||(ZS={}));var sE={chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0},cE=function(){function MixStorage(t,a){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=XS.nos,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=MixStorage.prototype;return t.reset=function reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=XS.nos,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m;return Lc.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(_p.localStorage)try{_p.localStorage.getItem&&_p.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(_p.localStorage.getItem(this.GRAYKEY))[t])}catch(t){_p.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){h.next=17;break}return h.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(c=h.sent).content||!c.content.grayConfigTag){h.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(c.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(c.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){h.next=10;break}return h.abrupt("return");case 10:m=_p.localStorage.getItem(this.GRAYKEY)?JSON.parse(_p.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),m[t]=this.grayConfig,_p.localStorage.setItem(this.GRAYKEY,Uc(m)),h.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",c.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){h.next=20;break}return h.next=20,this._getMixStorePolicy(t);case 20:case"end":return h.stop()}}),_callee,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g,I,M;return Lc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:if(a=(new Date).getTime(),_p.localStorage)try{this.mixStorePolicy=JSON.parse(_p.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=zp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(m=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(c=this._getMixStorePolicy).call(c,this,t),m))}catch(a){_p.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(_p.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){T.next=30;break}return T.prev=3,T.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:g=T.sent,I=g.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(I.ttl),this.mixStorePolicy.providers=I.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=zp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=I.nosPolicy?JSON.parse(I.nosPolicy):null,this.mixStorePolicy.s3Policy=I.s3Policy?JSON.parse(I.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(h=this._getMixStorePolicy).call(h,this,t),1e3*this.mixStorePolicy.ttl),M=_p.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(_p.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),M[t]=this.mixStorePolicy,_p.localStorage.setItem(this.MIXSTOREKEY,Uc(M)),T.next=30;break;case 23:if(T.prev=23,T.t0=T.catch(3),this.logger.error("getMixStorePolicy error",T.t0),0!==this.mixStoreErrorCount){T.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return T.stop()}}),_callee2,this,[[3,23]])})))},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,c=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(c===a[0])throw new Error("uploadFile all policy fail");var m=Rs(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(m&&m.retryNext&&c&&(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+c),this.curProvider=zp(c),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var h=this.mixStorePolicy[this.curProvider===XS.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!h||0===h)return;this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+zp(t.mixStorePolicy.providers[0])),t.curProvider=zp(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*h)}},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=c.sent,c.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return c.stop()}}),_callee3,this)})))},MixStorage}(),lE=Vp.trim,uE=N("".charAt),dE=h.parseFloat,pE=h.Symbol,mE=pE&&pE.iterator,hE=1/dE(kp+"-0")!=-1/0||mE&&!fails((function(){dE(Object(mE))}))?function parseFloat(t){var a=lE(toString$1(t)),c=dE(a);return 0===c&&"-"==uE(a,0)?-0:c}:dE;_export({global:!0,forced:parseFloat!=hE},{parseFloat:hE});var fE=H.parseFloat,gE=function(){function AWS(t,a){this.s3=null,this.core=t,this.cloudStorage=a,this.logger=t.logger}return AWS.prototype.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m,h,g,I,M,T,S,E,b,C=this;return Lc.wrap((function _callee2$(A){for(;;)switch(A.prev=A.next){case 0:if(!t.file){A.next=4;break}c=t.file,A.next=19;break;case 4:if("string"!=typeof t.fileInput){A.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((m=document.getElementById(t.fileInput))&&m.files&&m.files[0])){A.next=11;break}c=m.files[0],A.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:A.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){A.next=18;break}c=t.fileInput.files[0],A.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){A.next=21;break}throw new Error("dont get s3 policy");case 21:return h={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},g=this.s3,(I=new g).config.update(h),M=decodeURIComponent(a.bucket),T=decodeURIComponent(a.objectName),E={Bucket:M,Key:T,Body:S=c,Metadata:{token:a.token},ContentType:S.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",E),(b=I.upload(E)).on("httpUploadProgress",(function(a){var c=fE((a.loaded/a.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:a.total,loaded:a.loaded,percentage:c,percentageText:Math.round(100*c)+"%"})})),A.abrupt("return",new Mi((function(c,m){var h=(new Date).getTime();b.send((function(g,I){return __awaiter(C,void 0,void 0,Lc.mark((function _callee(){var E,b,C,A,N;return Lc.wrap((function _callee$(R){for(;;)switch(R.prev=R.next){case 0:if(!g||"RequestAbortedError"!==g.code){R.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",g),m(new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:g,curProvider:2}})),R.next=31;break;case 5:if(!g){R.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",g),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(b=null===(E=this.core)||void 0===E?void 0:E.auth)||void 0===b?void 0:b.account),trace_id:null===(C=this.core.clientSocket.socket)||void 0===C?void 0:C.sessionId,start_time:h,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof g.status?g.status:"number"==typeof g.code?g.code:0,description:g.message||""+g.code,operation_type:1,target:Uc({bucket:M,object:T})},{asyncParams:_p.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),R.next=12,_p.net.getNetworkStatus();case 12:if(A=R.sent,!1!==A.net_connect){R.next=16;break}return R.abrupt("return",m(new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:g,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:R.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),R.next=23;break;case 20:return R.prev=20,R.t0=R.catch(16),R.abrupt("return",m(new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:R.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:c(this.cloudStorage._uploadFile(t)),R.next=31;break;case 26:N=(N=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn),this.core.reporterHookCloudStorage.update({remote_addr:N,operation_type:1}),N=N.replace("{objectName}",I.Key),c({size:S.size,name:S.name,url:a.shortUrl?a.shortUrl:N,ext:S.name.split(".")[1]||"unknown"});case 31:case"end":return R.stop()}}),_callee,this,[[16,20]])})))})),t.onUploadStart&&t.onUploadStart(b)})));case 33:case"end":return A.stop()}}),_callee2,this)})))},Ke(AWS,[{key:"mixStorePolicy",get:function get(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),AWS}();function getUploadResponseFormat(t){return void 0===t&&(t="file"),Uc(iE[t]||{}).replace(/"/gi,'\\"')}var vE=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=t.logger,this.core=t,this.nos=new tE(t,this),this.mixStorage=new cE(t,this),this.aws=new gE(t,this),registerParser({cmdMap:rE,cmdConfig:aE}),this.setOptions(a),this.setListeners()}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=a+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=a+"-AllMixStorePolicy";var c=t.s3,m=__rest(t,["s3"]),h=qt({},sE,this.config);if(m&&Object.prototype.hasOwnProperty.call(m,"cdn")){var g=qt(qt({},h.cdn),m.cdn);this.config=qt({},h,m),this.config.cdn=g}else this.config=qt({},h,m);c&&(this.aws.s3=c)},t.setListeners=function setListeners(){var t,a,c,m;this.core.eventBus.on("kicked",bind$1(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",bind$1(a=this._clearUnCompleteTask).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._clearUnCompleteTask).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(m=this._clearUnCompleteTask).call(m,this))},t._clearUnCompleteTask=function _clearUnCompleteTask(){var t,a=this;forEach$1(t=mn(this.uploadTaskMap)).call(t,(function(t){var c=a.uploadTaskMap[t];c&&c.abort&&c.abort()})),this.uploadTaskMap={}},t.init=function init(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){t.next=5;break}return t.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return t.next=7,this.nos._getNosCdnHost();case 7:case"end":return t.stop()}}),_callee,this)})))},t.processCallback=function processCallback(t,a){var c=this,m=t.onUploadProgress,h=t.onUploadDone,g=t.onUploadStart;return{onUploadStart:"function"==typeof g?function(t){c.uploadTaskMap[a]=t;try{g(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",t)}}:function(t){c.uploadTaskMap[a]=t},onUploadProgress:"function"==typeof m?function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded});try{m(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded})},onUploadDone:"function"==typeof h?function(t){c.core.reporterHookCloudStorage.end(0);try{h(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){c.core.reporterHookCloudStorage.end(0)},taskKey:a}},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g,I,M,T;return Lc.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){S.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){S.next=7;break}if(!(a=Rs(t,"file.type"))||"string"!=typeof a||-1!==indexOf(a).call(a,t.type)){S.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):"string"==typeof t.fileInput?(c=document.getElementById(t.fileInput))&&c.files&&c.files[0]&&this.core.reporterHookCloudStorage.update({full_size:c.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),m=mm(),h=this.processCallback(t,m),g=h.onUploadStart,I=h.onUploadProgress,M=h.onUploadDone,t.onUploadStart=g,t.onUploadProgress=I,t.onUploadDone=M,T=null,S.prev=15,S.next=18,this._uploadFile(t);case 18:T=S.sent,delete this.uploadTaskMap[m],S.next=27;break;case 22:throw S.prev=22,S.t0=S.catch(15),delete this.uploadTaskMap[m],this.core.reporterHookCloudStorage.end((S.t0&&S.t0.code)===Lu.V2NIM_ERROR_CODE_CANCELLED?3:1),S.t0;case 27:return T&&(T.size=void 0===T.size?void 0:Number(T.size),T.w=void 0===T.w?void 0:Number(T.w),T.h=void 0===T.h?void 0:Number(T.h),T.dur=void 0===T.dur?void 0:Number(T.dur)),T.url=decodeURIComponent(T.url),t.onUploadDone({size:T.size,name:T.name,url:T.url,ext:T.name.split(".")[1]||"unknown"}),S.abrupt("return",T);case 31:case"end":return S.stop()}}),_callee2,this,[[15,22]])})))},t._uploadFile=function _uploadFile(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var m,h,g,I;return Lc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:if(Rs(this.mixStorage,"grayConfig.mixStoreEnable")&&Rs(this.mixStorage,"mixStorePolicy.providers.length")){M.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),M.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Rs(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Rs(this.mixStorage,"curProvider")),m=this.core.adapters.getFileUploadInformation(t),h=!0,m?!1===m.complete&&this.mixStorage.curProvider===XS.s3&&(h=!1):h=!1,this.aws.s3||(this.mixStorage.curProvider=XS.nos),g=oE,h){M.next=23;break}return M.prev=10,M.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:getUploadResponseFormat(t.type)}});case 13:I=M.sent,g=I.content.mixStoreTokenResTag,M.next=23;break;case 17:if(M.prev=17,M.t0=M.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",M.t0),!(M.t0 instanceof Fu)){M.next=22;break}throw M.t0;case 22:throw new ju({code:"v2"===Rs(this.core,"options.apiVersion")?Lu.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:M.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(h){M.next=27;break}return M.abrupt("return",this.mixStorage.curProvider===XS.s3?this.aws.s3Upload(t,g):this.nos.nosUpload(t,g));case 27:return M.abrupt("return",this.nos.nosUpload(t,null===(c=null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.payload)||void 0===c?void 0:c.mixStoreToken));case 28:case"end":return M.stop()}}),_callee3,this,[[10,17]])})))},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var c=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);c[0];var m=c[1];c[2];var h=c[3];c[4];var g=c[5];if(c[6],c[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var I=this._getUrlType(t);return I===XS.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",g)),I===XS.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",g)),t}var M=this.config,T=M.downloadUrl,S=M.downloadHostList,E=M.nosCdnEnable,b=this.config.cdn.cdnDomain,C=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",A=decodeURIComponent(g),N=indexOf(A).call(A,C);if(b&&N>-1&&E)return""+m+b+"/"+slice(A).call(A,N);if(includes(S).call(S,h)&&includes(g).call(g,"/")){var R=indexOf(g).call(g,"/"),k=g.substring(0,R),w=g.substring(R+1);return T.replace("{bucket}",k).replace("{object}",w)}var O=filter(S).call(S,(function(t){return"string"==typeof h&&includes(h).call(h,t)}))[0],P=O?h.replace(O,"").replace(/\W/g,""):null;return P?T.replace("{bucket}",P).replace("{object}",g):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if("string"==typeof t&&includes(t).call(t,"_im_url=1")){c.next=2;break}return c.abrupt("return",t);case 2:return c.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return a=c.sent,c.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 6:case"end":return c.stop()}}),_callee4,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c,m,h,g,I=this;return Lc.wrap((function _callee5$(M){for(;;)switch(M.prev=M.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,c=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(ZS.dontNeed)||c!==String(ZS.dontNeed)){M.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==ZS.time){M.next=17;break}if(!(a&&indexOf(a).call(a,String(ZS.time))>=0||c&&indexOf(c).call(c,String(ZS.time))>0)){M.next=13;break}return M.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:M.next=33;break;case 17:if(t.urls&&t.urls.length){M.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(h=[],g=[],forEach$1(m=t.urls).call(m,(function(t){var a=I._getUrlType(t);a===XS.nos&&g.push(t),a===XS.s3&&h.push(t)})),(!c||0!==h.length&&indexOf(c).call(c,String(ZS.urls))<0)&&(this.logger.warn("s3 url don't support url token"),h=[]),(!a||0!==g.length&&indexOf(a).call(a,String(ZS.urls))<0)&&(this.logger.warn("nos url don't support url token"),g=[]),0!==h.length||0!==g.length){M.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==h.length&&0!==g.length){M.next=33;break}return t.urls=Uc(t.urls),M.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return M.stop()}}),_callee5,this)})))},t._getUrlType=function _getUrlType(t){var a,c;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?XS.nos:this.mixStorePolicy.s3Policy&&some(c=this.mixStorePolicy.s3Policy.dlcdns).call(c,(function(a){return indexOf(t).call(t,a)>=0}))?XS.s3:null},t.getNosAccessToken=function getNosAccessToken(t){return validate({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},t.deleteNosAccessToken=function deleteNosAccessToken(t){return validate({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},t.process=function process(t){var a=Rs(t,"error.detail.ignore");return t.error&&!a?Mi.reject(t.error):Mi.resolve(t)},Ke(CloudStorageService,[{key:"grayConfig",get:function get(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function get(){return this.mixStorage.mixStorePolicy}}]),CloudStorageService}(),yE=Ch({none:0,normal:1,all:3}),_E=Ch({normal:0,advanced:1}),IE=Ch({normal:0,owner:1,manager:2}),ME={noVerify:0,needVerify:1,rejectAll:2},TE=Ch(ME),SE={needVerify:0,noVerify:1},bE=Ch(SE),CE={manager:0,all:1},AE=Ch(CE),NE={manager:0,all:1},RE=Ch(NE),kE={manager:0,all:1},wE=Ch(kE);function formatSuperTeam(t){var a,c=["teamId"],m=["level","memberNum","memberUpdateTime","createTime","updateTime"],h=["valid","validToCurrentUser","mute"],g={type:_E,muteType:yE,joinMode:TE,beInviteMode:bE,inviteMode:AE,updateTeamMode:RE,updateExtMode:wE};t.bits;var I=__rest(t,["bits"]);return forEach$1(c).call(c,(function(t){I[t]&&(I[t]=I[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==I[t]&&(I[t]=zp(I[t]))})),forEach$1(h).call(h,(function(t){void 0!==I[t]&&(I[t]=1===zp(I[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==I[t]&&(I[t]=g[t][I[t]]||I[t])})),I}function formatSuperTeams(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeam(t)})):[]}function generateSuperTeam(t){var a,c=qt({},t),m=["avatar","name","intro","announcement","ext"],h={joinMode:ME,beInviteMode:SE,inviteMode:CE,updateTeamMode:NE,updateExtMode:kE};return forEach$1(m).call(m,(function(t){void 0!==c[t]&&(c[t]=c[t].toString())})),forEach$1(a=mn(h)).call(a,(function(t){void 0!==c[t]&&(c[t]=h[t][c[t]])})),c}function generatorSuperTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],c={};return void 0!==t.bitConfigMask&&(c.bits=zp(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(c[a]=t[a].toString())})),Object.prototype.hasOwnProperty.call(t,"nickInTeam")&&(c.nickInTeam=t.nickInTeam),c}function formatSuperTeamMember(t){var a,c=["teamId"],m=["joinTime","updateTime","bitConfigMask"],h=["active","valid","mute"],g={type:IE},I=t.bits,M=__rest(t,["bits"]);return void 0!==I&&(M.muteTeam=1===zp(I),M.bitConfigMask=I),M.id=M.teamId+"-"+M.account,forEach$1(c).call(c,(function(t){M[t]&&(M[t]=M[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==M[t]&&(M[t]=zp(M[t]))})),forEach$1(h).call(h,(function(t){void 0!==M[t]&&(M[t]=1===zp(M[t]))})),forEach$1(a=mn(g)).call(a,(function(t){void 0!==M[t]&&(M[t]=g[t][M[t]]||M[t])})),M}function formatSuperTeamMembers(t){return t&&t.length>0?map$6(t).call(t,(function(t){return formatSuperTeamMember(t)})):[]}function generatorMemberBySuperTeam(t,a,c){return void 0===c&&(c="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:c,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersBySuperTeam(t,a,c){return void 0===c&&(c="normal"),a&&a.length>0?map$6(a).call(a,(function(a){return generatorMemberBySuperTeam(t,a,c)})):[]}var OE=function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddSuperTeamMembers=function notifyAddSuperTeamMembers(t,a){this.core.emit("addSuperTeamMembers",{team:t,accounts:a,members:generatorMembersBySuperTeam(t,a)})},t.notifyUpdateSuperTeamManagers=function notifyUpdateSuperTeamManagers(t,a,c,m){this.core.emit("updateSuperTeamManagers",{team:{teamId:t,memberUpdateTime:m},accounts:a,isManager:c,members:map$6(a).call(a,(function(a){return{id:t+"-"+a,type:c?"manager":"normal",account:a,updateTime:m}}))})},t.notifyRemoveSuperTeamMembers=function notifyRemoveSuperTeamMembers(t,a){this.core.emit("removeSuperTeamMembers",{team:t,accounts:a})},t.notifyTransferSuperTeam=function notifyTransferSuperTeam(t,a,c){this.core.emit("transferSuperTeam",{team:t,from:{id:t.teamId+"-"+a,account:a,type:"normal",updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+c,account:c,type:"owner",updateTime:t.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function notifyUpdateSuperTeamMembersMute(t,a,c){this.core.emit("updateSuperTeamMembersMute",{team:t,accounts:a,members:map$6(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:c,updateTime:t.memberUpdateTime}})),mute:c})},ModuleService}(),PE=function(t){function SuperTeamService(a){var c;return(c=t.call(this,"superTeam",a)||this).mySuperTeamMembersMap=new Il,c.service=new OE(a),registerParser({cmdMap:Tv,cmdConfig:bv}),c.setListeners(),c}wt(SuperTeamService,t);var a=SuperTeamService.prototype;return a.setListeners=function setListeners(){var t=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(a){t.emitMemberUpdate(a)})),this.core.eventBus.on("team/onNotification",(function(a){return t.notificationHandler(a)}))},a.reset=function reset(){this.mySuperTeamMembersMap.clear()},a.mergeMySuperTeamMembers=function mergeMySuperTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.mySuperTeamMembersMap.get(c),h=qt({},m,t);a.mySuperTeamMembersMap.set(c,h)}))},a.getSuperTeamInfo=function getSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:t.teamId});case 3:return a=m.sent,c=a.content.superTeam,m.abrupt("return",formatSuperTeam(c));case 6:case"end":return m.stop()}}),_callee,this)})))},a.getSuperTeams=function getSuperTeams(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var t,a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=c.sent,a=t.content.superTeams,c.abrupt("return",formatSuperTeams(a));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.updateSuperTeamInfo=function updateSuperTeamInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},t),a=generateSuperTeam(t),c.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:a});case 4:return c.abrupt("return",formatSuperTeam(a));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.addSuperTeamMembers=function addSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.removeSuperTeamMembers=function removeSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.addSuperTeamManagers=function addSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},a.removeSuperTeamManagers=function removeSuperTeamManagers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.applySuperTeam=function applySuperTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),c.next=3,this.core.sendCmd("applySuperTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=c.sent,c.abrupt("return",formatSuperTeam(a.content.superTeam));case 5:case"end":return c.stop()}}),_callee8,this)})))},a.transferSuperTeam=function transferSuperTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){return Lc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferSuperTeam",t);case 3:case"end":return a.stop()}}),_callee9,this)})))},a.muteSuperTeam=function muteSuperTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.muteSuperTeamMembers=function muteSuperTeamMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c;return Lc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),m.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:a});case 4:return c=formatSuperTeamMember(qt({updateTime:(new Date).getTime()},a)),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee12,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a,c,m;return Lc.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),h.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:a});case 4:return c=formatSuperTeamMember(qt({updateTime:(new Date).getTime(),account:this.core.account},a)),m=this.emitMemberUpdate(c),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",m),h.abrupt("return",c);case 8:case"end":return h.stop()}}),_callee13,this)})))},a.getSuperTeamMembersByAccounts=function getSuperTeamMembersByAccounts(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var c,m,h;return Lc.wrap((function _callee14$(g){for(;;)switch(g.prev=g.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},t),m=map$6(c=t.accounts).call(c,(function(a){return t.teamId+"|"+a})),g.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:m});case 4:return h=g.sent,g.abrupt("return",formatSuperTeamMembers(null===(a=h.content)||void 0===a?void 0:a.superTeamMembers));case 6:case"end":return g.stop()}}),_callee14,this)})))},a.getSuperTeamMembers=function getSuperTeamMembers(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){var c;return Lc.wrap((function _callee15$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("getSuperTeamMembers",qt({joinTime:0,limit:100,reverse:!1},t));case 3:return c=m.sent,m.abrupt("return",formatSuperTeamMembers(null===(a=c.content)||void 0===a?void 0:a.superTeamMembers));case 5:case"end":return m.stop()}}),_callee15,this)})))},a.queryMuteMembers=function queryMuteMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a,c;return Lc.wrap((function _callee16$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),m.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",qt({limit:100,joinTime:0,reverse:!1},t));case 3:return a=m.sent,c=a.content,m.abrupt("return",formatSuperTeamMembers(c.superTeamMembers));case 6:case"end":return m.stop()}}),_callee16,this)})))},a.leaveSuperTeam=function leaveSuperTeam(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){return Lc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee17,this)})))},a.passSuperTeamApply=function passSuperTeamApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){var a;return Lc.wrap((function _callee18$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("passSuperTeamApply",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee18,this,[[1,7]])})))},a.rejectSuperTeamApply=function rejectSuperTeamApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var a;return Lc.wrap((function _callee19$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee19,this,[[1,7]])})))},a.acceptSuperTeamInvite=function acceptSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){var a;return Lc.wrap((function _callee20$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("acceptSuperTeamInvite",t);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee20,this,[[1,7]])})))},a.rejectSuperTeamInvite=function rejectSuperTeamInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a;return Lc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),c.prev=1,c.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t),c.next=12;break;case 7:throw c.prev=7,c.t0=c.catch(1),a=c.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",t,null==a?void 0:a.code),c.t0;case 12:case"end":return c.stop()}}),_callee21,this,[[1,7]])})))},a.emitMemberUpdate=function emitMemberUpdate(t){t=formatSuperTeamMember(t),this.mergeMyTeamMembers([t]),this.core.emit("updateTeamMember",t);var a=_S(this.mySuperTeamMembersMap.get(t.teamId));return this.core.emit("myTeamMembers",[a]),a},a.mergeMyTeamMembers=function mergeMyTeamMembers(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.teamId,m=a.mySuperTeamMembersMap.get(c),h=qt({},m,t);a.mySuperTeamMembersMap.set(c,h)}))},a.syncSuperTeamsHandler=function syncSuperTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:zp(a.timetag)});var c=null==a?void 0:a.teams;if(c&&c.length){var m=formatSuperTeams(c);this.core.emit("superTeams",m)}},a.syncCreateSuperTeamHandler=function syncCreateSuperTeamHandler(t){var a=t.content,c=formatSuperTeam(null==a?void 0:a.superTeam),m=generatorMemberBySuperTeam(c,c.owner,"owner");this.core.emit("createSuperTeam",c,m)},a.syncUpdateSuperTeamMemberHandler=function syncUpdateSuperTeamMemberHandler(t){var a=t.content,c=formatSuperTeamMember(null==a?void 0:a.teamMember);c.updateTime||(c.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([c]),this.core.emit("updateSuperTeamMember",c);var m=_S(this.mySuperTeamMembersMap.get(c.teamId));this.core.emit("mySuperTeamMembers",[m])},a.syncMySuperTeamMembersHandler=function syncMySuperTeamMembersHandler(t){var a,c=t.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:zp(c.timetag)});var m=null==c?void 0:map$6(a=c.teamMembers).call(a,(function(t){return formatSuperTeamMember(t)}));this.mergeMySuperTeamMembers(m),this.core.emit("mySuperTeamMembers",_S(m))},a.notificationHandler=function notificationHandler(t){var a=t.attach,c=t.scene,m=t.from,h=t.to,g=t.time,I=t.idServer,M=t.idClient,T=a.team,S=a.account,E=a.accounts,b=a.type;if("superTeam"===c)switch("debug"===this.core.options.debugLevel?this.logger.debug("superTeam::recvNotification",I,M,a):this.logger.log("superTeam::recvNotification",I,M,h,b,S,E),b){case"updateSuperTeam":T.updateTime=g,this.core.emit("updateSuperTeam",T);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(T,E);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(T,[m]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(T,[S]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(h,E,!0,g);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(h,E,!1,g);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(T,E);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(T,[m]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:h});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(T,m,S);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(T,E,a.mute)}},SuperTeamService}(Mg),xE={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},VE={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},LE=function(t){function PluginService(a){var c;return(c=t.call(this,"plugin",a)||this).core=a,registerParser({cmdMap:xE,cmdConfig:VE}),c}wt(PluginService,t);var a=PluginService.prototype;return a.getChatroomAddress=function getChatroomAddress(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:t.chatroomId,isWeixinApp:"WXAPP"===_p.platform,ipType:t.ipType||0});case 3:return a=c.sent,c.abrupt("return",a.content.address);case 5:case"end":return c.stop()}}),_callee,this)})))},a.getQChatAddress=function getQChatAddress(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({ipType:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==t?void 0:t.ipType)||0}});case 3:return a=c.sent,c.abrupt("return",a.content.address);case 5:case"end":return c.stop()}}),_callee2,this)})))},PluginService}(Mg),DE={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},UE={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},FE=invertSerializeMap(UE),BE={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:UE.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:FE.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:FE.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:UE.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:FE.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:UE.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:UE.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:FE.sessionTag}]}},qE={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function formatCloudSession(t,a,c){var m=format(qE,t),h=getAccountFromSessionId(m.sessionId,"|"),g=h.accid,I=h.scene;if(m.sessionId=I+"-"+g,m.lastMsg){var M=1===m.lastMsgType;m.lastMsgInfo=M?{isLastMsgRecalled:M,revokedMsg:formatSystemMessage(deserialize(m.lastMsg,SS.sysMsg),c)}:{isLastMsgRecalled:M,lastMsg:formatMsg$1(deserialize(m.lastMsg,cv.msg),{account:a})}}return delete m.lastMsg,delete m.lastMsgType,m}function formatCloudSessions(t,a,c){return t&&t.length>0?map$6(t).call(t,(function(t){return formatCloudSession(t,a,c)})):[]}var GE,jE,HE,$E=function(t){function CloudSessionService(a){var c;return c=t.call(this,"cloudSession",a)||this,registerParser({cmdMap:DE,cmdConfig:BE}),c}wt(CloudSessionService,t);var a=CloudSessionService.prototype;return a.queryCloudSessionList=function queryCloudSessionList(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g;return Lc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return validate({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},t),(c=qt({limit:100,includedLastMsg:!0},t)).includedLastMsg=_m.boolean(t,"includedLastMsg"),I.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:c});case 5:return m=I.sent,h=(null===(a=m.content)||void 0===a?void 0:a.tag)||{},g=m.content.sessions,I.abrupt("return",{hasMore:+h.hasMore>0,sessionList:formatCloudSessions(g,this.core.account,this.logger)});case 9:case"end":return I.stop()}}),_callee,this)})))},a.queryCloudSession=function queryCloudSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h;return Lc.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),c=a.accid,m=a.scene,g.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c}});case 4:return h=g.sent,g.abrupt("return",formatCloudSession(h.content.session,this.core.account,this.logger));case 6:case"end":return g.stop()}}),_callee2,this)})))},a.updateCloudSession=function updateCloudSession(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c,m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=getAccountFromSessionId(t.sessionId,"-"),c=a.accid,m=a.scene,h.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c,ext:t.ext}});case 4:case"end":return h.stop()}}),_callee3,this)})))},a.deleteCloudSessionList=function deleteCloudSessionList(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c;return Lc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({sessionIdList:{type:"array",itemType:"string"}},t),c=map$6(a=t.sessionIdList).call(a,(function(t){var a=getAccountFromSessionId(t,"-"),c=a.accid,m=a.scene;return{sessionId:"superTeam"===m?"super_team|"+c:m+"|"+c}})),m.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:c});case 4:case"end":return m.stop()}}),_callee4,this)})))},a.nimMultiSyncUpdateCloudSessionHandler=function nimMultiSyncUpdateCloudSessionHandler(t){var a=formatCloudSession(t.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",a)},CloudSessionService}(Mg);!function(t){t[t.audio=1]="audio",t[t.video=2]="video",t[t.custom=3]="custom"}(GE||(GE={})),function(t){t[t.kClose=1]="kClose",t[t.kJoin=2]="kJoin",t[t.kInvite=3]="kInvite",t[t.kCancelInvite=4]="kCancelInvite",t[t.kReject=5]="kReject",t[t.kAccept=6]="kAccept",t[t.kLeave=7]="kLeave",t[t.kCustom=8]="kCustom"}(jE||(jE={})),function(t){t[t.kDefault=0]="kDefault",t[t.kLeave=1]="kLeave",t[t.kSelfSync=3]="kSelfSync"}(HE||(HE={}));var YE={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},WE={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},zE={avSignalTag:qt({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},KE=invertSerializeMap(zE),QE={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:KE.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:KE.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:zE.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:KE.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},JE={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:YE,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function formatSignaling(t){var a,c=format(JE,t),m=[];c.members&&c.members.length>0&&(m=map$6(a=c.members).call(a,(function(t){return function formatSignalingChannelMember(t){return format(JE,deserialize(t,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}(t)})),delete c.members);return m.length>0?{channelInfo:c,memberList:m}:{channelInfo:c}}function generateSignalingForCmd(t){return formatReverse(JE,t)}var XE,ZE,eb,tb,rb,nb,ab,ib=function(t){function SignalingService(a){var c;return(c=t.call(this)||this).timer=0,c.pollingInterval=12e4,c.name="signaling",c.logger=a.logger,c.core=a,c.channels={},registerParser({cmdMap:WE,cmdConfig:QE}),c}wt(SignalingService,t);var a=SignalingService.prototype;return a.callEx=function callEx(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c,m,h,g;return Lc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return validate({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:YE},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),I.next=3,this.core.sendCmd("signalingCallEx",{tag:generateSignalingForCmd(t)});case 3:if(c=I.sent,"200"===(m=(null===(a=c.content)||void 0===a?void 0:a.data)||{}).callStatus){I.next=7;break}throw new Fu({code:+m.callStatus,detail:{reason:"callEx failed"}});case 7:return h=formatSignaling(m),this.channels[h.channelInfo.channelId]=_S(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),I.abrupt("return",h);case 11:case"end":return I.stop()}}),_callee,this)})))},a.joinAndAccept=function joinAndAccept(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c,m,h,g,I,M;return Lc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),c=t.fromAccid,(m=__rest(t,["fromAccid"])).toAccid=c,T.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:generateSignalingForCmd(m)});case 5:if(h=T.sent,"200"===(g=(null===(a=h.content)||void 0===a?void 0:a.data)||{}).callStatus){T.next=9;break}throw new Fu({code:+g.callStatus,detail:{reason:"callEx failed"}});case 9:return I=formatSignaling(g),this.channels[I.channelInfo.channelId]=_S(I.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(M=this.aotoDelay).call(M,this),this.pollingInterval,-1)),T.abrupt("return",I);case 13:case"end":return T.stop()}}),_callee2,this)})))},a.create=function create(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c,m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},ext:{type:"string",required:!1}},t),h.next=3,this.core.sendCmd("signalingCreate",{tag:generateSignalingForCmd(t)});case 3:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h.abrupt("return",formatSignaling(m));case 6:case"end":return h.stop()}}),_callee3,this)})))},a.close=function close(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingClose",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.queryInfo=function queryInfo(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var c,m;return Lc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return validate({name:{type:"string",allowEmpty:!1}},t),h.next=3,this.core.sendCmd("signalingQueryInfo",{tag:t});case 3:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h.abrupt("return",formatSignaling(m));case 6:case"end":return h.stop()}}),_callee5,this)})))},a.join=function join(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var c,m,h,g;return Lc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},t),I.next=3,this.core.sendCmd("signalingJoin",{tag:generateSignalingForCmd(t)});case 3:return c=I.sent,m=(null===(a=c.content)||void 0===a?void 0:a.data)||{},h=formatSignaling(m),this.channels[h.channelInfo.channelId]=_S(h.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(g=this.aotoDelay).call(g,this),this.pollingInterval,-1)),I.abrupt("return",h);case 9:case"end":return I.stop()}}),_callee6,this)})))},a.aotoDelay=function aotoDelay(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var t,a,c,m,h;return Lc.wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:if(0!==(t=mn(this.channels)).length){g.next=4;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),g.abrupt("return");case 4:this.logger.log("signling:autoDelay",t),a=0;case 6:if(!(a<t.length)){g.next=23;break}return c=t[a],g.prev=8,g.next=11,this.core.sendCmd("signalingDelay",{tag:{channelId:c}});case 11:m=g.sent,h=formatSignaling(m.content.data),this.channels[c]=h.channelInfo,g.next=20;break;case 16:g.prev=16,g.t0=g.catch(8),this.logger.warn("signling:autoDelay "+c+" failed",g.t0),delete this.channels[c];case 20:a++,g.next=6;break;case 23:case"end":return g.stop()}}),_callee7,this,[[8,16]])})))},a.leave=function leave(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){return Lc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingLeave",{tag:generateSignalingForCmd(t)});case 3:delete this.channels[t.channelId];case 4:case"end":return a.stop()}}),_callee8,this)})))},a.invite=function invite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){return Lc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:YE}},t),a.next=3,this.core.sendCmd("signalingInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.cancelInvite=function cancelInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingCancelInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.reject=function reject(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var a,c;return Lc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a=t.fromAccid,(c=__rest(t,["fromAccid"])).toAccid=a,m.next=5,this.core.sendCmd("signalingReject",{tag:generateSignalingForCmd(c)});case 5:case"end":return m.stop()}}),_callee11,this)})))},a.accept=function accept(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c,m,h,g;return Lc.wrap((function _callee12$(I){for(;;)switch(I.prev=I.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},t),a=t.autoJoin,c=t.joinAttachExt,m=t.fromAccid,(h=__rest(t,["autoJoin","joinAttachExt","fromAccid"])).toAccid=m,I.next=5,this.core.sendCmd("signalingAccept",{tag:generateSignalingForCmd(h)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+t.autoJoin),!a){I.next=10;break}return g={channelId:t.channelId,needOffline:t.needOffline,attachExt:c,uid:t.uid},I.next=10,this.join(g);case 10:case"end":return I.stop()}}),_callee12,this)})))},a.sendCustomCommand=function sendCustomCommand(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){return Lc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee13,this)})))},a.signalingRecvNotificationHandler=function signalingRecvNotificationHandler(t){var a="number"==typeof Rs(t,"raw.r[0]")?""+t.raw.r[0]:"0";t.content.data.msgId=t.content.data.msgId||a,this.doNotify(t.content.data),a&&zp(a)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[a]})},a.signalingMultiSyncNotificationHandler=function signalingMultiSyncNotificationHandler(t){this.doNotify(t.content.data,HE.kSelfSync)},a.doNotify=function doNotify(t,a){void 0===a&&(a=HE.kDefault);var c=function formatSignalingNotification(t,a){void 0===a&&(a=HE.kDefault);var c=format(JE,t),m=c.attach,h=c.attachExt,g=c.time,I=c.msgId;c.fromAccid,c.toAccid,c.members,c.requestId,c.pushInfo;var M=__rest(c,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===m.type)try{c.member={accid:c.attach.member[1],uid:Number(c.attach.member[2]),createTime:Number(c.attach.member[3]),expireTime:Number(c.attach.member[4])}}catch(t){delete c.member}var T=m.type;return delete c.attach,{metaData:{eventType:T,channelInfo:M,feature:a,ext:h||"",time:g,msgId:I},rawData:c}}(t,a),m=c.metaData,h=c.rawData,g=h.fromAccid,I=h.toAccid,M=h.requestId,T=h.pushInfo,S=h.msgId,E=h.member;switch(m.eventType){case jE.kClose:this.emit("signalingClose",{fromAccid:g,metaData:m});break;case jE.kJoin:this.emit("signalingJoin",{fromAccid:g,metaData:m,member:E});break;case jE.kInvite:this.emit("signalingInvite",{fromAccid:g,toAccid:I,requestId:M,pushInfo:T,metaData:m});break;case jE.kCancelInvite:this.emit("signalingCancelInvite",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case jE.kReject:this.emit("signalingReject",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case jE.kAccept:this.emit("signalingAccept",{fromAccid:g,toAccid:I,requestId:M,metaData:m});break;case jE.kLeave:this.emit("signalingLeave",{fromAccid:g,metaData:m});break;case jE.kCustom:this.emit("signalingCustomCommand",{fromAccid:g,metaData:m});break;default:this.logger.warn("signaling:notification, no such a type "+m.eventType,h)}return S},a.signalingSyncNotificationHandler=function signalingSyncNotificationHandler(t){var a,c,m=this;if(t.content.datas&&t.content.datas.length>0){var h=filter(a=map$6(c=t.content.datas).call(c,(function(t){return m.doNotify(t,HE.kLeave)}))).call(a,(function(t){return t}));h.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:h})}},a.singalingSyncChannelsHandler=function singalingSyncChannelsHandler(t){var a;if(this.timer=0,this.channels={},t.content.datas&&t.content.datas.length>0){var c=map$6(a=t.content.datas).call(a,(function(t){return formatSignaling(t)}));this.emit("singalingSyncChannels",c)}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t),Mi.resolve(t);var c=Rs(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},SignalingService}(Gi.EventEmitter),ob=function(t){function Service(a,c){var m;return(m=t.call(this)||this).name=a,m.core=c,m.name=a,m.logger=c.logger,m.core=c,m}wt(Service,t);var a=Service.prototype;return a.emit=function emit(a){var c=this;try{for(var m,h,g=arguments.length,I=new Array(g>1?g-1:0),M=1;M<g;M++)I[M-1]=arguments[M];var T=(m=t.prototype.emit).call.apply(m,concat(h=[this,a]).call(h,I));return T}catch(t){return qi((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=Rs(t,"error.detail.ignore");return t.error&&!c?Mi.reject(t.error):Mi.resolve(t)},Service}(Gi),sb={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},cb={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},lb={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:cb,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},ub=function getDeserializeTag(){return invertSerializeMap(lb)},db=function getCmdConfig(){var t=ub();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:lb.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:lb.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:lb.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:lb.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:t.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:lb.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:lb.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:lb.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:lb.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:lb.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:lb.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:lb.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:lb.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:lb.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:t.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:lb.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:lb.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:t.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:lb.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:lb.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:lb.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:lb.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:lb.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:lb.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:lb.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:lb.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:lb.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:lb.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:t.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:t.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:lb.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:lb.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:lb.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:t.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:lb.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:lb.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:t.qchatChannelIdInfoTag}]}}};!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(XE||(XE={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(ZE||(ZE={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(eb||(eb={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(tb||(tb={})),function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(rb||(rb={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(nb||(nb={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(ab||(ab={}));var pb={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:tb},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},mb={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},hb={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:ZE},opeType:{type:"enum",values:eb},toAccids:{type:"object"}},fb={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:ZE},opeType:{type:"enum",values:eb},roleId:{type:"string"}},gb={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},vb={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(fb,t)}function formatChannel(t){return format(pb,t)}function formatChannels(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(mb,t)}function formatUnreadInfos(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(gb,t)}function formatChannelCategorys(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatChannelCategory(t)})):[]}function formatChannelMembers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatChannelMember(t){return format(vb,t)}(t)})):[]}function formatFailServerIds(t){try{return JSON.parse(t)}catch(t){return[]}}var yb={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},_b={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Ib={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format(yb,t)}function formatServers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(_b,t)}function formatMembers$1(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(Ib,t)}(t)})):[]}function generateAntispamTag(t){var a,c,m;if(!t.antispamTag)return{};var h=qt({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)&&(h.antiSpamBusinessId=Uc(null===(m=t.antispamTag)||void 0===m?void 0:m.antiSpamBusinessId)),h}var Mb={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(Mb,t)}function formatInviteApplyRecords(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var Tb,Sb,Eb,bb,Cb={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(Cb,t)}!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(Tb||(Tb={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(Sb||(Sb={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(Eb||(Eb={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory",t[t.mentionedRole=27]="mentionedRole"}(bb||(bb={}));var Ab,Nb,Rb,kb,wb,Ob,Pb,xb,Vb={type:{type:"enum",values:Tb},memberType:{type:"enum",values:Sb},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},Lb={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Tb},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},Db={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:Sb},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=qt({},t),c=formatReverse(Vb,a);return c.auths&&(c.auths=function generateRoleAuthsForCmd(t){var a,c=reduce(a=mn(t)).call(a,(function(a,c){var m=bb[c];return m?a[m]=Eb[t[c]]:a[c]=Eb[t[c]],a}),{});return Uc(c)}(c.auths)),c}function formatRoleAuths(t){var a;return reduce(a=mn(t)).call(a,(function(a,c){var m=getEnumKeyByEnumValue(bb,c);m?a[m]=Eb[t[c]]:a[zp(c)]=Eb[t[c]];return a}),{})}function formatRole(t){var a=format(Vb,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Lb,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Db,t)}function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)}!function(t){t[t.default=1]="default",t[t.sync=2]="sync"}(Ab||(Ab={})),function(t){t[t.sendTime=1]="sendTime"}(Nb||(Nb={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(Rb||(Rb={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(kb||(kb={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(wb||(wb={})),function(t){t[t.unknown=0]="unknown",t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids",t[t.accids=5]="accids"}(Ob||(Ob={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",t[t.myMemberInfoUpdated=35]="myMemberInfoUpdated",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(Pb||(Pb={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(xb||(xb={}));var Ub=Math.max,Fb=Math.min;function debounce(t,a,c){var m,h,g,I,M,T,S=0,E=!1,b=!1,C=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var c=m,g=h;return m=h=void 0,S=a,I=t.apply(g,c)}function leadingEdge(t){return S=t,M=qi(timerExpired,a),E?invokeFunc(t):I}function shouldInvoke(t){var c=t-T;return void 0===T||c>=a||c<0||b&&t-S>=g}function timerExpired(){var t=Ri();if(shouldInvoke(t))return trailingEdge(t);M=qi(timerExpired,function remainingWait(t){var c=a-(t-T);return b?Fb(c,g-(t-S)):c}(t))}function trailingEdge(t){return M=void 0,C&&m?invokeFunc(t):(m=h=void 0,I)}function debounced(){var t=Ri(),c=shouldInvoke(t);if(m=arguments,h=this,T=t,c){if(void 0===M)return leadingEdge(T);if(b)return clearTimeout(M),M=qi(timerExpired,a),invokeFunc(T)}return void 0===M&&(M=qi(timerExpired,a)),I}return a=Number(a)||0,isObject(c)&&(E=!!c.leading,g=(b="maxWait"in c)?Ub(Number(c.maxWait)||0,a):g,C="trailing"in c?!!c.trailing:C),debounced.cancel=function cancel(){void 0!==M&&clearTimeout(M),S=0,m=T=h=M=void 0},debounced.flush=function flush(){return void 0===M?I:trailingEdge(Ri())},debounced}var Bb;function throttle(t,a,c){var m=!0,h=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return isObject(c)&&(m="leading"in c?!!c.leading:m,h="trailing"in c?!!c.trailing:h),debounce(t,a,{leading:m,maxWait:a,trailing:h})}!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(Bb||(Bb={}));var qb=function(){function UnreadInfoModuleService(t){var a=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=throttle((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t)),Rs(a.core,"qchatServer.emit")&&a.core.qchatServer.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}var t=UnreadInfoModuleService.prototype;return t.changeCacheServerRoleIds=function changeCacheServerRoleIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g,I,M,T=this;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:if(c=t.attach.serverIdentifyInfo,m=c.serverId,h=c.roleId,this.serverRoleIdsMap[m]){S.next=4;break}return S.next=4,this.getRoleIdsByServerId([m]);case 4:if(g=this.serverRoleIdsMap[m],!(t.time<g.timeTag)){S.next=7;break}return S.abrupt("return");case 7:if(t.type===Pb[Pb.serverIdentifyAdd]?g.roleIds.add(h):g.roleIds.delete(h),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+m+" roleIds is",concat(a=[]).call(a,g.roleIds)),I=this.unreadServerCount[m]){S.next=12;break}return S.abrupt("return");case 12:M=jT(mn(I),100),forEach$1(M).call(M,(function(t){T.core.qchatChannel.getChannelUnreadInfos({channels:map$6(t).call(t,(function(t){return{serverId:m,channelId:t}}))})}));case 14:case"end":return S.stop()}}),_callee,this)})))},t.getRoleIdsByServerId=function getRoleIdsByServerId(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g=this;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if((c=filter(t).call(t,(function(t){return!g.serverRoleIdsMap[t]}))).length){I.next=3;break}return I.abrupt("return");case 3:return m={serverIdTimeTags:c},I.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:m});case 6:h=I.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",m,"result is",h),forEach$1(a=h.content.serverRoles).call(a,(function(t){try{t.roleIds=JSON.parse(t.roleIds)}catch(t){g.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}g.serverRoleIdsMap[t.serverId]={roleIds:new WI(t.roleIds),timeTag:t.timeTag}}));case 9:case"end":return I.stop()}}),_callee2,this)})))},t._unSubscribeChannel=function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var c,m,h,g,I;return Lc.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:if(c=t+"_"+a,m=[],this.manualSubscribeUnreadMap[c]?m.push(this.manualSubscribeUnreadMap[c]):this.autoSubscribeUnreadMap[c]&&m.push(this.autoSubscribeUnreadMap[c]),this.manualSubscribeTypingMap[c]&&m.push(this.manualSubscribeTypingMap[c]),0!==m.length){M.next=6;break}return M.abrupt("return");case 6:for(h=0,g=m;h<g.length;h++)I=g[h],this.subscribe({opeType:Bb.unSub,type:I,channels:[{serverId:t,channelId:a}]});this.manualSubscribeUnreadMap[c]?this.manualSubscribeUnreadMap[c]=void 0:this.autoSubscribeUnreadMap[c]&&(this.autoSubscribeUnreadMap[c]=void 0),this.manualSubscribeTypingMap[c]&&(this.manualSubscribeTypingMap[c]=void 0);case 9:case"end":return M.stop()}}),_callee3,this)})))},t._unSubscribeServer=function _unSubscribeServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c;return Lc.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t,c=this.manualSubscribeServerMap[a]||this.autoSubscribeServerMap[a]){m.next=4;break}return m.abrupt("return");case 4:this.subscribe({opeType:Bb.unSub,type:c,channels:[{serverId:t,channelId:""}]}),this.manualSubscribeServerMap[a]?this.manualSubscribeServerMap[a]=void 0:this.autoSubscribeServerMap[a]&&(this.autoSubscribeServerMap[a]=void 0);case 6:case"end":return m.stop()}}),_callee4,this)})))},t.subscribe=function subscribe(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c,m,h,g=this;return Lc.wrap((function _callee6$(I){for(;;)switch(I.prev=I.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),I.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return c=I.sent,m=new WI,forEach$1(a=t.channels).call(a,(function(t){return __awaiter(g,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:this.serverRoleIdsMap[t.serverId]||m.add(t.serverId);case 1:case"end":return a.stop()}}),_callee5,this)})))})),h=jT(Yc(m),10),forEach$1(h).call(h,(function(t){g.getRoleIdsByServerId(t)})),I.abrupt("return",c.content);case 9:case"end":return I.stop()}}),_callee6,this)})))},t.autoSubscribe=function autoSubscribe(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return t.stop()}}),_callee7,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a,c,m,h,g,I,M,T=this;return Lc.wrap((function _callee10$(S){for(;;)switch(S.prev=S.next){case 0:if(this.serverRoleIdsMap={},g=100,t){S.next=6;break}return this.unreadServerCount={},this.unreadCount={},S.abrupt("return");case 6:return I={},forEach$1(a=mn(this.manualSubscribeUnreadMap)).call(a,(function(t){var a=T.manualSubscribeUnreadMap[t];if(a){var c=t.split("_"),m={serverId:c[0],channelId:c[1]};I[a]=I[a]||[],I[a].push(m)}})),I[5]=[],forEach$1(c=mn(this.manualSubscribeTypingMap)).call(c,(function(t){return __awaiter(T,void 0,void 0,Lc.mark((function _callee8(){var a,c,m,h;return Lc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:this.manualSubscribeTypingMap[t]&&(a=t.split("_"),c=a[0],m=a[1],h={serverId:c,channelId:m},I[5].push(h));case 2:case"end":return g.stop()}}),_callee8,this)})))})),I[4]=[],forEach$1(m=mn(this.manualSubscribeServerMap)).call(m,(function(t){return __awaiter(T,void 0,void 0,Lc.mark((function _callee9(){var a;return Lc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:this.manualSubscribeServerMap[t]&&(a={serverId:t},I[4].push(a));case 2:case"end":return c.stop()}}),_callee9,this)})))})),M=[],forEach$1(h=mn(I)).call(h,(function(t){var a=I[t];if(a&&0===a.length)return Mi.resolve();if(a.length>g){var c=jT(a,100);return forEach$1(c).call(c,(function(a){M.push(T.createSubscribePromise(a,t))}))}M.push(T.createSubscribePromise(a,t))})),S.next=16,Mi.all(M);case 16:case"end":return S.stop()}}),_callee10,this)})))},t.createSubscribePromise=function createSubscribePromise(t,a){var c=this,m={type:zp(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",m),this.subscribe(m).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),c.updateUnreads(a))})).catch((function(t){c.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))},t.cacheSubscribe=function cacheSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var m=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,h=5===t.type?c.manualSubscribeTypingMap:4===t.type?c.manualSubscribeServerMap:c.manualSubscribeUnreadMap;t.opeType===Bb.sub?h[m]=t.type:t.opeType===Bb.unSub&&(h[m]=void 0)}))},t.cacheAutoSubscribe=function cacheAutoSubscribe(t){var a,c=this;forEach$1(a=t.channels).call(a,(function(a){var m=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,h=4===t.type?c.autoSubscribeServerMap:c.autoSubscribeUnreadMap;t.opeType===Bb.sub?h[m]=t.type:t.opeType===Bb.unSub&&(h[m]=void 0)}))},t.cacheUnreadCount=function cacheUnreadCount(t){var a=this;forEach$1(t).call(t,(function(t){var c=t.serverId+"_"+t.channelId;a.unreadCount[c]=qt({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))},t.getServerUnreadInfo=function getServerUnreadInfo(t){var a,c=this,m={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},h=this.unreadServerCount[t];h&&(forEach$1(a=mn(h)).call(a,(function(a){var h=t+"_"+a,g=c.unreadCount[h];m.unreadCount+=g.unreadCount,m.mentionedCount+=g.mentionedCount,void 0!==g.maxCount&&(m.maxCount=g.maxCount)})),m.unreadCount=m.unreadCount>m.maxCount?m.maxCount:m.unreadCount,m.mentionedCount=m.mentionedCount>m.maxCount?m.maxCount:m.mentionedCount);return m},t.getUnreadInfo=function getUnreadInfo(t){validate({serverId:{type:"string"},channelId:{type:"string"}},t);var a=t.serverId+"_"+t.channelId;return this.unreadCount[a]?this.unreadCount[a]:null},t.shouldChangeUnread=function shouldChangeUnread(t,a){if(!t.serverId||!t.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId))return!1;if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&2!==(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(wb,wb.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var c=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),m=a?"ackTimestamp":"lastMsgTime";if(!c)return!1;if(t.time&&c[m]&&c[m]>t.time)return!1}return!0},t.shouldChangeMentionedUnread=function shouldChangeMentionedUnread(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var c,m;return Lc.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:if(!t.accidsOfMentionedRoles||!includes(c=t.accidsOfMentionedRoles).call(c,this.core.account)){h.next=2;break}return h.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){h.next=16;break}if(this.serverRoleIdsMap[t.serverId]){h.next=9;break}if(a){h.next=7;break}return this.handledRoleMsg(t),h.abrupt("return",!1);case 7:return h.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:m=0;case 10:if(!(m<t.mentionRoleIds.length)){h.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[m])){h.next=13;break}return h.abrupt("return",!0);case 13:m++,h.next=10;break;case 16:return h.abrupt("return",!1);case 17:case"end":return h.stop()}}),_callee11,this)})))},t.handledRoleMsg=function handledRoleMsg(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c,m,h,g,I=this;return Lc.wrap((function _callee12$(M){for(;;)switch(M.prev=M.next){case 0:if(t.mentionRoleIds){M.next=2;break}return M.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){M.next=5;break}return M.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){M.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),M.abrupt("return");case 8:if(c=!1,forEach$1(a=t.mentionRoleIds).call(a,(function(a){I.serverRoleIdsMap[t.serverId].roleIds.has(a)&&(c=!0,I.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",t))})),c){M.next=12;break}return M.abrupt("return");case 12:if(m=this.unreadCount[t.serverId+"_"+t.channelId],h=2===(null==t?void 0:t.status),m.mentionedCount=h?m.mentionedCount?m.mentionedCount-1:0:m.mentionedCount?m.mentionedCount+1:1,"number"!=typeof m.maxCount){M.next=25;break}if(!((g=(g=m.mentionedCount)>m.maxCount?m.maxCount:g)>m.maxCount)){M.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),M.abrupt("return");case 21:this.core.emit("unreadInfo",qt(qt({},m),{mentionedCount:g})),this.core.emit("unreadInfos",[qt(qt({},m),{mentionedCount:g})]),this.core.qchatChannel.emit("unreadInfos",[qt(qt({},m),{mentionedCount:g})]),this._serverUnreadInfo(t.serverId);case 25:case"end":return M.stop()}}),_callee12,this)})))},t.getMentionedFlag=function getMentionedFlag(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var c;return Lc.wrap((function _callee13$(m){for(;;)switch(m.prev=m.next){case 0:if(!t.mentionAll){m.next=4;break}return m.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){m.next=10;break}return m.next=7,this.shouldChangeMentionedUnread(t,a);case 7:return m.abrupt("return",m.sent);case 10:if(!t.mentionAccids||!includes(c=t.mentionAccids).call(c,this.core.account)){m.next=12;break}return m.abrupt("return",!0);case 12:return m.abrupt("return",!1);case 13:case"end":return m.stop()}}),_callee13,this)})))},t.changeUnread=function changeUnread(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var c,m,h,g,I,M,T;return Lc.wrap((function _callee14$(S){for(;;)switch(S.prev=S.next){case 0:if(c=t.serverId,m=t.channelId,h=c+"_"+m,this.shouldChangeUnread(t,a)){S.next=6;break}return this.core.logger.debug("changeUnread: "+h+" does not need to update unreadInfo"),S.abrupt("return");case 6:if(this.unreadCount[h]){S.next=11;break}return S.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:c,channelId:m}]});case 9:return!this.serverRoleIdsMap[c]&&t.mentionRoleIds&&this.getRoleIdsByServerId([c]),S.abrupt("return");case 11:return g=this.unreadCount[h],I=2===(null==t?void 0:t.status),S.next=15,this.getMentionedFlag(t);case 15:if(M=S.sent,I?(g.unreadCount=g.unreadCount?g.unreadCount-1:0,M&&(g.mentionedCount=g.mentionedCount?g.mentionedCount-1:0),delete g.lastMsgTime,this.core.logger.debug("changeUnread: "+h+" unread reduce ",g)):(g.unreadCount=g.unreadCount?g.unreadCount+1:1,M&&(g.mentionedCount=g.mentionedCount?g.mentionedCount+1:1),t.time&&(g.lastMsgTime=t.time),this.core.logger.debug("changeUnread: "+h+" unread add ",g)),T="number"==typeof g.maxCount?g.maxCount:100,!(g.unreadCount>T)){S.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),S.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})),this.core.emit("unreadInfos",[qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[qt(qt({},g),{mentionedCount:g.mentionedCount>T?T:g.mentionedCount,unreadCount:g.unreadCount>T?T:g.unreadCount})]),this._serverUnreadInfo(c);case 26:case"end":return S.stop()}}),_callee14,this)})))},t.updateUnreads=function updateUnreads(t){var a,c,m=this;if(t&&t.length>0){var h=[],g=[],I=map$6(a=filter(t).call(t,(function(t){var a=t.serverId+"_"+t.channelId,c=m.unreadCount[a],h=Rs(c,"ackTimestamp"),g=Rs(t,"ackTimestamp");return!(h&&g&&g<h)&&(Rs(c,"unreadCount")!==Rs(t,"unreadCount")||Rs(c,"mentionedCount")!==Rs(t,"mentionedCount"))}))).call(a,(function(t){h.push(m.getServerUnreadInfo(t.serverId)),g.push(m.unreadServerCount[t.serverId]);var a=t.serverId,c=t.channelId,I=a+"_"+c;return m.core.logger.debug("qchat channel updateUnread: ",t),m.unreadCount[I]=qt({},t),m.unreadServerCount[a]||(m.unreadServerCount[a]={}),m.unreadServerCount[a][c]=!0,t}));if(0!==I.length){this.core.emit("unreadInfos",I),this.core.qchatChannel.emit("unreadInfos",I);var M={};forEach$1(I).call(I,(function(t,a){m.core.emit("unreadInfo",t);var c=h[a],I=g[a],T=m.getServerUnreadInfo(t.serverId),S=m.unreadServerCount[t.serverId],E=c.unreadCount!==T.unreadCount,b=!I||0===mn(I).length,C=S&&mn(S).length>0,A=c.mentionedCount!==T.mentionedCount;(E||A||b&&C)&&(M[t.serverId]=!0)})),forEach$1(c=mn(M)).call(c,(function(t){m.core.emit("serverUnreadInfo",m.getServerUnreadInfo(t)),Rs(m.core,"qchatServer.emit")&&m.core.qchatServer.emit("serverUnreadInfo",m.getServerUnreadInfo(t))}))}}},t.clearUnreadCountByServers=function clearUnreadCountByServers(t,a){var c=this,m=[];forEach$1(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach$1(a=mn(c.unreadServerCount[t])).call(a,(function(a){m.push(t+"_"+a)}))}));var h=[];forEach$1(m).call(m,(function(t){h.push(qt(qt({},c.unreadCount[t]),{unreadCount:0,mentionedCount:0,ackTimestamp:a}))})),this.updateUnreads(h)},UnreadInfoModuleService}(),Gb=function(){function SubscribeForVisitorService(t){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new WI,this.autoVisitorSubscribeServer=new WI,this.autoVisitorSubscribeChannel=new WI,this.core=t}var t=SubscribeForVisitorService.prototype;return t.subscribeChannelAsVisitor=function subscribeChannelAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c,m,h,g=this;return Lc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return c=I.sent,m=c.content.failedArr,h=filter(a=t.channels).call(a,(function(t){return!some(m).call(m,(function(a){return a.channelId===t.channelId&&a.serverId===t.serverId}))})),forEach$1(h).call(h,(function(a){1===t.opeType?g.autoVisitorSubscribeChannel.add(a.serverId+"&"+a.channelId):g.autoVisitorSubscribeChannel.delete(a.serverId+"&"+a.channelId)})),I.abrupt("return",{failedChannels:m});case 7:case"end":return I.stop()}}),_callee,this)})))},t.subscribeServerAsVisitor=function subscribeServerAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g,I,M=this;return Lc.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:map$6(a=t.serverIds).call(a,(function(t){return{serverId:t}}))});case 2:return h=T.sent,g=h.content.failedArr,I=filter(c=t.serverIds).call(c,(function(t){return!some(g).call(g,(function(a){return a.serverId===t}))})),forEach$1(I).call(I,(function(a){1===t.opeType?M.autoVisitorSubscribeServer.add(a):M.autoVisitorSubscribeServer.delete(a)})),T.abrupt("return",{failedServers:map$6(m=h.content.failedArr).call(m,(function(t){return t.serverId}))});case 7:case"end":return T.stop()}}),_callee2,this)})))},t.deleteServer=function deleteServer(t){var a;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var c=[];forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){if(0===indexOf(a).call(a,t)){var m=a.replace(t+"&","");c.push({serverId:t,channelId:m})}})),c.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:c})},t.deleteAutoSetInServerId=function deleteAutoSetInServerId(t){var a,c=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){0===indexOf(a).call(a,t)&&c.autoVisitorSubscribeChannel.delete(a)}))},t.deleteAutoSetInChannel=function deleteAutoSetInChannel(t,a){this.autoVisitorSubscribeChannel.delete(t+"&"+a)},t.unSubscribeChannel=function unSubscribeChannel(t,a){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:a}]})},t.isInSubscribeChannels=function isInSubscribeChannels(t,a){return this.autoVisitorSubscribeChannel.has(t+"&"+a)},t.isInAutoServers=function isInAutoServers(t){return this.autoServers.has(t)},t.doAutoSubscribe=function doAutoSubscribe(){var t=this,a=[],c=jT(Yc(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);forEach$1(c).call(c,(function(c){a.push(t.subscribeServerAsVisitor({opeType:1,serverIds:c}))}));var m=jT(Yc(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return forEach$1(m).call(m,(function(c){a.push(t.subscribeChannelAsVisitor({opeType:1,channels:map$6(c).call(c,(function(t){var a=indexOf(t).call(t,"&");return{serverId:slice(t).call(t,0,a),channelId:slice(t).call(t,a+1)}}))}))})),Mi.all(a)},t.doAutoEnterServer=function doAutoEnterServer(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var t,a,c,m=this;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return t=jT(Yc(this.autoServers),this.limitForBatchEnter),a=[],forEach$1(t).call(t,(function(t){a.push(m.core.qchatServer.enterAsVisitor({serverIds:t}))})),h.next=5,Mi.all(a);case 5:c=h.sent,forEach$1(c).call(c,(function(t){var a;forEach$1(a=t.failedServers).call(a,(function(t){m.deleteAutoSetInServerId(t)}))}));case 7:case"end":return h.stop()}}),_callee3,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=7;break}return a.next=3,this.doAutoEnterServer();case 3:return a.next=5,this.doAutoSubscribe();case 5:a.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return a.stop()}}),_callee4,this)})))},t.cacheServer=function cacheServer(t){var a=this;forEach$1(t).call(t,(function(t){return a.autoServers.add(t)}))},SubscribeForVisitorService}();function _createForOfIteratorHelperLoose$1(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray$1(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var jb,Hb,$b=function(t){function QChatChannelService(a,c){var m;return(m=t.call(this,"qchatChannel",a)||this).config={autoSubscribe:!1},m.core=a,registerParser({cmdMap:sb,cmdConfig:db()}),c&&m.setOptions(c),m.subscribeModuleService=new qb(a),m.subscribeForVisitorService=new Gb(a),m.setListener(),m}wt(QChatChannelService,t);var a=QChatChannelService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=qt(this.config,t))},a.setListener=function setListener(){var t,a,c,m,h,g=this;this.core.eventBus.on("logined",(function(t){g.subscribeModuleService.resumeSubscribe(t.isAutoReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isAutoReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(t){g.subscribeModuleService.resumeSubscribe(t.isReconnect),g.subscribeForVisitorService.resumeSubscribe(t.isReconnect),g.config.autoSubscribe&&(g.subscribeModuleService.autoSubscribeServerMap={},g.subscribeModuleService.autoSubscribeUnreadMap={},g.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",bind$1(t=this.subscribeModuleService.changeUnread).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",bind$1(a=this.subscribeModuleService.updateUnreads).call(a,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",bind$1(c=this.subscribeModuleService.cacheSubscribe).call(c,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",bind$1(m=this.subscribeModuleService.clearUnreadCountByServers).call(m,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",bind$1(h=this.subscribeModuleService.getRoleIdsByServerId).call(h,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(t){if(g.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===Pb[Pb.channelVisibilityUpdate])g.logger.log("QChatChannel::begin autoUnSubscribe channel key is",t.serverId+"_"+t.channelId),g.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),g.logger.log("QChatChannel::autoUnSubscribe channel done key is",t.serverId+"_"+t.channelId);else if(t.type===Pb[Pb.serverEnterLeave]){var a;(g.subscribeModuleService.manualSubscribeServerMap[t.serverId]||g.subscribeModuleService.autoSubscribeServerMap[t.serverId])&&(g.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),g.subscribeModuleService._unSubscribeServer(t.serverId),g.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var c=g.subscribeModuleService.unreadServerCount[t.serverId];if(!c)return;g.logger.log("QChatChannel::begin autoUnSubscribe channels key is",mn(c)),forEach$1(a=mn(c)).call(a,(function(a){g.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),g.logger.log("QChatChannel::autoUnSubscribe channels done key is",mn(c))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(t){g.subscribeModuleService.changeCacheServerRoleIds(t)}))},a.createChannel=function createChannel(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(tb)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:qt(qt({},t),{type:tb[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteChannel=function deleteChannel(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateChannel=function updateChannel(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a,c;return Lc.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(tb),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),a=t,t.type&&(a.type=tb[t.type]),m.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:a,antispamTag:generateAntispamTag(t)});case 5:return c=m.sent,m.abrupt("return",formatChannel(c.content.channelInfo));case 7:case"end":return m.stop()}}),_callee3,this)})))},a.getChannels=function getChannels(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=c.sent,c.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getChannelsByPage=function getChannelsByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c,m,h;return Lc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:qt({limit:100},t)});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatChannels(m)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.getMembersByPage=function getMembersByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c,m,h;return Lc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee6,this)})))},a.updateWhiteBlackRole=function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},opeType:{type:"enum",values:getEnumKeys(eb)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:qt(qt({},t),{type:ZE[t.type],opeType:eb[t.opeType]})});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.getWhiteBlackRolesPage=function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a,c,m,h;return Lc.wrap((function _callee8$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:qt(qt({},t),{type:ZE[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatRoles(m)});case 6:case"end":return g.stop()}}),_callee8,this)})))},a.updateWhiteBlackMembers=function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){return Lc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},opeType:{type:"enum",values:getEnumKeys(eb)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:qt(qt({},t),{type:ZE[t.type],opeType:eb[t.opeType],toAccids:Uc(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.getWhiteBlackMembersPage=function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a,c,m,h;return Lc.wrap((function _callee10$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:qt(qt({limit:100},t),{type:ZE[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee10,this)})))},a.getExistingWhiteBlackRoles=function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var a,c;return Lc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},roleIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:qt(qt({},t),{type:ZE[t.type],roleIds:Uc(t.roleIds)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",{datas:formatRoles(c)});case 6:case"end":return m.stop()}}),_callee11,this)})))},a.getExistingWhiteBlackMembers=function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c;return Lc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(ZE)},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:qt(qt({},t),{type:ZE[t.type],accids:Uc(t.accids)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",{datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee12,this)})))},a.updateCategoryInfoOfChannel=function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a;return Lc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return c.stop()}}),_callee13,this)})))},a.createChannelCategory=function createChannelCategory(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var a;return Lc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.removeChannelCategory=function removeChannelCategory(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){return Lc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateChannelCategory=function updateChannelCategory(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a;return Lc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getChannelCategoriesByID=function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){var a;return Lc.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=c.sent,c.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return c.stop()}}),_callee17,this)})))},a.updateChannelCategoryWhiteBlackRole=function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){return Lc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},opeType:{type:"enum",values:getEnumKeys(eb)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:qt(qt({},t),{type:ZE[t.type],opeType:eb[t.opeType]})});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getChannelCategoryWhiteBlackRolesPage=function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var a,c,m,h;return Lc.wrap((function _callee19$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:qt(qt({},t),{type:ZE[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatRoles(m)});case 6:case"end":return g.stop()}}),_callee19,this)})))},a.updateChannelCategoryWhiteBlackMembers=function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){return Lc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},opeType:{type:"enum",values:getEnumKeys(eb)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:qt(qt({},t),{type:ZE[t.type],opeType:eb[t.opeType],toAccids:Uc(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getChannelCategoryWhiteBlackMembersPage=function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a,c,m,h;return Lc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:qt(qt({},t),{type:ZE[t.type]})});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.getChannelCategoryWhiteBlackRoles=function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var a,c;return Lc.wrap((function _callee22$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},roleIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:qt(qt({},t),{type:ZE[t.type],roleIds:Uc(t.roleIds)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",formatRoles(c));case 6:case"end":return m.stop()}}),_callee22,this)})))},a.getChannelCategoryWhiteBlackMembers=function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){var a,c;return Lc.wrap((function _callee23$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ZE)},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:qt(qt({},t),{type:ZE[t.type],accids:Uc(t.accids)})});case 3:return a=m.sent,c=a.content.datas,m.abrupt("return",formatMembers$1(c));case 6:case"end":return m.stop()}}),_callee23,this)})))},a.getChannelCategoriesPage=function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){var a,c,m,h;return Lc.wrap((function _callee24$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatChannelCategorys(m)});case 6:case"end":return g.stop()}}),_callee24,this)})))},a.getChannelCategoryChannelsPage=function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee25(){var a,c,m,h;return Lc.wrap((function _callee25$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatChannels(m)});case 6:case"end":return g.stop()}}),_callee25,this)})))},a.subscribeChannel=function subscribeChannel(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee26(){var a,c;return Lc.wrap((function _callee26$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),!this.config.autoSubscribe||t.isInternalTrigger||5===t.type){m.next=3;break}throw new Hu("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return m.next=5,this.subscribeModuleService.subscribe(t);case 5:if((a=m.sent).unreadInfos=formatUnreadInfos(a.unreadInfos),5!==t.type){m.next=10;break}return this.subscribeModuleService.cacheSubscribe(t),m.abrupt("return");case 10:return 1===t.opeType&&(t.channels=map$6(c=a.unreadInfos).call(c,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(t):this.subscribeModuleService.cacheSubscribe(t),this.subscribeModuleService.updateUnreads(a.unreadInfos),m.abrupt("return",a);case 15:case"end":return m.stop()}}),_callee26,this)})))},a.getChannelUnreadInfos=function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee27(){var a,c;return Lc.wrap((function _callee27$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=m.sent,c=formatUnreadInfos(a.content.unreadInfos),this.subscribeModuleService.updateUnreads(c),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee27,this)})))},a.getChannelSearchByPage=function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee28(){var a,c,m,h;return Lc.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(rb),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(XE),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new Bu("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:qt(qt({},t),{order:t.order&&rb[t.order],sort:sort(t)&&XE[sort(t)]})});case 5:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag),cursor:h.cursor},datas:formatChannels(m)});case 8:case"end":return g.stop()}}),_callee28,this)})))},a.channelMemberSearch=function channelMemberSearch(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee29(){var a;return Lc.wrap((function _callee29$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelMembers(a.content.datas));case 5:case"end":return c.stop()}}),_callee29,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee30(){return Lc.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee30,this)})))},a.qchatAutoSubscribeNotificationHandler=function qchatAutoSubscribeNotificationHandler(t){var a=formatUnreadInfos(t.content.unreadInfos),c=t.content.serverIds;this.subscribeModuleService.updateUnreads(a);var m=[];if(c.length){var h={opeType:1};h.channels=map$6(c).call(c,(function(t){return{serverId:t.serverId,channelId:""}})),h.type=4,m.push(h)}if(a.length){var g={opeType:1};g.channels=map$6(a).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}})),g.type=1,m.push(g)}if(m.length)for(var I,M=_createForOfIteratorHelperLoose$1(m);!(I=M()).done;){var T=I.value;this.subscribeModuleService.cacheAutoSubscribe(T)}},QChatChannelService}(ob);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(jb||(jb={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(Hb||(Hb={}));var Yb={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Wb={limit:{type:"number"}};function formatMembers(t){return jc(t)&&t.length>0?map$6(t).call(t,(function(t){return function formatMember(t){return format(Yb,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new Bu('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new Bu('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(Wb,t)}var zb,Kb={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},Qb={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},Jb=function getCmdConfig(){var t=function getDeserializeTag(){return invertSerializeMap(Qb)}();return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:Qb.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:t.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:Qb.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:Qb.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:t.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:Qb.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:t.memberInfo}]}}},Xb=function(t){function QChatMediaService(a,c){var m;return(m=t.call(this,"qchatMedia",a)||this).config={},m.tokenExpireTime=24e4,m.getTokenState=!1,m.core=a,registerParser({cmdMap:Kb,cmdConfig:Jb()}),c&&m.setOptions(c),m.setListener(),m.tokenExpireTime=24e4,m.channelId="",m.serverId="",m}wt(QChatMediaService,t);var a=QChatMediaService.prototype;return a.setOptions=function setOptions(t){t&&(this.config=qt(this.config,t),(null==t?void 0:t.neroom)&&this.setNeroom(t.neroom))},a.setNeroom=function setNeroom(t){this.neroom=new t},a.setListener=function setListener(){var t,a,c,m,h=this;this.core.eventBus.on("disconnect",bind$1(t=this._existRomm).call(t,this)),this.core.eventBus.on("kicked",bind$1(a=this._existRomm).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._existRomm).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(m=this._existRomm).call(m,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(t){return __awaiter(h,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===Pb[Pb.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===Pb[Pb.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee,this)})))}))},a._existRomm=function _existRomm(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))},a._checkPermission=function _checkPermission(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=c.sent,c.abrupt("return",a);case 4:case"end":return c.stop()}}),_callee3,this)})))},a._checkConnectState=function _checkConnectState(){if("connect"!==this.state)throw new Hu("QChatMedia::you should connect first")},a.kickMemberOut=function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,c.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:c.next=11;break;case 7:throw c.prev=7,c.t0=c.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+Uc(t),c.t0),new Hu("QChatMedia::kickMemberOut error",c.t0);case 11:case"end":return c.stop()}}),_callee4,this,[[2,7]])})))},a.disconnectChannel=function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){return Lc.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=1,a.next=4,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(1),this.logger.error("QChatMedia::disconnect error",a.t0);case 9:if(!this.authService){a.next=12;break}return a.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee5,this,[[1,6]])})))},a._setStateInit=function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},a.muteAudio=function muteAudio(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var I;return Lc.wrap((function _callee6$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){M.next=14;break}return M.prev=3,M.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyAudio();case 6:M.next=12;break;case 8:throw M.prev=8,M.t0=M.catch(3),this.logger.error("QChatMedia::muteAudio error",M.t0),new Hu("QChatMedia::muteAudio error",M.t0);case 12:case 25:M.next=31;break;case 14:if(M.prev=14,!(I=null===(m=this.roomContext)||void 0===m?void 0:m.roomProperties.audioOff)||(null===(h=I.value)||void 0===h?void 0:h.split("_")[0])!==Hb.offNotAllowSelfOn){M.next=23;break}return M.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(M.sent){M.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),M.abrupt("return");case 23:return M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberAudio(t.accid);case 27:throw M.prev=27,M.t1=M.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+Uc(t),M.t1),new Hu("QChatMedia::muteAudio error",M.t1);case 31:case"end":return M.stop()}}),_callee6,this,[[3,8],[14,27]])})))},a.unMuteAudio=function unMuteAudio(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var I;return Lc.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(I=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(c=I.value)||void 0===c?void 0:c.split("_")[0])!==Hb.offNotAllowSelfOn){M.next=10;break}return M.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(M.sent){M.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),M.abrupt("return");case 10:if((null===(m=this.roomContext)||void 0===m?void 0:m.localMember.uuid)!==t.accid){M.next=22;break}return M.prev=11,M.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyAudio();case 14:M.next=20;break;case 16:throw M.prev=16,M.t0=M.catch(11),this.logger.error("QChatMedia::unMuteAudio error",M.t0),new Hu("QChatMedia::unMuteAudio error",M.t0);case 20:case 25:M.next=31;break;case 22:return M.prev=22,M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.unmuteMemberAudio(t.accid);case 27:throw M.prev=27,M.t1=M.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+Uc(t),M.t1),new Hu("QChatMedia::unMuteAudio error",M.t1);case 31:case"end":return M.stop()}}),_callee7,this,[[11,16],[22,27]])})))},a.muteVideo=function muteVideo(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var I;return Lc.wrap((function _callee8$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){M.next=14;break}return M.prev=3,M.next=6,null===(c=this.rtcController)||void 0===c?void 0:c.muteMyVideo();case 6:M.next=12;break;case 8:throw M.prev=8,M.t0=M.catch(3),this.logger.error("QChatMedia::muteVideo error",M.t0),new Hu("QChatMedia::muteVideo error",M.t0);case 12:case 25:M.next=31;break;case 14:if(M.prev=14,!(I=null===(m=this.roomContext)||void 0===m?void 0:m.roomProperties.videoOff)||(null===(h=I.value)||void 0===h?void 0:h.split("_")[0])!==Hb.offNotAllowSelfOn){M.next=23;break}return M.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(M.sent){M.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),M.abrupt("return");case 23:return M.next=25,null===(g=this.rtcController)||void 0===g?void 0:g.muteMemberVideo(t.accid);case 27:throw M.prev=27,M.t1=M.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+Uc(t),M.t1),new Hu("QChatMedia::muteVideo error",M.t1);case 31:case"end":return M.stop()}}),_callee8,this,[[3,8],[14,27]])})))},a.unMuteVideo=function unMuteVideo(t){var a,c,m,h,g;return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var I;return Lc.wrap((function _callee9$(M){for(;;)switch(M.prev=M.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(I=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(c=I.value)||void 0===c?void 0:c.split("_")[0])!==Hb.offNotAllowSelfOn){M.next=10;break}return M.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(M.sent){M.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),M.abrupt("return");case 10:if((null===(m=this.roomContext)||void 0===m?void 0:m.localMember.uuid)!==t.accid){M.next=22;break}return M.prev=11,M.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyVideo();case 14:M.next=20;break;case 16:throw M.prev=16,M.t0=M.catch(11),this.logger.error("QChatMedia::unMuteVideo error",M.t0),new Hu("QChatMedia::unMuteVideo error",M.t0);case 20:M.next=30;break;case 22:M.prev=22,null===(g=this.rtcController)||void 0===g||g.unmuteMemberVideo(t.accid),M.next=30;break;case 26:throw M.prev=26,M.t1=M.catch(22),this.logger.error("QChatMedia::unMuteVideo error",M.t1),new Hu("QChatMedia::unMuteVideo error",M.t1);case 30:case"end":return M.stop()}}),_callee9,this,[[11,16],[22,26]])})))},a.startScreenShare=function startScreenShare(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new Hu("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee10,this,[[1,5]])})))},a.stopScreenShare=function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new Hu("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))},a.stopMemberScreenShare=function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){return Lc.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",c.t0),new Hu("QChatMedia::stopMemberScreenShare error",c.t0);case 10:case"end":return c.stop()}}),_callee12,this,[[2,6]])})))},a.subscribeRemoteVideoStream=function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){return Lc.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",c.t0),new Hu("QChatMedia::subscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee13,this,[[2,6]])})))},a.unSubscribeRemoteVideoStream=function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){return Lc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",c.t0),new Hu("QChatMedia::unSubscribeRemoteVideoStream error",c.t0);case 10:case"end":return c.stop()}}),_callee14,this,[[2,6]])})))},a.setupVideoCanvas=function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Hu("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Hu("QChatMedia::setupVideoCanvas error",t)}},a.setupRemoteVideoSubStreamCanvas=function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new Hu("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},a.getScreenSharingUserUuid=function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new Hu("QChatMedia::getScreenSharingUserUuid error",t)}},a.initQChatMedia=function initQChatMedia(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){return Lc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new Hu("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee15,this,[[6,10]])})))},a.loginByIM=function loginByIM(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a,c;return Lc.wrap((function _callee16$(m){for(;;)switch(m.prev=m.next){case 0:if("init"===this.state){m.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),m.abrupt("return");case 3:return m.next=5,this._getToken();case 5:return a=m.sent,c=Rs(this.core,"options.token")||Rs(this.core,"V2NIMLoginService.token"),m.prev=7,m.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(this.core.account,a,c);case 10:m.next=16;break;case 12:throw m.prev=12,m.t0=m.catch(7),this.logger.error("QChatMedia::loginByIM error",m.t0),new Hu("QChatMedia::loginByIM error",m.t0);case 16:this.state="login";case 17:case"end":return m.stop()}}),_callee16,this,[[7,12]])})))},a._getToken=function _getToken(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){var a,c,m,h,g=this;return Lc.wrap((function _callee18$(I){for(;;)switch(I.prev=I.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),I.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return a=I.sent,c=a.content.neroomToken,m=c.token,h=c.expire,this.logger.log("QChatMedia::getToken success token is "+m+",expire is "+h+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*h-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return __awaiter(g,void 0,void 0,Lc.mark((function _callee17(){var t;return Lc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee17,this)})))}),1e3*h-this.tokenExpireTime)),I.abrupt("return",m);case 8:case"end":return I.stop()}}),_callee18,this)})))},a.connectChannel=function connectChannel(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var m;return Lc.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:if(void 0!==this.state){h.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),h.abrupt("return");case 3:if("init"!==this.state){h.next=6;break}return h.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,h.prev=8,h.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:h.next=17;break;case 13:throw h.prev=13,h.t0=h.catch(8),this.logger.error("QChatMedia::connectChannel error",h.t0),new Hu("QChatMedia::connectChannel error",h.t0);case 17:if(!(m=null===(c=this.roomService)||void 0===c?void 0:c.getRoomContext(t.channelId))){h.next=28;break}return this.roomContext=m,this.rtcController=this.roomContext.rtcController,this.state="connect",h.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),h.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return h.stop()}}),_callee19,this,[[8,13]])})))},a.updateRTCChannelInfo=function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){return Lc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:qt(qt({},t),{audio:Uc(t.audio),video:Uc(t.video)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getRTCChannelInfo=function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a;return Lc.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=c.sent,c.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return c.stop()}}),_callee21,this)})))},a.getRTCChannelOnlineMembers=function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var a;return Lc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addRTCChannelListener=function addRTCChannelListener(){var t,a,c=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(c,void 0,void 0,Lc.mark((function _callee23(){var a;return Lc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:if(1026!==t||this.getTokenState){c.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,c.next=5,this._getToken();case 5:if(a=c.sent,!this.authService){c.next=9;break}return c.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return c.stop()}}),_callee23,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new Hu("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,m,h,g,I,M;if(c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var T=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];T!==Hb.offNotAllowSelfOn&&T!==Hb.offAllowSelfOn||(null===(m=c.roomContext)||void 0===m?void 0:m.localMember.isAudioOn)&&(null===(h=c.rtcController)||void 0===h||h.muteMyAudio())}else if(t.videoOff){var S=null===(g=t.videoOff.value)||void 0===g?void 0:g.split("_")[0];S!==Hb.offNotAllowSelfOn&&S!==Hb.offAllowSelfOn||(null===(I=c.roomContext)||void 0===I?void 0:I.localMember.isVideoOn)&&(null===(M=c.rtcController)||void 0===M||M.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){c.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberJoinRTCChannel",a),c.core.qchatMedia.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){c.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map$6(t).call(t,(function(t){return t.uuid}));c.core.emit("memberLeaveRTCChannel",a),c.core.qchatMedia.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){c.authService&&c.authService.logout(),c._setStateInit(),c.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),c.core.emit("RTCChannelEnded",t),c.core.qchatMedia.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&c.disconnectChannel(),c.core.emit("RTCChannelError",t),c.core.qchatMedia.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){c.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),c.core.emit("onRtcAudioVolumeIndication",t),c.core.qchatMedia.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),c.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),c.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:m.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,m){c.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),c.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid}),c.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:m.uuid})}})},a.enumCameraDevices=function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new Hu("QChatMedia::enumCameraDevices error",a)}))},a.enumPlayoutDevices=function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new Hu("QChatMedia::enumPlayoutDevices error",a)}))},a.enumRecordDevices=function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new Hu("QChatMedia::enumRecordDevices error",a)}))},a.removeRTCChannelListener=function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})},a.setSelectedCameraDevice=function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new Hu("QChatMedia::setSelectedCameraDevice error",t)}))},a.setSelectedPlayoutDevice=function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new Hu("QChatMedia::setSelectedPlayoutDevice error",t)}))},a.setSelectedRecordDevice=function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new Hu("QChatMedia::setSelectedRecordDevice error",t)}))},a.getRTCMembers=function getRTCMembers(){var t,a;return this._checkConnectState(),map$6(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))},a.subscribeRemoteVideoSubStream=function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){return Lc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",c.t0),new Hu("QChatMedia::subscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee24,this,[[2,6]])})))},a.unsubscribeRemoteVideoSubStream=function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee25(){return Lc.wrap((function _callee25$(c){for(;;)switch(c.prev=c.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),c.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0),new Hu("QChatMedia::unsubscribeRemoteVideoSubStream error",c.t0);case 10:case"end":return c.stop()}}),_callee25,this,[[2,6]])})))},a.muteAllAudio=function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee26(){return Lc.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Uc({value:Hb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new Hu("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee26,this,[[7,11]])})))},a.muteAllVideo=function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee27(){return Lc.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Uc({value:Hb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new Hu("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))},a.unMuteAllAudio=function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee28(){return Lc.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Uc({value:Hb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new Hu("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))},a.unMuteAllVideo=function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,Lc.mark((function _callee29(){return Lc.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Uc({value:Hb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new Hu("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))},QChatMediaService}(ob),Zb={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},eC={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:cb},tC=function getDeserializeTag(){return invertSerializeMap(eC)},rC=function getCmdConfig(){var t=tC();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:eC.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:eC.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:eC.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:eC.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:eC.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:t.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:eC.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:t.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:eC.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:eC.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:t.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:t.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:t.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:eC.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:eC.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:eC.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:eC.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:t.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:t.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:eC.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:eC.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:eC.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:t.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:t.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:t.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:t.qchatMsgTag}]}}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(zb||(zb={}));var nC,aC={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},iC={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:cb},oC=function getDeserializeTag(){return invertSerializeMap(iC)},sC=function getCmdConfig(){var t=oC();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:iC.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:iC.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:iC.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:iC.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:t.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:t.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:iC.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:iC.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:t.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:iC.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:iC.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:iC.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:iC.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:iC.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:iC.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:t.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:t.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:t.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:iC.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:t.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:t.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:t.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},cC={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},lC={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},uC=function getDeserializeTag(){return invertSerializeMap(lC)},dC=function getCmdConfig(){var t=uC();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:lC.serverRole},{type:"Property",name:"antispamTag",reflectMapper:lC.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:lC.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:t.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:lC.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:t.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:lC.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:lC.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:t.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:t.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:t.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:t.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:t.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:lC.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:lC.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:lC.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:t.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:lC.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:lC.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:lC.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:t.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:lC.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:t.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:lC.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},pC=["image","audio","video","file"],mC={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:Pb},fromClientType:{type:"enum",values:zb},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var c=qt({},t),m=qt({type:a||Pb.custom},formatReverse(mC,c));return m.serverId&&m.channelId&&m.toAccids?m.toType=Ob.channelAccids:m.serverId&&m.toAccids?m.toType=Ob.serverAccids:m.serverId&&m.channelId?m.toType=Ob.channel:m.serverId?m.toType=Ob.server:m.toAccids?m.toType=Ob.accids:m.toType=Ob.unknown,m}function generatorSysMsgMarkersForCmd(t){var a=vT(t,["msgIdServer","type"]);return formatReverse(mC,a)}var hC=((nC={})[Pb.channelUpdateWhiteBlackIdentify]=function(t){var a=ub();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateWhiteBlackRoleTag)),t},nC[Pb.channelUpdateWhiteBlackIdentifyUser]=function(t){var a=ub();return t.notify=function formatUpdateWhiteBlackMembers(t){return format(hb,t)}(deserialize(t.notify,a.qchatUpdateWhiteBlackMembersTag)),t},nC[Pb.updateQuickComment]=function(t){var a=tC();return t.notify=function formatQuickCommentRequest(t){return format(vC,t)}(deserialize(t.notify,a.qchatQuickCommentRequestTag)),t},nC[Pb.channelCategoryCreate]=function(t){var a=ub();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},nC[Pb.channelCategoryUpdate]=function(t){var a=ub();return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,a.QChatChannelCategoryInfo)),t},nC[Pb.channelCategoryUpdateWhiteBlackIdentify]=function(t){var a=ub();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackRoleTag)),t},nC[Pb.channelCategoryUpdateWhiteBlackIdentifyUser]=function(t){var a=ub();return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,a.qchatUpdateChannelCategoryWhiteBlackMembersTag)),t},nC[Pb.serverIdentifyAdd]=function(t){var a=uC();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},nC[Pb.serverIdentifyRemove]=function(t){var a=uC();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},nC[Pb.serverIdentifyUpdate]=function(t){var a=uC();return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,a.serverRole)),t},nC[Pb.channelIdentifyUpdate]=function(t){var a=uC();return t.channelIdentifyInfo=formatRole(deserialize(t.channelIdentifyInfo,a.channelRole)),t},nC[Pb.userIdentifyUpdate]=function(t){var a=uC();return t.userIdentifyInfo=formatRole(deserialize(t.userIdentifyInfo,a.memberRole)),t},nC[Pb.myMemberInfoUpdated]=function(t){var a,c=Rs(t,"userInfo.name"),m=Rs(t,"userInfo.icon");return t.updatedInfos=map$6(a=t.reuseServers).call(a,(function(t){var a={serverId:t.serverId};return 1==(1&t.bits)&&"string"==typeof c&&qt(a,{nickChanged:!0,nick:c}),2==(2&t.bits)&&"string"==typeof m&&qt(a,{avatarChanged:!0,avatar:m}),a})),delete t.userInfo,delete t.reuseServers,t},nC);function formatSystemNotification(t,a){var c=format(mC,t);if(!c.attach)return c;var m=oC(),h=ub();if(c.attach.serverInfo&&(c.attach.serverInfo=formatServer(deserialize(c.attach.serverInfo,m.serverInfo))),c.attach.channelInfo&&(c.attach.channelInfo=formatChannel(deserialize(c.attach.channelInfo,h.channelInfo))),c.attach.serverMember&&(c.attach.serverMember=formatMember$1(deserialize(c.attach.serverMember,m.memberInfo))),hC[c.attach.type]&&(c.attach=hC[c.attach.type](c.attach)),c.attach.updateAuths)try{c.attach.updateAuths=formatRoleAuths(JSON.parse(c.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return c.attach.type&&(c.attach.rawType=c.attach.type,c.attach.type=Pb[c.attach.type]),c}var fC={type:{type:"enum",values:Rb},fromClientType:{type:"enum",values:zb},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:wb},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),c=formatReverse(fC,a);if(c.msgIdClient=t.resendFlag?t.msgIdClient:mm(),!c.msgIdClient)throw new Gu("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(c.replyMsgFromAccount=t.replyMessage.fromAccount,c.replyMsgTime=+t.replyMessage.time,c.replyMsgIdServer=t.replyMessage.msgIdServer,c.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(c.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,c.threadMsgTime=+t.replyMessage.threadRefer.time,c.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,c.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(c.threadMsgFromAccount=t.replyMessage.fromAccount,c.threadMsgTime=+t.replyMessage.time,c.threadMsgIdServer=t.replyMessage.msgIdServer,c.threadMsgIdClient=t.replyMessage.msgIdClient),delete c.replyMessage),c}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:zb},pushPayload:{type:"object"}},t)}function formatMsg(t,a,c){var m,h;return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee(){var g,I,M,T;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return(g=format(fC,t)).deliveryStatus=a.deliveryStatus?kb[a.deliveryStatus]:kb[kb.success],a.time&&(g.time=a.time),I=tC(),g.updateContent&&(M=format({status:{type:"number"}},M=deserialize(M=JSON.parse(g.updateContent),I.qchatMsgTag)),g.updateContent=M),g.updateOperatorInfo&&(T=formatMsgOperatorInfo(deserialize(T=JSON.parse(g.updateOperatorInfo),I.qchatMsgUpdateTag)),g.updateOperatorInfo=T),""===(null===(m=null==g?void 0:g.threadRefer)||void 0===m?void 0:m.fromAccount)&&delete g.threadRefer,""===(null===(h=null==g?void 0:g.replyRefer)||void 0===h?void 0:h.fromAccount)&&delete g.replyRefer,g.attach&&a.attachUrl&&(g.attach.url=a.attachUrl),S.next=11,formatMsgAttach(g,c);case 11:return S.abrupt("return",S.sent);case 12:case"end":return S.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var c;return Lc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(includes(pC).call(pC,t.type)&&t.attach&&t.attach.url){m.next=2;break}return m.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){m.next=4;break}return m.abrupt("return",t);case 4:if(!(indexOf(c=t.attach.url).call(c,"_im_url=1")<0)){m.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),m.abrupt("return",t);case 7:return m.prev=7,m.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=m.sent,m.next=16;break;case 13:throw m.prev=13,m.t0=m.catch(7),new Gu('url "'+t.attach.url+'" parse error',"message.attach.url","parse error");case 16:return m.abrupt("return",t);case 17:case"end":return m.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t,a,c){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(jc(t)&&t.length>0){h.next=2;break}return h.abrupt("return",[]);case 2:return m=map$6(t).call(t,(function(t){return formatMsg(t,a,c)})),h.next=5,Mi.all(m);case 5:return h.abrupt("return",h.sent);case 6:case"end":return h.stop()}}),_callee3)})))}var gC={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map$6(t).call(t,(function(t){var a,c=format(gC,t);return c.details=map$6(a=c.details).call(a,(function(t){var a=t.createTime?zp(t.createTime):0;return a=isNaN(a)?0:a,{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type,createTime:a}})),c})),c={};return forEach$1(a).call(a,(function(t){return c[t.msgIdServer]=t})),c}var vC={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var yC={includeSelf:{type:"number"},order:{type:"enum",values:rb},sort:{type:"enum",values:Nb},msgTypes:{type:"object"},subTypes:{type:"object"}};var _C={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}};var IC={6:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(t.serverId),!0},16:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(t.serverId,t.channelId),!0},26:function _(t){var a=Rs(t,"attach.addAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},27:function _(t){var a=Rs(t,"attach.deleteAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},31:function _(t){var a,c;return 1===t.attach.event?(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:t.serverId,channelId:t.channelId}],isInternalTrigger:!0}):2===t.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)),!0},32:function _(t){var a,c;return 2===t.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)):1===t.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(t.serverId),(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:t.serverId}],isInternalTrigger:!0})),!0},34:function _(t){return 2===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(t.serverId,t.channelId),!0},101:function _(t){var a=vT(t,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",a),this.core.emit("recvTypingEvent",a),this.core.qchatMsg.emit("recvTypingEvent",a),!1}},MC=function(){function NotificationModuleService(t){this.core=t,this.logger=t.logger}var t=NotificationModuleService.prototype;return t.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=m.sent,c=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",c):this.logger.log("sendCustomSysMsg success",c.serverId,c.channelId,c.msgIdServer),m.abrupt("return",c);case 6:case"end":return m.stop()}}),_callee,this)})))},t.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c,m,h,g;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return a=t.systemNotification,c=__rest(t,["systemNotification"]),m=vT(a,["msgIdServer","type","body","ext","status"]),h=generatorSysMsgForCmd(m),I.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:h,qchatMsgUpdateTag:qt(qt({},c),{operatorAccount:this.core.account,operatorClientType:zb.Web,pushPayload:Uc(t.pushPayload),routeEnable:_m.boolean(t,"routeEnable")})});case 5:return g=I.sent,I.abrupt("return",formatSystemNotification(g.content.sysMsg,this.logger));case 7:case"end":return I.stop()}}),_callee2,this)})))},t.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map$6(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return c.stop()}}),_callee3,this)})))},t.onSysMsg=function onSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.core.logger),m=IC[Pb[c.type]];if(m)if(!1===m.call(this,c))return;var h={feature:"default",systemNotifications:[c]};this.logger.log("qchat on systemNotification: ",h),this.core.emit("systemNotification",h),this.core.qchatMsg.emit("systemNotification",h)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var c=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",c),this.core.qchatMsg.emit("systemNotificationUpdate",c)}},t.onSyncSysMsg=function onSyncSysMsg(t){var a=this,c=t.content.systemNotifications;if(c&&c.length>0){var m=map$6(c).call(c,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:m}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:m})}else this.logger.warn("sync system notification not exist")},NotificationModuleService}(),TC=["image","audio","video","file"],SC=function(){function MessageModuleService(t){var a=this;this.markMessageRead=throttle((function(t){return __awaiter(a,void 0,void 0,Lc.mark((function _callee(){var a,c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=m.sent,c=formatUnreadInfo(a.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[c]);case 5:case"end":return m.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}var t=MessageModuleService.prototype;return t.sendMessage=function sendMessage(t){var a,c,m,h;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var g,I,M,T,S,E;return Lc.wrap((function _callee2$(b){for(;;)switch(b.prev=b.next){case 0:if(!(indexOf(TC).call(TC,t.type)>-1)){b.next=4;break}return b.next=3,this.doSendFile(t);case 3:t.attach=b.sent;case 4:return g=generatorMsgForCmd(qt({fromAccount:this.core.account},t)),b.next=7,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:kb.sending},this.core);case 7:I=b.sent;try{t.onSendBefore&&t.onSendBefore(I)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return b.prev=9,b.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:g});case 12:M=b.sent,b.next=22;break;case 15:return b.prev=15,b.t0=b.catch(9),b.next=19,formatMsg(g,{time:(new Date).getTime(),deliveryStatus:kb.failed,attachUrl:null===(a=I.attach)||void 0===a?void 0:a.url},this.core);case 19:throw T=b.sent,b.t0.msg=T,b.t0;case 22:return S=M.content,b.next=25,formatMsg(qt({},S.qchatMsg),{deliveryStatus:kb.success,attachUrl:null===(c=I.attach)||void 0===c?void 0:c.url},this.core);case 25:if(!(E=b.sent).isAntispam){b.next=29;break}throw{code:10403,msg:E,message:(null===(m=null==E?void 0:E.antiSpamInfo)||void 0===m?void 0:m.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(h=null==E?void 0:E.antiSpamInfo)||void 0===h?void 0:h.yidunAntiSpamRes)||""};case 29:return b.abrupt("return",E);case 30:case"end":return b.stop()}}),_callee2,this,[[9,15]])})))},t.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){c.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){c.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return c.prev=5,c.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=c.sent,c.next=15;break;case 11:throw c.prev=11,c.t0=c.catch(5),this.logger.error("sendFile:: upload File error or abort.",c.t0),c.t0;case 15:return c.abrupt("return",a);case 16:case"end":return c.stop()}}),_callee3,this,[[5,11]])})))},t.resendMessage=function resendMessage(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var m,h,g,I,M;return Lc.wrap((function _callee4$(T){for(;;)switch(T.prev=T.next){case 0:return(m=generatorMsgForCmd(qt(qt({},t),{resendFlag:!0}))).deliveryStatus=kb.sending,T.prev=2,T.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:m});case 5:h=T.sent,T.next=15;break;case 8:return T.prev=8,T.t0=T.catch(2),T.next=12,formatMsg(m,{time:(new Date).getTime(),deliveryStatus:kb.failed},this.core);case 12:throw g=T.sent,T.t0.msg=g,T.t0;case 15:return I=h.content,T.next=18,formatMsg(qt({},I.qchatMsg),{deliveryStatus:kb.success},this.core);case 18:if(!(M=T.sent).isAntispam){T.next=22;break}throw{code:10403,msg:M,message:(null===(a=null==M?void 0:M.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=null==M?void 0:M.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 22:return T.abrupt("return",M);case 23:case"end":return T.stop()}}),_callee4,this,[[2,8]])})))},t.doUpdateMessage=function doUpdateMessage(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var m,h,g,I,M;return Lc.wrap((function _callee5$(T){for(;;)switch(T.prev=T.next){case 0:return m=t.message,h=__rest(t,["message"]),(g=generatorMsgForCmd(m)).msgIdClient=void 0,g.time=m.time,T.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:g,qchatMsgUpdateTag:qt(qt({},h),{operatorAccount:this.core.account,operatorClientType:zb.Web,pushPayload:Uc(t.pushPayload),routeEnable:_m.boolean(t,"routeEnable")})});case 6:return I=T.sent,T.next=9,formatMsg(I.content.qchatMsg,{},this.core);case 9:if(M=T.sent,this.core.eventBus.emit("qchatChannel/changeUnread",M,!0),!I.content.qchatMsg.isAntispam){T.next=14;break}throw{code:10403,msg:g,message:(null===(a=I.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(c=I.content.qchatMsg)||void 0===c?void 0:c.yidunAntiSpamRes)||""};case 14:return T.abrupt("return",M);case 15:case"end":return T.stop()}}),_callee5,this)})))},t.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c,m,h=this;return Lc.wrap((function _callee6$(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 2:return c=g.sent,m=c.content,g.next=6,Mi.all(map$6(a=m.qchatMsgs).call(a,(function(t){return formatMsg(t,{},h.core)})));case 6:return g.abrupt("return",g.sent);case 7:case"end":return g.stop()}}),_callee6,this)})))},t.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var a,c,m,h,g,I=this;return Lc.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return c=M.sent,m=c.content,T=m.page,h=format(_C,T),M.next=7,Mi.all(map$6(a=m.datas).call(a,(function(t){return formatMsg(t,{},I.core)})));case 7:return g=M.sent,M.abrupt("return",{pageInfo:h,messages:g});case 9:case"end":return M.stop()}var T}),_callee7,this)})))},t.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a,c,m;return Lc.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:a={},c=0;case 2:if(!(c<t.length)){h.next=13;break}if((m=t[c]).fromAccount!==this.core.account){h.next=7;break}return a[m.msgIdClient]=!1,h.abrupt("continue",10);case 7:return h.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(m,!0);case 9:a[m.msgIdClient]=h.sent;case 10:c++,h.next=2;break;case 13:return h.abrupt("return",a);case 14:case"end":return h.stop()}}),_callee8,this)})))},t.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a,c,m;return Lc.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=h.sent,c=a.content.msgs,h.next=6,formatMsgs(c,{},this.core);case 6:return m=h.sent,h.abrupt("return",reduce(m).call(m,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return h.stop()}}),_callee9,this)})))},t.messageSearchByPage=function messageSearchByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a,c,m,h,g;return Lc.wrap((function _callee10$(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:qt(qt({},(M=t,formatReverse(yC,M))),{includeSelf:t.includeSelf?1:""})});case 2:return a=I.sent,c=a.content,m=c.datas,h=c.listQueryTag,I.next=6,formatMsgs(m,{},this.core);case 6:return g=I.sent,I.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:h.nextTimetag?zp(h.nextTimetag):0,cursor:h.cursor},datas:g});case 8:case"end":return I.stop()}var M}),_callee10,this)})))},t.onMsg=function onMsg(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){var a,c;return Lc.wrap((function _callee11$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t.content.qchatMsg){m.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),m.abrupt("return");case 4:return m.next=6,formatMsg(a,{},this.core);case 6:c=m.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1),this.core.emit("message",c),this.core.qchatMsg.emit("message",c);case 10:case"end":return m.stop()}}),_callee11,this)})))},t.onRecvUnreadInfo=function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a,c;return Lc.wrap((function _callee12$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t.content.qchatMsg){m.next=3;break}return m.abrupt("return");case 3:return m.next=5,formatMsg(a);case 5:c=m.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!1);case 7:case"end":return m.stop()}}),_callee12,this)})))},t.onMultiSyncRead=function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var c=formatUnreadInfo(a);this.core.eventBus.emit("qchatChannel/updateUnreads",[c])}},t.onMultiSyncServersRead=function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var c=formatClearServersUnread(a),m=c.successServerIds,h=c.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",m,h)}},t.onRecvMsgUpdate=function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a,c,m,h;return Lc.wrap((function _callee13$(g){for(;;)switch(g.prev=g.next){case 0:if(a=t.content.qchatMsg,c=t.content.qchatMsgUpdateInfo,a){g.next=4;break}return g.abrupt("return");case 4:return g.next=6,formatMsg(a,{},this.core);case 6:m=g.sent,h=formatMsgOperatorInfo(c),this.core.eventBus.emit("qchatChannel/changeUnread",m,!0),this.core.emit("messageUpdate",m,h),this.core.qchatMsg.emit("messageUpdate",m,h);case 11:case"end":return g.stop()}}),_callee13,this)})))},MessageModuleService}(),EC=function(){function ExtendModuleService(t){var a=this;this._sendTypingEvent=throttle((function(t){return __awaiter(a,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(qt(qt({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),Pb.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}var t=ExtendModuleService.prototype;return t.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a,c;return Lc.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return c=m.sent,m.abrupt("return",Mi.all(map$6(a=c.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return m.stop()}}),_callee2,this)})))},t.getReferMessages=function getReferMessages(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var m;return Lc.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(c=t.message.threadRefer)||void 0===c?void 0:c.msgIdServer)){h.next=2;break}throw new Error("Message has no reply");case 2:return h.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(m=h.sent,t.referType!==xb[xb.all]){h.next=9;break}return h.abrupt("return",{replyMessage:m[0],threadMessage:m[1]});case 9:if(t.referType!==xb[xb.reply]){h.next=13;break}return h.abrupt("return",{replyMessage:m[0]});case 13:if(t.referType!==xb[xb.thread]){h.next=15;break}return h.abrupt("return",{threadMessage:m[1]});case 15:return h.abrupt("return",{replyMessage:m[0],threadMessage:m[1]});case 16:case"end":return h.stop()}}),_callee3,this)})))},t.getThreadMessages=function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var c,m,h,g,I;return Lc.wrap((function _callee4$(M){for(;;)switch(M.prev=M.next){case 0:return m=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?qt({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,M.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:m,getThreadHistoryMsgTag:qt(qt({},t.messageQueryOption),{reverse:_m.boolean(t.messageQueryOption,"reverse")})});case 3:return h=M.sent,M.next=6,formatMsg(h.content.thread);case 6:return g=M.sent,M.next=9,Mi.all(map$6(c=h.content.qchatMsgs).call(c,(function(t){return formatMsg(t)})));case 9:return I=M.sent,M.abrupt("return",{thread:g,threadInfo:{messageCount:+h.content.threadInfo.messageCount,lastMessageTimestamp:+h.content.threadInfo.lastMessageTimestamp},messages:I});case 11:case"end":return M.stop()}}),_callee4,this)})))},t.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c,m,h;return Lc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return a=t.threadRootMessages,c=__rest(t,["threadRootMessages"]),g.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:c});case 3:if(m=g.sent,!((h=m.content.metas)&&h.length>0)){g.next=7;break}return g.abrupt("return",map$6(h).call(h,(function(t){return qt(qt({},t),{total:zp(t.total),timestamp:zp(t.timestamp),msgTime:zp(t.msgTime)})})));case 7:return g.abrupt("return",[]);case 8:case"end":return g.stop()}}),_callee5,this)})))},t.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c,m;return Lc.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:Uc(map$6(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return c=h.sent,m=c.content.quickCommentResponse,h.abrupt("return",formatQuickComments(m));case 5:case"end":return h.stop()}}),_callee6,this)})))},t.updateQuickComment=function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var c,m,h,g,I,M;return Lc.wrap((function _callee7$(T){for(;;)switch(T.prev=T.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),c=t.commentMessage,m=c.serverId,h=c.channelId,g=c.fromAccount,I=c.msgIdServer,M=c.time,T.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:m,channelId:h,fromAccount:g,msgIdServer:I,time:M,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return T.stop()}}),_callee7,this)})))},t.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){return Lc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))},ExtendModuleService}(),bC=function(t){function QChatMsgService(a){var c;return(c=t.call(this,"qchatMsg",a)||this).core=a,c.lastChannelIdInMark="",registerParser({cmdMap:Zb,cmdConfig:rC()}),c.notificationModuleService=new MC(a),c.messageModuleService=new SC(a),c.extendModuleService=new EC(a),c}wt(QChatMsgService,t);var a=QChatMsgService.prototype;return a.sendMessage=function sendMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){return Lc.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Rb)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))},a.updateMessage=function updateMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new Hu("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))},a.resendMessage=function resendMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.deleteMessage=function deleteMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Uc(t))).message.status=2,c.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return c.abrupt("return",c.sent);case 6:case"end":return c.stop()}}),_callee4,this)})))},a.revokeMessage=function revokeMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Uc(t))).message=vT(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,c.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}}),_callee5,this)})))},a.markMessageRead=function markMessageRead(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.replyMessage=function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new Hu("Forbid replying to message from other server, channel");return this.sendMessage(t)},a.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.getReferMessages=function getReferMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){return Lc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(xb),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))},a.getThreadMessages=function getThreadMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){return Lc.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))},a.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))},a.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))},a.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){return Lc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pb)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))},a.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){return Lc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){return Lc.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))},a.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){return Lc.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),a.next=3,this.messageModuleService.getMentionedMeMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee15,this)})))},a.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a;return Lc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),every(a=t.messages).call(a,(function(a){return t.messages[0].serverId===a.serverId}))){c.next=4;break}throw new Hu("Different serverId",t,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(t.messages[0].serverId)){c.next=7;break}throw new Hu("Not allowed for visitor",t,10403);case 7:return c.next=9,this.messageModuleService.areMentionedMeMessages(t.messages);case 9:return c.abrupt("return",c.sent);case 10:case"end":return c.stop()}}),_callee16,this)})))},a.addQuickComment=function addQuickComment(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){return Lc.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee17,this)})))},a.removeQuickComment=function removeQuickComment(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){return Lc.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee18,this)})))},a.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){return Lc.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))},a.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){return Lc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee20,this)})))},a.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){return Lc.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee21,this)})))},a.qchatOnMsgHandler=function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){return Lc.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee22,this)})))},a.qchatOnRecvUnreadInfoHandler=function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){return Lc.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee23,this)})))},a.qchatOnSysMsgHandler=function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)},a.qchatMultiSyncMessageReadHandler=function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)},a.qchatMultiSyncSystemNotificationUpdateHandler=function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)},a.qchatSyncSystemNotificationHandler=function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)},a.qchatRecvMessageUpdateHandler=function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){return Lc.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee24,this)})))},a.searchMsgByPage=function searchMsgByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee25(){return Lc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(rb),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(Nb),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee25,this)})))},a.qchatMultiSyncServersMessageReadHandler=function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)},QChatMsgService}(ob),CC=function(){function CategoryModuleService(t){this.core=t}var t=CategoryModuleService.prototype;return t.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return c.stop()}}),_callee,this)})))},t.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},t.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Hu("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return c.stop()}}),_callee3,this)})))},t.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(m=a.content.list,jc(m)&&m.length>0?map$6(m).call(m,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return c.stop()}var m}),_callee4,this)})))},t.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},t.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},t.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){var a;return Lc.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Hu("No update required",{},406);case 6:return c.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return c.stop()}}),_callee7,this)})))},t.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=c.sent,c.abrupt("return",(m=a.content.list,jc(m)&&m.length>0?map$6(m).call(m,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return c.stop()}var m}),_callee8,this)})))},CategoryModuleService}(),AC=function(t){function QChatRoleService(a){var c;return(c=t.call(this,"qchatRole",a)||this).core=a,registerParser({cmdMap:cC,cmdConfig:dC()}),c.category=new CC(a),c}wt(QChatRoleService,t);var a=QChatRoleService.prototype;return a.createServerRole=function createServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:qt(qt({},generatorRoleForCmd(t)),{type:Tb.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee,this)})))},a.updateServerRole=function updateServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var a;return Lc.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return c.stop()}}),_callee2,this)})))},a.deleteServerRole=function deleteServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.getServerRoles=function getServerRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a,c,m;return Lc.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),h.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return c=h.sent,m=filter(a=c.content.serverRoles).call(a,(function(t){return 1===zp(t.isMember)})),m=map$6(m).call(m,(function(t){return t.roleId})),h.abrupt("return",{roles:formatRoles(c.content.serverRoles),isMemberRoles:m});case 7:case"end":return h.stop()}}),_callee4,this)})))},a.addChannelRole=function addChannelRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a;return Lc.wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return c.stop()}}),_callee5,this)})))},a.getChannelRoles=function getChannelRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a;return Lc.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee6,this)})))},a.removeChannelRole=function removeChannelRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateChannelRole=function updateChannelRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){var a;return Lc.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Hu("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return c.stop()}}),_callee8,this)})))},a.addMemberRole=function addMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a;return Lc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),c.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=c.sent,c.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.getMemberRoles=function getMemberRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){var a;return Lc.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return c.stop()}}),_callee10,this)})))},a.removeMemberRole=function removeMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberRole=function updateMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){var a;return Lc.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=c.sent).raw.code){c.next=6;break}throw new Hu("No update required",{},406);case 6:return c.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return c.stop()}}),_callee12,this)})))},a.addMembersToServerRole=function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){var a,c,m;return Lc.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatAddMembersToServerRole",qt(qt({},t),{accids:Uc(t.accids)}));case 3:return a=h.sent,c=Rs(a,"content.accids.successAccids"),m=Rs(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:m?JSON.parse(m):[]});case 7:case"end":return h.stop()}}),_callee13,this)})))},a.removeMembersFromServerRole=function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var a,c,m;return Lc.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",qt(qt({},t),{accids:Uc(t.accids)}));case 3:return a=h.sent,c=Rs(a,"content.accids.successAccids"),m=Rs(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:c?JSON.parse(c):[],failedAccids:m?JSON.parse(m):[]});case 7:case"end":return h.stop()}}),_callee14,this)})))},a.getMembersFromServerRole=function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){var a;return Lc.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.members));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerRolesByAccid=function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a;return Lc.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return c.stop()}}),_callee16,this)})))},a.getExistingServerRolesByAccids=function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){var a,c,m;return Lc.wrap((function _callee17$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),h.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:Uc(t.accids)});case 3:return a=h.sent,h.prev=4,m=JSON.parse(a.content.serverRoles),forEach$1(c=mn(m)).call(c,(function(t){var a;forEach$1(a=m[t]).call(a,(function(a,c){m[t][c]=deserialize(a,uC().serverRole)})),m[t]=formatRoles(m[t])})),h.abrupt("return",m);case 10:throw h.prev=10,h.t0=h.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+t.serverId+" and "+t.accids,a.content.serverRoles),h.t0;case 14:case"end":return h.stop()}}),_callee17,this,[[4,10]])})))},a.getExistingChannelRolesByServerRoleIds=function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){var a;return Lc.wrap((function _callee18$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:Uc(t.roleIds)});case 3:return a=c.sent,c.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return c.stop()}}),_callee18,this)})))},a.getExistingAccidsOfMemberRoles=function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){var a,c;return Lc.wrap((function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:Uc(t.accids)});case 3:return a=m.sent,c=a.content.memberRoles,m.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return m.stop()}}),_callee19,this)})))},a.getExistingAccidsInServerRole=function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){var a,c;return Lc.wrap((function _callee20$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:Uc(t.accids)});case 3:return a=m.sent,c=a.content.members,m.abrupt("return",c&&c.length>0?map$6(c).call(c,(function(t){return t.accid})):[]);case 6:case"end":return m.stop()}}),_callee20,this)})))},a.updateServerRolePriorities=function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a,c;return Lc.wrap((function _callee21$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),m.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map$6(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return c=m.sent,m.abrupt("return",formatRoles(c.content.serverRoles));case 5:case"end":return m.stop()}}),_callee21,this)})))},a.checkPermission=function checkPermission(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var a;return Lc.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},t),c.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:qt(qt({},t),{auth:bb[t.auth]||t.auth})});case 3:return a=c.sent,c.abrupt("return",a.content.checked);case 5:case"end":return c.stop()}}),_callee22,this)})))},a.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){return Lc.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){return Lc.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))},a.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee25(){return Lc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee26(){return Lc.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))},a.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee27(){return Lc.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))},a.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee28(){return Lc.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))},a.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee29(){return Lc.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))},a.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee30(){return Lc.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))},a.checkPermissions=function checkPermissions(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee31(){var a,c,m,h;return Lc.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},t),this.core.logger.log("qchatRole::checkPermission options is",t),g.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:qt(qt({},t),{auths:Uc(map$6(a=t.auths).call(a,(function(t){return bb[t]||t})))})});case 4:return m=g.sent,this.core.logger.log("qchatRole::checkPermission result is",m.content),h={},forEach$1(c=m.content.checkPermissionsResult).call(c,(function(t){h[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",h),g.abrupt("return",formatRoleAuths(h));case 10:case"end":return g.stop()}}),_callee31,this)})))},QChatRoleService}(ob),NC=cp((function(t,a){return Td(t)?Qm(t,fT(a,1,Td,!0)):[]})),RC=NC;function _createForOfIteratorHelperLoose(t,a){var c,m=void 0!==bc&&Wc(t)||t["@@iterator"];if(m)return bind$1(c=(m=m.call(t)).next).call(c,m);if(jc(t)||(m=function _unsupportedIterableToArray(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var m=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===m&&t.constructor&&(m=t.constructor.name);if("Map"===m||"Set"===m)return Yc(t);if("Arguments"===m||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){m&&(t=m);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,m=new Array(a);c<a;c++)m[c]=t[c];return m}var kC=function(t){function QChatServerService(a){var c;return(c=t.call(this,"qchatServer",a)||this).core=a,registerParser({cmdMap:aC,cmdConfig:sC()}),c}wt(QChatServerService,t);var a=QChatServerService.prototype;return a.createServer=function createServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var a;return Lc.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:qt(qt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee,this)})))},a.deleteServer=function deleteServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){return Lc.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateServer=function updateServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var a;return Lc.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:qt(qt({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.getServers=function getServers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=c.sent,c.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return c.stop()}}),_callee4,this)})))},a.getServersByPage=function getServersByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var a,c,m,h;return Lc.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatServers(m)});case 6:case"end":return g.stop()}}),_callee5,this)})))},a.inviteServerMembers=function inviteServerMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){var a,c;return Lc.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),m.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=m.sent,c=a.content.record||{},m.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(c)});case 6:case"end":return m.stop()}}),_callee6,this)})))},a.acceptServerInvite=function acceptServerInvite(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee7(){return Lc.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.rejectInviteServer=function rejectInviteServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee8(){return Lc.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))},a.applyServerJoin=function applyServerJoin(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee9(){var a;return Lc.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return c.stop()}}),_callee9,this)})))},a.acceptServerApply=function acceptServerApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee10(){return Lc.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))},a.rejectServerApply=function rejectServerApply(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee11(){return Lc.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))},a.kickServerMembers=function kickServerMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee12(){return Lc.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))},a.leaveServer=function leaveServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee13(){return Lc.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee14(){var a;return Lc.wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee14,this)})))},a.updateServerMemberInfo=function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee15(){var a;return Lc.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),c.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=c.sent,c.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.getServerMembers=function getServerMembers(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee16(){var a,c,m,h,g;return Lc.wrap((function _callee16$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length)for(c=_createForOfIteratorHelperLoose(t.accids);!(m=c()).done;)h=m.value,a.push(h.serverId+"|"+h.accid);return I.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return g=I.sent,I.abrupt("return",formatMembers$1(g.content.accidList));case 7:case"end":return I.stop()}}),_callee16,this)})))},a.getServerMembersByPage=function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee17(){var a,c,m,h;return Lc.wrap((function _callee17$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatMembers$1(m)});case 6:case"end":return g.stop()}}),_callee17,this)})))},a.subscribeServer=function subscribeServer(t){var a,c,m,h;return __awaiter(this,void 0,void 0,Lc.mark((function _callee18(){var g,I,M,T;return Lc.wrap((function _callee18$(S){for(;;)switch(S.prev=S.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)||t.isInternalTrigger){S.next=3;break}throw new Hu("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(t.type||(t.type=4),!t.servers.length){S.next=12;break}return I=qt(qt({},t),{channels:map$6(g=t.servers).call(g,(function(t){return{serverId:t.serverId,channelId:""}}))}),S.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(I);case 8:return M=S.sent,T=M.failedChannels,(null===(h=null===(m=this.core.qchatChannel)||void 0===m?void 0:m.config)||void 0===h?void 0:h.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(I):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(I),S.abrupt("return",{failedServers:T});case 12:case"end":return S.stop()}}),_callee18,this)})))},a.banServerMember=function banServerMember(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee19(){return Lc.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:qt(qt({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.unbanServerMember=function unbanServerMember(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee20(){return Lc.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:qt(qt({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getBannedMembersByPage=function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee21(){var a,c,m,h;return Lc.wrap((function _callee21$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),g.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag)},datas:formatServerMemberBanInfos(m)});case 6:case"end":return g.stop()}}),_callee21,this)})))},a.serverSearchByPage=function serverSearchByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee22(){var a,c,m,h;return Lc.wrap((function _callee22$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(rb),required:!1},searchType:{type:"enum",values:getEnumKeys(ab)},sort:{type:"enum",values:getEnumKeys(nb),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){g.next=3;break}throw new Bu("startTime more than endTime",t,"timeRule");case 3:return g.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:qt(qt({},t),{order:t.order&&rb[t.order],searchType:ab[t.searchType],sort:sort(t)&&nb[sort(t)],serverType:Uc(t.serverType)})});case 5:return a=g.sent,c=a.content,m=c.datas,h=c.listQueryTag,g.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:zp(h.nextTimetag),cursor:h.cursor},datas:formatServers(m)});case 8:case"end":return g.stop()}}),_callee22,this)})))},a.serverMemberSearchByPage=function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee23(){var a;return Lc.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),c.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=c.sent,c.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return c.stop()}}),_callee23,this)})))},a.generateInviteCode=function generateInviteCode(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee24(){var a;return Lc.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),c.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=c.sent,c.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return c.stop()}}),_callee24,this)})))},a.joinByInviteCode=function joinByInviteCode(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee25(){return Lc.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getInviteApplyRecordOfServer=function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee26(){var a;return Lc.wrap((function _callee26$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee26,this)})))},a.getInviteApplyRecordOfSelf=function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee27(){var a;return Lc.wrap((function _callee27$(c){for(;;)switch(c.prev=c.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),c.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:qt(qt({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=c.sent,c.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return c.stop()}}),_callee27,this)})))},a.markRead=function markRead(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee28(){var a,c,m,h;return Lc.wrap((function _callee28$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),g.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=g.sent,c=formatClearServersUnread(a.content.clearServersUnreadTag),m=c.successServerIds,h=c.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",m,h),g.abrupt("return",c);case 9:case"end":return g.stop()}}),_callee28,this)})))},a.subscribeAllChannel=function subscribeAllChannel(t){var a,c;return __awaiter(this,void 0,void 0,Lc.mark((function _callee29(){var m,h,g;return Lc.wrap((function _callee29$(I){for(;;)switch(I.prev=I.next){case 0:if(validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),!(null===(c=null===(a=this.core.qchatChannel)||void 0===a?void 0:a.config)||void 0===c?void 0:c.autoSubscribe)){I.next=3;break}throw new Hu("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return I.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",t,{timeout:3e4});case 5:return(h=I.sent).content.unreadInfos=formatUnreadInfos(h.content.unreadInfos),h.content.failServerIds=formatFailServerIds(h.content.failServerIds),g={type:t.type,opeType:1,channels:map$6(m=h.content.unreadInfos).call(m,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",g),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",t.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",h.content.unreadInfos),I.abrupt("return",h.content);case 13:case"end":return I.stop()}}),_callee29,this)})))},a.enterAsVisitor=function enterAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee30(){var a,c,m;return Lc.wrap((function _callee30$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:Uc(t.serverIds)}});case 3:return a=h.sent,c=formatFailServerIds(a.content.failServerIds),m=RC(t.serverIds,c),this.core.qchatChannel.subscribeForVisitorService.cacheServer(m),h.abrupt("return",{failedServers:c});case 8:case"end":return h.stop()}}),_callee30,this)})))},a.leaveAsVisitor=function leaveAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee31(){var a,c,m,h=this;return Lc.wrap((function _callee31$(g){for(;;)switch(g.prev=g.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),g.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:Uc(t.serverIds)}});case 3:return a=g.sent,c=formatFailServerIds(a.content.failServerIds),m=RC(t.serverIds,c),forEach$1(m).call(m,(function(t){h.core.qchatChannel.subscribeForVisitorService.deleteServer(t)})),g.abrupt("return",{failedServers:c});case 8:case"end":return g.stop()}}),_callee31,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee32(){return Lc.wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},t),!t.serverIds.length){a.next=5;break}return a.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(t);case 4:return a.abrupt("return",a.sent);case 5:return a.abrupt("return",{failedServers:[]});case 6:case"end":return a.stop()}}),_callee32,this)})))},QChatServerService}(ob),wC="V2NIMNotificationService",OC={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","101_3":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","4_101":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},PC={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:boolToInt,retConverter:function retConverter(t,a){return"0"!==a[6]&&!!zp(t)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:boolToInt,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function def(t){if(101===t.type&&t["pushConfig.forcePush"])return"#%@all@%#"},converter:function converter(t,a){if(a["pushConfig.forcePush"])return t?Uc(t):"#%@all@%#"}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:boolToInt,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:boolToInt,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:boolToInt,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:boolToInt,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:boolToInt,retType:"boolean",access:"pushConfig.pushNickEnabled"}},xC={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},VC={v2SendCustomNotification:{sid:30,cid:7,service:wC,params:[{type:"Property",name:"tag",reflectMapper:PC}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:wC,params:[{type:"Property",name:"tag",reflectMapper:PC}]},onSysNotification:{sid:7,cid:3,service:wC,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(PC)}]},syncBroadcastMsg:{sid:4,cid:16,service:wC,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(xC)}]},onBroadcastMsg:{sid:7,cid:17,service:wC,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(xC)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:wC,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(PC)}]},v2NotificationRevoke:{sid:7,cid:14,service:wC,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(PC)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:wC,response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(PC)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},LC={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccounts:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},DC=function(t){function V2NIMNotificationServiceImpl(a,c){var m;return(m=t.call(this,"V2NIMNotificationService",a)||this).config={compatibleWithV1:!0},"v2"!==m.core.options.apiVersion?Qe(m):(registerParser({cmdMap:OC,cmdConfig:VC}),m.setOptions(c),m)}wt(V2NIMNotificationServiceImpl,t);var a=V2NIMNotificationServiceImpl.prototype;return a.setOptions=function setOptions(t){var a;(null===(a=this.core.systemMessage)||void 0===a?void 0:a.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=qt(this.config,t)},a.sendCustomNotification=function sendCustomNotification(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var m,h,g,I,M,T;return Lc.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return this.checkV2(),validateConversationId(this.core.account,t),validate(LC,{content:a,params:c},"",!0),h=this.core.V2NIMConversationIdUtil.parseConversationType(t),g=this.core.V2NIMConversationIdUtil.parseConversationTargetId(t),(m={})[Yl.V2NIM_CONVERSATION_TYPE_P2P]=100,m[Yl.V2NIM_CONVERSATION_TYPE_TEAM]=101,m[Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM]=103,I=m,M=Ri(),T=h===Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",S.next=10,this.core.sendCmd(T,{tag:qt(qt({},c),{notificationConfig:qt({unreadEnabled:!0,offlineEnabled:!0},null==c?void 0:c.notificationConfig),pushConfig:qt({pushEnabled:!0,pushNickEnabled:!0},null==c?void 0:c.pushConfig),antispamConfig:qt({antispamEnabled:!0},null==c?void 0:c.antispamConfig),routeConfig:qt({routeEnabled:!0},null==c?void 0:c.routeConfig),timestamp:M,type:I[h],receiverId:g,content:a})});case 10:case"end":return S.stop()}}),_callee,this)})))},a.processSystemNotification=function processSystemNotification(t){var a=[0,1,2,3,4,15,16,17,18],c=[5,6],m=t.type;if(!includes(a).call(a,m)){includes(c).call(c,m)&&this.core.eventBus.emit("V2NIMFriendService/sysNotification",t);var h={100:Yl.V2NIM_CONVERSATION_TYPE_P2P,101:Yl.V2NIM_CONVERSATION_TYPE_TEAM,102:Yl.V2NIM_CONVERSATION_TYPE_P2P,103:Yl.V2NIM_CONVERSATION_TYPE_SUPER_TEAM},g=qt(qt({},t),{conversationType:h[m]});return delete g.type,g}this.core.eventBus.emit("V2NIMTeamService/sysNotification",t)},a.markBroadcastMsgAck=function markBroadcastMsgAck(t){this.config.compatibleWithV1||this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:map$6(t).call(t,(function(t){return t.id}))})},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.datas;this.markBroadcastMsgAck(a),this.emit("onReceiveBroadcastNotifications",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.data;this.markBroadcastMsgAck([a]),this.emit("onReceiveBroadcastNotifications",[a])},a.onSysNotificationHandler=function onSysNotificationHandler(t){this.markSysNotificationAck([t.content.data]);var a=this.processSystemNotification(t.content.data);a&&this.emit("onReceiveCustomNotifications",[a])},a.v2SyncOfflineSysNotificationsHandler=function v2SyncOfflineSysNotificationsHandler(t){var a,c,m,h=this;this.markSysNotificationAck([t.content.datas]);var g=filter(a=map$6(c=sort(m=t.content.datas).call(m,(function(t,a){return t.timestamp-a.timestamp}))).call(c,(function(t){return h.processSystemNotification(t)}))).call(a,(function(t){return t}));g&&this.emit("onReceiveCustomNotifications",g)},a.v2NotificationRevokeHandler=function v2NotificationRevokeHandler(t){this.markSysNotificationAck([t.content.data])},a.v2NotificationSyncRevokeHandler=function v2NotificationSyncRevokeHandler(t){var a=t.content.type;1===zp(a)&&this.markSysNotificationAck(t.content.datas)},a.markSysNotificationAck=function markSysNotificationAck(t){if(!this.config.compatibleWithV1){var a=[],c=[],m=[15,16,17,18,103];forEach$1(t).call(t,(function(t){t.idServer&&(includes(m).call(m,t.type)?c.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:a}),c.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:c})}},V2NIMNotificationServiceImpl}(ch),UC=function(t){function V2NIMStorageUtil(a){var c;return(c=t.call(this,"V2NIMStorageUtil",a)||this).core=a,c}wt(V2NIMStorageUtil,t);var a=V2NIMStorageUtil.prototype;return a.imageThumbUrl=function imageThumbUrl(t,a){return t+"?imageView&thumbnail="+a+"z"+a},a.videoCoverUrl=function videoCoverUrl(t,a){return t+"?vframe&offset="+a},V2NIMStorageUtil}(ch),FC=function(t){function V2NIMStorageServiceImpl(a){var c;return(c=t.call(this,"V2NIMStorageService",a)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},c.uploadingMessageInfo={},c.core=a,c.core.V2NIMStorageUtil=new UC(c.core),c}wt(V2NIMStorageServiceImpl,t);var a=V2NIMStorageServiceImpl.prototype;return a.addCustomStorageScene=function addCustomStorageScene(t,a){return this.checkV2(),validate({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:t,expireTime:a},"",!0),this.sceneMap[t]={sceneName:t,expireTime:a},{sceneName:t,expireTime:a}},a.getStorageSceneList=function getStorageSceneList(){return this.checkV2(),Ci(this.sceneMap)},a.getStorageScene=function getStorageScene(t){return t&&this.sceneMap[t]||this.sceneMap.nim_default_im},a.hasStorageScene=function hasStorageScene(t){return void 0!==this.sceneMap[t]},a.createUploadFileTask=function createUploadFileTask(t){var a;if(this.checkV2(),"string"==typeof t.fileObj&&0===indexOf(a=t.fileObj).call(a,"nim-external")){var c=document.getElementById(t.fileObj);c&&c.files&&c.files[0]&&(t.fileObj=c.files[0])}return{taskId:mm(),uploadParams:t}},a.uploadFile=function uploadFile(t,a){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var c;return Lc.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return this.checkV2(),validate({taskId:{type:"string",allowEmpty:!1}},t,"fileTask",!0),m.next=4,this._uploadFile(t,a);case 4:return c=m.sent,m.abrupt("return",c[0]);case 6:case"end":return m.stop()}}),_callee,this)})))},a._uploadFile=function _uploadFile(t,a,c){var m;return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var h,g,I,M,T,S,E,b,C,A,N=this;return Lc.wrap((function _callee2$(R){for(;;)switch(R.prev=R.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){R.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(h=t.uploadParams,g=t.taskId,I=getFileOrPath(h.fileObj),M=I.file,T=I.path,S=(c||{}).fileType,!this.uploadingMessageInfo[g]){R.next=7;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(R.prev=7,E={},M?E.file=M:T&&(0===(null==T?void 0:indexOf(T).call(T,"nim-external"))?E.fileInput=T:E.filePath=T),b=this.getStorageScene(h.sceneName),E.nosScenes=b.sceneName,E.nosSurvivalTime=b.expireTime,S===iu.V2NIM_MESSAGE_TYPE_IMAGE?E.type="image":S===iu.V2NIM_MESSAGE_TYPE_AUDIO?E.type="audio":S===iu.V2NIM_MESSAGE_TYPE_VIDEO?E.type="video":E.type="file",!E.file||!this.core.pluginMap["browser-md5-file"]){R.next=19;break}return R.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],g,E.file);case 17:C=R.sent,E.md5=C;case 19:return E.onUploadProgress=function(t){"function"==typeof a&&a(100*t.percentage)},E.onUploadStart=function(t){var a;if(null===(a=N.uploadingMessageInfo[g])||void 0===a?void 0:a.abort)return t.abort(),void delete N.uploadingMessageInfo[g];N.uploadingMessageInfo[g]={abort:!1,task:t}},this.uploadingMessageInfo[g]={abort:!1},R.next=24,this.core.cloudStorage.uploadFile(E);case 24:if(A=R.sent,!(null===(m=this.uploadingMessageInfo[g])||void 0===m?void 0:m.abort)){R.next=27;break}throw new Fu({code:Lu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[g],R.abrupt("return",[A.url,A]);case 31:throw R.prev=31,R.t0=R.catch(7),delete this.uploadingMessageInfo[g],this.core.logger.error("sendFile:: upload File error or abort.",R.t0),R.t0;case 36:case"end":return R.stop()}}),_callee2,this,[[7,31]])})))},a.cancelUploadFile=function cancelUploadFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this._cancelUploadFile(t.taskId);case 3:case"end":return a.stop()}}),_callee3,this)})))},a._cancelUploadFile=function _cancelUploadFile(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var a;return Lc.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),!(null==(a=this.uploadingMessageInfo[t])?void 0:a.task)){c.next=16;break}return c.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),c.next=7,a.task.abort();case 7:delete this.uploadingMessageInfo[t],c.next=14;break;case 10:c.prev=10,c.t0=c.catch(3),delete this.uploadingMessageInfo[t],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",c.t0);case 14:c.next=22;break;case 16:if(!a){c.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),a.abort=!0,c.next=22;break;case 21:throw new Fu({code:Lu.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return c.stop()}}),_callee4,this,[[3,10]])})))},a.getFileMd5=function getFileMd5(t,a,c){return __awaiter(this,void 0,void 0,Lc.mark((function _callee5(){var m=this;return Lc.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",new Mi((function(h,g){var I,M=new t;(null===(I=m.uploadingMessageInfo[a])||void 0===I?void 0:I.abort)?g(new Fu({code:Lu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):m.uploadingMessageInfo[a]={abort:!1,task:M};try{M.md5(c,(function(t,a){"aborted"===t?g(new Fu({code:Lu.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:t}})):t?g(new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:t}})):h(a)}))}catch(t){g(new Fu({code:Lu.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:t}}))}})));case 1:case"end":return h.stop()}}),_callee5)})))},a.shortUrlToLong=function shortUrlToLong(t){return __awaiter(this,void 0,void 0,Lc.mark((function _callee6(){return Lc.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.abrupt("return",this.core.cloudStorage.getOriginUrl(t));case 2:case"end":return a.stop()}}),_callee6,this)})))},a.videoCoverUrl=function videoCoverUrl(t,a){return this.checkV2(),this.core.V2NIMStorageUtil.videoCoverUrl(t,a)},a.imageThumbUrl=function imageThumbUrl(t,a){return this.checkV2(),this.core.V2NIMStorageUtil.imageThumbUrl(t,a)},V2NIMStorageServiceImpl}(ch),BC={"27_1":"v2NIMSync","27_10":"v2QChatSync"},qC={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},GC=function(t){function V2NIMSyncServiceImpl(a){var c;return(c=t.call(this,"V2NIMSyncService",a)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],c.config={},c.timetags={},"v2"!==c.core.options.apiVersion?Qe(c):(c.initEventListeners(),registerParser({cmdMap:BC,cmdConfig:qC}),c)}wt(V2NIMSyncServiceImpl,t);var a=V2NIMSyncServiceImpl.prototype;return a.reset=function reset(){this.timetags={}},a.setOptions=function setOptions(t){var a=this.core;return this.config=qt({myInfo:!0,offlineMsgs:!!a.V2NIMMessageService.name,roamingMsgs:!!a.V2NIMMessageService.name,relations:!0,friends:!0,friendUsers:!0,msgReceipts:!!a.V2NIMMessageService.name,broadcastMsgs:!!a.V2NIMMessageService.name,recallMsg:!!a.V2NIMMessageService.name,sessionAck:!!a.V2NIMConversationService.name,superTeamSessionAck:!!a.V2NIMConversationService.name,superTeamRoamingMsgs:!!a.V2NIMTeamService.name,deleteSuperTeamMsg:!!a.V2NIMTeamService.name,deleteSelfMsgs:!!a.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!a.V2NIMMessageService.name,avSignal:!!a.signaling.name,teams:!!a.V2NIMTeamService.name,superTeams:!!a.V2NIMTeamService.name,myTeamMembers:!!a.V2NIMTeamService.name,mySuperTeamMembers:!!a.V2NIMTeamService.name},t),this.config},a.doBasicSync=function doBasicSync(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee(){var t,a,c,m,h,g=this;return Lc.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return t=mn(this.config),a=filter(t).call(t,(function(t){var a;return!includes(a=g.teamKey).call(a,t)&&g.config[t]})),c=this.genSyncParams(a),I.next=5,this.core.clientSocket.sendCmd("v2NIMSync",{tag:c});case 5:return m=I.sent,h=m.content.timetag,this.setTimetags(h,a),I.next=10,this.delaySyncDone();case 10:return I.next=12,this.handleImmediate();case 12:this.core.logger.log("sync::basic sync complete in",h);case 13:case"end":return I.stop()}}),_callee,this)})))},a.doTeamSync=function doTeamSync(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee2(){var t,a,c,m,h,g=this;return Lc.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:return a=filter(t=this.teamKey).call(t,(function(t){return g.config[t]})),c=this.genSyncParams(a),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),m=null,I.prev=4,I.next=7,this.core.clientSocket.sendCmd("v2NIMSync",{tag:c});case 7:m=I.sent,I.next=14;break;case 10:throw I.prev=10,I.t0=I.catch(4),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",I.t0),I.t0;case 14:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),h=m.content.timetag,this.setTimetags(h,this.teamKey),this.core.logger.log("sync::team sync complete in",h);case 18:case"end":return I.stop()}}),_callee2,this,[[4,10]])})))},a.doQchatSync=function doQchatSync(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee3(){var t;return Lc.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:t=a.sent,this.core.logger.log("sync::qchat sync complete in",t.content.timetag);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.doSync=function doSync(){return __awaiter(this,void 0,void 0,Lc.mark((function _callee4(){var t;return Lc.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==(t=Rs(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))){a.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),a.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Hl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_SYNCING}),1!==t){a.next=20;break}return a.prev=7,a.next=10,this.doBasicSync();case 10:return a.next=12,this.doTeamSync();case 12:a.next=18;break;case 14:return a.prev=14,a.t0=a.catch(7),this.doSyncComplete(a.t0),a.abrupt("return");case 18:a.next=49;break;case 20:if(2!==t){a.next=32;break}return a.prev=21,a.next=24,this.doQchatSync();case 24:a.next=30;break;case 26:return a.prev=26,a.t1=a.catch(21),this.doSyncComplete(a.t1),a.abrupt("return");case 30:a.next=49;break;case 32:if(3!==t){a.next=48;break}return a.prev=33,a.next=36,this.doBasicSync();case 36:return a.next=38,this.doTeamSync();case 38:return a.next=40,this.doQchatSync();case 40:a.next=46;break;case 42:return a.prev=42,a.t2=a.catch(33),this.doSyncComplete(a.t2),a.abrupt("return");case 46:a.next=49;break;case 48:return a.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return a.stop()}}),_callee4,this,[[7,14],[21,26],[33,42]])})))},a.doSyncComplete=function doSyncComplete(t){t&&this.core.logger.log("sync::doSync complete but got error",t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:Hl.V2NIM_DATA_SYNC_TYPE_MAIN,state:$l.V2NIM_DATA_SYNC_STATE_COMPLETED,error:t,subType:"mainSync"})},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.doSync()}))},a.genSyncParams=function genSyncParams(t){var a=this;return reduce(t).call(t,(function(t,c){var m=c;return t[m]=a.timetags[m]||0,t}),{})},a.setTimetags=function setTimetags(t,a){var c=this;forEach$1(a).call(a,(function(a){c.timetags[a]=t}))},a.handleImmediate=function handleImmediate(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),Mi.resolve()},a.delaySyncDone=function delaySyncDone(){return"ALI"===getMiniappEnv()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new Mi((function(t){qi((function(){t()}),100)}))):Mi.resolve()},V2NIMSyncServiceImpl}(ch),jC=createCommonjsModule((function(t,a){t.exports=function(t){var add32=function(t,a){return t+a&4294967295},a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function cmn(t,a,c,m,h,g){return a=add32(add32(a,t),add32(m,g)),add32(a<<h|a>>>32-h,c)}function ff(t,a,c,m,h,g,I){return cmn(a&c|~a&m,t,a,h,g,I)}function gg(t,a,c,m,h,g,I){return cmn(a&m|c&~m,t,a,h,g,I)}function hh(t,a,c,m,h,g,I){return cmn(a^c^m,t,a,h,g,I)}function ii(t,a,c,m,h,g,I){return cmn(c^(a|~m),t,a,h,g,I)}function md5cycle(t,a){var c=t[0],m=t[1],h=t[2],g=t[3];c=ff(c,m,h,g,a[0],7,-680876936),g=ff(g,c,m,h,a[1],12,-389564586),h=ff(h,g,c,m,a[2],17,606105819),m=ff(m,h,g,c,a[3],22,-1044525330),c=ff(c,m,h,g,a[4],7,-176418897),g=ff(g,c,m,h,a[5],12,1200080426),h=ff(h,g,c,m,a[6],17,-1473231341),m=ff(m,h,g,c,a[7],22,-45705983),c=ff(c,m,h,g,a[8],7,1770035416),g=ff(g,c,m,h,a[9],12,-1958414417),h=ff(h,g,c,m,a[10],17,-42063),m=ff(m,h,g,c,a[11],22,-1990404162),c=ff(c,m,h,g,a[12],7,1804603682),g=ff(g,c,m,h,a[13],12,-40341101),h=ff(h,g,c,m,a[14],17,-1502002290),c=gg(c,m=ff(m,h,g,c,a[15],22,1236535329),h,g,a[1],5,-165796510),g=gg(g,c,m,h,a[6],9,-1069501632),h=gg(h,g,c,m,a[11],14,643717713),m=gg(m,h,g,c,a[0],20,-373897302),c=gg(c,m,h,g,a[5],5,-701558691),g=gg(g,c,m,h,a[10],9,38016083),h=gg(h,g,c,m,a[15],14,-660478335),m=gg(m,h,g,c,a[4],20,-405537848),c=gg(c,m,h,g,a[9],5,568446438),g=gg(g,c,m,h,a[14],9,-1019803690),h=gg(h,g,c,m,a[3],14,-187363961),m=gg(m,h,g,c,a[8],20,1163531501),c=gg(c,m,h,g,a[13],5,-1444681467),g=gg(g,c,m,h,a[2],9,-51403784),h=gg(h,g,c,m,a[7],14,1735328473),c=hh(c,m=gg(m,h,g,c,a[12],20,-1926607734),h,g,a[5],4,-378558),g=hh(g,c,m,h,a[8],11,-2022574463),h=hh(h,g,c,m,a[11],16,1839030562),m=hh(m,h,g,c,a[14],23,-35309556),c=hh(c,m,h,g,a[1],4,-1530992060),g=hh(g,c,m,h,a[4],11,1272893353),h=hh(h,g,c,m,a[7],16,-155497632),m=hh(m,h,g,c,a[10],23,-1094730640),c=hh(c,m,h,g,a[13],4,681279174),g=hh(g,c,m,h,a[0],11,-358537222),h=hh(h,g,c,m,a[3],16,-722521979),m=hh(m,h,g,c,a[6],23,76029189),c=hh(c,m,h,g,a[9],4,-640364487),g=hh(g,c,m,h,a[12],11,-421815835),h=hh(h,g,c,m,a[15],16,530742520),c=ii(c,m=hh(m,h,g,c,a[2],23,-995338651),h,g,a[0],6,-198630844),g=ii(g,c,m,h,a[7],10,1126891415),h=ii(h,g,c,m,a[14],15,-1416354905),m=ii(m,h,g,c,a[5],21,-57434055),c=ii(c,m,h,g,a[12],6,1700485571),g=ii(g,c,m,h,a[3],10,-1894986606),h=ii(h,g,c,m,a[10],15,-1051523),m=ii(m,h,g,c,a[1],21,-2054922799),c=ii(c,m,h,g,a[8],6,1873313359),g=ii(g,c,m,h,a[15],10,-30611744),h=ii(h,g,c,m,a[6],15,-1560198380),m=ii(m,h,g,c,a[13],21,1309151649),c=ii(c,m,h,g,a[4],6,-145523070),g=ii(g,c,m,h,a[11],10,-1120210379),h=ii(h,g,c,m,a[2],15,718787259),m=ii(m,h,g,c,a[9],21,-343485551),t[0]=add32(c,t[0]),t[1]=add32(m,t[1]),t[2]=add32(h,t[2]),t[3]=add32(g,t[3])}function md5blk(t){var a,c=[];for(a=0;a<64;a+=4)c[a>>2]=t.charCodeAt(a)+(t.charCodeAt(a+1)<<8)+(t.charCodeAt(a+2)<<16)+(t.charCodeAt(a+3)<<24);return c}function md5blk_array(t){var a,c=[];for(a=0;a<64;a+=4)c[a>>2]=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+(t[a+3]<<24);return c}function md51(t){var a,c,m,h,g,I,M=t.length,T=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=M;a+=64)md5cycle(T,md5blk(t.substring(a-64,a)));for(c=(t=t.substring(a-64)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)m[a>>2]|=t.charCodeAt(a)<<(a%4<<3);if(m[a>>2]|=128<<(a%4<<3),a>55)for(md5cycle(T,m),a=0;a<16;a+=1)m[a]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(h[2],16),I=parseInt(h[1],16)||0,m[14]=g,m[15]=I,md5cycle(T,m),T}function md51_array(t){var a,c,m,h,g,I,M=t.length,T=[1732584193,-271733879,-1732584194,271733878];for(a=64;a<=M;a+=64)md5cycle(T,md5blk_array(t.subarray(a-64,a)));for(c=(t=a-64<M?t.subarray(a-64):new Uint8Array(0)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)m[a>>2]|=t[a]<<(a%4<<3);if(m[a>>2]|=128<<(a%4<<3),a>55)for(md5cycle(T,m),a=0;a<16;a+=1)m[a]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(h[2],16),I=parseInt(h[1],16)||0,m[14]=g,m[15]=I,md5cycle(T,m),T}function rhex(t){var c,m="";for(c=0;c<4;c+=1)m+=a[t>>8*c+4&15]+a[t>>8*c&15];return m}function hex(t){var a;for(a=0;a<t.length;a+=1)t[a]=rhex(t[a]);return t.join("")}function toUtf8(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function utf8Str2ArrayBuffer(t,a){var c,m=t.length,h=new ArrayBuffer(m),g=new Uint8Array(h);for(c=0;c<m;c+=1)g[c]=t.charCodeAt(c);return a?g:h}function arrayBuffer2Utf8Str(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function concatenateArrayBuffers(t,a,c){var m=new Uint8Array(t.byteLength+a.byteLength);return m.set(new Uint8Array(t)),m.set(new Uint8Array(a),t.byteLength),c?m:m.buffer}function hexToBinaryString(t){var a,c=[],m=t.length;for(a=0;a<m-1;a+=2)c.push(parseInt(t.substr(a,2),16));return String.fromCharCode.apply(String,c)}function SparkMD5(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==hex(md51("hello"))&&(add32=function(t,a){var c=(65535&t)+(65535&a);return(t>>16)+(a>>16)+(c>>16)<<16|65535&c}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function clamp(t,a){return(t=0|t||0)<0?Math.max(t+a,0):Math.min(t,a)}ArrayBuffer.prototype.slice=function(a,c){var m,h,g,I,M=this.byteLength,T=clamp(a,M),S=M;return c!==t&&(S=clamp(c,M)),T>S?new ArrayBuffer(0):(m=S-T,h=new ArrayBuffer(m),g=new Uint8Array(h),I=new Uint8Array(this,T,m),g.set(I),h)}}(),SparkMD5.prototype.append=function(t){return this.appendBinary(toUtf8(t)),this},SparkMD5.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var a,c=this._buff.length;for(a=64;a<=c;a+=64)md5cycle(this._hash,md5blk(this._buff.substring(a-64,a)));return this._buff=this._buff.substring(a-64),this},SparkMD5.prototype.end=function(t){var a,c,m=this._buff,h=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<h;a+=1)g[a>>2]|=m.charCodeAt(a)<<(a%4<<3);return this._finish(g,h),c=hex(this._hash),t&&(c=hexToBinaryString(c)),this.reset(),c},SparkMD5.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},SparkMD5.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},SparkMD5.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},SparkMD5.prototype._finish=function(t,a){var c,m,h,g=a;if(t[g>>2]|=128<<(g%4<<3),g>55)for(md5cycle(this._hash,t),g=0;g<16;g+=1)t[g]=0;c=(c=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(c[2],16),h=parseInt(c[1],16)||0,t[14]=m,t[15]=h,md5cycle(this._hash,t)},SparkMD5.hash=function(t,a){return SparkMD5.hashBinary(toUtf8(t),a)},SparkMD5.hashBinary=function(t,a){var c=hex(md51(t));return a?hexToBinaryString(c):c},SparkMD5.ArrayBuffer=function(){this.reset()},SparkMD5.ArrayBuffer.prototype.append=function(t){var a,c=concatenateArrayBuffers(this._buff.buffer,t,!0),m=c.length;for(this._length+=t.byteLength,a=64;a<=m;a+=64)md5cycle(this._hash,md5blk_array(c.subarray(a-64,a)));return this._buff=a-64<m?new Uint8Array(c.buffer.slice(a-64)):new Uint8Array(0),this},SparkMD5.ArrayBuffer.prototype.end=function(t){var a,c,m=this._buff,h=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<h;a+=1)g[a>>2]|=m[a]<<(a%4<<3);return this._finish(g,h),c=hex(this._hash),t&&(c=hexToBinaryString(c)),this.reset(),c},SparkMD5.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.ArrayBuffer.prototype.getState=function(){var t=SparkMD5.prototype.getState.call(this);return t.buff=arrayBuffer2Utf8Str(t.buff),t},SparkMD5.ArrayBuffer.prototype.setState=function(t){return t.buff=utf8Str2ArrayBuffer(t.buff,!0),SparkMD5.prototype.setState.call(this,t)},SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy,SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish,SparkMD5.ArrayBuffer.hash=function(t,a){var c=hex(md51_array(new Uint8Array(t)));return a?hexToBinaryString(c):c},SparkMD5}()}));var HC=function _interopDefault$1(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(jC);var $C=class BMF{md5(t,a,c){this.aborted=!1,this.progress=0;let m=0;const h=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,g=2097152,I=Math.ceil(t.size/g),M=new HC.ArrayBuffer,T=new FileReader;function loadNext(){const a=m*g,c=a+g>=t.size?t.size:a+g;T.readAsArrayBuffer(h.call(t,a,c))}loadNext(),T.onloadend=t=>{M.append(t.target.result),m++,this.progress=m/I,c&&"function"==typeof c&&c(this.progress),this.aborted?a("aborted"):m<I?loadNext():a(null,M.end())}}abort(){this.aborted=!0}};!function setAdapters(t){dp(_p,t)}(by),ty.registerService(uh,"V1NIMLoginService"),ty.registerService(aT,"msg"),ty.registerService(lT,"misc"),ty.registerService(yT,"user"),ty.registerService(HT,"session"),ty.registerService(IS,"team"),ty.registerService(bS,"systemMessage"),ty.registerService(wS,"friend"),ty.registerService(LS,"event"),ty.registerService(jS,"msgExtend"),ty.registerService(YS,"msgLog"),ty.registerService(JS,"passThrough"),ty.registerService(vE,"cloudStorage"),ty.registerService(PE,"superTeam"),ty.registerService(Eg,"sync"),ty.registerService(LE,"plugin"),ty.registerService($E,"cloudSession"),ty.registerService(ib,"signaling"),ty.registerService(Ig,"V2NIMLoginService"),ty.registerService(Ky,"V2NIMConversationService"),ty.registerService(hI,"V2NIMMessageService"),ty.registerService(DC,"V2NIMNotificationService"),ty.registerService(FC,"V2NIMStorageService"),ty.registerService(e_,"V2NIMConversationGroupService"),ty.registerService(qI,"V2NIMTeamService"),ty.registerService(XI,"V2NIMUserService"),ty.registerService(uM,"V2NIMFriendService"),ty.registerService(KM,"V2NIMSettingService"),ty.registerService(GC,"V2NIMSyncService"),ty.registerService($b,"qchatChannel"),ty.registerService(Xb,"qchatMedia"),ty.registerService(bC,"qchatMsg"),ty.registerService(AC,"qchatRole"),ty.registerService(kC,"qchatServer"),ty.registerPlugin($C,"browser-md5-file"),t.V2NIMConst=Uu,t.default=ty,Object.defineProperty(t,"__esModule",{value:!0})}));
