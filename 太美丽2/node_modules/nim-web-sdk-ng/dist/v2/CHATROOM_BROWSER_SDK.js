/**
 * 
 *   Version: 10.2.700
 * 
 *   Git Hash: 18df1970f7eab400dd95135e615b73e18c93f312
 * 
 *   Created At: 2024/5/31 下午4:54:44
 * 
 *   Target: CHATROOM_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((t="undefined"!=typeof globalThis?globalThis:t||self).Chatroom={})}(this,(function(t){"use strict";var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var c,_,check=function(t){return t&&t.Math==Math&&t},E=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof a&&a)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},h=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),m=Function.prototype,g=m.apply,I=m.call,T="object"==typeof Reflect&&Reflect.apply||(h?I.bind(g):function(){return I.apply(g,arguments)}),N=Function.prototype,M=N.bind,O=N.call,S=h&&M.bind(O,O),A=h?function(t){return t&&S(t)}:function(t){return t&&function(){return O.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},C=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),R=Function.prototype.call,b=h?R.bind(R):function(){return R.apply(R,arguments)},D={}.propertyIsEnumerable,k=Object.getOwnPropertyDescriptor,V={f:k&&!D.call({1:2},1)?function propertyIsEnumerable(t){var a=k(this,t);return!!a&&a.enumerable}:D},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},L=A({}.toString),P=A("".slice),classofRaw=function(t){return P(L(t),8,-1)},w=Object,x=A("".split),U=fails((function(){return!w("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?x(t,""):w(t)}:w,isNullOrUndefined=function(t){return null==t},G=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw G("Can't call method on "+t);return t},toIndexedObject=function(t){return U(requireObjectCoercible(t))},B="object"==typeof document&&document.all,H=void 0===B&&void 0!==B?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===B}:function(t){return"object"==typeof t?null!==t:isCallable(t)},Y={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(Y[t])||aFunction(E[t]):Y[t]&&Y[t][a]||E[t]&&E[t][a]},j=A({}.isPrototypeOf),K=getBuiltIn("navigator","userAgent")||"",W=E.process,q=E.Deno,z=W&&W.versions||q&&q.version,$=z&&z.v8;$&&(_=(c=$.split("."))[0]>0&&c[0]<4?1:+(c[0]+c[1])),!_&&K&&(!(c=K.match(/Edge\/(\d+)/))||c[1]>=74)&&(c=K.match(/Chrome\/(\d+)/))&&(_=+c[1]);var X=_,J=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),Q=J&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Z=Object,ee=Q?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&j(a.prototype,Z(t))},te=String,tryToString=function(t){try{return te(t)}catch(t){return"Object"}},re=TypeError,aCallable=function(t){if(isCallable(t))return t;throw re(tryToString(t)+" is not a function")},getMethod=function(t,a){var c=t[a];return isNullOrUndefined(c)?void 0:aCallable(c)},ne=TypeError,oe=Object.defineProperty,ie="__core-js_shared__",ae=E[ie]||function(t,a){try{oe(E,t,{value:a,configurable:!0,writable:!0})}catch(c){E[t]=a}return a}(ie,{}),se=createCommonjsModule((function(t){(t.exports=function(t,a){return ae[t]||(ae[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),ce=Object,toObject=function(t){return ce(requireObjectCoercible(t))},le=A({}.hasOwnProperty),ue=Object.hasOwn||function hasOwn(t,a){return le(toObject(t),a)},_e=0,de=Math.random(),pe=A(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+pe(++_e+de,36)},Ee=se("wks"),fe=E.Symbol,he=fe&&fe.for,me=Q?fe:fe&&fe.withoutSetter||uid,wellKnownSymbol=function(t){if(!ue(Ee,t)||!J&&"string"!=typeof Ee[t]){var a="Symbol."+t;J&&ue(fe,t)?Ee[t]=fe[t]:Ee[t]=Q&&he?he(a):me(a)}return Ee[t]},ge=TypeError,Ie=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!H(t)||ee(t))return t;var c,_=getMethod(t,Ie);if(_){if(void 0===a&&(a="default"),c=b(_,t,a),!H(c)||ee(c))return c;throw ge("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var c,_;if("string"===a&&isCallable(c=t.toString)&&!H(_=b(c,t)))return _;if(isCallable(c=t.valueOf)&&!H(_=b(c,t)))return _;if("string"!==a&&isCallable(c=t.toString)&&!H(_=b(c,t)))return _;throw ne("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return ee(a)?a:a+""},Te=E.document,Ne=H(Te)&&H(Te.createElement),documentCreateElement=function(t){return Ne?Te.createElement(t):{}},ve=!C&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Me=Object.getOwnPropertyDescriptor,Oe={f:C?Me:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),ve)try{return Me(t,a)}catch(t){}if(ue(t,a))return createPropertyDescriptor(!b(V.f,t,a),t[a])}},Se=/#|\.prototype\./,isForced=function(t,a){var c=Ce[Ae(t)];return c==ye||c!=Re&&(isCallable(a)?fails(a):!!a)},Ae=isForced.normalize=function(t){return String(t).replace(Se,".").toLowerCase()},Ce=isForced.data={},Re=isForced.NATIVE="N",ye=isForced.POLYFILL="P",be=isForced,De=A(A.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:h?De(t,a):function(){return t.apply(a,arguments)}},ke=C&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ve=String,Le=TypeError,anObject=function(t){if(H(t))return t;throw Le(Ve(t)+" is not an object")},Pe=TypeError,we=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,Ue="enumerable",Ge="configurable",Fe="writable",Be={f:C?ke?function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),"function"==typeof t&&"prototype"===a&&"value"in c&&Fe in c&&!c.writable){var _=xe(t,a);_&&_.writable&&(t[a]=c.value,c={configurable:Ge in c?c.configurable:_.configurable,enumerable:Ue in c?c.enumerable:_.enumerable,writable:!1})}return we(t,a,c)}:we:function defineProperty(t,a,c){if(anObject(t),a=toPropertyKey(a),anObject(c),ve)try{return we(t,a,c)}catch(t){}if("get"in c||"set"in c)throw Pe("Accessors not supported");return"value"in c&&(t[a]=c.value),t}},He=C?function(t,a,c){return Be.f(t,a,createPropertyDescriptor(1,c))}:function(t,a,c){return t[a]=c,t},Ye=Oe.f,wrapConstructor=function(t){var Wrapper=function(a,c,_){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,c)}return new t(a,c,_)}return T(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var c,_,h,m,g,I,T,N,M=t.target,O=t.global,S=t.stat,C=t.proto,R=O?E:S?E[M]:(E[M]||{}).prototype,b=O?Y:Y[M]||He(Y,M,{})[M],D=b.prototype;for(h in a)c=!be(O?h:M+(S?".":"#")+h,t.forced)&&R&&ue(R,h),g=b[h],c&&(I=t.dontCallGetSet?(N=Ye(R,h))&&N.value:R[h]),m=c&&I?I:a[h],c&&typeof g==typeof m||(T=t.bind&&c?functionBindContext(m,E):t.wrap&&c?wrapConstructor(m):C&&isCallable(m)?A(m):m,(t.sham||m&&m.sham||g&&g.sham)&&He(T,"sham",!0),He(b,h,T),C&&(ue(Y,_=M+"Prototype")||He(Y,_,{}),He(Y[_],h,m),t.real&&D&&!D[h]&&He(D,h,m)))},je=Be.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==je,sham:!C},{defineProperty:je});var Ke,We=createCommonjsModule((function(t){var a=Y.Object,c=t.exports=function defineProperty(t,c,_){return a.defineProperty(t,c,_)};a.defineProperty.sham&&(c.sham=!0)})),qe=We,ze=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var c=0;c<a.length;c++){var _=a[c];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),qe(t,_.key,_)}}t.exports=function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),qe(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),$e=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),Xe=Math.ceil,Je=Math.floor,Qe=Math.trunc||function trunc(t){var a=+t;return(a>0?Je:Xe)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Qe(a)},Ze=Math.max,et=Math.min,toAbsoluteIndex=function(t,a){var c=toIntegerOrInfinity(t);return c<0?Ze(c+a,0):et(c,a)},tt=Math.min,lengthOfArrayLike=function(t){return(a=t.length)>0?tt(toIntegerOrInfinity(a),9007199254740991):0;var a},createMethod$5=function(t){return function(a,c,_){var E,h=toIndexedObject(a),m=lengthOfArrayLike(h),g=toAbsoluteIndex(_,m);if(t&&c!=c){for(;m>g;)if((E=h[g++])!=E)return!0}else for(;m>g;g++)if((t||g in h)&&h[g]===c)return t||g||0;return!t&&-1}},rt={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},nt={},ot=rt.indexOf,it=A([].push),objectKeysInternal=function(t,a){var c,_=toIndexedObject(t),E=0,h=[];for(c in _)!ue(nt,c)&&ue(_,c)&&it(h,c);for(;a.length>E;)ue(_,c=a[E++])&&(~ot(h,c)||it(h,c));return h},at=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],st=Object.keys||function keys(t){return objectKeysInternal(t,at)},ct=C&&!ke?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var c,_=toIndexedObject(a),E=st(a),h=E.length,m=0;h>m;)Be.f(t,c=E[m++],_[c]);return t},lt={f:ct},ut=getBuiltIn("document","documentElement"),_t=se("keys"),sharedKey=function(t){return _t[t]||(_t[t]=uid(t))},dt=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{Ke=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&Ke?NullProtoObjectViaActiveX(Ke):((a=documentCreateElement("iframe")).style.display="none",ut.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(Ke);for(var c=at.length;c--;)delete NullProtoObject.prototype[at[c]];return NullProtoObject()};nt[dt]=!0;var pt=Object.create||function create(t,a){var c;return null!==t?(EmptyConstructor.prototype=anObject(t),c=new EmptyConstructor,EmptyConstructor.prototype=null,c[dt]=t):c=NullProtoObject(),void 0===a?c:lt.f(c,a)};_export({target:"Object",stat:!0,sham:!C},{create:pt});var Et=Y.Object,ft=function create(t,a){return Et.create(t,a)},ht=String,mt=TypeError,gt=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,c={};try{(t=A(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(c,[]),a=c instanceof Array}catch(t){}return function setPrototypeOf(c,_){return anObject(c),function(t){if("object"==typeof t||isCallable(t))return t;throw mt("Can't set "+ht(t)+" as a prototype")}(_),a?t(c,_):c.__proto__=_,c}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:gt});var It=Y.Object.setPrototypeOf,Tt=A([].slice),Nt=Function,vt=A([].concat),Mt=A([].join),Ot={},construct$8=function(t,a,c){if(!ue(Ot,a)){for(var _=[],E=0;E<a;E++)_[E]="a["+E+"]";Ot[a]=Nt("C,a","return new C("+Mt(_,",")+")")}return Ot[a](t,c)},St=h?Nt.bind:function bind(t){var a=aCallable(this),c=a.prototype,_=Tt(arguments,1),E=function bound(){var c=vt(_,Tt(arguments));return this instanceof E?construct$8(a,c.length,c):a.apply(t,c)};return H(c)&&(E.prototype=c),E};_export({target:"Function",proto:!0,forced:Function.bind!==St},{bind:St});var entryVirtual=function(t){return Y[t+"Prototype"]},At=entryVirtual("Function").bind,Ct=Function.prototype,bind$1=function(t){var a=t.bind;return t===Ct||j(Ct,t)&&a===Ct.bind?At:a},Rt=createCommonjsModule((function(t){function _setPrototypeOf(a,c){var _;return t.exports=_setPrototypeOf=It?bind$1(_=It).call(_):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,c)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),yt=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=ft(a.prototype),t.prototype.constructor=t,Rt(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports}))),bt=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},Dt=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw Dt("Maximum allowed index exceeded");return t},createProperty=function(t,a,c){var _=toPropertyKey(a);_ in t?Be.f(t,_,createPropertyDescriptor(0,c)):t[_]=c},kt={};kt[wellKnownSymbol("toStringTag")]="z";var Vt="[object z]"===String(kt),Lt=wellKnownSymbol("toStringTag"),Pt=Object,wt="Arguments"==classofRaw(function(){return arguments}()),xt=Vt?classofRaw:function(t){var a,c,_;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(c=function(t,a){try{return t[a]}catch(t){}}(a=Pt(t),Lt))?c:wt?classofRaw(a):"Object"==(_=classofRaw(a))&&isCallable(a.callee)?"Arguments":_},Ut=A(Function.toString);isCallable(ae.inspectSource)||(ae.inspectSource=function(t){return Ut(t)});var Gt=ae.inspectSource,noop$1=function(){},Ft=[],Bt=getBuiltIn("Reflect","construct"),Ht=/^\s*(?:class|function)\b/,Yt=A(Ht.exec),jt=!Ht.exec(noop$1),Kt=function isConstructor(t){if(!isCallable(t))return!1;try{return Bt(noop$1,Ft,t),!0}catch(t){return!1}},Wt=function isConstructor(t){if(!isCallable(t))return!1;switch(xt(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return jt||!!Yt(Ht,Gt(t))}catch(t){return!0}};Wt.sham=!0;var qt=!Bt||fails((function(){var t;return Kt(Kt.call)||!Kt(Object)||!Kt((function(){t=!0}))||t}))?Wt:Kt,zt=wellKnownSymbol("species"),$t=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return bt(t)&&(a=t.constructor,(qt(a)&&(a===$t||bt(a.prototype))||H(a)&&null===(a=a[zt]))&&(a=void 0)),void 0===a?$t:a}(t))(0===a?0:a)},Xt=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return X>=51||!fails((function(){var a=[];return(a.constructor={})[Xt]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},Jt=wellKnownSymbol("isConcatSpreadable"),Qt=X>=51||!fails((function(){var t=[];return t[Jt]=!1,t.concat()[0]!==t})),Zt=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!H(t))return!1;var a=t[Jt];return void 0!==a?!!a:bt(t)};_export({target:"Array",proto:!0,arity:1,forced:!Qt||!Zt},{concat:function concat(t){var a,c,_,E,h,m=toObject(this),g=arraySpeciesCreate(m,0),I=0;for(a=-1,_=arguments.length;a<_;a++)if(isConcatSpreadable(h=-1===a?m:arguments[a]))for(E=lengthOfArrayLike(h),doesNotExceedSafeInteger(I+E),c=0;c<E;c++,I++)c in h&&createProperty(g,I,h[c]);else doesNotExceedSafeInteger(I+1),createProperty(g,I++,h);return g.length=I,g}});var er,tr,rr,nr=String,toString$1=function(t){if("Symbol"===xt(t))throw TypeError("Cannot convert a Symbol value to a string");return nr(t)},or=at.concat("length","prototype"),ir={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,or)}},ar=Array,sr=Math.max,arraySliceSimple=function(t,a,c){for(var _=lengthOfArrayLike(t),E=toAbsoluteIndex(a,_),h=toAbsoluteIndex(void 0===c?_:c,_),m=ar(sr(h-E,0)),g=0;E<h;E++,g++)createProperty(m,g,t[E]);return m.length=g,m},cr=ir.f,lr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ur={f:function getOwnPropertyNames(t){return lr&&"Window"==classofRaw(t)?function(t){try{return cr(t)}catch(t){return arraySliceSimple(lr)}}(t):cr(toIndexedObject(t))}},_r={f:Object.getOwnPropertySymbols},defineBuiltIn=function(t,a,c,_){return _&&_.enumerable?t[a]=c:He(t,a,c),t},dr={f:wellKnownSymbol},pr=Be.f,wellKnownSymbolDefine=function(t){var a=Y.Symbol||(Y.Symbol={});ue(a,t)||pr(a,t,{value:dr.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,c=a&&a.valueOf,_=wellKnownSymbol("toPrimitive");a&&!a[_]&&defineBuiltIn(a,_,(function(t){return b(c,this)}),{arity:1})},Er=Vt?{}.toString:function toString(){return"[object "+xt(this)+"]"},fr=Be.f,hr=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,c,_){if(t){var E=c?t:t.prototype;ue(E,hr)||fr(E,hr,{configurable:!0,value:a}),_&&!Vt&&He(E,"toString",Er)}},mr=E.WeakMap,gr=isCallable(mr)&&/native code/.test(String(mr)),Ir="Object already initialized",Tr=E.TypeError,Nr=E.WeakMap;if(gr||ae.state){var vr=ae.state||(ae.state=new Nr),Mr=A(vr.get),Or=A(vr.has),Sr=A(vr.set);er=function(t,a){if(Or(vr,t))throw Tr(Ir);return a.facade=t,Sr(vr,t,a),a},tr=function(t){return Mr(vr,t)||{}},rr=function(t){return Or(vr,t)}}else{var Ar=sharedKey("state");nt[Ar]=!0,er=function(t,a){if(ue(t,Ar))throw Tr(Ir);return a.facade=t,He(t,Ar,a),a},tr=function(t){return ue(t,Ar)?t[Ar]:{}},rr=function(t){return ue(t,Ar)}}var Cr={set:er,get:tr,has:rr,enforce:function(t){return rr(t)?tr(t):er(t,{})},getterFor:function(t){return function(a){var c;if(!H(a)||(c=tr(a)).type!==t)throw Tr("Incompatible receiver, "+t+" required");return c}}},Rr=A([].push),createMethod$4=function(t){var a=1==t,c=2==t,_=3==t,E=4==t,h=6==t,m=7==t,g=5==t||h;return function(I,T,N,M){for(var O,S,A=toObject(I),C=U(A),R=functionBindContext(T,N),b=lengthOfArrayLike(C),D=0,k=M||arraySpeciesCreate,V=a?k(I,b):c||m?k(I,0):void 0;b>D;D++)if((g||D in C)&&(S=R(O=C[D],D,A),t))if(a)V[D]=S;else if(S)switch(t){case 3:return!0;case 5:return O;case 6:return D;case 2:Rr(V,O)}else switch(t){case 4:return!1;case 7:Rr(V,O)}return h?-1:_||E?E:V}},yr={forEach:createMethod$4(0),map:createMethod$4(1),filter:createMethod$4(2),some:createMethod$4(3),every:createMethod$4(4),find:createMethod$4(5),findIndex:createMethod$4(6),filterReject:createMethod$4(7)},br=yr.forEach,Dr=sharedKey("hidden"),kr="Symbol",Vr=Cr.set,Lr=Cr.getterFor(kr),Pr=Object.prototype,wr=E.Symbol,xr=wr&&wr.prototype,Ur=E.TypeError,Gr=E.QObject,Fr=Oe.f,Br=Be.f,Hr=ur.f,Yr=V.f,jr=A([].push),Kr=se("symbols"),Wr=se("op-symbols"),qr=se("wks"),zr=!Gr||!Gr.prototype||!Gr.prototype.findChild,$r=C&&fails((function(){return 7!=pt(Br({},"a",{get:function(){return Br(this,"a",{value:7}).a}})).a}))?function(t,a,c){var _=Fr(Pr,a);_&&delete Pr[a],Br(t,a,c),_&&t!==Pr&&Br(Pr,a,_)}:Br,wrap$1=function(t,a){var c=Kr[t]=pt(xr);return Vr(c,{type:kr,tag:t,description:a}),C||(c.description=a),c},Xr=function defineProperty(t,a,c){t===Pr&&Xr(Wr,a,c),anObject(t);var _=toPropertyKey(a);return anObject(c),ue(Kr,_)?(c.enumerable?(ue(t,Dr)&&t[Dr][_]&&(t[Dr][_]=!1),c=pt(c,{enumerable:createPropertyDescriptor(0,!1)})):(ue(t,Dr)||Br(t,Dr,createPropertyDescriptor(1,{})),t[Dr][_]=!0),$r(t,_,c)):Br(t,_,c)},Jr=function defineProperties(t,a){anObject(t);var c=toIndexedObject(a),_=st(c).concat($getOwnPropertySymbols(c));return br(_,(function(a){C&&!b(Qr,c,a)||Xr(t,a,c[a])})),t},Qr=function propertyIsEnumerable(t){var a=toPropertyKey(t),c=b(Yr,this,a);return!(this===Pr&&ue(Kr,a)&&!ue(Wr,a))&&(!(c||!ue(this,a)||!ue(Kr,a)||ue(this,Dr)&&this[Dr][a])||c)},Zr=function getOwnPropertyDescriptor(t,a){var c=toIndexedObject(t),_=toPropertyKey(a);if(c!==Pr||!ue(Kr,_)||ue(Wr,_)){var E=Fr(c,_);return!E||!ue(Kr,_)||ue(c,Dr)&&c[Dr][_]||(E.enumerable=!0),E}},en=function getOwnPropertyNames(t){var a=Hr(toIndexedObject(t)),c=[];return br(a,(function(t){ue(Kr,t)||ue(nt,t)||jr(c,t)})),c},$getOwnPropertySymbols=function(t){var a=t===Pr,c=Hr(a?Wr:toIndexedObject(t)),_=[];return br(c,(function(t){!ue(Kr,t)||a&&!ue(Pr,t)||jr(_,Kr[t])})),_};J||(wr=function Symbol(){if(j(xr,this))throw Ur("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===Pr&&b(setter,Wr,t),ue(this,Dr)&&ue(this[Dr],a)&&(this[Dr][a]=!1),$r(this,a,createPropertyDescriptor(1,t))};return C&&zr&&$r(Pr,a,{configurable:!0,set:setter}),wrap$1(a,t)},xr=wr.prototype,defineBuiltIn(xr,"toString",(function toString(){return Lr(this).tag})),defineBuiltIn(wr,"withoutSetter",(function(t){return wrap$1(uid(t),t)})),V.f=Qr,Be.f=Xr,lt.f=Jr,Oe.f=Zr,ir.f=ur.f=en,_r.f=$getOwnPropertySymbols,dr.f=function(t){return wrap$1(wellKnownSymbol(t),t)},C&&Br(xr,"description",{configurable:!0,get:function description(){return Lr(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!J,sham:!J},{Symbol:wr}),br(st(qr),(function(t){wellKnownSymbolDefine(t)})),_export({target:kr,stat:!0,forced:!J},{useSetter:function(){zr=!0},useSimple:function(){zr=!1}}),_export({target:"Object",stat:!0,forced:!J,sham:!C},{create:function create(t,a){return void 0===a?pt(t):Jr(pt(t),a)},defineProperty:Xr,defineProperties:Jr,getOwnPropertyDescriptor:Zr}),_export({target:"Object",stat:!0,forced:!J},{getOwnPropertyNames:en}),symbolDefineToPrimitive(),setToStringTag(wr,kr),nt[Dr]=!0;var tn=J&&!!Symbol.for&&!!Symbol.keyFor,rn=se("string-to-symbol-registry"),nn=se("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!tn},{for:function(t){var a=toString$1(t);if(ue(rn,a))return rn[a];var c=getBuiltIn("Symbol")(a);return rn[a]=c,nn[c]=a,c}});var an=se("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!tn},{keyFor:function keyFor(t){if(!ee(t))throw TypeError(tryToString(t)+" is not a symbol");if(ue(an,t))return an[t]}});var sn=getBuiltIn("JSON","stringify"),cn=A(/./.exec),ln=A("".charAt),un=A("".charCodeAt),_n=A("".replace),dn=A(1..toString),pn=/[\uD800-\uDFFF]/g,En=/^[\uD800-\uDBFF]$/,fn=/^[\uDC00-\uDFFF]$/,hn=!J||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=sn([t])||"{}"!=sn({a:t})||"{}"!=sn(Object(t))})),mn=fails((function(){return'"\\udf06\\ud834"'!==sn("\udf06\ud834")||'"\\udead"'!==sn("\udead")})),stringifyWithSymbolsFix=function(t,a){var c=Tt(arguments),_=a;if((H(a)||void 0!==t)&&!ee(t))return bt(a)||(a=function(t,a){if(isCallable(_)&&(a=b(_,this,t,a)),!ee(a))return a}),c[1]=a,T(sn,null,c)},fixIllFormed=function(t,a,c){var _=ln(c,a-1),E=ln(c,a+1);return cn(En,t)&&!cn(fn,E)||cn(fn,t)&&!cn(En,_)?"\\u"+dn(un(t,0),16):t};sn&&_export({target:"JSON",stat:!0,arity:3,forced:hn||mn},{stringify:function stringify(t,a,c){var _=Tt(arguments),E=T(hn?stringifyWithSymbolsFix:sn,null,_);return mn&&"string"==typeof E?_n(E,pn,fixIllFormed):E}});var gn=!J||fails((function(){_r.f(1)}));_export({target:"Object",stat:!0,forced:gn},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=_r.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(E.JSON,"JSON",!0);var In,Tn,Nn,vn=Y.Symbol,Mn={},On=Function.prototype,Sn=C&&Object.getOwnPropertyDescriptor,An=ue(On,"name"),Cn={EXISTS:An,PROPER:An&&"something"===function something(){}.name,CONFIGURABLE:An&&(!C||C&&Sn(On,"name").configurable)},Rn=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),yn=sharedKey("IE_PROTO"),bn=Object,Dn=bn.prototype,kn=Rn?bn.getPrototypeOf:function(t){var a=toObject(t);if(ue(a,yn))return a[yn];var c=a.constructor;return isCallable(c)&&a instanceof c?c.prototype:a instanceof bn?Dn:null},Vn=wellKnownSymbol("iterator"),Ln=!1;[].keys&&("next"in(Nn=[].keys())?(Tn=kn(kn(Nn)))!==Object.prototype&&(In=Tn):Ln=!0);var Pn=!H(In)||fails((function(){var t={};return In[Vn].call(t)!==t}));In=Pn?{}:pt(In),isCallable(In[Vn])||defineBuiltIn(In,Vn,(function(){return this}));var wn={IteratorPrototype:In,BUGGY_SAFARI_ITERATORS:Ln},xn=wn.IteratorPrototype,returnThis$1=function(){return this},Un=Cn.PROPER,Gn=wn.BUGGY_SAFARI_ITERATORS,Fn=wellKnownSymbol("iterator"),Bn="keys",Hn="values",Yn="entries",returnThis=function(){return this},iteratorDefine=function(t,a,c,_,E,h,m){!function(t,a,c,_){var E=a+" Iterator";t.prototype=pt(xn,{next:createPropertyDescriptor(+!_,c)}),setToStringTag(t,E,!1,!0),Mn[E]=returnThis$1}(c,a,_);var g,I,T,getIterationMethod=function(t){if(t===E&&A)return A;if(!Gn&&t in O)return O[t];switch(t){case Bn:return function keys(){return new c(this,t)};case Hn:return function values(){return new c(this,t)};case Yn:return function entries(){return new c(this,t)}}return function(){return new c(this)}},N=a+" Iterator",M=!1,O=t.prototype,S=O[Fn]||O["@@iterator"]||E&&O[E],A=!Gn&&S||getIterationMethod(E),C="Array"==a&&O.entries||S;if(C&&(g=kn(C.call(new t)))!==Object.prototype&&g.next&&(setToStringTag(g,N,!0,!0),Mn[N]=returnThis),Un&&E==Hn&&S&&S.name!==Hn&&(M=!0,A=function values(){return b(S,this)}),E)if(I={values:getIterationMethod(Hn),keys:h?A:getIterationMethod(Bn),entries:getIterationMethod(Yn)},m)for(T in I)(Gn||M||!(T in O))&&defineBuiltIn(O,T,I[T]);else _export({target:a,proto:!0,forced:Gn||M},I);return m&&O[Fn]!==A&&defineBuiltIn(O,Fn,A,{name:E}),Mn[a]=A,I};Be.f;var jn="Array Iterator",Kn=Cr.set,Wn=Cr.getterFor(jn);iteratorDefine(Array,"Array",(function(t,a){Kn(this,{type:jn,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=Wn(this),a=t.target,c=t.kind,_=t.index++;return!a||_>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==c?{value:_,done:!1}:"values"==c?{value:a[_],done:!1}:{value:[_,a[_]],done:!1}}),"values"),Mn.Arguments=Mn.Array;var qn=wellKnownSymbol("toStringTag");for(var zn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var $n=E[zn],Xn=$n&&$n.prototype;Xn&&xt(Xn)!==qn&&He(Xn,qn,zn),Mn[zn]=Mn.Array}var Jn=vn;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var Qn=Jn,Zn=A("".charAt),eo=A("".charCodeAt),to=A("".slice),createMethod$3=function(t){return function(a,c){var _,E,h=toString$1(requireObjectCoercible(a)),m=toIntegerOrInfinity(c),g=h.length;return m<0||m>=g?t?"":void 0:(_=eo(h,m))<55296||_>56319||m+1===g||(E=eo(h,m+1))<56320||E>57343?t?Zn(h,m):_:t?to(h,m,m+2):E-56320+(_-55296<<10)+65536}},ro={codeAt:createMethod$3(!1),charAt:createMethod$3(!0)},no=ro.charAt,oo="String Iterator",io=Cr.set,ao=Cr.getterFor(oo);iteratorDefine(String,"String",(function(t){io(this,{type:oo,string:toString$1(t),index:0})}),(function next(){var t,a=ao(this),c=a.string,_=a.index;return _>=c.length?{value:void 0,done:!0}:(t=no(c,_),a.index+=t.length,{value:t,done:!1})}));var so=dr.f("iterator"),co=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof Qn&&"symbol"==typeof so?function(t){return typeof t}:function(t){return t&&"function"==typeof Qn&&t.constructor===Qn&&t!==Qn.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),lo=fails((function(){kn(1)}));_export({target:"Object",stat:!0,forced:lo,sham:!Rn},{getPrototypeOf:function getPrototypeOf(t){return kn(toObject(t))}});var uo=Y.Object.getPrototypeOf,arrayMethodIsStrict=function(t,a){var c=[][t];return!!c&&fails((function(){c.call(null,a||function(){return 1},1)}))},_o=yr.forEach,po=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return _o(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=po},{forEach:po});var Eo=entryVirtual("Array").forEach,fo=Array.prototype,ho={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===fo||j(fo,t)&&a===fo.forEach||ue(ho,xt(t))?Eo:a},mo=A([].concat),go=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=ir.f(anObject(t)),c=_r.f;return c?mo(a,c(t)):a},Io=Error,To=A("".replace),No=String(Io("zxcasd").stack),vo=/\n\s*at [^:]*:[^\n]*/,Mo=vo.test(No),errorStackClear=function(t,a){if(Mo&&"string"==typeof t&&!Io.prepareStackTrace)for(;a--;)t=To(t,vo,"");return t},installErrorCause=function(t,a){H(a)&&"cause"in a&&He(t,"cause",a.cause)},Oo=wellKnownSymbol("iterator"),So=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(Mn.Array===t||So[Oo]===t)},Ao=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,Ao)||getMethod(t,"@@iterator")||Mn[xt(t)]},Co=TypeError,getIterator=function(t,a){var c=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(c))return anObject(b(c,t));throw Co(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,c){var _,E;anObject(t);try{if(!(_=getMethod(t,"return"))){if("throw"===a)throw c;return c}_=b(_,t)}catch(t){E=!0,_=t}if("throw"===a)throw c;if(E)throw _;return anObject(_),c},Ro=TypeError,Result=function(t,a){this.stopped=t,this.result=a},yo=Result.prototype,iterate=function(t,a,c){var _,E,h,m,g,I,T,N=c&&c.that,M=!(!c||!c.AS_ENTRIES),O=!(!c||!c.IS_RECORD),S=!(!c||!c.IS_ITERATOR),A=!(!c||!c.INTERRUPTED),C=functionBindContext(a,N),stop=function(t){return _&&iteratorClose(_,"normal",t),new Result(!0,t)},callFn=function(t){return M?(anObject(t),A?C(t[0],t[1],stop):C(t[0],t[1])):A?C(t,stop):C(t)};if(O)_=t.iterator;else if(S)_=t;else{if(!(E=getIteratorMethod$5(t)))throw Ro(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(E)){for(h=0,m=lengthOfArrayLike(t);m>h;h++)if((g=callFn(t[h]))&&j(yo,g))return g;return new Result(!1)}_=getIterator(t,E)}for(I=O?t.next:_.next;!(T=b(I,_)).done;){try{g=callFn(T.value)}catch(t){iteratorClose(_,"throw",t)}if("object"==typeof g&&g&&j(yo,g))return g}return new Result(!1)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},bo=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),Do=wellKnownSymbol("toStringTag"),ko=Error,Vo=[].push,Lo=function AggregateError(t,a){var c,_=arguments.length>2?arguments[2]:void 0,E=j(Po,this);gt?c=gt(ko(),E?kn(this):Po):(c=E?this:pt(Po),He(c,Do,"Error")),void 0!==a&&He(c,"message",normalizeStringArgument(a)),bo&&He(c,"stack",errorStackClear(c.stack,1)),installErrorCause(c,_);var h=[];return iterate(t,Vo,{that:h}),He(c,"errors",h),c};gt?gt(Lo,ko):function(t,a,c){for(var _=go(a),E=Be.f,h=Oe.f,m=0;m<_.length;m++){var g=_[m];ue(t,g)||c&&ue(c,g)||E(t,g,h(a,g))}}(Lo,ko,{name:!0});var Po=Lo.prototype=pt(ko.prototype,{constructor:createPropertyDescriptor(1,Lo),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:Lo});var wo,xo,Uo,Go,Fo="process"==classofRaw(E.process),Bo=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),c=Be.f;C&&a&&!a[Bo]&&c(a,Bo,{configurable:!0,get:function(){return this}})},Ho=TypeError,anInstance=function(t,a){if(j(a,t))return t;throw Ho("Incorrect invocation")},Yo=TypeError,aConstructor=function(t){if(qt(t))return t;throw Yo(tryToString(t)+" is not a constructor")},jo=wellKnownSymbol("species"),speciesConstructor=function(t,a){var c,_=anObject(t).constructor;return void 0===_||isNullOrUndefined(c=anObject(_)[jo])?a:aConstructor(c)},Ko=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw Ko("Not enough arguments");return t},Wo=/(?:ipad|iphone|ipod).*applewebkit/i.test(K),qo=E.setImmediate,zo=E.clearImmediate,$o=E.process,Xo=E.Dispatch,Jo=E.Function,Qo=E.MessageChannel,Zo=E.String,ei=0,ti={},ri="onreadystatechange";try{wo=E.location}catch(t){}var run=function(t){if(ue(ti,t)){var a=ti[t];delete ti[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){E.postMessage(Zo(t),wo.protocol+"//"+wo.host)};qo&&zo||(qo=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Jo(t),c=Tt(arguments,1);return ti[++ei]=function(){T(a,void 0,c)},xo(ei),ei},zo=function clearImmediate(t){delete ti[t]},Fo?xo=function(t){$o.nextTick(runner(t))}:Xo&&Xo.now?xo=function(t){Xo.now(runner(t))}:Qo&&!Wo?(Go=(Uo=new Qo).port2,Uo.port1.onmessage=listener,xo=functionBindContext(Go.postMessage,Go)):E.addEventListener&&isCallable(E.postMessage)&&!E.importScripts&&wo&&"file:"!==wo.protocol&&!fails(post)?(xo=post,E.addEventListener("message",listener,!1)):xo=ri in documentCreateElement("script")?function(t){ut.appendChild(documentCreateElement("script")).onreadystatechange=function(){ut.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var ni,oi,ii,ai,si,ci,li,ui,_i={set:qo,clear:zo},di=/ipad|iphone|ipod/i.test(K)&&void 0!==E.Pebble,pi=/web0s(?!.*chrome)/i.test(K),Ei=Oe.f,fi=_i.set,hi=E.MutationObserver||E.WebKitMutationObserver,mi=E.document,gi=E.process,Ii=E.Promise,Ti=Ei(E,"queueMicrotask"),Ni=Ti&&Ti.value;Ni||(ni=function(){var t,a;for(Fo&&(t=gi.domain)&&t.exit();oi;){a=oi.fn,oi=oi.next;try{a()}catch(t){throw oi?ai():ii=void 0,t}}ii=void 0,t&&t.enter()},Wo||Fo||pi||!hi||!mi?!di&&Ii&&Ii.resolve?((li=Ii.resolve(void 0)).constructor=Ii,ui=functionBindContext(li.then,li),ai=function(){ui(ni)}):Fo?ai=function(){gi.nextTick(ni)}:(fi=functionBindContext(fi,E),ai=function(){fi(ni)}):(si=!0,ci=mi.createTextNode(""),new hi(ni).observe(ci,{characterData:!0}),ai=function(){ci.data=si=!si}));var vi=Ni||function(t){var a={fn:t,next:void 0};ii&&(ii.next=a),oi||(oi=a,ai()),ii=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Mi,Oi,Si=Queue,Ai=E.Promise,Ci="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Ri=!Ci&&!Fo&&"object"==typeof window&&"object"==typeof document,yi=Ai&&Ai.prototype,bi=wellKnownSymbol("species"),Di=!1,ki=isCallable(E.PromiseRejectionEvent),Vi=be("Promise",(function(){var t=Gt(Ai),a=t!==String(Ai);if(!a&&66===X)return!0;if(!yi.catch||!yi.finally)return!0;if(!X||X<51||!/native code/.test(t)){var c=new Ai((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((c.constructor={})[bi]=FakePromise,!(Di=c.then((function(){}))instanceof FakePromise))return!0}return!a&&(Ri||Ci)&&!ki})),Li={CONSTRUCTOR:Vi,REJECTION_EVENT:ki,SUBCLASSING:Di},Pi=TypeError,PromiseCapability=function(t){var a,c;this.promise=new t((function(t,_){if(void 0!==a||void 0!==c)throw Pi("Bad Promise constructor");a=t,c=_})),this.resolve=aCallable(a),this.reject=aCallable(c)},wi={f:function(t){return new PromiseCapability(t)}},xi=_i.set,Ui="Promise",Gi=Li.CONSTRUCTOR,Fi=Li.REJECTION_EVENT,Bi=Cr.getterFor(Ui),Hi=Cr.set,Yi=Ai&&Ai.prototype,ji=Ai,Ki=Yi,Wi=E.TypeError,qi=E.document,zi=E.process,$i=wi.f,Xi=$i,Ji=!!(qi&&qi.createEvent&&E.dispatchEvent),Qi="unhandledrejection",isThenable=function(t){var a;return!(!H(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var c,_,E,h=a.value,m=1==a.state,g=m?t.ok:t.fail,I=t.resolve,T=t.reject,N=t.domain;try{g?(m||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===g?c=h:(N&&N.enter(),c=g(h),N&&(N.exit(),E=!0)),c===t.promise?T(Wi("Promise-chain cycle")):(_=isThenable(c))?b(_,c,I,T):I(c)):T(h)}catch(t){N&&!E&&N.exit(),T(t)}},notify=function(t,a){t.notified||(t.notified=!0,vi((function(){for(var c,_=t.reactions;c=_.get();)callReaction(c,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,c){var _,h;Ji?((_=qi.createEvent("Event")).promise=a,_.reason=c,_.initEvent(t,!1,!0),E.dispatchEvent(_)):_={promise:a,reason:c},!Fi&&(h=E["on"+t])?h(_):t===Qi&&function(t,a){var c=E.console;c&&c.error&&(1==arguments.length?c.error(t):c.error(t,a))}("Unhandled promise rejection",c)},onUnhandled=function(t){b(xi,E,(function(){var a,c=t.facade,_=t.value;if(isUnhandled(t)&&(a=perform((function(){Fo?zi.emit("unhandledRejection",_,c):dispatchEvent(Qi,c,_)})),t.rejection=Fo||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){b(xi,E,(function(){var a=t.facade;Fo?zi.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,c){return function(_){t(a,_,c)}},internalReject=function(t,a,c){t.done||(t.done=!0,c&&(t=c),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,c){if(!t.done){t.done=!0,c&&(t=c);try{if(t.facade===a)throw Wi("Promise can't be resolved itself");var _=isThenable(a);_?vi((function(){var c={done:!1};try{b(_,a,bind(internalResolve,c,t),bind(internalReject,c,t))}catch(a){internalReject(c,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};Gi&&(Ki=(ji=function Promise(t){anInstance(this,Ki),aCallable(t),b(Mi,this);var a=Bi(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Mi=function Promise(t){Hi(this,{type:Ui,done:!1,notified:!1,parent:!1,reactions:new Si,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn(Ki,"then",(function then(t,a){var c=Bi(this),_=$i(speciesConstructor(this,ji));return c.parent=!0,_.ok=!isCallable(t)||t,_.fail=isCallable(a)&&a,_.domain=Fo?zi.domain:void 0,0==c.state?c.reactions.add(_):vi((function(){callReaction(_,c)})),_.promise})),Oi=function(){var t=new Mi,a=Bi(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},wi.f=$i=function(t){return t===ji||undefined===t?new Oi(t):Xi(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:Gi},{Promise:ji}),setToStringTag(ji,Ui,!1,!0),setSpecies(Ui);var Zi=wellKnownSymbol("iterator"),ea=!1;try{var ta=0,ra={next:function(){return{done:!!ta++}},return:function(){ea=!0}};ra[Zi]=function(){return this},Array.from(ra,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!ea)return!1;var c=!1;try{var _={};_[Zi]=function(){return{next:function(){return{done:c=!0}}}},t(_)}catch(t){}return c},na=Li.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){Ai.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:na},{all:function all(t){var a=this,c=wi.f(a),_=c.resolve,E=c.reject,h=perform((function(){var c=aCallable(a.resolve),h=[],m=0,g=1;iterate(t,(function(t){var I=m++,T=!1;g++,b(c,a,t).then((function(t){T||(T=!0,h[I]=t,--g||_(h))}),E)})),--g||_(h)}));return h.error&&E(h.value),c.promise}});var oa=Li.CONSTRUCTOR;Ai&&Ai.prototype,_export({target:"Promise",proto:!0,forced:oa,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:na},{race:function race(t){var a=this,c=wi.f(a),_=c.reject,E=perform((function(){var E=aCallable(a.resolve);iterate(t,(function(t){b(E,a,t).then(c.resolve,_)}))}));return E.error&&_(E.value),c.promise}}),_export({target:"Promise",stat:!0,forced:Li.CONSTRUCTOR},{reject:function reject(t){var a=wi.f(this);return b(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),H(a)&&a.constructor===t)return a;var c=wi.f(t);return(0,c.resolve)(a),c.promise},ia=Li.CONSTRUCTOR,aa=getBuiltIn("Promise"),sa=!ia;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(sa&&this===aa?Ai:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,c=wi.f(a),_=c.resolve,E=c.reject,h=perform((function(){var c=aCallable(a.resolve),E=[],h=0,m=1;iterate(t,(function(t){var g=h++,I=!1;m++,b(c,a,t).then((function(t){I||(I=!0,E[g]={status:"fulfilled",value:t},--m||_(E))}),(function(t){I||(I=!0,E[g]={status:"rejected",reason:t},--m||_(E))}))})),--m||_(E)}));return h.error&&E(h.value),c.promise}});var ca="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,c=getBuiltIn("AggregateError"),_=wi.f(a),E=_.resolve,h=_.reject,m=perform((function(){var _=aCallable(a.resolve),m=[],g=0,I=1,T=!1;iterate(t,(function(t){var N=g++,M=!1;I++,b(_,a,t).then((function(t){M||T||(T=!0,E(t))}),(function(t){M||T||(M=!0,m[N]=t,--I||h(new c(m,ca)))}))})),--I||h(new c(m,ca))}));return m.error&&h(m.value),_.promise}});var la=Ai&&Ai.prototype,ua=!!Ai&&fails((function(){la.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:ua},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),c=isCallable(t);return this.then(c?function(c){return promiseResolve(a,t()).then((function(){return c}))}:t,c?function(c){return promiseResolve(a,t()).then((function(){throw c}))}:t)}});var _a=Y.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=wi.f(this),c=perform(t);return(c.error?a.reject:a.resolve)(c.value),a.promise}});var da=_a,pa=A([].reverse),Ea=[1,2];_export({target:"Array",proto:!0,forced:String(Ea)===String(Ea.reverse())},{reverse:function reverse(){return bt(this)&&(this.length=this.length),pa(this)}});var fa=entryVirtual("Array").reverse,ha=Array.prototype,reverse=function(t){var a=t.reverse;return t===ha||j(ha,t)&&a===ha.reverse?fa:a},ma=arrayMethodHasSpeciesSupport("slice"),ga=wellKnownSymbol("species"),Ia=Array,Ta=Math.max;_export({target:"Array",proto:!0,forced:!ma},{slice:function slice(t,a){var c,_,E,h=toIndexedObject(this),m=lengthOfArrayLike(h),g=toAbsoluteIndex(t,m),I=toAbsoluteIndex(void 0===a?m:a,m);if(bt(h)&&(c=h.constructor,(qt(c)&&(c===Ia||bt(c.prototype))||H(c)&&null===(c=c[ga]))&&(c=void 0),c===Ia||void 0===c))return Tt(h,g,I);for(_=new(void 0===c?Ia:c)(Ta(I-g,0)),E=0;g<I;g++,E++)g in h&&createProperty(_,E,h[g]);return _.length=E,_}});var Na=entryVirtual("Array").slice,va=Array.prototype,slice=function(t){var a=t.slice;return t===va||j(va,t)&&a===va.slice?Na:a},Ma=createCommonjsModule((function(t){var a=co.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return c},t.exports.__esModule=!0,t.exports.default=t.exports;var c={},_=Object.prototype,E=_.hasOwnProperty,h="function"==typeof Qn?Qn:{},m=h.iterator||"@@iterator",g=h.asyncIterator||"@@asyncIterator",I=h.toStringTag||"@@toStringTag";function define(t,a,c){return qe(t,a,{value:c,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,c){return t[a]=c}}function wrap(t,a,c,_){var E=a&&a.prototype instanceof Generator?a:Generator,h=ft(E.prototype),m=new Context(_||[]);return h._invoke=function(t,a,c){var _="suspendedStart";return function(E,h){if("executing"===_)throw new Error("Generator is already running");if("completed"===_){if("throw"===E)throw h;return doneResult()}for(c.method=E,c.arg=h;;){var m=c.delegate;if(m){var g=maybeInvokeDelegate(m,c);if(g){if(g===T)continue;return g}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===_)throw _="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);_="executing";var I=tryCatch(t,a,c);if("normal"===I.type){if(_=c.done?"completed":"suspendedYield",I.arg===T)continue;return{value:I.arg,done:c.done}}"throw"===I.type&&(_="completed",c.method="throw",c.arg=I.arg)}}}(t,c,m),h}function tryCatch(t,a,c){try{return{type:"normal",arg:t.call(a,c)}}catch(t){return{type:"throw",arg:t}}}c.wrap=wrap;var T={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var N={};define(N,m,(function(){return this}));var M=uo&&uo(uo(values([])));M&&M!==_&&E.call(M,m)&&(N=M);var O=GeneratorFunctionPrototype.prototype=Generator.prototype=ft(N);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,c){function invoke(_,h,m,g){var I=tryCatch(t[_],t,h);if("throw"!==I.type){var T=I.arg,N=T.value;return N&&"object"==a(N)&&E.call(N,"__await")?c.resolve(N.__await).then((function(t){invoke("next",t,m,g)}),(function(t){invoke("throw",t,m,g)})):c.resolve(N).then((function(t){T.value=t,m(T)}),(function(t){return invoke("throw",t,m,g)}))}g(I.arg)}var _;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new c((function(c,_){invoke(t,a,c,_)}))}return _=_?_.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var c=t.iterator[a.method];if(void 0===c){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return T;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var _=tryCatch(c,t.iterator,a.arg);if("throw"===_.type)return a.method="throw",a.arg=_.arg,a.delegate=null,T;var E=_.arg;return E?E.done?(a[t.resultName]=E.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,T):E:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,T)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[m];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var c=-1,_=function next(){for(;++c<t.length;)if(E.call(t,c))return next.value=t[c],next.done=!1,next;return next.value=void 0,next.done=!0,next};return _.next=_}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(O,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,I,"GeneratorFunction"),c.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},c.mark=function(t){return It?It(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,I,"GeneratorFunction")),t.prototype=ft(O),t},c.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,g,(function(){return this})),c.AsyncIterator=AsyncIterator,c.async=function(t,a,_,E,h){void 0===h&&(h=da);var m=new AsyncIterator(wrap(t,a,_,E),h);return c.isGeneratorFunction(a)?m:m.next().then((function(t){return t.done?t.value:m.next()}))},defineIteratorMethods(O),define(O,I,"Generator"),define(O,m,(function(){return this})),define(O,"toString",(function(){return"[object Generator]"})),c.keys=function(t){var a=[];for(var c in t)a.push(c);return reverse(a).call(a),function next(){for(;a.length;){var c=a.pop();if(c in t)return next.value=c,next.done=!1,next}return next.done=!0,next}},c.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var c in this)"t"===c.charAt(0)&&E.call(this,c)&&!isNaN(+slice(c).call(c,1))&&(this[c]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(c,_){return h.type="throw",h.arg=t,a.next=c,_&&(a.method="next",a.arg=void 0),!!_}for(var c=this.tryEntries.length-1;c>=0;--c){var _=this.tryEntries[c],h=_.completion;if("root"===_.tryLoc)return handle("end");if(_.tryLoc<=this.prev){var m=E.call(_,"catchLoc"),g=E.call(_,"finallyLoc");if(m&&g){if(this.prev<_.catchLoc)return handle(_.catchLoc,!0);if(this.prev<_.finallyLoc)return handle(_.finallyLoc)}else if(m){if(this.prev<_.catchLoc)return handle(_.catchLoc,!0)}else{if(!g)throw new Error("try statement without catch or finally");if(this.prev<_.finallyLoc)return handle(_.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var c=this.tryEntries.length-1;c>=0;--c){var _=this.tryEntries[c];if(_.tryLoc<=this.prev&&E.call(_,"finallyLoc")&&this.prev<_.finallyLoc){var h=_;break}}h&&("break"===t||"continue"===t)&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var m=h?h.completion:{};return m.type=t,m.arg=a,h?(this.method="next",this.next=h.finallyLoc,T):this.complete(m)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),T},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===t)return this.complete(c.completion,c.afterLoc),resetTryEntry(c),T}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===t){var _=c.completion;if("throw"===_.type){var E=_.arg;resetTryEntry(c)}return E}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,c){return this.delegate={iterator:values(t),resultName:a,nextLoc:c},"next"===this.method&&(this.arg=void 0),T}},c}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),Oa=Ma(),Sa=Oa;try{regeneratorRuntime=Oa}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Oa:Function("r","regeneratorRuntime = r")(Oa)}var Aa=Object.assign,Ca=Object.defineProperty,Ra=A([].concat),ya=!Aa||fails((function(){if(C&&1!==Aa({b:1},Aa(Ca({},"a",{enumerable:!0,get:function(){Ca(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},c=Symbol(),_="abcdefghijklmnopqrst";return t[c]=7,_.split("").forEach((function(t){a[t]=t})),7!=Aa({},t)[c]||st(Aa({},a)).join("")!=_}))?function assign(t,a){for(var c=toObject(t),_=arguments.length,E=1,h=_r.f,m=V.f;_>E;)for(var g,I=U(arguments[E++]),T=h?Ra(st(I),h(I)):st(I),N=T.length,M=0;N>M;)g=T[M++],C&&!b(m,I,g)||(c[g]=I[g]);return c}:Aa;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==ya},{assign:ya});var ba=Y.Object.assign,Da=V.f,ka=A(Da),Va=A([].push),createMethod$2=function(t){return function(a){for(var c,_=toIndexedObject(a),E=st(_),h=E.length,m=0,g=[];h>m;)c=E[m++],C&&!ka(_,c)||Va(g,t?[c,_[c]]:_[c]);return g}},La={entries:createMethod$2(!0),values:createMethod$2(!1)}.values;_export({target:"Object",stat:!0},{values:function values(t){return La(t)}});var Pa=Y.Object.values;function __rest(t,a){var c={};for(var _ in t)Object.prototype.hasOwnProperty.call(t,_)&&a.indexOf(_)<0&&(c[_]=t[_]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var E=0;for(_=Object.getOwnPropertySymbols(t);E<_.length;E++)a.indexOf(_[E])<0&&Object.prototype.propertyIsEnumerable.call(t,_[E])&&(c[_[E]]=t[_[E]])}return c}function __awaiter(t,a,c,_){return new(c||(c=Promise))((function(E,h){function fulfilled(t){try{step(_.next(t))}catch(t){h(t)}}function rejected(t){try{step(_.throw(t))}catch(t){h(t)}}function step(t){t.done?E(t.value):function adopt(t){return t instanceof c?t:new c((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((_=_.apply(t,a||[])).next())}))}_export({global:!0},{globalThis:E});var wa=E,xa=Date,Ua=A(xa.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return Ua(new xa)}});var Ga=Y.Date.now,Fa=rt.includes,Ba=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:Ba},{includes:function includes(t){return Fa(this,t,arguments.length>1?arguments[1]:void 0)}});var Ha=entryVirtual("Array").includes,Ya=wellKnownSymbol("match"),ja=TypeError,notARegexp=function(t){if(function(t){var a;return H(t)&&(void 0!==(a=t[Ya])?!!a:"RegExp"==classofRaw(t))}(t))throw ja("The method doesn't accept regular expressions");return t},Ka=wellKnownSymbol("match"),Wa=A("".indexOf);_export({target:"String",proto:!0,forced:!function(t){var a=/./;try{"/./"[t](a)}catch(c){try{return a[Ka]=!1,"/./"[t](a)}catch(t){}}return!1}("includes")},{includes:function includes(t){return!!~Wa(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var qa=entryVirtual("String").includes,za=Array.prototype,$a=String.prototype,includes=function(t){var a=t.includes;return t===za||j(za,t)&&a===za.includes?Ha:"string"==typeof t||t===$a||j($a,t)&&a===$a.includes?qa:a},Xa=fails((function(){st(1)}));_export({target:"Object",stat:!0,forced:Xa},{keys:function keys(t){return st(toObject(t))}});var Ja=Y.Object.keys,Qa=/MSIE .\./.test(K),Za=E.Function,wrap=function(t){return Qa?function(a,c){var _=validateArgumentsLength(arguments.length,1)>2,E=isCallable(a)?a:Za(a),h=_?Tt(arguments,2):void 0;return t(_?function(){T(E,this,h)}:E,c)}:t},es={setTimeout:wrap(E.setTimeout),setInterval:wrap(E.setInterval)},ts=es.setInterval;_export({global:!0,bind:!0,forced:E.setInterval!==ts},{setInterval:ts});var rs=es.setTimeout;_export({global:!0,bind:!0,forced:E.setTimeout!==rs},{setTimeout:rs});var ns=Y.setTimeout,os=yr.filter,is=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!is},{filter:function filter(t){return os(this,t,arguments.length>1?arguments[1]:void 0)}});var as=entryVirtual("Array").filter,ss=Array.prototype,filter=function(t){var a=t.filter;return t===ss||j(ss,t)&&a===ss.filter?as:a},cs=entryVirtual("Array").concat,ls=Array.prototype,concat=function(t){var a=t.concat;return t===ls||j(ls,t)&&a===ls.concat?cs:a},us=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var c=0;c<a.length;c++){var _=a[c];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),qe(t,_.key,_)}}function _createClass(t,a,c){return a&&_defineProperties(t.prototype,a),c&&_defineProperties(t,c),qe(t,"prototype",{writable:!1}),t}var t={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},a=function emptyFn(){},c=function(){function Reporter(a){_classCallCheck(this,Reporter),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Ga(),this.timer=null,this.endedAsyncMsgByModule={},this.setConfig(a),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){var a=ba({},this.reportConfig.common,t.common);this.reportConfig=ba({},this.reportConfig,t),this.reportConfig.common=a,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function reportImmediately(t,a){var c=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(t,ba({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,_;null===(_=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===_||_.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(t,a){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(c.priority||(c.priority=this.getEventPriority(t,a)),this.reportConfig.isDataReportEnable&&t){var _=Ga();"HIGH"===c.priority?this.highPriorityMsgList.push({module:t,msg:a,createTime:_}):"NORMAL"===c.priority?this.msgList.push({module:t,msg:a,createTime:_}):"LOW"===c.priority&&this.lowPriorityMsgList.push({module:t,msg:a,createTime:_}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(this.reportConfig.isDataReportEnable&&t&&!this.traceMsgCache[t]){var c=ba(ba({start_time:Ga()},a),{extension:[]});this.traceMsgCache[t]=c}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a,c){var _,E=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t]){var h=this.traceMsgCache[t].extension,m=h.length,g=(new Date).getTime();0===m?a.duration=g-this.traceMsgCache[t].start_time:h[m-1].end_time?a.duration=g-h[m-1].end_time:a.duration=g-this.traceMsgCache[t].start_time,h.push(ba({end_time:g},a));var I=h.length-1;(null==c?void 0:c.asyncParams)&&((_=this.traceMsgCache[t]).asyncPromiseArray||(_.asyncPromiseArray=[]),this.traceMsgCache[t].asyncPromiseArray.push(c.asyncParams.then((function(a){E.traceMsgCache[t]&&E.traceMsgCache[t].extension[I]&&ba(E.traceMsgCache[t].extension[I],a)}))))}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a,c,_=this,E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[t])if("nos"!==t||!1===E){"boolean"==typeof E?this.traceMsgCache[t].succeed=!!E:this.traceMsgCache[t].state=E,this.traceMsgCache[t].duration=Ga()-this.traceMsgCache[t].start_time,forEach$1(a=this.traceMsgCache[t].extension).call(a,(function(t){delete t.end_time}));var h=this.traceMsgCache[t];if(this.traceMsgCache[t]=null,h.asyncPromiseArray){(c=this.endedAsyncMsgByModule)[t]||(c[t]=[]),this.endedAsyncMsgByModule[t].push(h);var m=function asyncCallback(){var a;_.endedAsyncMsgByModule[t]&&includes(a=_.endedAsyncMsgByModule[t]).call(a,h)&&(delete h.asyncPromiseArray,_.report(t,h,{priority:_.getEventPriority(t,h)}))};da.all(h.asyncPromiseArray).then(m).catch(m)}else this.report(t,h,{priority:this.getEventPriority(t,h)})}else this.traceMsgCache[t]=null}},{key:"getEventPriority",value:function getEventPriority(t,a){if("exceptions"===t){if(0===a.action)return"HIGH";if(2===a.action)return"HIGH";if(1===a.action&&0!==a.exception_service)return"HIGH"}else{if("msgReceive"===t)return"LOW";if("nim_api_trace"===t)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function reportTraceCancel(t){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[t]=[],this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function restore(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function destroy(){var t,c=this;this.reportConfig.isDataReportEnable&&(forEach$1(t=Ja(this.traceMsgCache)).call(t,(function(t){c.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=a,this.report=a,this.reportTraceStart=a,this.reportTraceUpdate=a,this.reportTraceEnd=a,this.pause=a,this.restore=a,this.destroy=a,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function initUploadConfig(){var t,a,c=this;if(!this.loading){this.loading=!0;var _=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:_.dev_id,sdkVer:_.sdk_ver,platform:_.platform,appkey:_.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,_;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var E=t.data.data||{};c.reportConfig.maxSize=E.maxSize>1e3?1e3:E.maxSize,c.reportConfig.maxInterval=E.maxInterval>1e4?1e4:E.maxInterval,c.reportConfig.maxInterval=E.maxInterval<10?10:E.maxInterval,c.reportConfig.minInterval=E.minInterval<2?2:E.minInterval,c.reportConfig.maxDelay=E.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.isUploadEnable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(_=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===_||_.log("Get reporter upload config success")}})).catch((function(t){var a,_;c.loading=!1,null===(_=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===_||_.error("Get reporter upload config failed",t)}))}catch(c){this.loading=!1,null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.error("Exec reporter request failed",c)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=ns((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Ga()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t,a,c,_,E,h,m=this,g={},I=Ga();this.highPriorityMsgList=filter(t=this.highPriorityMsgList).call(t,(function(t){return I-t.createTime<m.reportConfig.maxDelay})),this.msgList=filter(a=this.msgList).call(a,(function(t){return I-t.createTime<m.reportConfig.maxDelay})),this.lowPriorityMsgList=filter(c=this.lowPriorityMsgList).call(c,(function(t){return I-t.createTime<m.reportConfig.maxDelay})),this.cacheMsgList=filter(_=this.cacheMsgList).call(_,(function(t){return I-t.createTime<m.reportConfig.maxDelay}));var T=slice(E=this.highPriorityMsgList).call(E,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=slice(h=this.highPriorityMsgList).call(h,T.length),T.length<this.reportConfig.maxSize){var N,M,O=this.reportConfig.maxSize-T.length;T=concat(T).call(T,slice(N=this.msgList).call(N,0,O)),this.msgList=slice(M=this.msgList).call(M,O)}if(T.length<this.reportConfig.maxSize){var S,A,C=this.reportConfig.maxSize-T.length;T=concat(T).call(T,slice(S=this.lowPriorityMsgList).call(S,0,C)),this.lowPriorityMsgList=slice(A=this.lowPriorityMsgList).call(A,C)}if(T.length<this.reportConfig.maxSize){var R,b,D=this.reportConfig.maxSize-T.length;T=concat(T).call(T,slice(R=this.cacheMsgList).call(R,0,D)),this.cacheMsgList=slice(b=this.cacheMsgList).call(b,D)}return forEach$1(T).call(T,(function(t){g[t.module]?g[t.module].push(t.msg):g[t.module]=[t.msg]})),{uploadMsgArr:T,uploadMsg:g}}},{key:"upload",value:function upload(){var t,a,c=this;if(this.isUploadEnable&&!(this.lastReportTime&&Ga()-this.lastReportTime<this.reportConfig.minInterval)){var _=this.getUploadMsg(),E=_.uploadMsgArr,h=_.uploadMsg;if(E.length){this.lastReportTime=Ga();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:h},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,_,h,m;c.cacheMsgList=slice(a=concat(_=c.cacheMsgList).call(_,E)).call(a,0,c.reportConfig.cacheMaxSize),null===(m=null===(h=c.reportConfig)||void 0===h?void 0:h.logger)||void 0===m||m.warn("Reporter upload failed",t)}))}catch(c){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",c)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()}));var _s=function listCacheClear(){this.__data__=[],this.size=0};var ds=function eq(t,a){return t===a||t!=t&&a!=a};var ps=function assocIndexOf(t,a){for(var c=t.length;c--;)if(ds(t[c][0],a))return c;return-1},Es=Array.prototype.splice;var fs=function listCacheDelete(t){var a=this.__data__,c=ps(a,t);return!(c<0)&&(c==a.length-1?a.pop():Es.call(a,c,1),--this.size,!0)};var hs=function listCacheGet(t){var a=this.__data__,c=ps(a,t);return c<0?void 0:a[c][1]};var ms=function listCacheHas(t){return ps(this.__data__,t)>-1};var gs=function listCacheSet(t,a){var c=this.__data__,_=ps(c,t);return _<0?(++this.size,c.push([t,a])):c[_][1]=a,this};function ListCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var _=t[a];this.set(_[0],_[1])}}ListCache.prototype.clear=_s,ListCache.prototype.delete=fs,ListCache.prototype.get=hs,ListCache.prototype.has=ms,ListCache.prototype.set=gs;var Is=ListCache;var Ts=function stackClear(){this.__data__=new Is,this.size=0};var Ns=function stackDelete(t){var a=this.__data__,c=a.delete(t);return this.size=a.size,c};var vs=function stackGet(t){return this.__data__.get(t)};var Ms=function stackHas(t){return this.__data__.has(t)},Os="object"==typeof a&&a&&a.Object===Object&&a,Ss="object"==typeof self&&self&&self.Object===Object&&self,As=Os||Ss||Function("return this")(),Cs=As.Symbol,Rs=Object.prototype,ys=Rs.hasOwnProperty,bs=Rs.toString,Ds=Cs?Cs.toStringTag:void 0;var ks=function getRawTag(t){var a=ys.call(t,Ds),c=t[Ds];try{t[Ds]=void 0;var _=!0}catch(t){}var E=bs.call(t);return _&&(a?t[Ds]=c:delete t[Ds]),E},Vs=Object.prototype.toString;var Ls=function objectToString(t){return Vs.call(t)},Ps=Cs?Cs.toStringTag:void 0;var ws=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ps&&Ps in Object(t)?ks(t):Ls(t)};var xs=function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var Us=function isFunction(t){if(!xs(t))return!1;var a=ws(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},Gs=As["__core-js_shared__"],Fs=function(){var t=/[^.]+$/.exec(Gs&&Gs.keys&&Gs.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Bs=function isMasked(t){return!!Fs&&Fs in t},Hs=Function.prototype.toString;var Ys=function toSource(t){if(null!=t){try{return Hs.call(t)}catch(t){}try{return t+""}catch(t){}}return""},js=/^\[object .+?Constructor\]$/,Ks=Function.prototype,Ws=Object.prototype,qs=Ks.toString,zs=Ws.hasOwnProperty,$s=RegExp("^"+qs.call(zs).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Xs=function baseIsNative(t){return!(!xs(t)||Bs(t))&&(Us(t)?$s:js).test(Ys(t))};var Js=function getValue(t,a){return null==t?void 0:t[a]};var Qs=function getNative(t,a){var c=Js(t,a);return Xs(c)?c:void 0},Zs=Qs(As,"Map"),ec=Qs(Object,"create");var tc=function hashClear(){this.__data__=ec?ec(null):{},this.size=0};var rc=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},nc=Object.prototype.hasOwnProperty;var oc=function hashGet(t){var a=this.__data__;if(ec){var c=a[t];return"__lodash_hash_undefined__"===c?void 0:c}return nc.call(a,t)?a[t]:void 0},ic=Object.prototype.hasOwnProperty;var ac=function hashHas(t){var a=this.__data__;return ec?void 0!==a[t]:ic.call(a,t)};var sc=function hashSet(t,a){var c=this.__data__;return this.size+=this.has(t)?0:1,c[t]=ec&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var _=t[a];this.set(_[0],_[1])}}Hash.prototype.clear=tc,Hash.prototype.delete=rc,Hash.prototype.get=oc,Hash.prototype.has=ac,Hash.prototype.set=sc;var cc=Hash;var lc=function mapCacheClear(){this.size=0,this.__data__={hash:new cc,map:new(Zs||Is),string:new cc}};var uc=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var _c=function getMapData(t,a){var c=t.__data__;return uc(a)?c["string"==typeof a?"string":"hash"]:c.map};var dc=function mapCacheDelete(t){var a=_c(this,t).delete(t);return this.size-=a?1:0,a};var pc=function mapCacheGet(t){return _c(this,t).get(t)};var Ec=function mapCacheHas(t){return _c(this,t).has(t)};var fc=function mapCacheSet(t,a){var c=_c(this,t),_=c.size;return c.set(t,a),this.size+=c.size==_?0:1,this};function MapCache(t){var a=-1,c=null==t?0:t.length;for(this.clear();++a<c;){var _=t[a];this.set(_[0],_[1])}}MapCache.prototype.clear=lc,MapCache.prototype.delete=dc,MapCache.prototype.get=pc,MapCache.prototype.has=Ec,MapCache.prototype.set=fc;var hc=MapCache;var mc=function stackSet(t,a){var c=this.__data__;if(c instanceof Is){var _=c.__data__;if(!Zs||_.length<199)return _.push([t,a]),this.size=++c.size,this;c=this.__data__=new hc(_)}return c.set(t,a),this.size=c.size,this};function Stack(t){var a=this.__data__=new Is(t);this.size=a.size}Stack.prototype.clear=Ts,Stack.prototype.delete=Ns,Stack.prototype.get=vs,Stack.prototype.has=Ms,Stack.prototype.set=mc;var gc=Stack,Ic=function(){try{var t=Qs(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Tc=function baseAssignValue(t,a,c){"__proto__"==a&&Ic?Ic(t,a,{configurable:!0,enumerable:!0,value:c,writable:!0}):t[a]=c};var Nc=function assignMergeValue(t,a,c){(void 0!==c&&!ds(t[a],c)||void 0===c&&!(a in t))&&Tc(t,a,c)};var vc=function createBaseFor(t){return function(a,c,_){for(var E=-1,h=Object(a),m=_(a),g=m.length;g--;){var I=m[t?g:++E];if(!1===c(h[I],I,h))break}return a}}(),Mc=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,_=c&&t&&!t.nodeType&&t,E=_&&_.exports===c?As.Buffer:void 0,h=E?E.allocUnsafe:void 0;t.exports=function cloneBuffer(t,a){if(a)return t.slice();var c=t.length,_=h?h(c):new t.constructor(c);return t.copy(_),_}})),Oc=As.Uint8Array;var Sc=function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new Oc(a).set(new Oc(t)),a};var Ac=function cloneTypedArray(t,a){var c=a?Sc(t.buffer):t.buffer;return new t.constructor(c,t.byteOffset,t.length)};var Cc=function copyArray(t,a){var c=-1,_=t.length;for(a||(a=Array(_));++c<_;)a[c]=t[c];return a},Rc=Object.create,yc=function(){function object(){}return function(t){if(!xs(t))return{};if(Rc)return Rc(t);object.prototype=t;var a=new object;return object.prototype=void 0,a}}();var bc=function overArg(t,a){return function(c){return t(a(c))}},Dc=bc(Object.getPrototypeOf,Object),kc=Object.prototype;var Vc=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||kc)};var Lc=function initCloneObject(t){return"function"!=typeof t.constructor||Vc(t)?{}:yc(Dc(t))};var Pc=function isObjectLike(t){return null!=t&&"object"==typeof t};var wc=function baseIsArguments(t){return Pc(t)&&"[object Arguments]"==ws(t)},xc=Object.prototype,Uc=xc.hasOwnProperty,Gc=xc.propertyIsEnumerable,Fc=wc(function(){return arguments}())?wc:function(t){return Pc(t)&&Uc.call(t,"callee")&&!Gc.call(t,"callee")},Bc=Fc,Hc=Array.isArray;var Yc=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var jc=function isArrayLike(t){return null!=t&&Yc(t.length)&&!Us(t)};var Kc=function isArrayLikeObject(t){return Pc(t)&&jc(t)};var Wc=function stubFalse(){return!1},qc=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,_=c&&t&&!t.nodeType&&t,E=_&&_.exports===c?As.Buffer:void 0,h=(E?E.isBuffer:void 0)||Wc;t.exports=h})),zc=Function.prototype,$c=Object.prototype,Xc=zc.toString,Jc=$c.hasOwnProperty,Qc=Xc.call(Object);var Zc=function isPlainObject(t){if(!Pc(t)||"[object Object]"!=ws(t))return!1;var a=Dc(t);if(null===a)return!0;var c=Jc.call(a,"constructor")&&a.constructor;return"function"==typeof c&&c instanceof c&&Xc.call(c)==Qc},el={};el["[object Float32Array]"]=el["[object Float64Array]"]=el["[object Int8Array]"]=el["[object Int16Array]"]=el["[object Int32Array]"]=el["[object Uint8Array]"]=el["[object Uint8ClampedArray]"]=el["[object Uint16Array]"]=el["[object Uint32Array]"]=!0,el["[object Arguments]"]=el["[object Array]"]=el["[object ArrayBuffer]"]=el["[object Boolean]"]=el["[object DataView]"]=el["[object Date]"]=el["[object Error]"]=el["[object Function]"]=el["[object Map]"]=el["[object Number]"]=el["[object Object]"]=el["[object RegExp]"]=el["[object Set]"]=el["[object String]"]=el["[object WeakMap]"]=!1;var tl=function baseIsTypedArray(t){return Pc(t)&&Yc(t.length)&&!!el[ws(t)]};var rl=function baseUnary(t){return function(a){return t(a)}},nl=createCommonjsModule((function(t,a){var c=a&&!a.nodeType&&a,_=c&&t&&!t.nodeType&&t,E=_&&_.exports===c&&Os.process,h=function(){try{var t=_&&_.require&&_.require("util").types;return t||E&&E.binding&&E.binding("util")}catch(t){}}();t.exports=h})),ol=nl&&nl.isTypedArray,il=ol?rl(ol):tl;var al=function safeGet(t,a){if(("constructor"!==a||"function"!=typeof t[a])&&"__proto__"!=a)return t[a]},sl=Object.prototype.hasOwnProperty;var cl=function assignValue(t,a,c){var _=t[a];sl.call(t,a)&&ds(_,c)&&(void 0!==c||a in t)||Tc(t,a,c)};var ll=function copyObject(t,a,c,_){var E=!c;c||(c={});for(var h=-1,m=a.length;++h<m;){var g=a[h],I=_?_(c[g],t[g],g,c,t):void 0;void 0===I&&(I=t[g]),E?Tc(c,g,I):cl(c,g,I)}return c};var ul=function baseTimes(t,a){for(var c=-1,_=Array(t);++c<t;)_[c]=a(c);return _},_l=/^(?:0|[1-9]\d*)$/;var dl=function isIndex(t,a){var c=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==c||"symbol"!=c&&_l.test(t))&&t>-1&&t%1==0&&t<a},pl=Object.prototype.hasOwnProperty;var El=function arrayLikeKeys(t,a){var c=Hc(t),_=!c&&Bc(t),E=!c&&!_&&qc(t),h=!c&&!_&&!E&&il(t),m=c||_||E||h,g=m?ul(t.length,String):[],I=g.length;for(var T in t)!a&&!pl.call(t,T)||m&&("length"==T||E&&("offset"==T||"parent"==T)||h&&("buffer"==T||"byteLength"==T||"byteOffset"==T)||dl(T,I))||g.push(T);return g};var fl=function nativeKeysIn(t){var a=[];if(null!=t)for(var c in Object(t))a.push(c);return a},hl=Object.prototype.hasOwnProperty;var ml=function baseKeysIn(t){if(!xs(t))return fl(t);var a=Vc(t),c=[];for(var _ in t)("constructor"!=_||!a&&hl.call(t,_))&&c.push(_);return c};var gl=function keysIn(t){return jc(t)?El(t,!0):ml(t)};var Il=function toPlainObject(t){return ll(t,gl(t))};var Tl=function baseMergeDeep(t,a,c,_,E,h,m){var g=al(t,c),I=al(a,c),T=m.get(I);if(T)Nc(t,c,T);else{var N=h?h(g,I,c+"",t,a,m):void 0,M=void 0===N;if(M){var O=Hc(I),S=!O&&qc(I),A=!O&&!S&&il(I);N=I,O||S||A?Hc(g)?N=g:Kc(g)?N=Cc(g):S?(M=!1,N=Mc(I,!0)):A?(M=!1,N=Ac(I,!0)):N=[]:Zc(I)||Bc(I)?(N=g,Bc(g)?N=Il(g):xs(g)&&!Us(g)||(N=Lc(I))):M=!1}M&&(m.set(I,N),E(N,I,_,h,m),m.delete(I)),Nc(t,c,N)}};var Nl=function baseMerge(t,a,c,_,E){t!==a&&vc(a,(function(h,m){if(E||(E=new gc),xs(h))Tl(t,a,m,c,baseMerge,_,E);else{var g=_?_(al(t,m),h,m+"",t,a,E):void 0;void 0===g&&(g=h),Nc(t,m,g)}}),gl)};var vl=function identity(t){return t};var Ml=function apply(t,a,c){switch(c.length){case 0:return t.call(a);case 1:return t.call(a,c[0]);case 2:return t.call(a,c[0],c[1]);case 3:return t.call(a,c[0],c[1],c[2])}return t.apply(a,c)},Ol=Math.max;var Sl=function overRest(t,a,c){return a=Ol(void 0===a?t.length-1:a,0),function(){for(var _=arguments,E=-1,h=Ol(_.length-a,0),m=Array(h);++E<h;)m[E]=_[a+E];E=-1;for(var g=Array(a+1);++E<a;)g[E]=_[E];return g[a]=c(m),Ml(t,this,g)}};var Al=function constant(t){return function(){return t}},Cl=Ic?function(t,a){return Ic(t,"toString",{configurable:!0,enumerable:!1,value:Al(a),writable:!0})}:vl,Rl=Date.now;var yl=function shortOut(t){var a=0,c=0;return function(){var _=Rl(),E=16-(_-c);if(c=_,E>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},bl=yl(Cl);var Dl=function baseRest(t,a){return bl(Sl(t,a,vl),t+"")};var kl=function isIterateeCall(t,a,c){if(!xs(c))return!1;var _=typeof a;return!!("number"==_?jc(c)&&dl(a,c.length):"string"==_&&a in c)&&ds(c[a],t)};var Vl=function createAssigner(t){return Dl((function(a,c){var _=-1,E=c.length,h=E>1?c[E-1]:void 0,m=E>2?c[2]:void 0;for(h=t.length>3&&"function"==typeof h?(E--,h):void 0,m&&kl(c[0],c[1],m)&&(h=E<3?void 0:h,E=1),a=Object(a);++_<E;){var g=c[_];g&&t(a,g,_,h)}return a}))},Ll=Vl((function(t,a,c){Nl(t,a,c)})),Pl=rt.indexOf,wl=A([].indexOf),xl=!!wl&&1/wl([1],1,-0)<0,Ul=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:xl||!Ul},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return xl?wl(this,t,a)||0:Pl(this,t,a)}});var Gl=entryVirtual("Array").indexOf,Fl=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Fl||j(Fl,t)&&a===Fl.indexOf?Gl:a},Bl=yr.some,Hl=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!Hl},{some:function some(t){return Bl(this,t,arguments.length>1?arguments[1]:void 0)}});var Yl,jl,Kl=entryVirtual("Array").some,Wl=Array.prototype,some=function(t){var a=t.some;return t===Wl||j(Wl,t)&&a===Wl.some?Kl:a};!function(t){t[t.Unset=0]="Unset",t[t.RN=2]="RN",t[t.UNIAPP=3]="UNIAPP",t[t.Electron=5]="Electron",t[t.WeiXin=6]="WeiXin",t[t.BROWSER=100]="BROWSER",t[t.H5=101]="H5",t[t.Ali=102]="Ali",t[t.Baidu=103]="Baidu",t[t.Tiktok=104]="Tiktok"}(Yl||(Yl={})),function(t){t[t.kStatNetTypeUnkonw=0]="kStatNetTypeUnkonw",t[t.kStatNetTypeEthernet=1]="kStatNetTypeEthernet",t[t.kStatNetTypeWifi=2]="kStatNetTypeWifi",t[t.kStatNetType2G=3]="kStatNetType2G",t[t.kStatNetType3G=4]="kStatNetType3G",t[t.kStatNetType4G=5]="kStatNetType4G",t[t.kStatNetType5G=6]="kStatNetType5G"}(jl||(jl={}));var ql={wifi:jl.kStatNetTypeWifi,"2g":jl.kStatNetType2G,"3g":jl.kStatNetType3G,"4g":jl.kStatNetType4G,"5g":jl.kStatNetType5G,ethernet:jl.kStatNetTypeEthernet,unknown:jl.kStatNetTypeUnkonw,none:jl.kStatNetTypeUnkonw,notreachable:jl.kStatNetTypeUnkonw,wwan:jl.kStatNetTypeUnkonw};function isMobile(){if(!navigator||!navigator.userAgent)return!1;var t=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return some(t).call(t,(function(t){return navigator.userAgent.match(t)}))}function isElectron(){var t;return!(!navigator||!navigator.userAgent)&&("object"==typeof navigator&&"string"==typeof navigator.userAgent&&indexOf(t=navigator.userAgent).call(t,"Electron")>=0)}function isBrowser(){return navigator&&navigator.userAgent}var zl={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")},getFileUploadInformation:function getFileUploadInformation(t){throw new Error("Function not implemented.")},net:{__getEnv:function __getEnv(){return null},__onNetworkStatusChangeFn:null,getNetworkStatus:function getNetworkStatus(){var t=this.__getEnv();return new da((function(a,c){t.getNetworkType({success:function success(t){var c=!1;c="boolean"==typeof t.networkAvailable?t.networkAvailable:"none"!==t.networkType.toLowerCase(),a({net_type:ql[t.networkType.toLowerCase()],net_connect:c})},fail:function fail(){c(new Error("getNetworkType failed"))}})}))},onNetworkStatusChange:function onNetworkStatusChange(t){var a=this.__getEnv();this.offNetworkStatusChange(),a.onNetworkStatusChange&&(this.__onNetworkStatusChangeFn=function(a){var c=a.networkType.toLowerCase();t({isConnected:a.isConnected||"none"!==c,networkType:ql[c]})},a.onNetworkStatusChange(this.__onNetworkStatusChangeFn))},offNetworkStatusChange:function offNetworkStatusChange(){var t=this.__getEnv();t.offNetworkStatusChange&&(this.__onNetworkStatusChangeFn&&t.offNetworkStatusChange(this.__onNetworkStatusChangeFn),this.__onNetworkStatusChangeFn=null)}}};var $l=yr.findIndex,Xl="findIndex",Jl=!0;Xl in[]&&Array(1).findIndex((function(){Jl=!1})),_export({target:"Array",proto:!0,forced:Jl},{findIndex:function findIndex(t){return $l(this,t,arguments.length>1?arguments[1]:void 0)}});var Ql=entryVirtual("Array").findIndex,Zl=Array.prototype,findIndex=function(t){var a=t.findIndex;return t===Zl||j(Zl,t)&&a===Zl.findIndex?Ql:a},eu=yr.map,tu=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!tu},{map:function map(t){return eu(this,t,arguments.length>1?arguments[1]:void 0)}});var ru=entryVirtual("Array").map,nu=Array.prototype,map$7=function(t){var a=t.map;return t===nu||j(nu,t)&&a===nu.map?ru:a};Y.JSON||(Y.JSON={stringify:JSON.stringify});var ou=function stringify(t,a,c){return T(Y.JSON.stringify,null,arguments)},iu=ou,au=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),su=Object.isExtensible,cu=fails((function(){su(1)}))||au?function isExtensible(t){return!!H(t)&&((!au||"ArrayBuffer"!=classofRaw(t))&&(!su||su(t)))}:su,lu=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),uu=createCommonjsModule((function(t){var a=Be.f,c=!1,_=uid("meta"),E=0,setMetadata=function(t){a(t,_,{value:{objectID:"O"+E++,weakData:{}}})},h=t.exports={enable:function(){h.enable=function(){},c=!0;var t=ir.f,a=A([].splice),E={};E[_]=1,t(E).length&&(ir.f=function(c){for(var E=t(c),h=0,m=E.length;h<m;h++)if(E[h]===_){a(E,h,1);break}return E},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ur.f}))},fastKey:function(t,a){if(!H(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!ue(t,_)){if(!cu(t))return"F";if(!a)return"E";setMetadata(t)}return t[_].objectID},getWeakData:function(t,a){if(!ue(t,_)){if(!cu(t))return!0;if(!a)return!1;setMetadata(t)}return t[_].weakData},onFreeze:function(t){return lu&&c&&cu(t)&&!ue(t,_)&&setMetadata(t),t}};nt[_]=!0})),_u=Be.f,du=yr.forEach,pu=Cr.set,Eu=Cr.getterFor,defineBuiltIns=function(t,a,c){for(var _ in a)c&&c.unsafe&&t[_]?t[_]=a[_]:defineBuiltIn(t,_,a[_],c);return t},fu=Be.f,hu=uu.fastKey,mu=Cr.set,gu=Cr.getterFor,Iu={getConstructor:function(t,a,c,_){var E=t((function(t,E){anInstance(t,h),mu(t,{type:a,index:pt(null),first:void 0,last:void 0,size:0}),C||(t.size=0),isNullOrUndefined(E)||iterate(E,t[_],{that:t,AS_ENTRIES:c})})),h=E.prototype,m=gu(a),define=function(t,a,c){var _,E,h=m(t),g=getEntry(t,a);return g?g.value=c:(h.last=g={index:E=hu(a,!0),key:a,value:c,previous:_=h.last,next:void 0,removed:!1},h.first||(h.first=g),_&&(_.next=g),C?h.size++:t.size++,"F"!==E&&(h.index[E]=g)),t},getEntry=function(t,a){var c,_=m(t),E=hu(a);if("F"!==E)return _.index[E];for(c=_.first;c;c=c.next)if(c.key==a)return c};return defineBuiltIns(h,{clear:function clear(){for(var t=m(this),a=t.index,c=t.first;c;)c.removed=!0,c.previous&&(c.previous=c.previous.next=void 0),delete a[c.index],c=c.next;t.first=t.last=void 0,C?t.size=0:this.size=0},delete:function(t){var a=this,c=m(a),_=getEntry(a,t);if(_){var E=_.next,h=_.previous;delete c.index[_.index],_.removed=!0,h&&(h.next=E),E&&(E.previous=h),c.first==_&&(c.first=E),c.last==_&&(c.last=h),C?c.size--:a.size--}return!!_},forEach:function forEach(t){for(var a,c=m(this),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:c.first;)for(_(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(h,c?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),C&&fu(h,"size",{get:function(){return m(this).size}}),E},setStrong:function(t,a,c){var _=a+" Iterator",E=gu(a),h=gu(_);iteratorDefine(t,a,(function(t,a){mu(this,{type:_,target:t,state:E(t),kind:a,last:void 0})}),(function(){for(var t=h(this),a=t.kind,c=t.last;c&&c.removed;)c=c.previous;return t.target&&(t.last=c=c?c.next:t.state.first)?"keys"==a?{value:c.key,done:!1}:"values"==a?{value:c.value,done:!1}:{value:[c.key,c.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),c?"entries":"values",!c,!0),setSpecies(a)}};!function(t,a,c){var _,h=-1!==t.indexOf("Map"),m=-1!==t.indexOf("Weak"),g=h?"set":"add",I=E[t],T=I&&I.prototype,N={};if(C&&isCallable(I)&&(m||T.forEach&&!fails((function(){(new I).entries().next()})))){var M=(_=a((function(a,c){pu(anInstance(a,M),{type:t,collection:new I}),null!=c&&iterate(c,a[g],{that:a,AS_ENTRIES:h})}))).prototype,O=Eu(t);du(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in T)||m&&"clear"==t||He(M,t,(function(c,_){var E=O(this).collection;if(!a&&m&&!H(c))return"get"==t&&void 0;var h=E[t](0===c?0:c,_);return a?this:h}))})),m||_u(M,"size",{configurable:!0,get:function(){return O(this).collection.size}})}else _=c.getConstructor(a,t,h,g),uu.enable();setToStringTag(_,t,!1,!0),N[t]=_,_export({global:!0,forced:!0},N),m||c.setStrong(_,t,h)}("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),Iu);var Tu=Y.Map,Nu=[].push;_export({target:"Map",stat:!0,forced:!0},{from:function from(t){var a,c,_,E,h=arguments.length,m=h>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==m)&&aCallable(m),isNullOrUndefined(t)?new this:(c=[],a?(_=0,E=functionBindContext(m,h>2?arguments[2]:void 0),iterate(t,(function(t){b(Nu,c,E(t,_++))}))):iterate(t,Nu,{that:c}),new this(c))}});_export({target:"Map",stat:!0,forced:!0},{of:function of(){return new this(Tt(arguments))}});_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function deleteAll(){for(var t,a=anObject(this),c=aCallable(a.delete),_=!0,E=0,h=arguments.length;E<h;E++)t=b(c,a,arguments[E]),_=_&&t;return!!_}});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var c,_,E=anObject(this),h=aCallable(E.get),m=aCallable(E.has),g=aCallable(E.set);return b(m,E,t)?(c=b(h,E,t),"update"in a&&(c=a.update(c,t,E),b(g,E,t,c)),c):(_=a.insert(t,E),b(g,E,t,_),_)}});var vu=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(c,(function(t,c,E){if(!_(c,t,a))return E()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0),E=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(E.set);return iterate(c,(function(t,c){_(c,t,a)&&b(h,E,t,c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),E}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,E){if(_(c,t,a))return E(c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,E){if(_(c,t,a))return E(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Mu=A([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var c=getIterator(t),_=new this,E=aCallable(_.has),h=aCallable(_.get),m=aCallable(_.set);return iterate(c,(function(t){var c=a(t);b(E,_,c)?Mu(b(h,_,c),t):b(m,_,c,[t])}),{IS_ITERATOR:!0}),_}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(vu(anObject(this)),(function(a,c,_){if((E=c)===(h=t)||E!=E&&h!=h)return _();var E,h}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var c=new this;aCallable(a);var _=aCallable(c.set);return iterate(t,(function(t){b(_,c,a(t),t)})),c}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(vu(anObject(this)),(function(a,c,_){if(c===t)return _(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0),E=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(E.set);return iterate(c,(function(t,c){b(h,E,_(c,t,a),c)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),E}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0),E=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(E.set);return iterate(c,(function(t,c){b(h,E,t,_(c,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),E}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),c=aCallable(a.set),_=arguments.length,E=0;E<_;)iterate(arguments[E++],c,{that:a,AS_ENTRIES:!0});return a}});var Ou=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),c=vu(a),_=arguments.length<2,E=_?void 0:arguments[1];if(aCallable(t),iterate(c,(function(c,h){_?(_=!1,E=h):E=t(E,h,c,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),_)throw Ou("Reduce of empty map with no initial value");return E}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),c=vu(a),_=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(c,(function(t,c,E){if(_(c,t,a))return E()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Su=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var c=anObject(this),_=aCallable(c.get),E=aCallable(c.has),h=aCallable(c.set),m=arguments.length;aCallable(a);var g=b(E,c,t);if(!g&&m<3)throw Su("Updating absent value");var I=g?b(_,c,t):aCallable(m>2?arguments[2]:void 0)(t,c);return b(h,c,t,a(I,t,c)),c}});var Au=TypeError,Cu=function upsert(t,a){var c,_=anObject(this),E=aCallable(_.get),h=aCallable(_.has),m=aCallable(_.set),g=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(g))throw Au("At least one callback required");return b(h,_,t)?(c=b(E,_,t),isCallable(a)&&(c=a(c),b(m,_,t,c))):isCallable(g)&&(c=g(),b(m,_,t,c)),c};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:Cu}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:Cu});var Ru=Tu,yu=createCommonjsModule((function(t){function _getPrototypeOf(a){var c;return t.exports=_getPrototypeOf=It?bind$1(c=uo).call(c):function _getPrototypeOf(t){return t.__proto__||uo(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),bu=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),Du=getBuiltIn("Reflect","construct"),ku=Object.prototype,Vu=[].push,Lu=fails((function(){function F(){}return!(Du((function(){}),[],F)instanceof F)})),Pu=!fails((function(){Du((function(){}))})),wu=Lu||Pu;_export({target:"Reflect",stat:!0,forced:wu,sham:wu},{construct:function construct(t,a){aConstructor(t),anObject(a);var c=arguments.length<3?t:aConstructor(arguments[2]);if(Pu&&!Lu)return Du(t,a,c);if(t==c){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var _=[null];return T(Vu,_,a),new(T(St,t,_))}var E=c.prototype,h=pt(H(E)?E:ku),m=T(t,h,a);return H(m)?m:h}});var xu=Y.Reflect.construct,Uu=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!xu)return!1;if(xu.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(xu(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Gu=createCommonjsModule((function(t){function _construct(a,c,_){var E;Uu()?(t.exports=_construct=bind$1(E=xu).call(E),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,c){var _=[null];_.push.apply(_,a);var E=new(bind$1(Function).apply(t,_));return c&&Rt(E,c.prototype),E},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),Fu=createCommonjsModule((function(t){function _wrapNativeSuper(a){var c="function"==typeof Ru?new Ru:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!bu(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(t))return c.get(t);c.set(t,Wrapper)}function Wrapper(){return Gu(t,arguments,yu(this).constructor)}return Wrapper.prototype=ft(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),Rt(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),Bu=getDefaultExportFromCjs(Fu),Hu=TypeError,createMethod$1=function(t){return function(a,c,_,E){aCallable(c);var h=toObject(a),m=U(h),g=lengthOfArrayLike(h),I=t?g-1:0,T=t?-1:1;if(_<2)for(;;){if(I in m){E=m[I],I+=T;break}if(I+=T,t?I<0:g<=I)throw Hu("Reduce of empty array with no initial value")}for(;t?I>=0:g>I;I+=T)I in m&&(E=c(E,m[I],I,h));return E}},Yu={left:createMethod$1(!1),right:createMethod$1(!0)}.left,ju=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!ju||!Fo&&X>79&&X<83},{reduce:function reduce(t){var a=arguments.length;return Yu(this,t,a,a>1?arguments[1]:void 0)}});var Ku,Wu,qu,zu,$u,Xu,Ju,Qu,Zu,e_,t_,r_,n_,o_,i_,a_,s_,c_,l_,u_,__,d_,p_,E_,f_,h_,m_,g_,I_,T_,N_,v_,M_,O_,S_,A_,C_,R_,y_,b_,D_,k_,V_,L_=entryVirtual("Array").reduce,P_=Array.prototype,reduce=function(t){var a=t.reduce;return t===P_||j(P_,t)&&a===P_.reduce?L_:a};!function(t){t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",t[t.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(Ku||(Ku={})),function(t){t[t.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",t[t.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",t[t.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Wu||(Wu={})),function(t){t[t.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",t[t.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",t[t.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(qu||(qu={})),function(t){t[t.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",t[t.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",t[t.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",t[t.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(zu||(zu={})),function(t){t[t.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",t[t.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",t[t.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}($u||($u={})),function(t){t[t.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",t[t.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Xu||(Xu={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",t[t.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Ju||(Ju={})),function(t){t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",t[t.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Qu||(Qu={})),function(t){t[t.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",t[t.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Zu||(Zu={})),function(t){t[t.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",t[t.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",t[t.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",t[t.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(e_||(e_={})),function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(t_||(t_={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(r_||(r_={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(n_||(n_={})),function(t){t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",t[t.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",t[t.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(o_||(o_={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(i_||(i_={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(a_||(a_={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(s_||(s_={})),function(t){t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",t[t.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(c_||(c_={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(l_||(l_={})),function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(u_||(u_={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(__||(__={})),function(t){t[t.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",t[t.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(d_||(d_={})),function(t){t[t.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",t[t.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(p_||(p_={})),function(t){t[t.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",t[t.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(E_||(E_={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(f_||(f_={})),function(t){t[t.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",t[t.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(h_||(h_={})),function(t){t[t.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",t[t.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",t[t.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",t[t.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",t[t.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",t[t.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",t[t.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",t[t.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(m_||(m_={})),function(t){t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",t[t.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(g_||(g_={})),function(t){t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",t[t.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(I_||(I_={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(T_||(T_={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(N_||(N_={})),function(t){t[t.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",t[t.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",t[t.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(v_||(v_={})),function(t){t[t.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",t[t.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",t[t.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(M_||(M_={})),function(t){t[t.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",t[t.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(O_||(O_={})),function(t){t[t.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",t[t.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(S_||(S_={})),function(t){t[t.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(A_||(A_={})),function(t){t[t.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",t[t.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(C_||(C_={})),function(t){t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",t[t.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(R_||(R_={})),function(t){t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL=0]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_ALL",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER=1]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_MANAGER",t[t.V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE=2]="V2NIM_TEAM_MESSAGE_NOTIFY_MODE_CLOSE"}(y_||(y_={})),function(t){t[t.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",t[t.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",t[t.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(b_||(b_={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",t[t.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(D_||(D_={})),function(t){t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",t[t.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(k_||(k_={})),function(t){t[t.teamApply=0]="teamApply",t[t.teamApplyReject=1]="teamApplyReject",t[t.teamInvite=2]="teamInvite",t[t.teamInviteReject=3]="teamInviteReject",t[t.tlistUpdate=4]="tlistUpdate",t[t.superTeamApply=15]="superTeamApply",t[t.superTeamApplyReject=16]="superTeamApplyReject",t[t.superTeamInvite=17]="superTeamInvite",t[t.superTeamInviteReject=18]="superTeamInviteReject"}(V_||(V_={}));var w_={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_MESSAGE_HIT_CLIENT_ANTISPAM:{code:107452,message:"message hit client antispam"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},x_=Ja(w_),U_=reduce(x_).call(x_,(function(t,a){var c=w_[a];return t[a]=c.code,t}),{}),G_=reduce(x_).call(x_,(function(t,a){var c=w_[a];return t[c.code]=c.message,t}),{}),F_=function(t){function V2NIMErrorImpl(a){var c;return(c=t.call(this,a.desc)||this).name="V2NIMError",c.code=a.code||0,c.desc=a.desc||G_[c.code]||j_[c.code]||"",c.message=c.desc,c.detail=a.detail||{},c}return yt(V2NIMErrorImpl,t),V2NIMErrorImpl.prototype.toString=function toString(){var t,a=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?iu(this.detail):"");return(null===(t=null==this?void 0:this.detail)||void 0===t?void 0:t.rawError)&&(a+="\n rawError: "+this.detail.rawError.message),a},V2NIMErrorImpl}(Bu(Error));var B_=function(t){function ValidateError(a,c,_){var E;return void 0===c&&(c={}),(E=t.call(this,{code:U_.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:a,rules:_,data:c}})||this).name="validateError",E.message=E.message+"\n"+iu(E.detail,null,2),E.data=c,E.rules=_,E}return yt(ValidateError,t),ValidateError}(F_),H_=function(t){function ValidateErrorV2(a){var c,_,E,h;return(c=t.call(this,{code:U_.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(_=a.detail)||void 0===_?void 0:_.reason,rules:null===(E=a.detail)||void 0===E?void 0:E.rules,data:null===(h=a.detail)||void 0===h?void 0:h.data}})||this).name="ValidateErrorV2",c}return yt(ValidateErrorV2,t),ValidateErrorV2}(F_),Y_=function(t){function UploadError(a){var c;return(c=t.call(this,ba({code:400},a))||this).desc=c.desc||"upload file error",c.message=c.desc,c.name="uploadError",c}return yt(UploadError,t),UploadError}(F_),j_={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Service unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},K_=["error","warn","log","debug"],W_=function emptyFunc(){},q_=["off","error","warn","log","debug"],z_=function(){function Logger(t){this.strategies={debug:{name:"debug",func:console.log},log:{name:"  log",func:console.log},warn:{name:" warn",func:console.warn},error:{name:"error",func:console.error}},this.debug=W_,this.log=W_,this.warn=W_,this.error=W_,includes(q_).call(q_,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,c=findIndex(K_).call(K_,(function(a){return a===t}));forEach$1(K_).call(K_,(function(t,_){_<=c&&(a[t]=function(){var a=slice(Array.prototype).call(arguments),c=this.strategies[t],_=this.formatArgs(a,c.name);c.func(_)})}))},t.formatArgs=function formatArgs(t,a){var c=new Date;return"[NIM "+a+" "+(c.getMonth()+1+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds())+"] "+map$7(t).call(t,(function(t){return t instanceof F_?t.toString():t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?iu(t):t})).join(" ")},t.destroy=function destroy(){this.debug=W_,this.log=W_,this.warn=W_,this.error=W_},Logger}(),$_="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",X_="imElite_sdk_abtest_web",callWithSafeIterationClosing=function(t,a,c,_){try{return _?a(anObject(c)[0],c[1]):a(c)}catch(a){iteratorClose(t,"throw",a)}},J_=Array,Q_=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:Q_},{from:function from(t){var a=toObject(t),c=qt(this),_=arguments.length,E=_>1?arguments[1]:void 0,h=void 0!==E;h&&(E=functionBindContext(E,_>2?arguments[2]:void 0));var m,g,I,T,N,M,O=getIteratorMethod$5(a),S=0;if(!O||this===J_&&isArrayIteratorMethod(O))for(m=lengthOfArrayLike(a),g=c?new this(m):J_(m);m>S;S++)M=h?E(a[S],S):a[S],createProperty(g,S,M);else for(N=(T=getIterator(a,O)).next,g=c?new this:[];!(I=b(N,T)).done;S++)M=h?callWithSafeIterationClosing(T,E,[I.value,S],!0):I.value,createProperty(g,S,M);return g.length=S,g}});var Z_=Y.Array.from,ed=getIteratorMethod$5;_export({target:"Array",stat:!0},{isArray:bt});var td=Y.Array.isArray,rd=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),c=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-c:t+c}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var nd=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,c="~";function Events(){}function EE(t,a,c){this.fn=t,this.context=a,this.once=c||!1}function addListener(t,a,_,E,h){if("function"!=typeof _)throw new TypeError("The listener must be a function");var m=new EE(_,E||t,h),g=c?c+a:a;return t._events[g]?t._events[g].fn?t._events[g]=[t._events[g],m]:t._events[g].push(m):(t._events[g]=m,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(c=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,_,E=[];if(0===this._eventsCount)return E;for(_ in t=this._events)a.call(t,_)&&E.push(c?_.slice(1):_);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(t)):E},EventEmitter.prototype.listeners=function listeners(t){var a=c?c+t:t,_=this._events[a];if(!_)return[];if(_.fn)return[_.fn];for(var E=0,h=_.length,m=new Array(h);E<h;E++)m[E]=_[E].fn;return m},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=c?c+t:t,_=this._events[a];return _?_.fn?1:_.length:0},EventEmitter.prototype.emit=function emit(t,a,_,E,h,m){var g=c?c+t:t;if(!this._events[g])return!1;var I,T,N=this._events[g],M=arguments.length;if(N.fn){switch(N.once&&this.removeListener(t,N.fn,void 0,!0),M){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,a),!0;case 3:return N.fn.call(N.context,a,_),!0;case 4:return N.fn.call(N.context,a,_,E),!0;case 5:return N.fn.call(N.context,a,_,E,h),!0;case 6:return N.fn.call(N.context,a,_,E,h,m),!0}for(T=1,I=new Array(M-1);T<M;T++)I[T-1]=arguments[T];N.fn.apply(N.context,I)}else{var O,S=N.length;for(T=0;T<S;T++)switch(N[T].once&&this.removeListener(t,N[T].fn,void 0,!0),M){case 1:N[T].fn.call(N[T].context);break;case 2:N[T].fn.call(N[T].context,a);break;case 3:N[T].fn.call(N[T].context,a,_);break;case 4:N[T].fn.call(N[T].context,a,_,E);break;default:if(!I)for(O=1,I=new Array(M-1);O<M;O++)I[O-1]=arguments[O];N[T].fn.apply(N[T].context,I)}}return!0},EventEmitter.prototype.on=function on(t,a,c){return addListener(this,t,a,c,!1)},EventEmitter.prototype.once=function once(t,a,c){return addListener(this,t,a,c,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,_,E){var h=c?c+t:t;if(!this._events[h])return this;if(!a)return clearEvent(this,h),this;var m=this._events[h];if(m.fn)m.fn!==a||E&&!m.once||_&&m.context!==_||clearEvent(this,h);else{for(var g=0,I=[],T=m.length;g<T;g++)(m[g].fn!==a||E&&!m[g].once||_&&m[g].context!==_)&&I.push(m[g]);I.length?this._events[h]=1===I.length?I[0]:I:clearEvent(this,h)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=c?c+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=c,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter}));var od=function isSymbol(t){return"symbol"==typeof t||Pc(t)&&"[object Symbol]"==ws(t)},id=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ad=/^\w*$/;var sd=function isKey(t,a){if(Hc(t))return!1;var c=typeof t;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=t&&!od(t))||(ad.test(t)||!id.test(t)||null!=a&&t in Object(a))};function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var c=arguments,_=a?a.apply(this,c):c[0],E=memoized.cache;if(E.has(_))return E.get(_);var h=t.apply(this,c);return memoized.cache=E.set(_,h)||E,h};return memoized.cache=new(memoize.Cache||hc),memoized}memoize.Cache=hc;var cd=memoize;var ld=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ud=/\\(\\)?/g,_d=function memoizeCapped(t){var a=cd(t,(function(t){return 500===c.size&&c.clear(),t})),c=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(ld,(function(t,c,_,E){a.push(_?E.replace(ud,"$1"):c||t)})),a})),dd=_d;var pd=function arrayMap(t,a){for(var c=-1,_=null==t?0:t.length,E=Array(_);++c<_;)E[c]=a(t[c],c,t);return E},Ed=Cs?Cs.prototype:void 0,fd=Ed?Ed.toString:void 0;var hd=function baseToString(t){if("string"==typeof t)return t;if(Hc(t))return pd(t,baseToString)+"";if(od(t))return fd?fd.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var md=function toString(t){return null==t?"":hd(t)};var gd=function castPath(t,a){return Hc(t)?t:sd(t,a)?[t]:dd(md(t))};var Id=function toKey(t){if("string"==typeof t||od(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Td=function baseGet(t,a){for(var c=0,_=(a=gd(a,t)).length;null!=t&&c<_;)t=t[Id(a[c++])];return c&&c==_?t:void 0};var Nd=function get(t,a,c){var _=null==t?void 0:Td(t,a);return void 0===_?c:_},vd=ro.codeAt;_export({target:"String",proto:!0},{codePointAt:function codePointAt(t){return vd(this,t)}});var Md=entryVirtual("String").codePointAt,Od=String.prototype,codePointAt=function(t){var a=t.codePointAt;return"string"==typeof t||t===Od||j(Od,t)&&a===Od.codePointAt?Md:a},Sd=RangeError,Ad=String.fromCharCode,Cd=String.fromCodePoint,Rd=A([].join),yd=!!Cd&&1!=Cd.length;_export({target:"String",stat:!0,arity:1,forced:yd},{fromCodePoint:function fromCodePoint(t){for(var a,c=[],_=arguments.length,E=0;_>E;){if(a=+arguments[E++],toAbsoluteIndex(a,1114111)!==a)throw Sd(a+" is not a valid code point");c[E]=a<65536?Ad(a):Ad(55296+((a-=65536)>>10),a%1024+56320)}return Rd(c,"")}});var bd=Y.String.fromCodePoint,Dd="\t\n\v\f\r                　\u2028\u2029\ufeff",kd=A("".replace),Vd="["+Dd+"]",Ld=RegExp("^"+Vd+Vd+"*"),Pd=RegExp(Vd+Vd+"*$"),createMethod=function(t){return function(a){var c=toString$1(requireObjectCoercible(a));return 1&t&&(c=kd(c,Ld,"")),2&t&&(c=kd(c,Pd,"")),c}},wd={start:createMethod(1),end:createMethod(2),trim:createMethod(3)},xd=wd.trim,Ud=E.parseInt,Gd=E.Symbol,Fd=Gd&&Gd.iterator,Bd=/^[+-]?0x/i,Hd=A(Bd.exec),Yd=8!==Ud(Dd+"08")||22!==Ud(Dd+"0x16")||Fd&&!fails((function(){Ud(Object(Fd))}))?function parseInt(t,a){var c=xd(toString$1(t));return Ud(c,a>>>0||(Hd(Bd,c)?16:10))}:Ud;_export({global:!0,forced:parseInt!=Yd},{parseInt:Yd});var jd=Y.parseInt,Kd=TypeError,Wd=Object.getOwnPropertyDescriptor,qd=C&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(bt(t)&&!Wd(t,"length").writable)throw Kd("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},zd=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw zd("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},$d=arrayMethodHasSpeciesSupport("splice"),Xd=Math.max,Jd=Math.min;_export({target:"Array",proto:!0,forced:!$d},{splice:function splice(t,a){var c,_,E,h,m,g,I=toObject(this),T=lengthOfArrayLike(I),N=toAbsoluteIndex(t,T),M=arguments.length;for(0===M?c=_=0:1===M?(c=0,_=T-N):(c=M-2,_=Jd(Xd(toIntegerOrInfinity(a),0),T-N)),doesNotExceedSafeInteger(T+c-_),E=arraySpeciesCreate(I,_),h=0;h<_;h++)(m=N+h)in I&&createProperty(E,h,I[m]);if(E.length=_,c<_){for(h=N;h<T-_;h++)g=h+c,(m=h+_)in I?I[g]=I[m]:deletePropertyOrThrow(I,g);for(h=T;h>T-_+c;h--)deletePropertyOrThrow(I,h-1)}else if(c>_)for(h=T-_;h>N;h--)g=h+c-1,(m=h+_-1)in I?I[g]=I[m]:deletePropertyOrThrow(I,g);for(h=0;h<c;h++)I[h+N]=arguments[h+2];return qd(I,T-_+c),E}});var Qd=entryVirtual("Array").splice,Zd=Array.prototype,splice=function(t){var a=t.splice;return t===Zd||j(Zd,t)&&a===Zd.splice?Qd:a},ep=function abs(t){var a;if(void 0!==t)return(a=BigNumber(t)).sign=1,a},tp=function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)},rp=function isValidType(t){var a;return some(a=["number"==typeof t,"string"==typeof t&&t.length>0,tp(t)&&t.length>0,t instanceof BigNumber]).call(a,(function(t){return!0===t}))},np="Invalid Number",op="Invalid Number - Division By Zero";function BigNumber(t){var a;if(!(this instanceof BigNumber))return new BigNumber(t);if(this.number=[],this.sign=1,this.rest=0,rp(t)){if(tp(t)){for((t.length&&"-"===t[0]||"+"===t[0])&&(this.sign="+"===t[0]?1:-1,t.shift(0)),a=t.length-1;a>=0;a--)if(!this.addDigit(t[a]))return}else for("-"!==(t=t.toString()).charAt(0)&&"+"!==t.charAt(0)||(this.sign="+"===t.charAt(0)?1:-1,t=t.substring(1)),a=t.length-1;a>=0;a--)if(!this.addDigit(jd(t.charAt(a),10)))return}else this.number=np}BigNumber.prototype.addDigit=function(t){return function testDigit(t){return/^\d$/.test(t)}(t)?(this.number.push(t),this):(this.number=np,!1)},BigNumber.prototype._compare=function(t){var a,c;if(!rp(t))return null;if(a=BigNumber(t),this.sign!==a.sign)return this.sign;if(this.number.length>a.number.length)return this.sign;if(this.number.length<a.number.length)return-1*this.sign;for(c=this.number.length-1;c>=0;c--){if(this.number[c]>a.number[c])return this.sign;if(this.number[c]<a.number[c])return-1*this.sign}return 0},BigNumber.prototype.gt=function(t){return this._compare(t)>0},BigNumber.prototype.gte=function(t){return this._compare(t)>=0},BigNumber.prototype.equals=function(t){return 0===this._compare(t)},BigNumber.prototype.lte=function(t){return this._compare(t)<=0},BigNumber.prototype.lt=function(t){return this._compare(t)<0},BigNumber.prototype.subtract=function(t){var a;return void 0===t?this:(a=BigNumber(t),this.sign!==a.sign?(this.number=BigNumber._add(this,a),this):(this.sign=this.lt(a)?-1:1,this.number=ep(this).lt(ep(a))?BigNumber._subtract(a,this):BigNumber._subtract(this,a),this))},BigNumber._add=function(t,a){var c,_=0,E=Math.max(t.number.length,a.number.length);for(c=0;c<E||_>0;c++)t.number[c]=(_+=(t.number[c]||0)+(a.number[c]||0))%10,_=Math.floor(_/10);return t.number},BigNumber._subtract=function(t,a){var c,_,E=0,h=t.number.length;for(c=0;c<h;c++)t.number[c]-=(a.number[c]||0)+E,t.number[c]+=10*(E=t.number[c]<0?1:0);for(c=0,h=t.number.length-1;0===t.number[h-c]&&h-c>0;)c++;c>0&&splice(_=t.number).call(_,-c);return t.number},BigNumber.prototype.multiply=function(t){if(void 0===t)return this;var a,c,_=BigNumber(t),E=0,h=[];if(this.isZero()||_.isZero())return BigNumber(0);for(this.sign*=_.sign,a=0;a<this.number.length;a++)for(E=0,c=0;c<_.number.length||E>0;c++)h[a+c]=(E+=(h[a+c]||0)+this.number[a]*(_.number[c]||0))%10,E=Math.floor(E/10);return this.number=h,this},BigNumber.prototype.divide=function(t){if(void 0===t)return this;var a,c,_=BigNumber(t),E=[],h=BigNumber(0);if(_.isZero())return this.number=op,this;if(this.isZero())return this.rest=BigNumber(0),this;if(this.sign*=_.sign,_.sign=1,1===_.number.length&&1===_.number[0])return this.rest=BigNumber(0),this;for(a=this.number.length-1;a>=0;a--)for(h.multiply(10),h.number[0]=this.number[a],E[a]=0;_.lte(h);)E[a]++,h.subtract(_);for(a=0,c=E.length-1;0===E[c-a]&&c-a>0;)a++;return a>0&&splice(E).call(E,-a),this.rest=h,this.number=E,this},BigNumber.prototype.mod=function(t){return this.divide(t).rest},BigNumber.prototype.isZero=function(){var t;for(t=0;t<this.number.length;t++)if(0!==this.number[t])return!1;return!0},BigNumber.prototype.toString=function(){var t,a="";if("string"==typeof this.number)return this.number;for(t=this.number.length-1;t>=0;t--)a+=this.number[t];return this.sign>0?a:"-"+a};var ip=Math.pow(2,32);function varintToBytes(t){var a=new Uint8Array(4),c=new DataView(a.buffer),_=0;do{var E=127&t;(t>>>=7)>0&&(E|=128),c.setUint8(_++,E)}while(t>0);return slice(a).call(a,0,_)}function encodeText(t){if("function"==typeof TextEncoder)return(new TextEncoder).encode(t);var a=function textEncoder(t){for(var a=[],c=t.length,_=0;_<c;){var E=codePointAt(t).call(t,_),h=0,m=0;for(E<=127?(h=0,m=0):E<=2047?(h=6,m=192):E<=65535?(h=12,m=224):E<=2097151&&(h=18,m=240),a.push(m|E>>h),h-=6;h>=0;)a.push(128|E>>h&63),h-=6;_+=E>=65536?2:1}return a}(t);return new Uint8Array(a)}function decodeText(t){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(t):function textDecoder(t){for(var a="",c=0;c<t.length;){var _=t[c],E=0,h=0;if(_<=127?(E=0,h=255&_):_<=223?(E=1,h=31&_):_<=239?(E=2,h=15&_):_<=244&&(E=3,h=7&_),t.length-c-E>0)for(var m=0;m<E;)h=h<<6|63&(_=t[c+m+1]),m+=1;else h=65533,E=t.length-c;a+=bd(h),c+=E+1}return a}(t)}var ap=function(){function Unpack(t){this.offset=0,this.buffer=new Uint8Array(t),this.view=new DataView(t)}var t=Unpack.prototype;return t.checkBufferBoundaryAccess=function checkBufferBoundaryAccess(){return this.offset>=this.buffer.byteLength},t.length=function length(){var t;return(null===(t=this.view)||void 0===t?void 0:t.byteLength)||0},t.getBuffer=function getBuffer(){return this.view.buffer},t.popRaw=function popRaw(t){try{var a,c=slice(a=this.buffer).call(a,this.offset,this.offset+t);return this.offset+=t,c}catch(t){throw new Error("UnpackException raw")}},t.popByte=function popByte(){try{var t=this.view.getUint8(this.offset);return this.offset+=1,t}catch(t){throw new Error("UnpackException byte")}},t.popVarbin=function popVarbin(){return this.popRaw(this.popVarInt())},t.popString=function popString(){try{return decodeText(this.popVarbin())}catch(t){throw new Error("UnpackException string")}},t.popInt=function popInt(){try{var t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}catch(t){throw new Error("UnpackException int")}},t.popVarInt=function popVarInt(){var t=1,a=0,c=0;do{a+=(127&(c=this.popByte()))*t,t*=128}while(0!=(128&c));return a},t.popLong=function popLong(){try{var t,a=function getBigUint64(t,a){void 0===a&&(a=!1);var c=new DataView(t.buffer),_=a?[4,0]:[0,4],E=_[0],h=_[1],m=c.getUint32(E,a),g=c.getUint32(h,a);return m>0?m*ip+g:g}(slice(t=this.buffer).call(t,this.offset,this.offset+8),!0);return this.offset+=8,Number(a)}catch(t){throw new Error("UnpackException long")}},t.popShort=function popShort(){try{var t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}catch(t){throw new Error("UnpackException short")}},t.popBoolean=function popBoolean(){return this.popByte()>0},t.toString=function toString(){return Z_(new Uint8Array(this.buffer)).toString()},t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},Unpack}(),sp=function(){function PacketDecoder(t){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.unpack=new ap(t)}var t=PacketDecoder.prototype;return t.reset=function reset(){this.innerHeader=null,this.unpack.reset()},t.unmarshalHeader=function unmarshalHeader(){var t,a=this._unmarshalHeader();this.packetLength=a.packetLength,this.serviceId=a.serviceId,this.commandId=a.commandId,this.serialId=a.serialId,this.tag=a.tag,this.resCode=a.resCode,4===a.serviceId&&includes(t=[1,2,10,11]).call(t,a.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function _unmarshalHeader(){var t=this.unpack.popVarInt(),a=this.unpack.popByte(),c=this.unpack.popByte(),_=this.unpack.popShort(),E=this.unpack.popByte(),h=200;return this.hasRescode(E)&&(h=this.unpack.popShort()),{packetLength:t,serviceId:a,commandId:c,serialId:_,tag:E,resCode:h}},t.hasRescode=function hasRescode(t){return 0!=((t=t||this.tag)&PacketDecoder.RES_CODE)},t.getHeader=function getHeader(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function getInnerHeader(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function unmarshalProperty(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var _=this.unpack.popVarInt(),E=this.unpack.popString();a[_]=E}return a},t.unmarshalPropertyArray=function unmarshalPropertyArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalProperty());return a},t.unmarshalLong=function unmarshalLong(){return this.unpack.popLong()},t.unmarshalLongArray=function unmarshalLongArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popLong());return a},t.unmarshalStrArray=function unmarshalStrArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unpack.popString());return a},t.unmarshalStrLongMap=function unmarshalStrLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var _=this.unpack.popString(),E=this.unpack.popLong();a[_]=E}return a},t.unmarshalStrStrMap=function unmarshalStrStrMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var _=this.unpack.popString(),E=this.unpack.popString();a[_]=E}return a},t.unmarshalLongLongMap=function unmarshalLongLongMap(){for(var t=this.unpack.popVarInt(),a={},c=0;c<t;c++){var _=this.unpack.popLong(),E=this.unpack.popLong();a[_]=E}return{m_map:a}},t.unmarshalKVArray=function unmarshalKVArray(){for(var t=this.unpack.popVarInt(),a=[],c=0;c<t;c++)a.push(this.unmarshalStrStrMap());return a},t.unmarshal=function unmarshal(t){var a,c=this,_=ba(ba({},this.getHeader()),{r:[]});if(this.innerHeader&&(_.r[0]=this.msgId,_.r[1]={body:[],headerPacket:this.getInnerHeader()}),!includes(a=[200,406,808,810,7101]).call(a,_.code))return iu(_);var E=[];return t&&forEach$1(t).call(t,(function(t){if(!c.unpack.checkBufferBoundaryAccess())switch(t.type){case"PropertyArray":E.push(c.unmarshalPropertyArray());break;case"Property":E.push(c.unmarshalProperty());break;case"Byte":E.push(c.unpack.popByte());break;case"Int":E.push(c.unpack.popInt());break;case"Bool":E.push(c.unpack.popBoolean());break;case"Long":E.push(c.unmarshalLong());break;case"LongArray":E.push(c.unmarshalLongArray());break;case"String":E.push(c.unpack.popString());break;case"StrArray":E.push(c.unmarshalStrArray());break;case"StrStrMap":E.push(c.unmarshalStrStrMap());break;case"StrLongMap":E.push(c.unmarshalStrLongMap());break;case"LongLongMap":E.push(c.unmarshalLongLongMap());break;case"KVArray":E.push(c.unmarshalKVArray())}})),this.innerHeader?_.r[1].body=E:_.r=E,iu(_)},PacketDecoder}();sp.RES_CODE=2;var cp=function isUndefined(t){return void 0===t};function getPromiseWithAbort(t){var a={},c=new da((function(t,c){a.abort=c}));return a.promise=da.race([t,c]),a}da.reject;var lp=function(){function PromiseManager(){this.abortFns=[]}var t=PromiseManager.prototype;return t.add=function add(t){var a=getPromiseWithAbort(t);return this.abortFns.push(a.abort),a.promise},t.clear=function clear(t){var a;forEach$1(a=this.abortFns).call(a,(function(a){return a(t||new F_({code:U_.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function destroy(){this.clear()},PromiseManager}(),up={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},_p={timestamp:0,rtt:0,baseClock:0,baseTime:0},dp=function(){function TimeOrigin(t,a,c){void 0===c&&(c="getServerTime"),this.serverOrigin=_p,this.config=up,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=t,this.logger=t.logger,this.promiseManager=new lp,this.cmdName=c,a&&this.setOptions(a)}var t=TimeOrigin.prototype;return t.setOptions=function setOptions(t){this.config=ba({},up,this.config,t)},t.reset=function reset(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=_p,this.currentChance=0},t.setOriginTimetick=function setOriginTimetick(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var t,a,c,_,E,h,m,g,I,T;return Sa.wrap((function _callee$(N){for(;;)switch(N.prev=N.next){case 0:if(this.config.enable){N.next=2;break}return N.abrupt("return");case 2:if(!this.isSettingNTP){N.next=4;break}return N.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){N.next=6;break}return N.abrupt("return");case 6:if(t=Nd(this.core,"auth.status"),a=Nd(this.core,"status"),c=Nd(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===a||c===r_.V2NIM_LOGIN_STATUS_LOGINED){N.next=11;break}return N.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,_="TimeOrigin::setOriginTimetick:",E=Ga(),this.core.logger.log(_+" getServerTime start, times "+this.currentChance),N.prev=18,N.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:m=N.sent,h=Nd(m,"content.time"),this.isSettingNTP=!1,N.next=33;break;case 26:return N.prev=26,N.t0=N.catch(18),g=N.t0,this.isSettingNTP=!1,this.logger.warn(_+" Calculate Delay time, getServerTime error",g),g.code!==U_.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=ns(bind$1(I=this.setOriginTimetick).call(I,this),this.failedDelay)),N.abrupt("return");case 33:if(h){N.next=37;break}return this.core.logger.warn(_+" Calculate Delay time incorrect format"),this.config.enable=!1,N.abrupt("return");case 37:T=Ga()-E,this.doSet(h,T);case 39:case"end":return N.stop()}}),_callee,this,[[18,26]])})))},t.doSet=function doSet(t,a){var c,_="TimeOrigin::setOriginTimetick:";if(a>this.config.tolerantRTT)this.logger.warn(_+" Denied, cause of exceeding the maximum tolerance range of RTT: "+a),this.timer=ns(bind$1(c=this.setOriginTimetick).call(c,this),this.failedDelay);else if(a>this.config.bestRTT){var E;this.serverOrigin.rtt&&a>=this.serverOrigin.rtt?this.logger.log(_+" Denied, cause of current.RTT >= serverOrigin.RTT: "+a):(this.setServerOrigin(a,t),this.logger.log(_+" Accept within maximum tolerance range of RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=ns(bind$1(E=this.setOriginTimetick).call(E,this),this.failedDelay)}else{var h;this.setServerOrigin(a,t),this.logger.log(_+" Accept within best RTT: "+a+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=ns(bind$1(h=this.setOriginTimetick).call(h,this),this.successDelay)}},t.getNTPTime=function getNTPTime(t){if(void 0===t&&(t=this.getTimeNode()),this.checkNodeReliable(t)){var a=Math.floor(t.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+a}return Ga()},t.checkNodeReliable=function checkNodeReliable(t){if(this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var a=t.clock-this.serverOrigin.baseClock,c=t.time-this.serverOrigin.baseTime;return Math.abs(c-a)<500}return!1},t.checkPerformance=function checkPerformance(){return"BROWSER"===zl.platform&&!("undefined"==typeof performance||!performance.now)},TimeOrigin.checkPerformance=function checkPerformance(){return"BROWSER"===zl.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function getTimeNode(){return{clock:this.checkPerformance()?performance.now():0,time:Ga()}},TimeOrigin.getTimeNode=function getTimeNode(){return{clock:TimeOrigin.checkPerformance()?performance.now():0,time:Ga()}},t.setServerOrigin=function setServerOrigin(t,a){this.serverOrigin={timestamp:a+Math.floor(t/2),rtt:t,baseClock:this.checkPerformance()?performance.now():0,baseTime:Ga()}},TimeOrigin}();function _createForOfIteratorHelperLoose$3(t,a){var c,_=void 0!==Qn&&ed(t)||t["@@iterator"];if(_)return bind$1(c=(_=_.call(t)).next).call(c,_);if(td(t)||(_=function _unsupportedIterableToArray$3(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,a);var _=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===_&&t.constructor&&(_=t.constructor.name);if("Map"===_||"Set"===_)return Z_(t);if("Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$3(t,a)}(t))||a&&t&&"number"==typeof t.length){_&&(t=_);var E=0;return function(){return E>=t.length?{done:!0}:{done:!1,value:t[E++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$3(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,_=new Array(a);c<a;c++)_[c]=t[c];return _}var pp={},Ep={};function createCmd(t,a,c,_){var E=pp[t];if(!E)return c.error("createCmd:: can not find cmd config: ",t),null;var h,m={SER:a,SID:E.sid,CID:E.cid,Q:[]};E.params&&_&&forEach$1(h=E.params).call(h,(function(t){var a=_[t.name];if(null!=a){var c=t.type,E=t.reflectMapper,h=t.select;switch(t.type){case"PropertyArray":c="ArrayMable",a=map$7(a).call(a,(function(t){return{t:"Property",v:E?serialize(t,E,h):t}}));break;case"Property":a=E?serialize(a,E,h):a;break;case"Bool":a=a?"true":"false"}m.Q.push({t:c,v:a})}}));return{packet:m,hasPacketResponse:"boolean"!=typeof E.hasPacketResponse||E.hasPacketResponse,hasPacketTimer:"boolean"!=typeof E.hasPacketTimer||E.hasPacketTimer}}function parseCmd(t,a){var c,_;try{_=JSON.parse(t)}catch(c){return void a.error('Parse command error:"'+t+'"')}var E=_.sid+"_"+_.cid,h=_.r;if(includes(c=["4_1","4_2","4_10","4_11"]).call(c,E)){var m=_.r[1].headerPacket;E=m.sid+"_"+m.cid,_.sid=m.sid,_.cid=m.cid,h=_.r[1].body}var g=Ep[E],I=[];if(g){for(var T,N=_createForOfIteratorHelperLoose$3(g);!(T=N()).done;){var M=T.value;I.push(parseEachCmd(_,M.config,M.cmd,h,a))}return I}a.error("parseCmd:: mapper not exist",E,_.code)}function parseEachCmd(t,a,c,_,E){var h,m={cmd:c,raw:t,error:null,service:null==a?void 0:a.service,content:{},__receiveTimeNode:dp.getTimeNode()};if(!c||!a)return m.notFound=!0,m;a.sid>=26&&a.sid<100&&(t.code=function toReadableCode(t){if("number"!=typeof t)throw new F_({code:U_.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:t}});if(t>=0&&t<1e3)return t;if(t>=2e4&&t<=20099)return t;var a=(65535&t)>>9;a-=a<=38?1:2;return 1e5+1e3*a+(511&t)}(t.code));var g,I=function genCmdError(t,a){var c=G_[t],_=j_[t];return null===_?null:new F_({code:t,desc:c||_||t,detail:{cmd:a,timetag:Ga()}})}(t.code,c);if(m.error=I,m.error){if(m.error.detail.cmd=c,!(null===(h=null==a?void 0:a.ignoreErrCodes)||void 0===h?void 0:includes(h).call(h,t.code)))return m;E.warn("parseCmd:: ignore error ",m.error),m.error.detail.ignore=!0}a.response&&forEach$1(g=a.response).call(g,(function(t,a){var c=_[a],E=t.type,h=t.name,g=t.reflectMapper;if(!cp(c))switch(E){case"Property":m.content[h]=g?deserialize(c,g):c;break;case"PropertyArray":m.content[h]=map$7(c).call(c,(function(t){return g?deserialize(t,g):t}));break;case"Int":case"Long":case"Byte":m.content[h]=+c;break;case"Bool":m.content[h]="true"===c||!0===c||1===c;break;default:m.content[h]=c}}));return m}function serialize(t,a,c){var _={};for(var E in t=function flattenObjByMapper(t,a){var c={};for(var _ in a){for(var E,h=a[_],m="number"==typeof h?_:h.access?h.access:_,g=t,I=_createForOfIteratorHelperLoose$3(m.split("."));!(E=I()).done;){var T=E.value;if(void 0===g[T]||null===g[T]){g=void 0;break}g=g[T]}void 0!==g&&(c[m]=g)}return c}(t,a),a){var h=a[E],m="number"==typeof h?E:h.access?h.access:E;c&&!includes(c).call(c,E)||(m in t?"number"==typeof h?_[h]=t[m]:"object"==typeof h&&(h.converter?_[h.id]=h.converter(t[m],t):_[h.id]=t[m]):"object"==typeof h&&h.def&&("function"==typeof h.def?_[h.id]=h.def(t):_[h.id]=h.def))}return _}function deserialize(t,a){var c={};for(var _ in t){var E=a[_];if("string"==typeof E)c[E]=t[_];else if("object"==typeof E&&"prop"in E){var h=E.access?E.access:E.prop;E.converter?c[h]=E.converter(t[_],t):E.type&&"number"===E.type?c[h]=+t[_]:E.type&&"boolean"===E.type?c[h]=!("0"===t[_]||!t[_]):c[h]=t[_]}}for(var m in a){var g=a[m];if(g&&void 0!==g.def){var I=g.access?g.access:g.prop;I in c||("function"==typeof g.def?c[I]=g.def(t):c[I]=g.def)}}return c=function unflattenObj(t){var a={},c=function _loop(c){var _=c.split(".");reduce(_).call(_,(function(a,E,h){return a[E]||(a[E]=isNaN(Number(_[h+1]))?_.length-1==h?t[c]:{}:[])}),a)};for(var _ in t)c(_);return a}(c),c}function registerParser(t){for(var a in ba(pp,t.cmdConfig),t.cmdMap){var c=t.cmdMap[a],_=t.cmdConfig[c];if(_)if(td(Ep[a])){for(var E,h=!1,m=_createForOfIteratorHelperLoose$3(Ep[a]);!(E=m()).done;){var g=E.value;if(g.cmd===c&&g.config.service===_.service){h=!0;break}}h||Ep[a].push({config:_,cmd:c})}else Ep[a]=[{config:_,cmd:c}]}}function invertSerializeItem(t){var a={};for(var c in t){var _=t[c];"number"==typeof _?a[_]=c:"object"==typeof _&&(a[_.id]={prop:c,type:_.retType,access:_.retAccess?_.retAccess:_.access?_.access:c,def:_.retDef,converter:_.retConverter})}return a}function boolToInt(t){return t?1:0}function objectToJSONString(t){if(t&&"object"==typeof t)try{return iu(t)}catch(t){return}}function stringToJSONObject(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){return}}var fp=function(){function Pack(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=Pack.prototype;return t.reset=function reset(){this.offset=0,this.buffer=null,this.view=null},t.size=function size(){return this.offset},t.getBuffer=function getBuffer(){var t;return slice(t=this.buffer).call(t,0,this.offset).buffer},t.ensureCapacity=function ensureCapacity(t){var a=this.offset+t;if(a>this.capacity)throw new Error("PackException over limit");if(a>this.buffer.byteLength){var c=Math.ceil(a/this.pageSize)*this.pageSize,_=new Uint8Array(c);_.set(this.buffer),this.buffer=_,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function putRaw(t){this.ensureCapacity(t.length);try{this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException raw")}},t.putByte=function putByte(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t)}catch(t){throw new Error("PackException byte")}},t.putString=function putString(t){try{var a=encodeText(t);this.putVarbin(a)}catch(t){throw new Error("PackException string")}},t.putInt=function putInt(t){this.ensureCapacity(4);try{this.view.setInt32(this.offset,t,!0),this.offset+=4}catch(t){throw new Error("PackException int")}},t.putVarInt=function putVarInt(t){var a=varintToBytes(t);this.putRaw(a)},t.putBoolean=function putBoolean(t){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,t?1:0)}catch(t){throw new Error("PackException boolean")}},t.putLong=function putLong(t){this.ensureCapacity(8);try{var a=function setBigUint64(t,a){void 0===a&&(a=!1);var c=new Uint8Array(8),_=new DataView(c.buffer),E=Number(t>ip-1?t/ip:0),h=Number(4294967295&t),m=a?[4,0]:[0,4],g=m[0],I=m[1];return _.setUint32(g,E,a),_.setUint32(I,h,a),c}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException long")}},t.putStringAsLong=function putStringAsLong(t){this.ensureCapacity(8);try{var a=function setBigUint64ForNumberOverflow(t,a){var c,_;void 0===a&&(a=!1);var E=new Uint8Array(8),h=new DataView(E.buffer),m=reverse(c=BigNumber(t).divide(ip).number).call(c).join(""),g=reverse(_=BigNumber(t).mod(ip).number).call(_).join(""),I=Number(m),T=Number(g),N=a?[4,0]:[0,4],M=N[0],O=N[1];return h.setUint32(M,I,a),h.setUint32(O,T,a),E}(t,!0);this.buffer.set(a,this.offset),this.offset+=8}catch(t){throw new Error("PackException stringAsLong")}},t.putShort=function putShort(t){this.ensureCapacity(2);try{this.view.setInt16(this.offset,t,!0),this.offset+=2}catch(t){throw new Error("PackException short")}},t.putVarbin=function putVarbin(t){if(!t)return this.ensureCapacity(1),this.putVarInt(0);if(t.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var a=varintToBytes(t.length);this.ensureCapacity(a.length+t.length);try{this.buffer.set(a,this.offset),this.offset+=a.length,this.buffer.set(t,this.offset),this.offset+=t.length}catch(t){throw new Error("PackException varbin")}},Pack}();function isConvertibleToNumber(t){if("number"!=typeof t){if(null==t)return!1;t=Number(t)}if(isNaN(t))throw new Error("Number type conversion error");return!0}function isUndefinedOrNull(t){return null==t}var hp,mp=function(){function PacketEncoder(t,a,c){this.pack=new fp,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=t,this.commandId=a,this.serialId=c}var t=PacketEncoder.prototype;return t.marshalHeader=function marshalHeader(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function marshalProperty(t){var a=this,c=Ja(t),_=filter(c).call(c,(function(t){return!isUndefinedOrNull(t)}));this.pack.putVarInt(_.length),forEach$1(_).call(_,(function(c){a.pack.putVarInt(Number(c)),td(t[c])||"[object Object]"===Object.prototype.toString.call(t[c])?a.pack.putString(iu(t[c])):a.pack.putString(String(t[c]))}))},t.marshalPropertyArray=function marshalPropertyArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalProperty(null==t?void 0:t.v)}))},t.marshalStrArray=function marshalStrArray(t){var a=this,c=filter(t).call(t,(function(t){return!isUndefinedOrNull(t)})),_=c.length;this.pack.putVarInt(_),forEach$1(c).call(c,(function(t){a.pack.putString(String(t))}))},t.marshalLongArray=function marshalLongArray(t){var a=this,c=filter(t).call(t,(function(t){return isConvertibleToNumber(t)})),_=c.length;this.pack.putVarInt(_),forEach$1(c).call(c,(function(t){a.putLong(t)}))},t.marshalStrStrMap=function marshalStrStrMap(t){var a=this,c=Ja(t),_=filter(c).call(c,(function(a){return!isUndefinedOrNull(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(_.length),forEach$1(_).call(_,(function(c){a.pack.putString(String(c)),a.pack.putString(String(t[c]))}))},t.marshalStrLongMap=function marshalStrLongMap(t){var a=this,c=Ja(t),_=filter(c).call(c,(function(a){return isConvertibleToNumber(t[a])&&!isUndefinedOrNull(a)}));this.pack.putVarInt(_.length),forEach$1(_).call(_,(function(c){a.pack.putString(String(c)),a.putLong(t[c])}))},t.marshalLongLongMap=function marshalLongLongMap(t){var a=this,c=Ja(t),_=filter(c).call(c,(function(a){var c=Number(a);return isConvertibleToNumber(c)&&isConvertibleToNumber(t[c])}));this.pack.putVarInt(_.length),forEach$1(_).call(_,(function(c){var _=Number(c);a.putLong(_),a.putLong(t[_])}))},t.marshalKVArray=function marshalKVArray(t){var a=this,c=t.length;this.pack.putVarInt(c),forEach$1(t).call(t,(function(t){a.marshalStrStrMap(t)}))},t.putLong=function putLong(t){"string"==typeof t&&t.length>15?this.pack.putStringAsLong(t):this.pack.putLong(Number(t))},t.marshal=function marshal(t,a){var c=this;return this.marshalHeader(),a&&forEach$1(a).call(a,(function(a,_){var E,h=a.type,m=null===(E=t[_])||void 0===E?void 0:E.v;if(!isUndefinedOrNull(m))switch(h){case"PropertyArray":c.marshalPropertyArray(m);break;case"Property":c.marshalProperty(m);break;case"Byte":if(!isConvertibleToNumber(m))return;c.pack.putByte(Number(m));break;case"Int":if(!isConvertibleToNumber(m))return;c.pack.putInt(Number(m));break;case"Bool":"false"===m?m=!1:"true"===m&&(m=!0),c.pack.putBoolean(m);break;case"Long":if(!isConvertibleToNumber(m))return;c.putLong(m);break;case"LongArray":c.marshalLongArray(m);break;case"String":c.pack.putString(String(m));break;case"StrArray":c.marshalStrArray(m);break;case"StrStrMap":c.marshalStrStrMap(m);break;case"StrLongMap":c.marshalStrLongMap(m);break;case"LongLongMap":c.marshalLongLongMap(m);break;case"KVArray":c.marshalKVArray(m)}})),this.pack.getBuffer()},t.reset=function reset(){this.pack.reset()},PacketEncoder}(),gp=function(t){function BaseWebsocket(a,c){var _;return(_=t.call(this)||this).url=c,_.websocket=null,_.socketConnectTimer=0,_.core=a,_.url=c,_.status="disconnected",_.logger=a.logger,_.connect(),_}yt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket("wss://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect")}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=ns((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("connectFailed",new F_({code:"v2"===Nd(c.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new zl.WebSocket(t),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(){c.logger.log("imsocket::Websocket onclose done"),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new F_({code:"v2"===Nd(c.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"connected"===c.status?(c.clean(),c.emit("disconnect")):(c.clean(),c.emit("connectFailed",new F_({code:"v2"===Nd(c.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){c.onConnect()}},a.onMessage=function onMessage(t){if(t.data){var a=new sp(t.data),c={sid:-1,cid:-1,ser:-1,packetLength:-1},_=null;try{a.unmarshalHeader(),c=a.getHeader(),_=a.getInnerHeader()}catch(t){this.reportBinaryError({err:t,sid:_?_.sid:null==c?void 0:c.sid,cid:_?_.cid:null==c?void 0:c.cid,type:"decode"})}var E=_?_.sid:c.sid,h=_?_.cid:c.cid,m=E+"_"+h,g=Ep[m];if(g&&g.length>0){var I,T=g[0].config;try{I=a.unmarshal(T.response)}catch(t){this.reportBinaryError({err:t,sid:E,cid:h,type:"decode"}),a.reset();var N=ba(ba({},c),{sid:E,cid:h,code:U_.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+N.sid+"_"+N.cid+'", ser '+N.ser+", packetLength "+N.packetLength+" unmarshal error",t),void this.emit("message",iu(N))}this.emit("message",I)}else this.core.logger.warn("imsocket::onMessage cmd not found",m);a.reset()}},a.send=function send(t,a,c,_,E){var h,m,g=new mp(t,a,c),I=pp[_],T="";try{T=iu(E),m=g.marshal(JSON.parse(T),I.params)}catch(_){throw this.reportBinaryError({err:_,sid:t,cid:a,rawStr:T,type:"encode"}),g.reset(),new F_({code:U_.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:t+"-"+a+", ser "+c+" marshal error",rawError:_}})}null===(h=this.websocket)||void 0===h||h.send(m),g.reset()},a.reportBinaryError=function reportBinaryError(t){var a,c,_=t.err,E=t.rawStr,h=t.sid,m=t.cid,g=t.type;this.core.reporter.reportTraceStart("exceptions",{user_id:null===(a=this.core.auth)||void 0===a?void 0:a.account,trace_id:null===(c=this.core.clientSocket.socket)||void 0===c?void 0:c.sessionId,start_time:Ga(),action:2,exception_service:9}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===g?U_.V2NIM_ERROR_CODE_PACK_ERROR:U_.V2NIM_ERROR_CODE_UNPACK_ERROR,description:_&&(_.message||""+_.code)+" rawObj: "+E,operation_type:"encode"===g?3:4,target:h+"-"+m},{asyncParams:zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},BaseWebsocket}(nd);function _createForOfIteratorHelperLoose$2(t,a){var c,_=void 0!==Qn&&ed(t)||t["@@iterator"];if(_)return bind$1(c=(_=_.call(t)).next).call(c,_);if(td(t)||(_=function _unsupportedIterableToArray$2(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var _=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===_&&t.constructor&&(_=t.constructor.name);if("Map"===_||"Set"===_)return Z_(t);if("Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$2(t,a)}(t))||a&&t&&"number"==typeof t.length){_&&(t=_);var E=0;return function(){return E>=t.length?{done:!0}:{done:!1,value:t[E++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,_=new Array(a);c<a;c++)_[c]=t[c];return _}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(hp||(hp={}));var Ip,Tp=function(){function V2BinaryClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new rd({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Ru,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2BinaryClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,_;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Sa.mark((function _callee(){var E,h,m,g;return Sa.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:if(this.isReconnect=a,(E=this.core.auth.getConnectStatus())!==a_.V2NIM_CONNECT_STATUS_CONNECTED){I.next=7;break}return h="clientSocket::connect status is "+E+", and would not repeat connect",m=new F_({code:U_.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:h}}),this.logger.warn(h),I.abrupt("return",da.reject(m));case 7:return this.auth.lifeCycle.processEvent("connect"),I.prev=8,I.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:zl.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),I.next=28;break;case 16:if(I.prev=16,I.t0=I.catch(8),g=I.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:g.code||0,description:"connectFailed:"+g.message,mixlink:!0,succeed:!1},{asyncParams:zl.net.getNetworkStatus()}),g.code!==U_.V2NIM_ERROR_CODE_CANCELLED&&g.code!==U_.V2NIM_ERROR_CODE_TIMEOUT){I.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(_=this.socket)||void 0===_||_.removeAllListeners(),this.socket=void 0,I.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,g),this.auth.lifeCycle.processEvent("connectFail",g),I.t0;case 28:case"end":return I.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new da((function(_,E){var h;a.socket=new gp(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"",operation_type:0,target:t}),c=!0,_()})),a.socket.on("message",bind$1(h=a.onMessage).call(h,a)),a.socket.on("disconnect",(function(_){return __awaiter(a,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",_),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==_?void 0:_.code)||0,description:(null==_?void 0:_.reason)||"",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(hp.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("connectFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::connectFailed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,E(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==a_.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new F_({code:U_.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===hp.ACTIVE||t===hp.KICKED?this.destroyOnlineListener():t===hp.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new F_({code:U_.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var _=this,E=this.core.auth.getLoginStatus(),h=["v2Login","login","chatroomLogin","v2ChatroomLogin"],m={cmd:t};if(E!==r_.V2NIM_LOGIN_STATUS_LOGINED&&!includes(h).call(h,t))return this.logger.warn("clientSocketV2::NIM login status is "+E+", so can not sendCmd "+t),da.reject(new F_({code:U_.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:ba({reason:"Can not sendCmd due to no logined"},m)}));var g="heartbeat"!==t,I=g?this.packetSer++:0,T=createCmd(t,I,this.logger,a);if(!T){var N=new F_({code:U_.V2NIM_ERROR_CODE_INTERNAL,detail:ba(ba({},m),{reason:"SendCmd::createCmd error: "+I+" "+t})});return this.logger.error(N),da.reject(N)}var M=T.packet,O=T.hasPacketResponse,S=T.hasPacketTimer,A=iu(M);g&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+I,A):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+I));var C=(new Date).getTime();return new da((function(E,h){O&&_.sendingCmdMap.set(I,{cmd:t,params:a,callback:[E,h],timer:S?ns((function(){var a=new F_({code:U_.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:ba({ser:I,reason:"Packet Timeout: ser "+I+" cmd "+t,timetag:(new Date).getTime()},m)});_.markCmdInvalid(I,a,t)}),c&&c.timeout?c.timeout:_.packetTimeout):null});try{_.socket.send(M.SID,M.CID,I,t,M.Q),O||E(M)}catch(a){var g=new F_({code:U_.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:ba({ser:I,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},m)});_.markCmdInvalid(I,g,t),h(g)}})).catch((function(t){return __awaiter(_,void 0,void 0,Sa.mark((function _callee3(){var a,c;return Sa.wrap((function _callee3$(_){for(;;)switch(_.prev=_.next){case 0:if(a=t,c=[U_.V2NIM_ERROR_CODE_DISCONNECT,U_.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,U_.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(c).call(c,a.code)){_.next=4;break}return _.abrupt("return",da.reject(a));case 4:return this.reportSendCmdFailed(a,{sid:M.SID,cid:M.CID,ser:I},C),_.abrupt("return",da.reject(a));case 6:case"end":return _.stop()}}),_callee3,this)})))}))},t.reportSendCmdFailed=function reportSendCmdFailed(t,a,c){var _;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(_=this.socket)||void 0===_?void 0:_.sessionId,start_time:c,action:2,exception_service:6});var E=Nd(t,"detail.disconnect_reason")||"",h=t.code===U_.V2NIM_ERROR_CODE_DISCONNECT?iu({disconnect_reason:E}):t.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:t.code,description:h,operation_type:1,target:a.sid+"-"+a.cid,context:""+a.ser},{asyncParams:zl.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,_=_createForOfIteratorHelperLoose$2(a);!(c=_()).done;){var E=c.value,h=E.raw.ser;if(E.error&&this.logger.error("clientSocketV2::onMessage packet error",E.raw.sid+"_"+E.raw.cid+", ser:"+h+",",E.error),E.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",E.raw.sid+"_"+E.raw.cid+", ser:"+h);"heartbeat"!==E.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+h,E.cmd,E.content):this.logger.log("clientSocketV2::recvCmd ser:"+h,E.cmd)),this.packetHandler(E)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var _=t.raw.ser,E=this.sendingCmdMap.get(_);if(E&&E.cmd===t.cmd){var h=E.callback,m=E.timer,g=E.params;if(clearTimeout(m),t.params=g,this.sendingCmdMap.delete(_),"heartbeat"===t.cmd)return void h[0]();var I=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);I&&"function"==typeof I.then?I.then((function(t){h[0](t)})).catch((function(t){h[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),h[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var _=this.sendingCmdMap.get(t);if(_){var E=_.callback,h=_.timer;h&&clearTimeout(h),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),E[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var _=a.callback,E=a.timer,h=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+h),E&&clearTimeout(E),_[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a=this;return Sa.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==U_.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(hp.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=ns((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var t;return Sa.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,zl.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),_=t.auth.getLoginStatus();a.isConnected&&_===r_.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===a_.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(hp.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),zl.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2BinaryClientSocket}(),Np=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],vp=["transport not supported","client not handshaken","unauthorized"],Mp=["reconnect"],Op=function(t){function BaseWebsocket(a,c){var _;return(_=t.call(this)||this).url=c,_.websocket=null,_.socketConnectTimer=0,_.core=a,_.url=c,_.status="disconnected",_.logger=a.logger,_.connect(),_}yt(BaseWebsocket,t);var a=BaseWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+Ga(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(a){if("connecting"===t.status){var c=a.data.split(":"),_=c[0];return c[1],t.sessionId=_,t.logger.log("imsocket::XHR success. status "+t.status+", "+("connecting"===t.status?"continue websocket connection":"stop websocket connection")),t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+_)}})).catch((function(a){if("connecting"===t.status){var c='imsocket::XHR fail. raw message: "'+(a=a||{}).message+'", code: "'+a.code+'"',_=a.code;_="v2"===Nd(t.core,"options.apiVersion")?a.code===U_.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?U_.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:U_.V2NIM_ERROR_CODE_CONNECT_FAILED:408===a.code?408:415;var E=new F_({code:_,detail:{reason:c,rawError:a}});t.logger.error(c),t.status="disconnected",t.emit("handshakeFailed",E)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(t){this.logger.warn("imsocket::attempt to send encodePacket error",t)}try{this.websocket.close()}catch(t){this.logger.warn("imsocket::attempt to close websocket error",t)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},a.clean=function clean(){this.status="disconnected",this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},a.onConnect=function onConnect(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},a._createWebsocket=function _createWebsocket(t){var a,c=this;this.socketConnectTimer=ns((function(){c.logger.error("imsocket::Websocket connect timeout. url: ",c.socketUrl),c.emit("handshakeFailed",new F_({code:"v2"===Nd(c.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+c.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=t,this.websocket=new zl.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(t){var a=(null==t?void 0:t.reason)||(null==t?void 0:t.message)||(null==t?void 0:t.errMsg)||"websocket.onclose";c.logger.log("imsocket::Websocket onclose done. code is "+(null==t?void 0:t.code)+" and reason is "+a),c.clean(),c.emit("disconnect",{code:(null==t?void 0:t.code)||0,reason:a})},this.websocket.onerror=function(t){c.logger.error("imsocket::Websocket onerror",t),"logined"===c.core.status&&c.core.clientSocket.ping()}},a.onMessage=function onMessage(t){var a,c=this.decodePacket(t.data);if(c)switch(c.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",c.data);break;case"event":c.name&&this.emit(c.name,c.args);break;case"error":"unauthorized"===c.reason?this.emit("connect_failed",c.reason):this.emit("error",c.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new F_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",c.type)}},a.encodePacket=function encodePacket(t){var a,c,_=t.type,E=t.id,h=void 0===E?"":E,m=t.endpoint,g=void 0===m?"":m,I=t.ack,T=null;if(!_)return"";switch(_){case"error":a=t.reason?indexOf(vp).call(vp,t.reason):"",c=t.advice?indexOf(Mp).call(Mp,t.advice):"",""===a&&""===c||(T=a+(""!==c?"+"+c:""));break;case"message":""!==t.data&&(T=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},T=iu(a);break;case"json":T=iu(t.data);break;case"connect":t.qs&&(T=t.qs);break;case"ack":T=t.ackId+(t.args&&t.args.length?"+"+iu(t.args):"")}var N=[indexOf(Np).call(Np,_),h+("data"===I?"+":""),g];return null!=T&&N.push(T),N.join(":")},a.decodePacket=function decodePacket(t){if(t)if("�"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var c,_=a[1],E=a[2],h=a[3],m=a[4],g=a[5],I={type:Np[+_],endpoint:m};switch(E&&(I.id=E,I.ack=!h||"data"),I.type){case"error":c=g.split("+"),I.reason=vp[+c[0]]||"";break;case"message":I.data=g||"";break;case"connect":I.qs=g||"";break;case"event":try{var T=JSON.parse(g);I.name=T.name,I.args=T.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}I.args=I.args||[];break;case"json":try{I.data=JSON.parse(g)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((c=g.match(/^([0-9]+)(\+)?(.*)/))&&(I.ackId=c[1],I.args=[],c[3]))try{I.args=c[3]?JSON.parse(c[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return I}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))},a.send=function send(t){var a,c={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(c))},BaseWebsocket}(nd);function _createForOfIteratorHelperLoose$1(t,a){var c,_=void 0!==Qn&&ed(t)||t["@@iterator"];if(_)return bind$1(c=(_=_.call(t)).next).call(c,_);if(td(t)||(_=function _unsupportedIterableToArray$1(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var _=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===_&&t.constructor&&(_=t.constructor.name);if("Map"===_||"Set"===_)return Z_(t);if("Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){_&&(t=_);var E=0;return function(){return E>=t.length?{done:!0}:{done:!1,value:t[E++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,_=new Array(a);c<a;c++)_[c]=t[c];return _}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(Ip||(Ip={}));var Sp,Ap,Cp=function(){function V2ClientSocket(t){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new rd({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new Ru,this.pingTimer=0,this.hasNetworkListener=!1,this.core=t,this.auth=t.auth,this.logger=t.logger,this.reporter=t.reporter,this.timerManager=t.timerManager,this.eventBus=t.eventBus,this.setListener()}var t=V2ClientSocket.prototype;return t.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.isReconnect=!0}))},t.setSessionId=function setSessionId(t){this.socket&&(this.socket.sessionId=t)},t.connect=function connect(t,a){var c,_;return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Sa.mark((function _callee(){var E,h,m,g;return Sa.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:if(this.isReconnect=a,(E=this.core.auth.getConnectStatus())!==a_.V2NIM_CONNECT_STATUS_CONNECTED){I.next=7;break}return h="clientSocket::connect status is "+E+", and would not repeat connect",m=new F_({code:U_.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:h}}),this.logger.warn(h),I.abrupt("return",da.reject(m));case 7:return this.auth.lifeCycle.processEvent("connect"),I.prev=8,I.next=11,this.auth.doLoginStepsManager.add(this.doConnect(t));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+t+", isReconnect: "+a),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:200,mixlink:!0,succeed:!0},{asyncParams:zl.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),I.next=28;break;case 16:if(I.prev=16,I.t0=I.catch(8),g=I.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:g.code||0,description:"connectFailed:"+g.message,mixlink:!0,succeed:!1},{asyncParams:zl.net.getNetworkStatus()}),g.code!==U_.V2NIM_ERROR_CODE_CANCELLED&&g.code!==U_.V2NIM_ERROR_CODE_TIMEOUT){I.next=25;break}throw null===(c=this.socket)||void 0===c||c.close(),null===(_=this.socket)||void 0===_||_.removeAllListeners(),this.socket=void 0,I.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+t,g),this.auth.lifeCycle.processEvent("connectFail",g),I.t0;case 28:case"end":return I.stop()}}),_callee,this,[[8,16]])})))},t.doConnect=function doConnect(t){var a=this,c=!1;return new da((function(_,E){var h;a.socket=new Op(a.core,t),a.socket.on("connect",(function(){a.logger.log("clientSocketV2::socket on connect",t),a.core.reporterHookLinkKeep.start(),a.core.reporterHookLinkKeep.update({code:0,description:"",operation_type:0,target:t}),c=!0,_()})),a.socket.on("message",bind$1(h=a.onMessage).call(h,a)),a.socket.on("disconnect",(function(_){return __awaiter(a,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,this.logger.log("clientSocketV2::socket on disconnect",_),a.next=4,this.core.reporterHookLinkKeep.update({code:(null==_?void 0:_.code)||0,description:(null==_?void 0:_.reason)||"",operation_type:1,target:t});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Ip.OFFLINE,"SocketOnDisconnect");case 6:case"end":return a.stop()}}),_callee2,this)})))})),a.socket.on("handshakeFailed",(function(t){c?a.ping():(a.logger.error('clientSocketV2::handshake failed: "'+(t&&t.message)+'"'),a.cleanSocket()),c=!0,E(t)}))}))},t.cleanSocket=function cleanSocket(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function resetSocketConfig(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function doDisconnect(t,a){if(this.logger.log("clientSocketV2::doDisconnect: type "+t+", reason ",a),this.core.auth.getConnectStatus()!==a_.V2NIM_CONNECT_STATUS_DISCONNECTED){var c={1:"close",2:"kicked",3:"broken"}[t]||"";this.markAllCmdInvaild(new F_({code:U_.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),t===Ip.ACTIVE||t===Ip.KICKED?this.destroyOnlineListener():t===Ip.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new F_({code:U_.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function sendCmd(t,a,c){var _=this,E=this.core.auth.getLoginStatus(),h=["v2Login","login","chatroomLogin","v2ChatroomLogin"],m={cmd:t};if(E!==r_.V2NIM_LOGIN_STATUS_LOGINED&&!includes(h).call(h,t))return this.logger.warn("clientSocketV2::NIM login status is "+E+", so can not sendCmd "+t),da.reject(new F_({code:U_.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:ba({reason:"Can not sendCmd due to no logined"},m)}));var g="heartbeat"!==t,I=g?this.packetSer++:0,T=createCmd(t,I,this.logger,a);if(!T){var N=new F_({code:U_.V2NIM_ERROR_CODE_INTERNAL,detail:ba(ba({},m),{reason:"SendCmd::createCmd error: "+I+" "+t})});return this.logger.error(N),da.reject(N)}var M=T.packet,O=T.hasPacketResponse,S=T.hasPacketTimer,A=iu(M);g&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::sendCmd",t,"ser:"+I,A):this.logger.log("clientSocketV2::sendCmd",t,"ser:"+I));var C=(new Date).getTime();return new da((function(E,h){O&&_.sendingCmdMap.set(I,{cmd:t,params:a,callback:[E,h],timer:S?ns((function(){var a=new F_({code:U_.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:ba({ser:I,reason:"Packet Timeout: ser "+I+" cmd "+t,timetag:(new Date).getTime()},m)});_.markCmdInvalid(I,a,t)}),c&&c.timeout?c.timeout:_.packetTimeout):null});try{_.socket.send(A),O||E(M)}catch(a){var g=new F_({code:U_.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:ba({ser:I,reason:"Unable to send packet"+(a&&a.message?": "+a.message:""),timetag:(new Date).getTime(),rawError:a},m)});_.markCmdInvalid(I,g,t),h(g)}})).catch((function(t){return __awaiter(_,void 0,void 0,Sa.mark((function _callee3(){var a,c,_,E,h;return Sa.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if(c=t,_=[U_.V2NIM_ERROR_CODE_DISCONNECT,U_.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,U_.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],includes(_).call(_,c.code)){m.next=4;break}return m.abrupt("return",da.reject(c));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(a=this.socket)||void 0===a?void 0:a.sessionId,start_time:C,action:2,exception_service:6}),E=Nd(c,"detail.disconnect_reason")||"",h=c.code===U_.V2NIM_ERROR_CODE_DISCONNECT?iu({disconnect_reason:E}):c.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:c.code,description:h,operation_type:1,target:M.SID+"-"+M.CID,context:""+M.SER},{asyncParams:zl.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),m.abrupt("return",da.reject(c));case 10:case"end":return m.stop()}}),_callee3,this)})))}))},t.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a)for(var c,_=_createForOfIteratorHelperLoose$1(a);!(c=_()).done;){var E=c.value,h=E.raw.ser;if(E.error&&this.logger.error("clientSocketV2::onMessage packet error",E.raw.sid+"_"+E.raw.cid+", ser:"+h+",",E.error),E.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",E.raw.sid+"_"+E.raw.cid+", ser:"+h);"heartbeat"!==E.cmd&&("debug"===this.core.options.debugLevel?this.logger.debug("clientSocketV2::recvCmd ser:"+h,E.cmd,E.content):this.logger.log("clientSocketV2::recvCmd ser:"+h,E.cmd)),this.packetHandler(E)}},t.packetHandler=function packetHandler(t){var a,c;if(t){var _=t.raw.ser,E=this.sendingCmdMap.get(_);if(E&&E.cmd===t.cmd){var h=E.callback,m=E.timer,g=E.params;if(clearTimeout(m),t.params=g,this.sendingCmdMap.delete(_),"heartbeat"===t.cmd)return void h[0]();var I=null===(a=this.core[t.service])||void 0===a?void 0:a.process(t);I&&"function"==typeof I.then?I.then((function(t){h[0](t)})).catch((function(t){h[1](t)})):(this.logger.log("clientSocketV2::handlerFn without promise",t.service,t.cmd),h[0](t))}else null===(c=this.core[t.service])||void 0===c||c.process(t)}},t.markCmdInvalid=function markCmdInvalid(t,a,c){var _=this.sendingCmdMap.get(t);if(_){var E=_.callback,h=_.timer;h&&clearTimeout(h),this.sendingCmdMap.delete(t),this.logger.warn("clientSocketV2::packet "+t+", "+c+" is invalid:",a),E[1](a)}},t.markAllCmdInvaild=function markAllCmdInvaild(t){var a,c=this;this.logger.log("markAllCmdInvaild",t),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var _=a.callback,E=a.timer,h=a.cmd;c.logger.debug("clientSocketV2::markAllCmdInvaild:cmd "+h),E&&clearTimeout(E),_[1](t)})),this.sendingCmdMap.clear()},t.ping=function ping(){var t;return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a=this;return Sa.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return clearTimeout(this.pingTimer),c.prev=1,c.next=4,this.sendCmd("heartbeat");case 4:c.next=20;break;case 6:if(c.prev=6,c.t0=c.catch(1),c.t0.code!==U_.V2NIM_ERROR_CODE_DISCONNECT){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,this.testHeartBeat5Timeout();case 13:if(!c.sent){c.next=20;break}return c.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(t=this.socket)||void 0===t?void 0:t.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Ip.OFFLINE,"PingError"),c.abrupt("return");case 20:this.pingTimer=ns((function(){a.ping()}),3e4);case 21:case"end":return c.stop()}}),_callee4,this,[[1,6]])})))},t.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var t;return Sa.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee5,this,[[3,9]])})))},t.initOnlineListener=function initOnlineListener(){var t=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,zl.net.onNetworkStatusChange((function(a){t.logger.log("clientSocketV2::onlineListener:network change",a);var c=t.auth.getConnectStatus(),_=t.auth.getLoginStatus();a.isConnected&&_===r_.V2NIM_LOGIN_STATUS_LOGINED?t.ping():a.isConnected&&c===a_.V2NIM_CONNECT_STATUS_WAITING?(t.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),t.auth.reconnect.clearReconnectTimer(),t.auth.reconnect.doReLogin()):a.isConnected||t.doDisconnect(Ip.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function destroyOnlineListener(){this.logger.log("clientSocketV2::onlineListener:destroy"),zl.net.offNetworkStatusChange(),this.hasNetworkListener=!1},V2ClientSocket}();function _createForOfIteratorHelperLoose(t,a){var c,_=void 0!==Qn&&ed(t)||t["@@iterator"];if(_)return bind$1(c=(_=_.call(t)).next).call(c,_);if(td(t)||(_=function _unsupportedIterableToArray(t,a){var c;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var _=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);"Object"===_&&t.constructor&&(_=t.constructor.name);if("Map"===_||"Set"===_)return Z_(t);if("Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){_&&(t=_);var E=0;return function(){return E>=t.length?{done:!0}:{done:!1,value:t[E++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,_=new Array(a);c<a;c++)_[c]=t[c];return _}!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac",t[t.HarmonyOS=65]="HarmonyOS"}(Sp||(Sp={})),function(t){t.Destroy="destroy",t.Logout="logout"}(Ap||(Ap={}));var Rp=function(){function TimerManager(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,c){void 0===a&&(a=0),void 0===c&&(c=1);var _=(new Date).getTime(),E=this.id;return this.timerList.push({id:E,loop:c,count:0,timeout:_+a,interval:a,callback:t}),this.id++,this.checkTimer(_),E},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,c,_=0,E=_createForOfIteratorHelperLoose(this.timerList);!(a=E()).done;){var h=a.value;(0===_||_>h.timeout)&&(_=h.timeout)}if(0!==this.timerList.length)if(null===this.timer||_<this.timeout||this.timeout<t)this.timer=ns(bind$1(c=this.nowTime).call(c,this),_-t),this.timeout=_}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose(this.timerList);!(t=a()).done;){var c=t.value;nowTime>=c.timeout&&(c.callback(),c.count++,c.timeout=nowTime+c.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var c;if(this.timerList[a].id===t)splice(c=this.timerList).call(c,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,c=this.timerList[t];if(c.loop>=0&&c.count>=c.loop)splice(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},TimerManager}(),yp=function(){function CoreAdapters(t){this.core=t}var t=CoreAdapters.prototype;return t.getFileUploadInformation=function getFileUploadInformation(t){return zl.getFileUploadInformation(t)},t.request=function request(t,a,c){var _=this,E=(new Date).getTime(),h=(null==c?void 0:c.exception_service)||0;return zl.request(t,a).catch((function(c){var m,g,I,T,N=c;throw _.core.reporter.reportTraceStart("exceptions",{user_id:_.core.options.account||(null===(g=null===(m=_.core)||void 0===m?void 0:m.auth)||void 0===g?void 0:g.account),trace_id:null===(T=null===(I=_.core.clientSocket)||void 0===I?void 0:I.socket)||void 0===T?void 0:T.sessionId,start_time:E,action:1,exception_service:h}),_.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof N.code?N.code:0,description:N.message||""+N.code,operation_type:0,target:t,context:a?iu(a):""},{asyncParams:zl.net.getNetworkStatus()}),_.core.reporter.reportTraceEnd("exceptions",1),c}))},t.uploadFile=function uploadFile(t){var a=this,c=(new Date).getTime();return zl.uploadFile(t).catch((function(_){var E,h,m,g,I=_;a.core.reporter.reportTraceStart("exceptions",{user_id:a.core.options.account||(null===(h=null===(E=a.core)||void 0===E?void 0:E.auth)||void 0===h?void 0:h.account),trace_id:null===(g=null===(m=a.core.clientSocket)||void 0===m?void 0:m.socket)||void 0===g?void 0:g.sessionId,start_time:c,action:1,exception_service:3});var T="BROWSER"===zl.platform?t.chunkUploadHost:t.commonUploadHost?t.commonUploadHost+"/"+(t.nosToken&&t.nosToken.bucket):"https://nos.netease.com/nim";throw a.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof I.code?I.code:0,description:I.message||""+I.code,operation_type:1,target:T},{asyncParams:zl.net.getNetworkStatus()}),a.core.reporter.reportTraceEnd("exceptions",1),_}))},CoreAdapters}(),bp=Math.min,Dp=[].lastIndexOf,kp=!!Dp&&1/[1].lastIndexOf(1,-0)<0,Vp=arrayMethodIsStrict("lastIndexOf"),Lp=kp||!Vp?function lastIndexOf(t){if(kp)return T(Dp,this,arguments)||0;var a=toIndexedObject(this),c=lengthOfArrayLike(a),_=c-1;for(arguments.length>1&&(_=bp(_,toIntegerOrInfinity(arguments[1]))),_<0&&(_=c+_);_>=0;_--)if(_ in a&&a[_]===t)return _||0;return-1}:Dp;_export({target:"Array",proto:!0,forced:Lp!==[].lastIndexOf},{lastIndexOf:Lp});var Pp=entryVirtual("Array").lastIndexOf,wp=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===wp||j(wp,t)&&a===wp.lastIndexOf?Pp:a},xp=bc(Object.keys,Object),Up=Object.prototype.hasOwnProperty;var Gp=function baseKeys(t){if(!Vc(t))return xp(t);var a=[];for(var c in Object(t))Up.call(t,c)&&"constructor"!=c&&a.push(c);return a};var Fp,Bp=function keys$8(t){return jc(t)?El(t):Gp(t)},Hp=Vl((function(t,a,c,_){ll(a,Bp(a),t,_)})),Yp=(Fp=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Fp()+Fp()+Fp()+Fp()+Fp()+Fp()+Fp()+Fp()});function getEnumValues(t){var a,c;return map$7(a=filter(c=Ja(t)).call(c,(function(t){return+t>=0}))).call(a,(function(t){return jd(t)}))}function assignOptions(t,a){return Hp({},t,a,(function(t,a){return cp(a)?t:a}))}function getFileExtension(t){var a=lastIndexOf(t).call(t,".");return a>-1?slice(t).call(t,a):""}var jp,Kp,Wp,qp,zp,$p,Xp=function(){function ABTest(t,a){this.abtInfo={},this.core=t,this.config=assignOptions({isAbtestEnable:!0,abtestUrl:$_,abtestProjectKey:X_},a)}var t=ABTest.prototype;return t.setOptions=function setOptions(t){this.config=assignOptions(this.config,t)},t.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var c;return Sa.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:if(this.config.isAbtestEnable){_.next=2;break}return _.abrupt("return");case 2:if(!this.abtInfo.experiments){_.next=4;break}return _.abrupt("return");case 4:if(this.config.abtestUrl){_.next=6;break}return _.abrupt("return");case 6:return _.prev=6,_.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.2.700",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:c=_.sent,_.next=15;break;case 12:_.prev=12,_.t0=_.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==c?void 0:c.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{};case 16:case"end":return _.stop()}}),_callee,this,[[6,12]])})))},ABTest}();!function(t){t[t.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",t[t.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",t[t.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(jp||(jp={})),function(t){t[t.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",t[t.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",t[t.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",t[t.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(Kp||(Kp={})),function(t){t[t.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",t[t.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",t[t.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",t[t.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",t[t.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",t[t.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",t[t.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",t[t.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",t[t.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(Wp||(Wp={})),function(t){t[t.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",t[t.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(qp||(qp={})),function(t){t[t.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",t[t.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",t[t.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(zp||(zp={})),function(t){t[t.V2NIM_CHATROOM_KICKED_REASON_UNKNOWN=-1]="V2NIM_CHATROOM_KICKED_REASON_UNKNOWN",t[t.V2NIM_CHATROOM_KICKED_REASON_CHATROOM_INVALID=1]="V2NIM_CHATROOM_KICKED_REASON_CHATROOM_INVALID",t[t.V2NIM_CHATROOM_KICKED_REASON_BY_MANAGER=2]="V2NIM_CHATROOM_KICKED_REASON_BY_MANAGER",t[t.V2NIM_CHATROOM_KICKED_REASON_BY_CONFLICT_LOGIN=3]="V2NIM_CHATROOM_KICKED_REASON_BY_CONFLICT_LOGIN",t[t.V2NIM_CHATROOM_KICKED_REASON_SILENTLY=4]="V2NIM_CHATROOM_KICKED_REASON_SILENTLY",t[t.V2NIM_CHATROOM_KICKED_REASON_BE_BLOCKED=5]="V2NIM_CHATROOM_KICKED_REASON_BE_BLOCKED"}($p||($p={}));var Jp=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Qp=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,c=null==t?0:t.length;for(this.__data__=new hc;++a<c;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Jp,SetCache.prototype.has=Qp;var Zp=SetCache;var eE=function arraySome(t,a){for(var c=-1,_=null==t?0:t.length;++c<_;)if(a(t[c],c,t))return!0;return!1};var tE=function cacheHas(t,a){return t.has(a)};var rE=function equalArrays(t,a,c,_,E,h){var m=1&c,g=t.length,I=a.length;if(g!=I&&!(m&&I>g))return!1;var T=h.get(t),N=h.get(a);if(T&&N)return T==a&&N==t;var M=-1,O=!0,S=2&c?new Zp:void 0;for(h.set(t,a),h.set(a,t);++M<g;){var A=t[M],C=a[M];if(_)var R=m?_(C,A,M,a,t,h):_(A,C,M,t,a,h);if(void 0!==R){if(R)continue;O=!1;break}if(S){if(!eE(a,(function(t,a){if(!tE(S,a)&&(A===t||E(A,t,c,_,h)))return S.push(a)}))){O=!1;break}}else if(A!==C&&!E(A,C,c,_,h)){O=!1;break}}return h.delete(t),h.delete(a),O};var nE=function mapToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t,_){c[++a]=[_,t]})),c};var oE=function setToArray(t){var a=-1,c=Array(t.size);return t.forEach((function(t){c[++a]=t})),c},iE=Cs?Cs.prototype:void 0,aE=iE?iE.valueOf:void 0;var sE=function equalByTag(t,a,c,_,E,h,m){switch(c){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!h(new Oc(t),new Oc(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ds(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var g=nE;case"[object Set]":var I=1&_;if(g||(g=oE),t.size!=a.size&&!I)return!1;var T=m.get(t);if(T)return T==a;_|=2,m.set(t,a);var N=rE(g(t),g(a),_,E,h,m);return m.delete(t),N;case"[object Symbol]":if(aE)return aE.call(t)==aE.call(a)}return!1};var cE=function arrayPush(t,a){for(var c=-1,_=a.length,E=t.length;++c<_;)t[E+c]=a[c];return t};var lE=function baseGetAllKeys(t,a,c){var _=a(t);return Hc(t)?_:cE(_,c(t))};var uE=function arrayFilter(t,a){for(var c=-1,_=null==t?0:t.length,E=0,h=[];++c<_;){var m=t[c];a(m,c,t)&&(h[E++]=m)}return h};var _E=function stubArray(){return[]},dE=Object.prototype.propertyIsEnumerable,pE=Object.getOwnPropertySymbols,fE=pE?function(t){return null==t?[]:(t=Object(t),uE(pE(t),(function(a){return dE.call(t,a)})))}:_E,hE=fE;var mE=function getAllKeys(t){return lE(t,Bp,hE)},gE=Object.prototype.hasOwnProperty;var IE=function equalObjects(t,a,c,_,E,h){var m=1&c,g=mE(t),I=g.length;if(I!=mE(a).length&&!m)return!1;for(var T=I;T--;){var N=g[T];if(!(m?N in a:gE.call(a,N)))return!1}var M=h.get(t),O=h.get(a);if(M&&O)return M==a&&O==t;var S=!0;h.set(t,a),h.set(a,t);for(var A=m;++T<I;){var C=t[N=g[T]],R=a[N];if(_)var b=m?_(R,C,N,a,t,h):_(C,R,N,t,a,h);if(!(void 0===b?C===R||E(C,R,c,_,h):b)){S=!1;break}A||(A="constructor"==N)}if(S&&!A){var D=t.constructor,k=a.constructor;D==k||!("constructor"in t)||!("constructor"in a)||"function"==typeof D&&D instanceof D&&"function"==typeof k&&k instanceof k||(S=!1)}return h.delete(t),h.delete(a),S},TE=Qs(As,"DataView"),NE=Qs(As,"Promise"),vE=Qs(As,"Set"),ME=Qs(As,"WeakMap"),OE="[object Map]",SE="[object Promise]",AE="[object Set]",CE="[object WeakMap]",RE="[object DataView]",yE=Ys(TE),bE=Ys(Zs),DE=Ys(NE),kE=Ys(vE),VE=Ys(ME),LE=ws;(TE&&LE(new TE(new ArrayBuffer(1)))!=RE||Zs&&LE(new Zs)!=OE||NE&&LE(NE.resolve())!=SE||vE&&LE(new vE)!=AE||ME&&LE(new ME)!=CE)&&(LE=function(t){var a=ws(t),c="[object Object]"==a?t.constructor:void 0,_=c?Ys(c):"";if(_)switch(_){case yE:return RE;case bE:return OE;case DE:return SE;case kE:return AE;case VE:return CE}return a});var PE=LE,wE="[object Arguments]",xE="[object Array]",UE="[object Object]",GE=Object.prototype.hasOwnProperty;var FE=function baseIsEqualDeep(t,a,c,_,E,h){var m=Hc(t),g=Hc(a),I=m?xE:PE(t),T=g?xE:PE(a),N=(I=I==wE?UE:I)==UE,M=(T=T==wE?UE:T)==UE,O=I==T;if(O&&qc(t)){if(!qc(a))return!1;m=!0,N=!1}if(O&&!N)return h||(h=new gc),m||il(t)?rE(t,a,c,_,E,h):sE(t,a,I,c,_,E,h);if(!(1&c)){var S=N&&GE.call(t,"__wrapped__"),A=M&&GE.call(a,"__wrapped__");if(S||A){var C=S?t.value():t,R=A?a.value():a;return h||(h=new gc),E(C,R,c,_,h)}}return!!O&&(h||(h=new gc),IE(t,a,c,_,E,h))};var BE=function baseIsEqual(t,a,c,_,E){return t===a||(null==t||null==a||!Pc(t)&&!Pc(a)?t!=t&&a!=a:FE(t,a,c,_,baseIsEqual,E))};var HE=function baseIsMatch(t,a,c,_){var E=c.length,h=E,m=!_;if(null==t)return!h;for(t=Object(t);E--;){var g=c[E];if(m&&g[2]?g[1]!==t[g[0]]:!(g[0]in t))return!1}for(;++E<h;){var I=(g=c[E])[0],T=t[I],N=g[1];if(m&&g[2]){if(void 0===T&&!(I in t))return!1}else{var M=new gc;if(_)var O=_(T,N,I,t,a,M);if(!(void 0===O?BE(N,T,3,_,M):O))return!1}}return!0};var YE=function isStrictComparable(t){return t==t&&!xs(t)};var jE=function getMatchData(t){for(var a=Bp(t),c=a.length;c--;){var _=a[c],E=t[_];a[c]=[_,E,YE(E)]}return a};var KE=function matchesStrictComparable(t,a){return function(c){return null!=c&&(c[t]===a&&(void 0!==a||t in Object(c)))}};var WE=function baseMatches(t){var a=jE(t);return 1==a.length&&a[0][2]?KE(a[0][0],a[0][1]):function(c){return c===t||HE(c,t,a)}};var qE=function baseHasIn(t,a){return null!=t&&a in Object(t)};var zE=function hasPath(t,a,c){for(var _=-1,E=(a=gd(a,t)).length,h=!1;++_<E;){var m=Id(a[_]);if(!(h=null!=t&&c(t,m)))break;t=t[m]}return h||++_!=E?h:!!(E=null==t?0:t.length)&&Yc(E)&&dl(m,E)&&(Hc(t)||Bc(t))};var $E=function hasIn(t,a){return null!=t&&zE(t,a,qE)};var XE=function baseMatchesProperty(t,a){return sd(t)&&YE(a)?KE(Id(t),a):function(c){var _=Nd(c,t);return void 0===_&&_===a?$E(c,t):BE(a,_,3)}};var JE=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var QE=function basePropertyDeep(t){return function(a){return Td(a,t)}};var ZE=function property(t){return sd(t)?JE(Id(t)):QE(t)};var ef=function baseIteratee(t){return"function"==typeof t?t:null==t?vl:"object"==typeof t?Hc(t)?XE(t[0],t[1]):WE(t):ZE(t)};var tf=function baseSet(t,a,c,_){if(!xs(t))return t;for(var E=-1,h=(a=gd(a,t)).length,m=h-1,g=t;null!=g&&++E<h;){var I=Id(a[E]),T=c;if("__proto__"===I||"constructor"===I||"prototype"===I)return t;if(E!=m){var N=g[I];void 0===(T=_?_(N,I,g):void 0)&&(T=xs(N)?N:dl(a[E+1])?[]:{})}cl(g,I,T),g=g[I]}return t};var rf=function basePickBy(t,a,c){for(var _=-1,E=a.length,h={};++_<E;){var m=a[_],g=Td(t,m);c(g,m)&&tf(h,gd(m,t),g)}return h},nf=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)cE(a,hE(t)),t=Dc(t);return a}:_E;var af=function getAllKeysIn(t){return lE(t,gl,nf)};var sf,cf,lf,uf,_f,df,pf=function pickBy(t,a){if(null==t)return{};var c=pd(af(t),(function(t){return[t]}));return a=ef(a),rf(t,c,(function(t,c){return a(t,c[0])}))};function formatMessage(t,a){return t.isSelf=t.senderId===a,delete t.resend,t.messageType!==lf.V2NIM_MESSAGE_TYPE_TEXT&&t.messageType!==lf.V2NIM_MESSAGE_TYPE_TIPS||(t.text=t.text||t.attachment,delete t.attachment),t.messageType===lf.V2NIM_MESSAGE_TYPE_NOTIFICATION&&(t.attachment=function formatMessageAttachment(t,a){var c,_,E,h,m,g,I,T,N,M,O,S,A,C,R,b,D,k={type:"number"==typeof Ef[t.id]?Ef[t.id]:t.id,targetIds:null===(c=t.data)||void 0===c?void 0:c.target,targetNicks:null===(_=t.data)||void 0===_?void 0:_.tarNick,targetTag:null===(E=t.data)||void 0===E?void 0:E.targetTag,operatorId:null===(h=t.data)||void 0===h?void 0:h.operator,operatorNick:null===(m=t.data)||void 0===m?void 0:m.opeNick,notificationExtension:null===(g=t.data)||void 0===g?void 0:g.ext,tags:null===(I=t.data)||void 0===I?void 0:I.tags,messageClientId:null===(T=t.data)||void 0===T?void 0:T.msgId,messageTime:null===(N=t.data)||void 0===N?void 0:N.msgTime,chatBanned:void 0!==(null===(M=t.data)||void 0===M?void 0:M.muted)?Boolean(null===(O=t.data)||void 0===O?void 0:O.muted):void 0,tempChatBanned:void 0!==(null===(S=t.data)||void 0===S?void 0:S.tempMuted)?Boolean(null===(A=t.data)||void 0===A?void 0:A.tempMuted):void 0,previousRole:null===(C=t.data)||void 0===C?void 0:C.previousRole,tempChatBannedDuration:"number"==typeof(null===(R=t.data)||void 0===R?void 0:R.muteTtl)?t.data.muteTtl:null===(b=t.data)||void 0===b?void 0:b.muteDuration};(k=pf(k,(function(t){return void 0!==t}))).type===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED?k.tempChatBanned=!0:k.type===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED&&(k.tempChatBanned=!1);if(null===(D=t.data)||void 0===D?void 0:D.member){var V=t.data.member;k.currentMember=pf({roomId:a,accountId:V.accountId,memberRole:V.memberRole,memberLevel:V.memberLevel,roomNick:V.nick,roomAvatar:V.avatar,serverExtension:V.ext,isOnline:!!V.onlineStat,blocked:!!V.blockList,chatBanned:!!V.chatBanned,tempChatBanned:!!V.tempChatBanned,tempChatBannedDuration:"number"==typeof V.muteTtl?V.muteTtl:V.muteDuration,tags:stringToJSONObject(V.tags),notifyTargetTags:V.notifyTargetTags,enterTime:V.enterTime,updateTime:V.updateTime,valid:void 0===V.valid||!!V.valid,multiEnterInfo:formatMultiEnterInfo(V.onlineList)},(function(t){return void 0!==t}))}return k.raw=t.raw,k}(t.attachment,t.roomId)),t}function formatMultiEnterInfo(t){if(t&&"string"==typeof t)try{var a=JSON.parse(t);return map$7(a).call(a,(function(t){return{roomNick:t.room_nick,roomAvatar:t.room_avatar,enterTime:t.enter_time,clientType:t.client_type}}))}catch(t){return}}!function(t){t[t.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",t[t.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",t[t.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(sf||(sf={})),function(t){t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",t[t.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(cf||(cf={})),function(t){t[t.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",t[t.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",t[t.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",t[t.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",t[t.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",t[t.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",t[t.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",t[t.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",t[t.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",t[t.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",t[t.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",t[t.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",t[t.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(lf||(lf={})),function(t){t[t.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",t[t.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(uf||(uf={})),function(t){t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER=0]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT=1]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED=2]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED=3]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED=4]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED=5]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED=6]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED=7]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED=8]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED=9]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED=10]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE=11]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED=12]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED=13]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED=14]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED=15]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE=16]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE=17]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE",t[t.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE=18]="V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE"}(_f||(_f={})),function(t){t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",t[t.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(df||(df={}));var Ef={301:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER,302:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT,303:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_ADDED,304:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED,305:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED,306:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED,312:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED,313:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED,314:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED,315:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED,316:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED,317:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE,320:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE,324:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_QUEUE_CHANGE,318:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED,319:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED,321:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED,322:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED,323:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE,325:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE,326:_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE};function attachmentToRaw(t,a){if(!a)return"";switch(t){case lf.V2NIM_MESSAGE_TYPE_CUSTOM:return a.raw||"";case lf.V2NIM_MESSAGE_TYPE_IMAGE:case lf.V2NIM_MESSAGE_TYPE_VIDEO:case lf.V2NIM_MESSAGE_TYPE_AUDIO:case lf.V2NIM_MESSAGE_TYPE_FILE:return function mediaAttachmentToRaw(t){var a=t,c=a.width,_=a.height,E=a.duration;a.path,a.file,a.raw,a.ctx,a.payload,a.bucketName,a.objectName,a.token,a.md5;var h=__rest(a,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","md5"]);return iu(ba(ba(ba(ba({},h),void 0===c?{}:{w:c}),void 0===_?{}:{h:_}),void 0===E?{}:{dur:E}))}(a);case lf.V2NIM_MESSAGE_TYPE_LOCATION:return function locationAttachmentToRaw(t){return iu({lat:t.latitude,lng:t.longitude,title:t.address})}(a);case lf.V2NIM_MESSAGE_TYPE_CALL:return function callAttachmentToRaw(t){t.raw;var a=__rest(t,["raw"]);try{var c;return iu(ba(ba({},a),{durations:map$7(c=t.durations).call(c,(function(t){return{accid:t.accountId,duration:t.duration}}))}))}catch(a){return iu(t)}}(a);default:return iu(a)}}function rawToAttachment(t,a){var c;try{switch(c=JSON.parse(t),a){case lf.V2NIM_MESSAGE_TYPE_CUSTOM:return{raw:t};case lf.V2NIM_MESSAGE_TYPE_LOCATION:return function locationRawToAttachment(t,a){return{latitude:a.lat,longitude:a.lng,address:a.title,raw:t}}(t,c);case lf.V2NIM_MESSAGE_TYPE_AUDIO:case lf.V2NIM_MESSAGE_TYPE_VIDEO:case lf.V2NIM_MESSAGE_TYPE_IMAGE:case lf.V2NIM_MESSAGE_TYPE_FILE:return function mediaRawToAttachment(t,a){var c=a.w,_=a.h,E=a.dur,h=__rest(a,["w","h","dur"]);return ba(ba(ba(ba(ba({},h),void 0===c?{}:{width:c}),void 0===_?{}:{height:_}),void 0===E?{}:{duration:E}),{raw:t})}(t,c);case lf.V2NIM_MESSAGE_TYPE_CALL:return function callRawToAttachment(t,a){var c;return ba(ba({},a),{durations:map$7(c=a.durations).call(c,(function(t){return{accountId:t.accid,duration:t.duration}})),raw:t})}(t,c);default:return"object"==typeof c&&c?ba(ba({},c),{raw:t}):{raw:t}}}catch(a){return"object"==typeof c&&c?ba(ba({},c),{raw:t}):{raw:t}}}var ff,hf,mf,gf,If="V2NIMChatroomMemberService",Tf={"36_15":"v2ChatroomUpdateSelfMemberInfo","36_16":"v2ChatroomGetMemberByIds","36_17":"v2ChatroomKickMember","36_19":"v2ChatroomSetMemberTempChatBanned","36_41":"v2ChatroomGetMemberListByTag","36_32":"v2ChatroomGetMemberCountByTag","36_37":"v2ChatroomGetMemberListByOption","36_38":"v2ChatroomUpdateMemberRole","36_39":"v2ChatroomSetMemberBlockedStatus","36_40":"v2ChatroomSetMemberChatBannedStatus","13_101":"v2ChatroomOnMemberTagUpdated"},Nf={roomId:1,accountId:2,memberRole:{id:3,retType:"number"},memberLevel:{id:4,retDef:0,retType:"number"},roomNick:5,roomAvatar:6,serverExtension:7,isOnline:{id:8,retType:"boolean"},enterTime:{id:10,retType:"number"},blocked:{id:12,retType:"boolean"},chatBanned:{id:13,retType:"boolean"},valid:{id:14,retDef:!0,retType:"boolean"},updateTime:{id:15,retDef:0,retType:"number"},tempChatBanned:{id:16,retType:"boolean",retDef:!1},tempChatBannedDuration:{id:17,retType:"number"},tags:{id:18,converter:objectToJSONString,retConverter:stringToJSONObject},notifyTargetTags:19,multiEnterInfo:{id:20,retConverter:formatMultiEnterInfo}},vf={memberRoles:{id:1,converter:function converter(t){return t.join(",")}},onlyBlocked:{id:2,converter:boolToInt},onlyChatBanned:{id:3,converter:boolToInt},onlyOnline:{id:4,converter:boolToInt},pageToken:5,limit:6},Mf={v2ChatroomGetMemberByIds:{sid:36,cid:16,service:If,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomGetMemberListByOption:{sid:36,cid:37,service:If,params:[{type:"Property",name:"tag",reflectMapper:vf}],response:[{type:"Int",name:"hasMore"},{type:"String",name:"pageToken"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomUpdateSelfMemberInfo:{sid:36,cid:15,service:If,params:[{type:"Property",name:"tag",reflectMapper:Nf},{type:"Bool",name:"notificationEnabled"},{type:"String",name:"notificationExtension"},{type:"Bool",name:"persistence"},{type:"Property",name:"antispamConfig",reflectMapper:{antispamBusinessId:1}}]},v2ChatroomSetMemberTempChatBanned:{sid:36,cid:19,service:If,params:[{type:"String",name:"accountId"},{type:"Long",name:"tempChatBannedDuration"},{type:"Bool",name:"notificationEnabled"},{type:"String",name:"notificationExtension"}]},v2ChatroomGetMemberListByTag:{sid:36,cid:41,service:If,params:[{type:"Property",name:"tag",reflectMapper:{tag:1,pageToken:2,limit:3}}],response:[{type:"Int",name:"hasMore"},{type:"String",name:"pageToken"},{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomGetMemberCountByTag:{sid:36,cid:32,service:If,params:[{type:"String",name:"tag"}],response:[{type:"Long",name:"data"}]},v2ChatroomKickMember:{sid:36,cid:17,service:If,params:[{type:"String",name:"accountId"},{type:"String",name:"notificationExtension"}]},v2ChatroomUpdateMemberRole:{sid:36,cid:38,service:If,params:[{type:"Property",name:"tag",reflectMapper:{accountId:1,memberRole:2,memberLevel:3,notificationExtension:4}}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomSetMemberBlockedStatus:{sid:36,cid:39,service:If,params:[{type:"String",name:"accountId"},{type:"Bool",name:"blocked"},{type:"String",name:"notificationExtension"}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomSetMemberChatBannedStatus:{sid:36,cid:40,service:If,params:[{type:"String",name:"accountId"},{type:"Bool",name:"chatBanned"},{type:"String",name:"notificationExtension"}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Nf)}]},v2ChatroomOnMemberTagUpdated:{sid:36,cid:101,service:If,response:[{type:"Property",name:"data",reflectMapper:{1:"tag"}}]}},Of="V2NIMChatroomLoginService",Sf={"1_2":"heartbeat","36_2":"v2ChatroomLogin","13_3":"v2ChatroomBeKicked","36_4":"v2ChatroomLogout"},Af={roomId:1,roomName:3,announcement:4,liveUrl:5,isValidRoom:{id:9,retType:"boolean"},serverExtension:12,queueLevelMode:{id:16,retType:"number"},creatorAccountId:100,onlineUserCount:{id:101,retType:"number"},chatBanned:{id:102,retType:"boolean"}},Cf={enabled:{id:1,retType:"boolean"},cdnUrls:{id:2,retConverter:function retConverter(t){if("string"==typeof t&&""!==t)return t.split("|")}},timestamp:{id:3,retType:"number"},pollingIntervalSeconds:{id:4,retType:"number"},decryptType:{id:5,retType:"number"},decryptKey:6,pollingTimeoutMillis:{id:7,retType:"number"}},Rf={heartbeat:{sid:1,cid:2,service:Of},v2ChatroomLogin:{sid:36,cid:2,service:Of,params:[{type:"Byte",name:"type"},{type:"Property",name:"chatroomLogin",reflectMapper:{appkey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,serverExtension:22,notificationExtension:23,clientSession:26,isAnonymous:{id:38,converter:function converter(t){return+t}},tags:{id:39,converter:function converter(t){if(td(t)&&t.length>0)return iu(t)}},notifyTargetTags:40,authType:41,loginExt:42,x:43,y:44,z:45,distance:46,antiSpamBusinessId:47}},{type:"Property",name:"chatroomIMLogin",reflectMapper:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,isReactNative:{id:112,converter:function converter(t){return+t}},authType:115,loginExt:116,token:1e3}}],response:[{type:"Property",name:"chatroomInfo",reflectMapper:invertSerializeItem(Af)},{type:"Property",name:"chatroomMember",reflectMapper:invertSerializeItem(Nf)},{type:"Property",name:"chatroomCdnInfo",reflectMapper:invertSerializeItem(Cf)}]},v2ChatroomLogout:{sid:36,cid:4,service:Of,params:[]},v2ChatroomBeKicked:{sid:13,cid:3,service:Of,response:[{type:"Int",name:"kickedReason"},{type:"String",name:"serverExtension"}]}};!function(t){t[t.V2NIM_CHATROOM_MEMBER_ROLE_NORMAL=0]="V2NIM_CHATROOM_MEMBER_ROLE_NORMAL",t[t.V2NIM_CHATROOM_MEMBER_ROLE_CREATOR=1]="V2NIM_CHATROOM_MEMBER_ROLE_CREATOR",t[t.V2NIM_CHATROOM_MEMBER_ROLE_MANAGER=2]="V2NIM_CHATROOM_MEMBER_ROLE_MANAGER",t[t.V2NIM_CHATROOM_MEMBER_ROLE_NORMAL_GUEST=3]="V2NIM_CHATROOM_MEMBER_ROLE_NORMAL_GUEST",t[t.V2NIM_CHATROOM_MEMBER_ROLE_ANONYMOUS_GUEST=4]="V2NIM_CHATROOM_MEMBER_ROLE_ANONYMOUS_GUEST",t[t.V2NIM_CHATROOM_MEMBER_ROLE_VIRTUAL=5]="V2NIM_CHATROOM_MEMBER_ROLE_VIRTUAL"}(ff||(ff={})),function(t){t[t.V2NIM_CHATROOM_STATUS_DISCONNECTED=0]="V2NIM_CHATROOM_STATUS_DISCONNECTED",t[t.V2NIM_CHATROOM_STATUS_WAITING=1]="V2NIM_CHATROOM_STATUS_WAITING",t[t.V2NIM_CHATROOM_STATUS_CONNECTING=2]="V2NIM_CHATROOM_STATUS_CONNECTING",t[t.V2NIM_CHATROOM_STATUS_CONNECTED=3]="V2NIM_CHATROOM_STATUS_CONNECTED",t[t.V2NIM_CHATROOM_STATUS_ENTERING=4]="V2NIM_CHATROOM_STATUS_ENTERING",t[t.V2NIM_CHATROOM_STATUS_ENTERED=5]="V2NIM_CHATROOM_STATUS_ENTERED",t[t.V2NIM_CHATROOM_STATUS_EXITED=6]="V2NIM_CHATROOM_STATUS_EXITED"}(hf||(hf={})),function(t){t.off="off",t.error="error",t.warn="warn",t.log="log",t.debug="debug"}(mf||(mf={})),function(t){t[t.V2NIM_CHATROOM_QUEUE_LEVEL_MODE_ANY=0]="V2NIM_CHATROOM_QUEUE_LEVEL_MODE_ANY",t[t.V2NIM_CHATROOM_QUEUE_LEVEL_MODE_MANAGER=1]="V2NIM_CHATROOM_QUEUE_LEVEL_MODE_MANAGER"}(gf||(gf={}));var yf={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_MESSAGE_HIT_CLIENT_ANTISPAM:{code:107452,message:"message hit client antispam"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},bf=Ja(yf),Df=reduce(bf).call(bf,(function(t,a){var c=yf[a];return t[a]=c.code,t}),{}),kf=reduce(bf).call(bf,(function(t,a){var c=yf[a];return t[c.code]=c.message,t}),{}),Vf=Object.freeze({__proto__:null,V2NIMErrorCode:Df,V2NIMErrorDesc:kf,get V2NIMLoginAuthType(){return jp},get V2NIMLoginStatus(){return Kp},get V2NIMLoginClientType(){return Wp},get V2NIMLoginClientChange(){return qp},get V2NIMConnectStatus(){return zp},get V2NIMChatroomKickedReason(){return $p},get V2NIMChatroomMemberRole(){return ff},get V2NIMMessageSendingState(){return sf},get V2NIMMessageAttachmentUploadState(){return cf},get V2NIMMessageType(){return lf},get V2NIMQueryDirection(){return uf},get V2NIMChatroomMessageNotificationType(){return _f},get V2NIMClientAntispamOperateType(){return df},get V2NIMChatroomStatus(){return hf},get V2NIMChatroomQueueLevelMode(){return gf}}),Lf=function(){function V2NIMLoginReconnect(t){this.currenRetryCount=0,this.reconnectTimer=0,this.backoffIntervals=[1e3,2e3,3e3],this.currReconnectInterval=0,this.core=t,this.auth=t.auth}var t=V2NIMLoginReconnect.prototype;return t.reset=function reset(){this.currenRetryCount=0,this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function clearReconnectTimer(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function attempToReLogin(){var t=this,a=this.backoffIntervals[this.currReconnectInterval];return this.currReconnectInterval=(this.currReconnectInterval+1)%this.backoffIntervals.length,this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+a+" ms, current retry count is "+this.currenRetryCount),this.clearReconnectTimer(),this.reconnectTimer=ns((function(){t.core.logger.log("reconnect::reconnect timer is now triggered");var a=t.auth.getConnectStatus();a===zp.V2NIM_CONNECT_STATUS_WAITING?t.doReLogin():t.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+a)}),a),!0},t.doReLogin=function doReLogin(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var t,a,c=this;return Sa.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:return this.auth.connectParams.forceMode=!1,_.prev=1,_.next=4,this.auth.updateDynamicParamters(!1);case 4:_.next=9;break;case 6:return _.prev=6,_.t0=_.catch(1),_.abrupt("return",this.auth.lifeCycle.processEvent("waiting"));case 9:return t=this.core.timeOrigin.getTimeNode(),this.auth.originLoginPromise=this.auth.doLogin(!0),_.prev=11,_.next=14,this.auth.previousLoginManager.add(this.auth.originLoginPromise);case 14:this.currReconnectInterval=0,this.auth.reportLoginSucc(t),_.next=29;break;case 18:if(_.prev=18,_.t1=_.catch(11),a=_.t1,this.core.logger.warn("reconnect::try login but failed due to",a),this.auth.reportLoginFail(t,a),!this.auth.checkLoginTerminalCode(a&&a.code)){_.next=28;break}return this.auth.clientSocket.doDisconnect(hp.ACTIVE,"ReloginTerminated}"),this.auth.lifeCycle.processEvent("exited",a),_.abrupt("return");case 28:a&&a.code===Df.V2NIM_ERROR_CODE_SERVER_UNIT_ERROR?this.auth.updateLinkAddress().then((function(){c.auth.lifeCycle.processEvent("waiting")})).catch((function(t){c.auth.lifeCycle.processEvent("reconnectFail",t)})):this.auth.lifeCycle.processEvent("waiting");case 29:case"end":return _.stop()}}),_callee,this,[[1,6],[11,18]])})))},V2NIMLoginReconnect}(),Pf=function(){function V2NIMLoginAuthenticator(t){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=t,this.auth=t.auth}var t=V2NIMLoginAuthenticator.prototype;return t.verifyAuthentication=function verifyAuthentication(t){var a,c,_,E,h,m,g,I,T,N,M,O,S,A;return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var C,R,b,D,k,V,L,P,w,x;return Sa.wrap((function _callee$(U){for(;;)switch(U.prev=U.next){case 0:return R=zl.getSystemInfo(),b={clientType:16,os:R.os,sdkVersion:100207,appLogin:t?0:1,protocolVersion:1,deviceId:this.auth.deviceId,appkey:this.auth.appkey,account:this.auth.account,browser:R.browser,clientSession:this.auth.clientSession,customClientType:this.core.options.customClientType,sdkHumanVersion:"10.2.700",userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.2.700":slice(C=R.userAgent).call(C,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:R.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:R.hostEnvEnum,authType:this.auth.authType,loginExt:this.auth.loginExt,token:this.auth.token},D=ba(ba({appkey:this.auth.appkey,account:this.auth.account,deviceId:this.auth.deviceId,chatroomId:this.auth.roomId,appLogin:t?0:1,chatroomNick:null===(a=this.auth.enterParams)||void 0===a?void 0:a.roomNick,chatroomAvatar:(null===(c=this.auth.enterParams)||void 0===c?void 0:c.roomAvatar)||"",serverExtension:null===(_=this.auth.enterParams)||void 0===_?void 0:_.serverExtension,notificationExtension:null===(E=this.auth.enterParams)||void 0===E?void 0:E.notificationExtension,clientSession:this.auth.clientSession,isAnonymous:this.auth.isAnonymous,tags:null===(m=null===(h=this.auth.enterParams)||void 0===h?void 0:h.tagConfig)||void 0===m?void 0:m.tags,notifyTargetTags:null===(I=null===(g=this.auth.enterParams)||void 0===g?void 0:g.tagConfig)||void 0===I?void 0:I.notifyTargetTags,authType:this.auth.authType,loginExt:this.auth.loginExt},null===(N=null===(T=this.auth.enterParams)||void 0===T?void 0:T.locationConfig)||void 0===N?void 0:N.locationInfo),{distance:null===(O=null===(M=this.auth.enterParams)||void 0===M?void 0:M.locationConfig)||void 0===O?void 0:O.distance,antiSpamBusinessId:null===(A=null===(S=this.auth.enterParams)||void 0===S?void 0:S.antispamConfig)||void 0===A?void 0:A.antispamBusinessId}),U.prev=3,this.auth.lifeCycle.processEvent("loginStart"),U.next=7,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2ChatroomLogin",{type:1,chatroomLogin:D,chatroomIMLogin:b}));case 7:k=U.sent,U.next=18;break;case 10:if(U.prev=10,U.t0=U.catch(3),V=U.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:V.code||0,succeed:!1,description:V.message},{asyncParams:zl.net.getNetworkStatus()}),V.code!==Df.V2NIM_ERROR_CODE_CANCELLED&&V.code!==Df.V2NIM_ERROR_CODE_TIMEOUT){U.next=16;break}throw V;case 16:throw this.processLoginFailed(V),V;case 18:return L=k.content,P=L.chatroomInfo,w=L.chatroomMember,x=L.chatroomCdnInfo,this.core.V2NIMChatroomMessageService.cdnUtil.setOptions(x),U.abrupt("return",{chatroom:P,selfMember:w});case 21:case"end":return U.stop()}}),_callee,this,[[3,10]])})))},t.processLoginFailed=function processLoginFailed(t){this.auth.clientSocket.doDisconnect(hp.ACTIVE,t),this.checkLoginTerminalCode(t.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",t)},t.changeLoginClient=function changeLoginClient(t,a){},t.checkAutoLogin=function checkAutoLogin(t){if(t)return!1;var a=zl.localStorage.getItem(this.lastLoginClientKey);if(!a)return!1;var c="",_="";try{var E=JSON.parse(a);c=Nd(E,"clientId"),_=Nd(E,"account")}catch(t){return!1}return c===this.auth.deviceId&&_===this.auth.account},t.checkLoginTerminalCode=function checkLoginTerminalCode(t){var a=[Df.V2NIM_ERROR_CODE_CANCELLED,Df.V2NIM_ERROR_CODE_TIMEOUT,Df.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Df.V2NIM_ERROR_CODE_FORBIDDEN,Df.V2NIM_ERROR_CODE_NOT_FOUND,Df.V2NIM_ERROR_CODE_PARAMETER_ERROR,Df.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Df.V2NIM_ERROR_CODE_IM_DISABLED,Df.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Df.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Df.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Df.V2NIM_ERROR_CODE_INVALID_TOKEN,Df.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Df.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Df.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Df.V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID,Df.V2NIM_ERROR_CODE_CHATROOM_DISABLED,Df.V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST,Df.V2NIM_ERROR_CODE_CHATROOM_CLOSED,Df.V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST];return includes(a).call(a,t)},t.reset=function reset(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function clearLastLoginClient(){zl.localStorage.removeItem(this.lastLoginClientKey)},V2NIMLoginAuthenticator}(),wf=function(){function V2NIMLoginLifeCycle(t){this.name="V2NIMLoginLifeCycle",this.chatroomStatus=hf.V2NIM_CHATROOM_STATUS_EXITED,this.entered=!1,this.core=t,this.auth=t.auth,this.logger=t.logger}var t=V2NIMLoginLifeCycle.prototype;return t.processEvent=function processEvent(t,a,c){var _=this.getConnectStatus();switch(t){case"connect":this.logger.log(this.name+"::connecting"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_CONNECTING);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_CONNECTED);break;case"connectFail":this.logger.log(this.name+"::connect fail",a),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_DISCONNECTED,a);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken",a),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_DISCONNECTED,a);break;case"loginStart":this.logger.log(this.name+"::login start"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_ENTERING);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_ENTERED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",c);break;case"loginFail":this.logger.log(this.name+"::login fail due to verify authentication failed:",a),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_DISCONNECTED,a);break;case"logout":this.logger.log(this.name+"::logout"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_EXITED),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",c),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_EXITED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"reconnectFail":this.logger.log(this.name+"::reconnect fail",a),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_EXITED,a),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"exited":if(this.logger.log(this.name+"::exited, isEntered: "+this.entered,a),this.chatroomStatus===hf.V2NIM_CHATROOM_STATUS_EXITED)return;this.setChatroomStatus(this.entered?hf.V2NIM_CHATROOM_STATUS_EXITED:hf.V2NIM_CHATROOM_STATUS_DISCONNECTED,a);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setChatroomStatus(hf.V2NIM_CHATROOM_STATUS_WAITING),_!==zp.V2NIM_CONNECT_STATUS_CONNECTING&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function getConnectStatus(){switch(this.chatroomStatus){case hf.V2NIM_CHATROOM_STATUS_EXITED:case hf.V2NIM_CHATROOM_STATUS_DISCONNECTED:return zp.V2NIM_CONNECT_STATUS_DISCONNECTED;case hf.V2NIM_CHATROOM_STATUS_ENTERED:case hf.V2NIM_CHATROOM_STATUS_ENTERING:case hf.V2NIM_CHATROOM_STATUS_CONNECTED:return zp.V2NIM_CONNECT_STATUS_CONNECTED;case hf.V2NIM_CHATROOM_STATUS_CONNECTING:return zp.V2NIM_CONNECT_STATUS_CONNECTING;case hf.V2NIM_CHATROOM_STATUS_WAITING:return zp.V2NIM_CONNECT_STATUS_WAITING}},t.getLoginStatus=function getLoginStatus(){switch(this.chatroomStatus){case hf.V2NIM_CHATROOM_STATUS_WAITING:return Kp.V2NIM_LOGIN_STATUS_UNLOGIN;case hf.V2NIM_CHATROOM_STATUS_EXITED:case hf.V2NIM_CHATROOM_STATUS_DISCONNECTED:return Kp.V2NIM_LOGIN_STATUS_LOGOUT;case hf.V2NIM_CHATROOM_STATUS_CONNECTED:case hf.V2NIM_CHATROOM_STATUS_CONNECTING:case hf.V2NIM_CHATROOM_STATUS_ENTERING:return Kp.V2NIM_LOGIN_STATUS_LOGINING;case hf.V2NIM_CHATROOM_STATUS_ENTERED:return Kp.V2NIM_LOGIN_STATUS_LOGINED}},t.setChatroomStatus=function setChatroomStatus(t,a){t===hf.V2NIM_CHATROOM_STATUS_ENTERED&&(this.entered=!0),this.chatroomStatus!==t&&(this.chatroomStatus=t,t===hf.V2NIM_CHATROOM_STATUS_EXITED&&this.core._clearModuleData(),this.core.emit("onChatroomStatus",t,a),t===hf.V2NIM_CHATROOM_STATUS_EXITED&&this.entered&&(this.entered=!1,this.core.emit("onChatroomExited",a)))},V2NIMLoginLifeCycle}(),xf=entryVirtual("Array").values,Uf=Array.prototype,Gf={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===Uf||j(Uf,t)&&a===Uf.values||ue(Gf,xt(t))?xf:a},Ff=yr.every,Bf=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Bf},{every:function every(t){return Ff(this,t,arguments.length>1?arguments[1]:void 0)}});var Hf=entryVirtual("Array").every,Yf=Array.prototype,every=function(t){var a=t.every;return t===Yf||j(Yf,t)&&a===Yf.every?Hf:a};var jf=function baseIsRegExp(t){return Pc(t)&&"[object RegExp]"==ws(t)},Kf=nl&&nl.isRegExp,Wf=Kf?rl(Kf):jf;var qf=function baseFindIndex(t,a,c,_){for(var E=t.length,h=c+(_?1:-1);_?h--:++h<E;)if(a(t[h],h,t))return h;return-1};var zf=function baseIsNaN(t){return t!=t};var $f=function strictIndexOf(t,a,c){for(var _=c-1,E=t.length;++_<E;)if(t[_]===a)return _;return-1};var Xf=function baseIndexOf(t,a,c){return a==a?$f(t,a,c):qf(t,zf,c)};var Jf=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&Xf(t,a,0)>-1};var Qf=function arrayIncludesWith(t,a,c){for(var _=-1,E=null==t?0:t.length;++_<E;)if(c(a,t[_]))return!0;return!1};var Zf=function baseDifference(t,a,c,_){var E=-1,h=Jf,m=!0,g=t.length,I=[],T=a.length;if(!g)return I;c&&(a=pd(a,rl(c))),_?(h=Qf,m=!1):a.length>=200&&(h=tE,m=!1,a=new Zp(a));e:for(;++E<g;){var N=t[E],M=null==c?N:c(N);if(N=_||0!==N?N:0,m&&M==M){for(var O=T;O--;)if(a[O]===M)continue e;I.push(N)}else h(a,M,_)||I.push(N)}return I},eh=Dl((function(t,a){return Kc(t)?Zf(t,a):[]})),th=eh;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,c,_){var E;void 0===a&&(a={}),void 0===_&&(_=!1);var h={};return forEach$1(E=Ja(t)).call(E,(function(E){var m=t[E].type,g=c?"In "+c+", ":"";if(null==a){var I=g+"param is null or undefined";throw _?new H_({detail:{reason:I,data:{key:E},rules:"required"}}):new B_(I,{key:E},"required")}if(void 0===a[E]){if(!1===t[E].required)return void(h[E]=a[E]);var T=g+"param '"+E+"' is required";throw _?new H_({detail:{reason:T,data:{key:E},rules:"required"}}):new B_(T,{key:E},"required")}var N=rh[m];if(N&&!N(a,E,t[E],_)){var M=g+"param '"+E+"' unexpected",O={key:E,value:a[E]};throw _?new H_({detail:{reason:M,data:O,rules:iu(t[E],replacer)}}):new B_(M,O,iu(t[E],replacer))}h[E]=a[E]})),h}var rh={string:function string(t,a,c){var _=c.allowEmpty,E=c.max,h=c.min,m=c.regExp,g=t[a];return"string"==typeof g&&((!1!==_||""!==g)&&(!("number"==typeof E&&g.length>E)&&(!("number"==typeof h&&g.length<h)&&!(Wf(m)&&!m.test(g)))))},number:function number(t,a,c){var _=c.min,E=c.max,h=t[a];return"number"==typeof h&&(!("number"==typeof _&&h<_)&&!("number"==typeof E&&h>E))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},file:function file(t,a){return!0},enum:function _enum(t,a,c){var _=values(c),E=t[a];return!_||indexOf(_).call(_,E)>-1},func:function func(t,a){return"function"==typeof t[a]},array:function array(t,a,c,_){var E;void 0===_&&(_=!1);var h=c.itemType,m=c.rules,g=c.min,I=c.max,T=values(c),N=t[a];return!!td(N)&&(!("number"==typeof I&&N.length>I)&&(!("number"==typeof g&&N.length<g)&&(!(h&&"enum"!==h&&!every(N).call(N,(function(t){return typeof t===h})))&&(("enum"!==h||!T||!th.apply(void 0,concat(E=[N]).call(E,T)).length)&&(m&&forEach$1(N).call(N,(function(t,c){return validate(m,t,a+"["+c+"]",_)})),!0)))))},object:function object(t,a,c,_){void 0===_&&(_=!1);var E=c.rules,h=c.allowEmpty,m=t[a];if("object"!=typeof m||null===m)return!1;if(E){var g=Ja(E),I=Ja(m),T=filter(I).call(I,(function(t){return indexOf(g).call(g,t)>-1}));if(!1===h&&0===T.length)return!1;validate(E,m,a,_)}return!0}},nh={updateParams:{type:"object",allowEmpty:!1,rules:{roomName:{type:"string",required:!1,allowEmpty:!1},announcement:{type:"string",required:!1},liveUrl:{type:"string",required:!1},serverExtension:{type:"string",required:!1},notificationEnabled:{type:"boolean",required:!1},notificationExtension:{type:"string",required:!1}}},antispamConfig:{type:"object",allowEmpty:!1,rules:{antispamBusinessId:{type:"string",required:!1}}}},oh={locationInfo:{type:"object",rules:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}},distance:{type:"number"}},ih={updateParams:{type:"object",allowEmpty:!1,rules:{tags:{type:"array",required:!1,itemType:"string"},notifyTargetTags:{type:"string",required:!1},notificationEnabled:{type:"boolean",required:!1},notificationExtension:{type:"string",required:!1}}}},ah={targetTag:{type:"string",required:!0,allowEmpty:!1},notifyTargetTags:{type:"string",required:!1},duration:{type:"number",required:!1},notificationEnabled:{type:"boolean",required:!1},notificationExtension:{type:"string",required:!1}},sh={roomId:{allowEmpty:!1,type:"string"},enterParams:{type:"object",required:!0,rules:{anonymousMode:{required:!1,type:"boolean"},accountId:{required:!1,type:"string",allowEmpty:!1},token:{required:!1,type:"string",allowEmpty:!1},roomNick:{required:!1,type:"string"},roomAvatar:{required:!1,type:"string"},loginOption:{type:"object",required:!1,rules:{authType:{type:"enum",required:!1,values:getEnumValues(jp)},tokenProvider:{required:!1,type:"func"},loginExtensionProvider:{required:!1,type:"func"}}},linkProvider:{type:"func"},serverExtension:{type:"string",required:!1,allowEmpty:!1},notificationExtension:{type:"string",required:!1,allowEmpty:!1},tagConfig:{type:"object",required:!1,rules:{notifyTargetTags:{type:"string",required:!1},tags:{type:"array",required:!1,itemType:"string"}}},locationConfig:{type:"object",required:!1,rules:oh},antispamConfig:{type:"object",required:!1,rules:{antispamBusinessId:{type:"string",required:!1,allowEmpty:!1}}}}}},ch=function validateLinkAddressArray(t){if(!td(t))throw new F_({code:400,message:"linkAddressArray must be an array"});if(0===t.length)throw new F_({code:400,message:"linkAddressArray must not be empty"});forEach$1(t).call(t,(function(t){if(!t)throw new F_({code:400,message:"linkAddress must not be empty"})}))},lh=function(t){function V2ChatroomService(a,c){var _;return(_=t.call(this)||this).name=a,_.logger=c.logger,_.core=c,_}yt(V2ChatroomService,t);var a=V2ChatroomService.prototype;return a.emit=function emit(a){var c=this;try{for(var _,E,h=arguments.length,m=new Array(h>1?h-1:0),g=1;g<h;g++)m[g-1]=arguments[g];this.logger.debug(this.name+'::emit event: "'+a.toString()+'",',void 0!==m[0]?m[0]:"",void 0!==m[1]?m[1]:"",void 0!==m[2]?m[2]:"");var I=(_=t.prototype.emit).call.apply(_,concat(E=[this,a]).call(E,m));return I}catch(t){return ns((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a){if(t.error)return this.logger.error(t.cmd+"::recvError",t.error),da.reject(t.error);try{var c=a.call(this,t);return da.resolve(c)}catch(t){return da.reject(t)}}var _=Nd(t,"error.detail.ignore");return t.error&&!_?da.reject(t.error):da.resolve(t)},V2ChatroomService}(nd),uh=function(t){function V2NIMChatroomLoginServiceImpl(a){var c;return(c=t.call(this,"V2NIMChatroomLoginService",a)||this).roomId="",c.token="",c.loginExt="",c.authType=jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,c.linkAddressArray=[],c.currLinkIdx=-1,c.isAnonymous=!1,c.processId="",c.connectParams={forceMode:!1},registerParser({cmdMap:Sf,cmdConfig:Rf}),a.auth=$e(c),c.previousLoginManager=new lp,c.doLoginStepsManager=new lp,c.loginTimerManager=new Rp,c.lifeCycle=new wf(a),c.reconnect=new Lf(a),c.authenticator=new Pf(a),c}yt(V2NIMChatroomLoginServiceImpl,t);var a=V2NIMChatroomLoginServiceImpl.prototype;return a.getNextLink=function getNextLink(){return this.currLinkIdx=(this.currLinkIdx+1)%this.linkAddressArray.length,this.linkAddressArray[this.currLinkIdx]},a.getCurrLink=function getCurrLink(){return this.linkAddressArray[this.currLinkIdx]},a.reset=function reset(){this.roomId="",this.token="",this.loginExt="",this.processId="",this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient()},a.login=function login(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var _,E=this;return Sa.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(validate(sh,{appkey:t,roomId:a,enterParams:c},"",!0),this.getLoginStatus()!==Kp.V2NIM_LOGIN_STATUS_LOGOUT){h.next=5;break}this.logger.log("V2NIMChatroomLoginService::login:allowLogin. \n        roomId: "+a+". \n        enterParams: "+iu(c,null,2)),h.next=11;break;case 5:if(this.getLoginStatus()!==Kp.V2NIM_LOGIN_STATUS_LOGINED){h.next=9;break}return h.abrupt("return",this.smoothForLogined(t,a,c));case 9:if(this.getLoginStatus()!==Kp.V2NIM_LOGIN_STATUS_LOGINING){h.next=11;break}return h.abrupt("return",this.smoothForLogining(t,a,c));case 11:return this.processId=Yp(),h.next=14,this.setLoginParams(t,a,c);case 14:return this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var t=new F_({code:Df.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});E.doLoginStepsManager.clear(t),E.previousLoginManager.clear(t),E.originLoginPromise=void 0,E.lifeCycle.processEvent("exited",t)}),c.timeout?1e3*c.timeout:6e4,1),h.prev=16,h.next=19,this.multiTryDoLogin();case 19:return _=h.sent,this.core.emit("onChatroomEntered"),this.loginTimerManager.destroy(),h.abrupt("return",_);case 25:throw h.prev=25,h.t0=h.catch(16),this.loginTimerManager.destroy(),h.t0;case 29:case"end":return h.stop()}}),_callee,this,[[16,25]])})))},a.multiTryDoLogin=function multiTryDoLogin(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var a,c,_,E,h;return Sa.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:a=this.core.timeOrigin.getTimeNode(),c=new F_({code:Df.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),_=0;case 3:if(!(_<this.linkAddressArray.length)){m.next=32;break}return E="V2NIMChatroomLoginService:: "+(_+1)+"th login attempt.",_>0?this.logger.warn(E):this.logger.log(E),m.prev=6,this.originLoginPromise=t||this.doLogin(!1),t=void 0,m.next=11,this.previousLoginManager.add(this.originLoginPromise);case 11:return h=m.sent,this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,this.reportLoginSucc(a),m.abrupt("return",h);case 19:if(m.prev=19,m.t0=m.catch(6),c=m.t0||c,this.logger.error("V2NIMChatroomLoginService::login failed, times of login try: "+_+", err.code: "+(null==c?void 0:c.code)+', err.message: "'+(null==c?void 0:c.message)+'"'),this.reportLoginFail(a,c),this.reconnect.clearReconnectTimer(),!(this.checkLoginTerminalCode(c&&c.code)||c&&c.code===Df.V2NIM_ERROR_CODE_SERVER_UNIT_ERROR)){m.next=29;break}throw this.lifeCycle.processEvent("exited",c),c;case 29:_++,m.next=3;break;case 32:throw this.lifeCycle.processEvent("exited",c),c;case 34:case"end":return m.stop()}}),_callee2,this,[[6,19]])})))},a.doLogin=function doLogin(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var a,c;return Sa.wrap((function _callee3$(_){for(;;)switch(_.prev=_.next){case 0:return a=!!t||this.authenticator.checkAutoLogin(this.connectParams.forceMode),_.next=3,this.doLoginStepsManager.add(this.clientSocket.connect(this.getNextLink(),t));case 3:return _.next=5,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(a));case 5:return c=_.sent,this.lifeCycle.processEvent("loginSucc",void 0,ba(ba({},c),{isReconnect:t})),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.clientSocket.ping(),this.core.abtest.abtRequest(),this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),_.prev=12,_.next=15,this.core.cloudStorage.init();case 15:_.next=20;break;case 17:_.prev=17,_.t0=_.catch(12),this.logger.warn("doLogin::cloudStorage init error",_.t0);case 20:return this.prevLoginResult=c,_.abrupt("return",c);case 22:case"end":return _.stop()}}),_callee3,this,[[12,17]])})))},a.reportLoginSucc=function reportLoginSucc(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a,c,_,E;return Sa.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return a=this.core.timeOrigin.getNTPTime(),c=Ga()-t.time,this.core.timeOrigin.checkNodeReliable(t)&&(c=a-this.core.timeOrigin.getNTPTime(t)),h.next=5,zl.net.getNetworkStatus();case 5:_=h.sent,E=_.net_connect,this.core.reporter.report("chatroomLogin",{accid:this.account,roomId:this.roomId,serverIps:this.linkAddressArray,currentServerIp:this.getCurrLink(),rt:c,result:200,failReason:"",time:a,net_connect:E,binary_websocket:this.core.config.binaryWebsocket});case 8:case"end":return h.stop()}}),_callee4,this)})))},a.reportLoginFail=function reportLoginFail(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var c,_,E,h,m,g;return Sa.wrap((function _callee5$(I){for(;;)switch(I.prev=I.next){case 0:if(c=Nd(a,"code")||Nd(a,"detail.rawError.code")||0,_=Nd(a,"detail.rawError.message")||Nd(a,"message")||"login failed",c!==Df.V2NIM_ERROR_CODE_CANCELLED){I.next=4;break}return I.abrupt("return");case 4:return E=this.core.timeOrigin.getNTPTime(),h=Ga()-t.time,this.core.timeOrigin.checkNodeReliable(t)&&(h=E-this.core.timeOrigin.getNTPTime(t)),I.next=9,zl.net.getNetworkStatus();case 9:m=I.sent,g=m.net_connect,this.core.reporter.report("chatroomLogin",{accid:this.account,roomId:this.roomId,serverIps:this.linkAddressArray,currentServerIp:this.getCurrLink(),rt:h,result:c,failReason:_,time:E,net_connect:g,binary_websocket:this.core.config.binaryWebsocket});case 12:case"end":return I.stop()}}),_callee5,this)})))},a.smoothForLogined=function smoothForLogined(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee6(){var _;return Sa.wrap((function _callee6$(E){for(;;)switch(E.prev=E.next){case 0:if(_=this.checkIsSameLogin(t,a,c),this.logger.warn("V2NIMChatroomLoginService::smoothForLogined:Logined, isSameLogin "+_),!_){E.next=6;break}return E.abrupt("return",this.prevLoginResult);case 6:return E.next=8,this.logout();case 8:return E.abrupt("return",this.login(t,a,c));case 9:case"end":return E.stop()}}),_callee6,this)})))},a.smoothForLogining=function smoothForLogining(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee7(){var _;return Sa.wrap((function _callee7$(E){for(;;)switch(E.prev=E.next){case 0:if(_=this.checkIsSameLogin(t,a,c),this.previousLoginManager.clear(),this.reconnect.reset(),!_){E.next=14;break}if(this.originLoginPromise){E.next=6;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 6:return this.reconnect.reset(),E.next=9,da.resolve();case 9:return E.next=11,this.multiTryDoLogin(this.originLoginPromise);case 11:return E.abrupt("return",E.sent);case 14:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(hp.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout",new F_({code:Df.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to logout. aborted previous login."}})),E.next=20,da.resolve();case 20:return E.abrupt("return",this.login(t,a,c));case 21:case"end":return E.stop()}}),_callee7,this)})))},a.checkIsSameLogin=function checkIsSameLogin(t,a,c){var _,E,h,m,g,I,T,N=void 0!==c.anonymousMode&&c.anonymousMode,M=(null===(_=c.loginOption)||void 0===_?void 0:_.authType)||jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,O=iu((null===(h=null===(E=this.enterParams)||void 0===E?void 0:E.tagConfig)||void 0===h?void 0:h.tags)||[]),S=iu((null===(m=c.tagConfig)||void 0===m?void 0:m.tags)||[]),A=iu((null===(g=this.enterParams)||void 0===g?void 0:g.locationConfig)||{}),C=iu(c.locationConfig||{});return this.appkey===t&&this.roomId===a&&this.authType===M&&this.isAnonymous===N&&this.account===c.accountId&&(null===(I=this.enterParams)||void 0===I?void 0:I.roomNick)===c.roomNick&&(null===(T=this.enterParams)||void 0===T?void 0:T.roomAvatar)===c.roomAvatar&&O===S&&A===C},a.logout=function logout(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee8(){var t,a,c;return Sa.wrap((function _callee8$(_){for(;;)switch(_.prev=_.next){case 0:this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),a=this.getLoginStatus(),c=new F_({code:Df.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to logout"}}),_.t0=a,_.next=_.t0===Kp.V2NIM_LOGIN_STATUS_LOGINED?10:_.t0===Kp.V2NIM_LOGIN_STATUS_LOGINING?23:_.t0===Kp.V2NIM_LOGIN_STATUS_UNLOGIN?26:_.t0===Kp.V2NIM_LOGIN_STATUS_LOGOUT?30:32;break;case 10:return _.prev=10,_.next=13,this.clientSocket.sendCmd("v2ChatroomLogout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(hp.ACTIVE,"UserActiveDisconnect"),this.lifeCycle.processEvent("logout",c),_.next=22;break;case 17:_.prev=17,_.t1=_.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",_.t1),this.clientSocket.doDisconnect(hp.ACTIVE,"UserActiveDisconnect"),this.lifeCycle.processEvent("logout",c);case 22:return _.abrupt("break",34);case 23:return this.clientSocket.doDisconnect(hp.ACTIVE,"UserActiveDisconnect"),this.lifeCycle.processEvent("logout",c),_.abrupt("break",34);case 26:return this.clientSocket.doDisconnect(hp.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout",c),_.abrupt("break",34);case 30:throw this.core._clearModuleData(),new F_({code:Df.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+a+". connectStatus "+t}});case 32:throw this.core._clearModuleData(),new F_({code:Df.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+a+". connectStatus "+t}});case 34:case"end":return _.stop()}}),_callee8,this,[[10,17]])})))},a.getConnectStatus=function getConnectStatus(){return this.lifeCycle.getConnectStatus()},a.getLoginStatus=function getLoginStatus(){return this.lifeCycle.getLoginStatus()},a.getLoginUser=function getLoginUser(){return this.account},a.getRoomId=function getRoomId(){return this.roomId},a.checkLoginTerminalCode=function checkLoginTerminalCode(t){return this.authenticator.checkLoginTerminalCode(t)},a.updateLinkAddress=function updateLinkAddress(){var t;return __awaiter(this,void 0,void 0,Sa.mark((function _callee9(){return Sa.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:if(!(null===(t=this.enterParams)||void 0===t?void 0:t.linkProvider)){a.next=12;break}return a.prev=1,a.next=4,this.enterParams.linkProvider(this.account,this.roomId);case 4:this.linkAddressArray=a.sent,this.currLinkIdx=-1,ch(this.linkAddressArray),a.next=12;break;case 9:throw a.prev=9,a.t0=a.catch(1),new F_({code:Df.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"linkProvider error: "+a.t0}});case 12:case"end":return a.stop()}}),_callee9,this,[[1,9]])})))},a.updateDynamicParamters=function updateDynamicParamters(t){var a,c,_,E;return __awaiter(this,void 0,void 0,Sa.mark((function _callee10(){return Sa.wrap((function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:if(this.enterParams){h.next=2;break}return h.abrupt("return");case 2:if(!t){h.next=5;break}return h.next=5,this.updateLinkAddress();case 5:if(this.authType===jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT||!(null===(c=null===(a=this.enterParams)||void 0===a?void 0:a.loginOption)||void 0===c?void 0:c.tokenProvider)){h.next=21;break}return h.prev=6,h.next=9,this.enterParams.loginOption.tokenProvider(this.appkey,this.roomId,this.account);case 9:this.token=h.sent,h.next=15;break;case 12:throw h.prev=12,h.t0=h.catch(6),new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"tokenProvider error: "+h.t0}});case 15:if(null!==this.token&&void 0!==this.token){h.next=19;break}throw new F_({code:Df.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"tokenProvider should not return null or undefined when authType === 1 or authType === 2"}});case 19:if(this.token||this.authType!==jp.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN){h.next=21;break}throw new F_({code:Df.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"tokenProvider should not return empty string when authType === 1"}});case 21:if(!(null===(E=null===(_=this.enterParams)||void 0===_?void 0:_.loginOption)||void 0===E?void 0:E.loginExtensionProvider)){h.next=33;break}return h.prev=22,h.next=25,this.enterParams.loginOption.loginExtensionProvider(this.appkey,this.roomId,this.account);case 25:this.loginExt=h.sent,h.next=31;break;case 28:throw h.prev=28,h.t1=h.catch(22),new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"loginExtensionProvider error: "+h.t1}});case 31:if(null!==this.loginExt&&void 0!==this.loginExt||this.authType!==jp.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY){h.next=33;break}throw new F_({code:Df.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"loginExtensionProvider should not return null or undefined when authType === 2"}});case 33:case"end":return h.stop()}}),_callee10,this,[[6,12],[22,28]])})))},a.setLoginParams=function setLoginParams(t,a,c){var _,E;return __awaiter(this,void 0,void 0,Sa.mark((function _callee11(){return Sa.wrap((function _callee11$(h){for(;;)switch(h.prev=h.next){case 0:if(this.reset(),this.roomId=a,this.enterParams=c,this.core.options.appkey=t,this.core.options.tags=(null===(_=c.tagConfig)||void 0===_?void 0:_.tags)||[],c.token&&(this.token=c.token),c.anonymousMode&&!c.accountId?this.core.options.account="nimanon_"+Yp():this.core.options.account=c.accountId,this.isAnonymous=void 0!==c.anonymousMode&&c.anonymousMode,!this.isAnonymous||c.roomNick){h.next=14;break}if(void 0!==c.roomNick){h.next=13;break}c.roomNick=this.core.options.account,h.next=14;break;case 13:throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"roomNick is required when anonymousMode is true"}});case 14:return this.authType=(null===(E=c.loginOption)||void 0===E?void 0:E.authType)||jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,h.next=17,this.updateDynamicParamters(!0);case 17:case"end":return h.stop()}}),_callee11,this)})))},a.v2LoginHandler=function v2LoginHandler(t){if(t.error)throw this.clientSocket.doDisconnect(hp.ACTIVE,t.error),t.error;return t},a.v2LoginClientChangeHandler=function v2LoginClientChangeHandler(t){this.authenticator.changeLoginClient(jd(t.content.state),t.content.datas)},a.nimLoginClientChangeHandler=function nimLoginClientChangeHandler(t){this.authenticator.changeLoginClient(jd(t.content.state),t.content.datas)},a.v2ChatroomBeKickedHandler=function v2ChatroomBeKickedHandler(t){var a=t.content,c=a.kickedReason,_=a.serverExtension;this.clientSocket.doDisconnect(hp.KICKED,c),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new F_({code:Df.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),c),this.core.emit("onChatroomKicked",{kickedReason:c,serverExtension:_})},ze(V2NIMChatroomLoginServiceImpl,[{key:"clientSocket",get:function get(){return this.core.clientSocket}},{key:"account",get:function get(){return this.core.options.account}},{key:"appkey",get:function get(){return this.core.options.appkey}},{key:"deviceId",get:function get(){return this.core.config.deviceId}},{key:"clientSession",get:function get(){return this.core.config.clientSession}}]),V2NIMChatroomLoginServiceImpl}(lh),_h={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},dh=function(){function ReporterHookLinkKeep(t,a){this.traceData=_h,this.core=t,this.traceData=ba({},_h,a),this.traceData.extension=[]}var t=ReporterHookLinkKeep.prototype;return t.reset=function reset(){this.traceData=ba({},_h),this.traceData.extension=[]},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function update(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a,c,_;return Sa.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,zl.net.getNetworkStatus();case 2:a=E.sent,c=a.net_type,_=a.net_connect,this.traceData.extension.push(ba({code:0,description:"",foreground:!0,foreg_backg_switch:!1,net_type:c,net_connect:_},t));case 6:case"end":return E.stop()}}),_callee,this)})))},t.end=function end(t){var a=this.traceData.extension[0],c=this.traceData.extension[1];if(a&&0===a.operation_type&&c&&1===c.operation_type){var _=a.net_type!==c.net_type||a.net_connect!==c.net_connect;if(t||!_)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},ReporterHookLinkKeep}(),ph="V2NIMChatroomInfoService",Eh={"36_13":"v2GetChatroomInfo","36_14":"v2UpdateChatroomInfo","36_30":"v2SetTempChatBannedByTag","13_33":"v2UpdateChatroomLocation","36_34":"v2UpdateChatroomTags"},fh={tags:{id:1,converter:function converter(t){return iu(t)}},notifyTargetTags:2,notificationEnabled:{id:3,converter:function converter(t){return+t}},notificationExtension:4},hh={v2GetChatroomInfo:{sid:36,cid:13,service:ph,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(Af)}]},v2UpdateChatroomInfo:{sid:36,cid:14,service:ph,params:[{type:"Property",name:"chatroom",reflectMapper:Af},{type:"Bool",name:"notificationEnabled"},{type:"String",name:"notificationExtension"}]},v2SetTempChatBannedByTag:{sid:36,cid:30,service:ph,params:[{type:"Property",name:"tag",reflectMapper:{targetTag:1,duration:2,notificationEnabled:{id:3,converter:function converter(t){return+t}},notificationExtension:4,notifyTargetTags:5}}]},v2UpdateChatroomLocation:{sid:13,cid:33,service:ph,params:[{type:"Property",name:"tag",reflectMapper:{x:1,y:2,z:3,distance:4}}]},v2UpdateChatroomTags:{sid:36,cid:34,service:ph,params:[{type:"Property",name:"tag",reflectMapper:fh}]}},mh=function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a)return a.call(this,t);var c=Nd(t,"error.detail.ignore");return t.error&&!c?da.reject(t.error):da.resolve(t)},Service}(),gh=function(){function V2NIMChatroomInfoModel(){this.chatroomInfo=null}return V2NIMChatroomInfoModel.prototype.reset=function reset(){this.chatroomInfo=null},V2NIMChatroomInfoModel}();var Ih=function basePick(t,a){return rf(t,a,(function(a,c){return $E(t,c)}))},Th=Cs?Cs.isConcatSpreadable:void 0;var Nh=function isFlattenable(t){return Hc(t)||Bc(t)||!!(Th&&t&&t[Th])};var vh=function baseFlatten(t,a,c,_,E){var h=-1,m=t.length;for(c||(c=Nh),E||(E=[]);++h<m;){var g=t[h];a>0&&c(g)?a>1?baseFlatten(g,a-1,c,_,E):cE(E,g):_||(E[E.length]=g)}return E};var Mh=function flatten(t){return(null==t?0:t.length)?vh(t,1):[]};var Oh=function flatRest(t){return bl(Sl(t,void 0,Mh),t+"")}((function(t,a){return null==t?{}:Ih(t,a)})),Sh=function(t){function V2NIMChatroomInfoServiceImpl(a){var c;return c=t.call(this,"V2NIMChatroomInfoService",a)||this,registerParser({cmdMap:Eh,cmdConfig:hh}),c.model=new gh,c.setListener(),c}yt(V2NIMChatroomInfoServiceImpl,t);var a=V2NIMChatroomInfoServiceImpl.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMChatroomMessageService/onReceiveNotification",(function(a,c){return __awaiter(t,void 0,void 0,Sa.mark((function _callee(){var t,_,E,h,m,g;return Sa.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:I.t0=a.attachment.type,I.next=I.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROOM_INFO_UPDATED?3:13;break;case 3:return E=null===(t=c.data.roomInfo)||void 0===t?void 0:t.extension,h=null===(_=c.data.roomInfo)||void 0===_?void 0:_.queueLevel,delete(m=ba(ba(ba({},c.data.roomInfo||{}),void 0!==E?{serverExtension:E}:{}),void 0!==h?{queueLevelMode:h}:{})).extension,delete m.queueLevel,I.next=10,this._updateChatroomInfo(m);case 10:return g=I.sent,this.core.V2NIMChatroomService.emit("onChatroomInfoUpdated",g),I.abrupt("break",13);case 13:case"end":return I.stop()}}),_callee,this)})))}))},a.reset=function reset(){this.model.reset()},a.getChatroomInfo=function getChatroomInfo(){return this.model.chatroomInfo},a.updateChatroomInfo=function updateChatroomInfo(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var c;return Sa.wrap((function _callee2$(_){for(;;)switch(_.prev=_.next){case 0:if(validate(nh,{updateParams:t,antispamConfig:a},"",!0),t.announcement||t.liveUrl||t.roomName||t.serverExtension){_.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"updateParams.announcement, updateParams.liveUrl, updateParams.roomName, updateParams.serverExtension 至少有一个不为空"}});case 3:return c=void 0===t.notificationEnabled||t.notificationEnabled,_.next=6,this.core.sendCmd("v2UpdateChatroomInfo",{chatroom:t,notificationEnabled:c,notificationExtension:t.notificationExtension||""});case 6:this._updateChatroomInfo(Oh(t,["announcement","liveUrl","roomName","serverExtension"]));case 7:case"end":return _.stop()}}),_callee2,this)})))},a.updateChatroomLocationInfo=function updateChatroomLocationInfo(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){return Sa.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate(oh,t,"",!0),a.next=3,this.core.sendCmd("v2UpdateChatroomLocation",{tag:ba(ba({},t.locationInfo),{distance:t.distance})});case 3:case"end":return a.stop()}}),_callee3,this)})))},a.updateChatroomTags=function updateChatroomTags(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){return Sa.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(validate(ih,{updateParams:t},"",!0),t.tags||void 0!==t.notifyTargetTags){a.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"updateParams.tags, updateParams.notifyTargetTags 至少有一个不为空"}});case 3:return t.notificationEnabled=void 0===t.notificationEnabled||t.notificationEnabled,a.next=6,this.core.sendCmd("v2UpdateChatroomTags",{tag:t});case 6:case"end":return a.stop()}}),_callee4,this)})))},a.setTempChatBannedByTag=function setTempChatBannedByTag(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){return Sa.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate(ah,t,"",!0),t.notificationEnabled=void 0===t.notificationEnabled||t.notificationEnabled,a.next=4,this.core.sendCmd("v2SetTempChatBannedByTag",{tag:t});case 4:case"end":return a.stop()}}),_callee5,this)})))},a._updateChatroomInfo=function _updateChatroomInfo(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee6(){return Sa.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.model.chatroomInfo){a.next=4;break}ba(this.model.chatroomInfo,t),a.next=6;break;case 4:return a.next=6,this._getChatroomInfoAsync();case 6:return a.abrupt("return",this.model.chatroomInfo);case 7:case"end":return a.stop()}}),_callee6,this)})))},a._getChatroomInfoAsync=function _getChatroomInfoAsync(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee7(){var t;return Sa.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("v2GetChatroomInfo");case 2:t=a.sent,this._setChatroomInfo(t.content.data);case 4:case"end":return a.stop()}}),_callee7,this)})))},a._setChatroomInfo=function _setChatroomInfo(t){this.model.chatroomInfo=t},V2NIMChatroomInfoServiceImpl}(mh),Ah=function(){function NOS(t,a){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=t,this.cloudStorage=a}var t=NOS.prototype;return t.reset=function reset(){this.nosErrorCount=0},t.getNosAccessToken=function getNosAccessToken(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a,c,_;return Sa.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.core.sendCmd("getNosAccessToken",{tag:t});case 2:return a=E.sent,c=Nd(a,"content.nosAccessTokenTag.token"),_=t.url,E.abrupt("return",{token:c,url:-1!==indexOf(_).call(_,"?")?_+"&token="+c:_+"?token="+c});case 6:case"end":return E.stop()}}),_callee,this)})))},t.deleteNosAccessToken=function deleteNosAccessToken(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:t});case 2:case"end":return a.stop()}}),_callee2,this)})))},t.nosUpload=function nosUpload(t,a){var c,_,E,h,m,g,I,T;return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var N,M,O,S,A,C,R,b,D,k,V,L,P,w,x,U,G,B,H;return Sa.wrap((function _callee3$(Y){for(;;)switch(Y.prev=Y.next){case 0:if(N=Nd(this.core,"config.cdn.bucket"),M={tag:t.nosScenes||N||"nim"},t.nosSurvivalTime&&(M.expireSec=t.nosSurvivalTime),O=this.core.adapters.getFileUploadInformation(t),!(!a&&!O)){Y.next=18;break}return Y.prev=6,Y.next=9,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:M});case 9:S=Y.sent,Y.next=18;break;case 12:if(Y.prev=12,Y.t0=Y.catch(6),this.core.logger.error("uploadFile:: getNosToken error",Y.t0),!(Y.t0 instanceof F_)){Y.next=17;break}throw Y.t0;case 17:throw new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:Y.t0,curProvider:1}});case 18:return A=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",O?null===(c=O.uploadInfo)||void 0===c?void 0:c.objectName:a?null==a?void 0:a.objectName:S.content.nosToken.objectName),C="",a&&a.shortUrl&&(C=a.shortUrl),(null===(h=null===(E=null===(_=null==O?void 0:O.uploadInfo)||void 0===_?void 0:_.payload)||void 0===E?void 0:E.mixStoreToken)||void 0===h?void 0:h.shortUrl)&&(C=O.uploadInfo.payload.mixStoreToken.shortUrl),R=C||A,Y.prev=23,D=O?{token:null===(m=null==O?void 0:O.uploadInfo)||void 0===m?void 0:m.token,bucket:null===(g=null==O?void 0:O.uploadInfo)||void 0===g?void 0:g.bucketName,objectName:null===(I=null==O?void 0:O.uploadInfo)||void 0===I?void 0:I.objectName}:a||S.content.nosToken,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:D,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,platform:zl.platform}),k="BROWSER"===zl.platform?this.config.chunkUploadHost:this.config.commonUploadHost?this.config.commonUploadHost+"/"+(D&&D.bucket):"https://nos.netease.com/nim",this.core.reporterHookCloudStorage.update({remote_addr:k,operation_type:a?2:0}),Y.next=30,this.core.adapters.uploadFile(ba(ba(ba({},t),{nosToken:D,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,maxSize:t.maxSize||this.config.chunkMaxSize}),a?{payload:{mixStoreToken:a}}:{}));case 30:b=Y.sent,Y.next=65;break;case 33:if(Y.prev=33,Y.t1=Y.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",Y.t1),V="v2"===Nd(this.core,"options.apiVersion"),Y.t1.code!==U_.V2NIM_ERROR_CODE_CANCELLED&&10499!==Y.t1.errCode){Y.next=39;break}throw new Y_({code:V?U_.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Nd(Y.t1,"message")||"Request abort",rawError:Y.t1,curProvider:1}});case 39:if(!V||Y.t1.errCode!==U_.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){Y.next=41;break}throw new F_({code:U_.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Nd(Y.t1,"message")||"Read file failed",rawError:Y.t1,curProvider:1}});case 41:return Y.next=43,zl.net.getNetworkStatus();case 43:if(L=Y.sent,!1!==L.net_connect){Y.next=47;break}throw new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:Y.t1,curProvider:1}});case 47:if(!a){Y.next=64;break}if(0!==this.nosErrorCount){Y.next=60;break}Y.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),Y.next=56;break;case 53:throw Y.prev=53,Y.t2=Y.catch(49),new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:Y.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:t.file||t.filePath}});case 56:return this.nosErrorCount=Nd(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),Y.abrupt("return",this.cloudStorage._uploadFile(t));case 60:return this.nosErrorCount--,Y.abrupt("return",this.nosUpload(t,a));case 62:Y.next=65;break;case 64:throw new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:Y.t1,curProvider:1}});case 65:if(P=null==b?void 0:b.type,w=P&&indexOf(P).call(P,"/")>-1?slice(P).call(P,0,indexOf(P).call(P,"/")):"",(x={image:"imageInfo",video:"vinfo",audio:"vinfo"})[w]){Y.next=70;break}return Y.abrupt("return",ba({url:R},b));case 70:return Y.prev=70,Y.next=73,this.core.adapters.request(A+"?"+x[w],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 73:U=Y.sent,Y.next=80;break;case 76:return Y.prev=76,Y.t3=Y.catch(70),this.core.logger.error("uploadFile:: fetch file info error",Y.t3),Y.abrupt("return",ba({url:R},b));case 80:if(!U){Y.next=87;break}return G=U.data,B="imageInfo"===x[w]?G:null===(T=null==G?void 0:G.GetVideoInfo)||void 0===T?void 0:T.VideoInfo,H={url:R,name:b.name,size:b.size,ext:b.ext,w:B.Width,h:B.Height,orientation:B.Orientation,dur:B.Duration,audioCodec:B.AudioCodec,videoCodec:B.VideoCodec,container:B.Container},Y.abrupt("return",pf(H,(function(t,a){return void 0!==a})));case 87:return Y.abrupt("return",ba({url:R},b));case 88:case"end":return Y.stop()}}),_callee3,this,[[6,12],[23,33],[49,53],[70,76]])})))},t._getNosCdnHost=function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a,c,_,E=this;return Sa.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=h.sent,h.next=10;break;case 6:return h.prev=6,h.t0=h.catch(0),this.core.logger.error("getNosCdnHost::error",h.t0),h.abrupt("return");case 10:if(a){h.next=12;break}return h.abrupt("return");case 12:c=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(_=jd(null==c?void 0:c.expire))&&c.cdnDomain?-1===_?(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix):(this.config.cdn.bucket=c.bucket,this.config.cdn.cdnDomain=c.cdnDomain,this.config.cdn.objectNamePrefix=c.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){E._getNosCdnHost()}),1e3*_)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return h.stop()}}),_callee4,this,[[0,6]])})))},ze(NOS,[{key:"config",get:function get(){return this.cloudStorage.config}}]),NOS}();var Ch=function baseForOwn(t,a){return t&&vc(t,a,Bp)};var Rh=function baseInverter(t,a,c,_){return Ch(t,(function(t,E,h){a(_,c(t),E,h)})),_};var yh,bh,Dh=function createInverter(t,a){return function(c,_){return Rh(c,t,a(_),{})}},kh=Object.prototype.toString,Vh=Dh((function(t,a,c){null!=a&&"function"!=typeof a.toString&&(a=kh.call(a)),t[a]=c}),Al(vl)),Lh={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Ph={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},wh={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Ph.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:Vh(Ph.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Ph.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Vh(Ph.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Vh(Ph.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:Vh(Ph.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Vh(Ph.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Ph.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Vh(Ph.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Ph.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Vh(Ph.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ph.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:Vh(Ph.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Ph.nosAccessTokenTag}]}},xh={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},Uh={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(yh||(yh={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(bh||(bh={}));var Gh={chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0},Fh=function(){function MixStorage(t,a){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=yh.nos,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=t,this.cloudStorage=a,this.logger=t.logger}var t=MixStorage.prototype;return t.reset=function reset(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=yh.nos,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var c,_;return Sa.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:if(zl.localStorage)try{zl.localStorage.getItem&&zl.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(zl.localStorage.getItem(this.GRAYKEY))[t])}catch(t){zl.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){E.next=17;break}return E.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(c=E.sent).content||!c.content.grayConfigTag){E.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(c.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(c.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){E.next=10;break}return E.abrupt("return");case 10:_=zl.localStorage.getItem(this.GRAYKEY)?JSON.parse(zl.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),_[t]=this.grayConfig,zl.localStorage.setItem(this.GRAYKEY,iu(_)),E.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",c.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){E.next=20;break}return E.next=20,this._getMixStorePolicy(t);case 20:case"end":return E.stop()}}),_callee,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var a,c,_,E,h,m,g;return Sa.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if(a=(new Date).getTime(),zl.localStorage)try{this.mixStorePolicy=JSON.parse(zl.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=jd(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(_=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(c=this._getMixStorePolicy).call(c,this,t),_))}catch(a){zl.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(zl.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){I.next=30;break}return I.prev=3,I.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:h=I.sent,m=h.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(m.ttl),this.mixStorePolicy.providers=m.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=jd(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=m.nosPolicy?JSON.parse(m.nosPolicy):null,this.mixStorePolicy.s3Policy=m.s3Policy?JSON.parse(m.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(E=this._getMixStorePolicy).call(E,this,t),1e3*this.mixStorePolicy.ttl),g=zl.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(zl.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),g[t]=this.mixStorePolicy,zl.localStorage.setItem(this.MIXSTOREKEY,iu(g)),I.next=30;break;case 23:if(I.prev=23,I.t0=I.catch(3),this.logger.error("getMixStorePolicy error",I.t0),0!==this.mixStoreErrorCount){I.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return I.stop()}}),_callee2,this,[[3,23]])})))},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,c=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(c===a[0])throw new Error("uploadFile all policy fail");var _=Nd(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(_&&_.retryNext&&c&&(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+c),this.curProvider=jd(c),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var E=this.mixStorePolicy[this.curProvider===yh.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!E||0===E)return;this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+jd(t.mixStorePolicy.providers[0])),t.curProvider=jd(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*E)}},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var a;return Sa.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=c.sent,c.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return c.stop()}}),_callee3,this)})))},MixStorage}(),Bh=wd.trim,Hh=A("".charAt),Yh=E.parseFloat,jh=E.Symbol,Kh=jh&&jh.iterator,Wh=1/Yh(Dd+"-0")!=-1/0||Kh&&!fails((function(){Yh(Object(Kh))}))?function parseFloat(t){var a=Bh(toString$1(t)),c=Yh(a);return 0===c&&"-"==Hh(a,0)?-0:c}:Yh;_export({global:!0,forced:parseFloat!=Wh},{parseFloat:Wh});var qh=Y.parseFloat,zh=function(){function AWS(t,a){this.s3=null,this.core=t,this.cloudStorage=a,this.logger=t.logger}return AWS.prototype.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var c,_,E,h,m,g,I,T,N,M,O=this;return Sa.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:if(!t.file){S.next=4;break}c=t.file,S.next=19;break;case 4:if("string"!=typeof t.fileInput){S.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((_=document.getElementById(t.fileInput))&&_.files&&_.files[0])){S.next=11;break}c=_.files[0],S.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:S.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){S.next=18;break}c=t.fileInput.files[0],S.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){S.next=21;break}throw new Error("dont get s3 policy");case 21:return E={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},h=this.s3,(m=new h).config.update(E),g=decodeURIComponent(a.bucket),I=decodeURIComponent(a.objectName),N={Bucket:g,Key:I,Body:T=c,Metadata:{token:a.token},ContentType:T.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",N),(M=m.upload(N)).on("httpUploadProgress",(function(a){var c=qh((a.loaded/a.total).toFixed(2));t.onUploadProgress&&t.onUploadProgress({total:a.total,loaded:a.loaded,percentage:c,percentageText:Math.round(100*c)+"%"})})),S.abrupt("return",new da((function(c,_){var E=(new Date).getTime();M.send((function(h,m){return __awaiter(O,void 0,void 0,Sa.mark((function _callee(){var N,M,O,S,A;return Sa.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:if(!h||"RequestAbortedError"!==h.code){C.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",h),_(new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:h,curProvider:2}})),C.next=31;break;case 5:if(!h){C.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",h),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(M=null===(N=this.core)||void 0===N?void 0:N.auth)||void 0===M?void 0:M.account),trace_id:null===(O=this.core.clientSocket.socket)||void 0===O?void 0:O.sessionId,start_time:E,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof h.status?h.status:"number"==typeof h.code?h.code:0,description:h.message||""+h.code,operation_type:1,target:iu({bucket:g,object:I})},{asyncParams:zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),C.next=12,zl.net.getNetworkStatus();case 12:if(S=C.sent,!1!==S.net_connect){C.next=16;break}return C.abrupt("return",_(new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:h,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:C.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),C.next=23;break;case 20:return C.prev=20,C.t0=C.catch(16),C.abrupt("return",_(new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:C.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:t.file||t.filePath}})));case 23:c(this.cloudStorage._uploadFile(t)),C.next=31;break;case 26:A=(A=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn),this.core.reporterHookCloudStorage.update({remote_addr:A,operation_type:1}),A=A.replace("{objectName}",m.Key),c({size:T.size,name:T.name,url:a.shortUrl?a.shortUrl:A,ext:T.name.split(".")[1]||"unknown"});case 31:case"end":return C.stop()}}),_callee,this,[[16,20]])})))})),t.onUploadStart&&t.onUploadStart(M)})));case 33:case"end":return S.stop()}}),_callee2,this)})))},ze(AWS,[{key:"mixStorePolicy",get:function get(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),AWS}();function getUploadResponseFormat(t){return void 0===t&&(t="file"),iu(xh[t]||{}).replace(/"/gi,'\\"')}var $h=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=t.logger,this.core=t,this.nos=new Ah(t,this),this.mixStorage=new Fh(t,this),this.aws=new zh(t,this),registerParser({cmdMap:Lh,cmdConfig:wh}),this.setOptions(a),this.setListeners()}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=a+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=a+"-AllMixStorePolicy";var c=t.s3,_=__rest(t,["s3"]),E=ba({},Gh,this.config);if(_&&Object.prototype.hasOwnProperty.call(_,"cdn")){var h=ba(ba({},E.cdn),_.cdn);this.config=ba({},E,_),this.config.cdn=h}else this.config=ba({},E,_);c&&(this.aws.s3=c)},t.setListeners=function setListeners(){var t,a,c,_;this.core.eventBus.on("kicked",bind$1(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("disconnect",bind$1(a=this._clearUnCompleteTask).call(a,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",bind$1(c=this._clearUnCompleteTask).call(c,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",bind$1(_=this._clearUnCompleteTask).call(_,this))},t._clearUnCompleteTask=function _clearUnCompleteTask(){var t,a=this;forEach$1(t=Ja(this.uploadTaskMap)).call(t,(function(t){var c=a.uploadTaskMap[t];c&&c.abort&&c.abort()})),this.uploadTaskMap={}},t.init=function init(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){return Sa.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){t.next=5;break}return t.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return t.next=7,this.nos._getNosCdnHost();case 7:case"end":return t.stop()}}),_callee,this)})))},t.processCallback=function processCallback(t,a){var c=this,_=t.onUploadProgress,E=t.onUploadDone,h=t.onUploadStart;return{onUploadStart:"function"==typeof h?function(t){c.uploadTaskMap[a]=t;try{h(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",t)}}:function(t){c.uploadTaskMap[a]=t},onUploadProgress:"function"==typeof _?function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded});try{_(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",t)}}:function(t){c.core.reporterHookCloudStorage.update({transferred_size:t.loaded})},onUploadDone:"function"==typeof E?function(t){c.core.reporterHookCloudStorage.end(0);try{E(t)}catch(t){c.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",t)}}:function(){c.core.reporterHookCloudStorage.end(0)},taskKey:a}},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var a,c,_,E,h,m,g,I;return Sa.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){T.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){T.next=7;break}if(!(a=Nd(t,"file.type"))||"string"!=typeof a||-1!==indexOf(a).call(a,t.type)){T.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),t.file?this.core.reporterHookCloudStorage.update({full_size:t.file.size}):"string"==typeof t.fileInput?(c=document.getElementById(t.fileInput))&&c.files&&c.files[0]&&this.core.reporterHookCloudStorage.update({full_size:c.files[0].size}):t.fileInput&&t.fileInput.files&&t.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:t.fileInput.files[0].size}),_=Yp(),E=this.processCallback(t,_),h=E.onUploadStart,m=E.onUploadProgress,g=E.onUploadDone,t.onUploadStart=h,t.onUploadProgress=m,t.onUploadDone=g,I=null,T.prev=15,T.next=18,this._uploadFile(t);case 18:I=T.sent,delete this.uploadTaskMap[_],T.next=27;break;case 22:throw T.prev=22,T.t0=T.catch(15),delete this.uploadTaskMap[_],this.core.reporterHookCloudStorage.end((T.t0&&T.t0.code)===U_.V2NIM_ERROR_CODE_CANCELLED?3:1),T.t0;case 27:return I&&(I.size=void 0===I.size?void 0:Number(I.size),I.w=void 0===I.w?void 0:Number(I.w),I.h=void 0===I.h?void 0:Number(I.h),I.dur=void 0===I.dur?void 0:Number(I.dur)),I.url=decodeURIComponent(I.url),t.onUploadDone({size:I.size,name:I.name,url:I.url,ext:I.name.split(".")[1]||"unknown"}),T.abrupt("return",I);case 31:case"end":return T.stop()}}),_callee2,this,[[15,22]])})))},t._uploadFile=function _uploadFile(t){var a,c;return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var _,E,h,m;return Sa.wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(Nd(this.mixStorage,"grayConfig.mixStoreEnable")&&Nd(this.mixStorage,"mixStorePolicy.providers.length")){g.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),g.abrupt("return",this.nos.nosUpload(t));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Nd(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Nd(this.mixStorage,"curProvider")),_=this.core.adapters.getFileUploadInformation(t),E=!0,_?!1===_.complete&&this.mixStorage.curProvider===yh.s3&&(E=!1):E=!1,this.aws.s3||(this.mixStorage.curProvider=yh.nos),h=Uh,E){g.next=23;break}return g.prev=10,g.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:t.nosSurvivalTime,returnBody:getUploadResponseFormat(t.type)}});case 13:m=g.sent,h=m.content.mixStoreTokenResTag,g.next=23;break;case 17:if(g.prev=17,g.t0=g.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",g.t0),!(g.t0 instanceof F_)){g.next=22;break}throw g.t0;case 22:throw new Y_({code:"v2"===Nd(this.core,"options.apiVersion")?U_.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:g.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(E){g.next=27;break}return g.abrupt("return",this.mixStorage.curProvider===yh.s3?this.aws.s3Upload(t,h):this.nos.nosUpload(t,h));case 27:return g.abrupt("return",this.nos.nosUpload(t,null===(c=null===(a=null==_?void 0:_.uploadInfo)||void 0===a?void 0:a.payload)||void 0===c?void 0:c.mixStoreToken));case 28:case"end":return g.stop()}}),_callee3,this,[[10,17]])})))},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var c=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);c[0];var _=c[1];c[2];var E=c[3];c[4];var h=c[5];if(c[6],c[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var m=this._getUrlType(t);return m===yh.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",h)),m===yh.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",h)),t}var g=this.config,I=g.downloadUrl,T=g.downloadHostList,N=g.nosCdnEnable,M=this.config.cdn.cdnDomain,O=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",S=decodeURIComponent(h),A=indexOf(S).call(S,O);if(M&&A>-1&&N)return""+_+M+"/"+slice(S).call(S,A);if(includes(T).call(T,E)&&includes(h).call(h,"/")){var C=indexOf(h).call(h,"/"),R=h.substring(0,C),b=h.substring(C+1);return I.replace("{bucket}",R).replace("{object}",b)}var D=filter(T).call(T,(function(t){return"string"==typeof E&&includes(E).call(E,t)}))[0],k=D?E.replace(D,"").replace(/\W/g,""):null;return k?I.replace("{bucket}",k).replace("{object}",h):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a;return Sa.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if("string"==typeof t&&includes(t).call(t,"_im_url=1")){c.next=2;break}return c.abrupt("return",t);case 2:return c.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 4:return a=c.sent,c.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 6:case"end":return c.stop()}}),_callee4,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var a,c,_,E,h,m=this;return Sa.wrap((function _callee5$(g){for(;;)switch(g.prev=g.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,c=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(bh.dontNeed)||c!==String(bh.dontNeed)){g.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==bh.time){g.next=17;break}if(!(a&&indexOf(a).call(a,String(bh.time))>=0||c&&indexOf(c).call(c,String(bh.time))>0)){g.next=13;break}return g.abrupt("return",this.mixStorage.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:g.next=33;break;case 17:if(t.urls&&t.urls.length){g.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(E=[],h=[],forEach$1(_=t.urls).call(_,(function(t){var a=m._getUrlType(t);a===yh.nos&&h.push(t),a===yh.s3&&E.push(t)})),(!c||0!==E.length&&indexOf(c).call(c,String(bh.urls))<0)&&(this.logger.warn("s3 url don't support url token"),E=[]),(!a||0!==h.length&&indexOf(a).call(a,String(bh.urls))<0)&&(this.logger.warn("nos url don't support url token"),h=[]),0!==E.length||0!==h.length){g.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==E.length&&0!==h.length){g.next=33;break}return t.urls=iu(t.urls),g.abrupt("return",this.mixStorage.getFileAuthToken(t));case 33:case"end":return g.stop()}}),_callee5,this)})))},t._getUrlType=function _getUrlType(t){var a,c;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?yh.nos:this.mixStorePolicy.s3Policy&&some(c=this.mixStorePolicy.s3Policy.dlcdns).call(c,(function(a){return indexOf(t).call(t,a)>=0}))?yh.s3:null},t.getNosAccessToken=function getNosAccessToken(t){return validate({url:{type:"string",allowEmpty:!1}},t),this.nos.getNosAccessToken(t)},t.deleteNosAccessToken=function deleteNosAccessToken(t){return validate({token:{type:"string",allowEmpty:!1}},t),this.nos.deleteNosAccessToken(t)},t.process=function process(t){var a=Nd(t,"error.detail.ignore");return t.error&&!a?da.reject(t.error):da.resolve(t)},ze(CloudStorageService,[{key:"grayConfig",get:function get(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function get(){return this.mixStorage.mixStorePolicy}}]),CloudStorageService}();function getFileOrPath(t){var a="object"==typeof t?t:void 0,c="string"==typeof t?t:void 0;if(!a&&!c)throw new F_({code:U_.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof c)if(0===indexOf(c).call(c,"nim-external")){var _=document.getElementById(c);if(!(_&&_.files&&_.files[0]))throw new F_({code:U_.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+c}});a=_.files[0]}else if("BROWSER"===zl.platform)throw new F_({code:U_.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+c}});if("object"==typeof a&&void 0===a.size)throw new F_({code:U_.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:a,path:c}}var Xh=function(t){function V2Service(a,c){var _;return(_=t.call(this)||this).name=a,_.logger=c.logger,_.core=c,_}yt(V2Service,t);var a=V2Service.prototype;return a.checkV2=function checkV2(){var t=this.core.options.apiVersion;if("v2"===t)return!0;throw new F_({code:U_.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+t+'" of client is not supported.'}})},a.emit=function emit(a){var c=this;try{for(var _,E,h=arguments.length,m=new Array(h>1?h-1:0),g=1;g<h;g++)m[g-1]=arguments[g];this.logger.debug(this.name+'::emit event: "'+a.toString()+'",',void 0!==m[0]?m[0]:"",void 0!==m[1]?m[1]:"",void 0!==m[2]?m[2]:"");var I=(_=t.prototype.emit).call.apply(_,concat(E=[this,a]).call(E,m));return I}catch(t){return ns((function(){throw c.logger.error(c.name+"::emit throw error in setTimeout. event: "+a.toString()+". Error",t),t}),0),!1}},a.process=function process(t){var a=this[t.cmd+"Handler"];if("function"==typeof a){if(t.error)return this.logger.error(t.cmd+"::recvError",t.error),da.reject(t.error);try{var c=a.call(this,t);return da.resolve(c)}catch(t){return da.reject(t)}}var _=Nd(t,"error.detail.ignore");return t.error&&!_?da.reject(t.error):da.resolve(t)},V2Service}(nd),Jh=function(t){function V2NIMStorageUtil(a){var c;return(c=t.call(this,"V2NIMStorageUtil",a)||this).core=a,c}yt(V2NIMStorageUtil,t);var a=V2NIMStorageUtil.prototype;return a.imageThumbUrl=function imageThumbUrl(t,a){return t+"?imageView&thumbnail="+a+"z"+a},a.videoCoverUrl=function videoCoverUrl(t,a){return t+"?vframe&offset="+a},V2NIMStorageUtil}(Xh),Qh=function(t){function V2NIMStorageServiceImpl(a){var c;return(c=t.call(this,"V2NIMStorageService",a)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},c.uploadingMessageInfo={},c.core=a,c.core.V2NIMStorageUtil=new Jh(c.core),c}yt(V2NIMStorageServiceImpl,t);var a=V2NIMStorageServiceImpl.prototype;return a.addCustomStorageScene=function addCustomStorageScene(t,a){return this.checkV2(),validate({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:t,expireTime:a},"",!0),this.sceneMap[t]={sceneName:t,expireTime:a},{sceneName:t,expireTime:a}},a.getStorageSceneList=function getStorageSceneList(){return this.checkV2(),Pa(this.sceneMap)},a.getStorageScene=function getStorageScene(t){return t&&this.sceneMap[t]||this.sceneMap.nim_default_im},a.hasStorageScene=function hasStorageScene(t){return void 0!==this.sceneMap[t]},a.createUploadFileTask=function createUploadFileTask(t){var a;if(this.checkV2(),"string"==typeof t.fileObj&&0===indexOf(a=t.fileObj).call(a,"nim-external")){var c=document.getElementById(t.fileObj);c&&c.files&&c.files[0]&&(t.fileObj=c.files[0])}return{taskId:Yp(),uploadParams:t}},a.uploadFile=function uploadFile(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var c;return Sa.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:return this.checkV2(),validate({taskId:{type:"string",allowEmpty:!1}},t,"fileTask",!0),_.next=4,this._uploadFile(t,a);case 4:return c=_.sent,_.abrupt("return",c[0]);case 6:case"end":return _.stop()}}),_callee,this)})))},a._uploadFile=function _uploadFile(t,a,c){var _;return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var E,h,m,g,I,T,N,M,O,S,A=this;return Sa.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){C.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(E=t.uploadParams,h=t.taskId,m=getFileOrPath(E.fileObj),g=m.file,I=m.path,T=(c||{}).fileType,!this.uploadingMessageInfo[h]){C.next=7;break}throw new F_({code:U_.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(C.prev=7,N={},g?N.file=g:I&&(0===(null==I?void 0:indexOf(I).call(I,"nim-external"))?N.fileInput=I:N.filePath=I),M=this.getStorageScene(E.sceneName),N.nosScenes=M.sceneName,N.nosSurvivalTime=M.expireTime,T===s_.V2NIM_MESSAGE_TYPE_IMAGE?N.type="image":T===s_.V2NIM_MESSAGE_TYPE_AUDIO?N.type="audio":T===s_.V2NIM_MESSAGE_TYPE_VIDEO?N.type="video":N.type="file",!N.file||!this.core.pluginMap["browser-md5-file"]){C.next=19;break}return C.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],h,N.file);case 17:O=C.sent,N.md5=O;case 19:return N.onUploadProgress=function(t){"function"==typeof a&&a(100*t.percentage)},N.onUploadStart=function(t){var a;if(null===(a=A.uploadingMessageInfo[h])||void 0===a?void 0:a.abort)return t.abort(),void delete A.uploadingMessageInfo[h];A.uploadingMessageInfo[h]={abort:!1,task:t}},this.uploadingMessageInfo[h]={abort:!1},C.next=24,this.core.cloudStorage.uploadFile(N);case 24:if(S=C.sent,!(null===(_=this.uploadingMessageInfo[h])||void 0===_?void 0:_.abort)){C.next=27;break}throw new F_({code:U_.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[h],C.abrupt("return",[S.url,S]);case 31:throw C.prev=31,C.t0=C.catch(7),delete this.uploadingMessageInfo[h],this.core.logger.error("sendFile:: upload File error or abort.",C.t0),C.t0;case 36:case"end":return C.stop()}}),_callee2,this,[[7,31]])})))},a.cancelUploadFile=function cancelUploadFile(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){return Sa.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.next=3,this._cancelUploadFile(t.taskId);case 3:case"end":return a.stop()}}),_callee3,this)})))},a._cancelUploadFile=function _cancelUploadFile(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var a;return Sa.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(this.checkV2(),!(null==(a=this.uploadingMessageInfo[t])?void 0:a.task)){c.next=16;break}return c.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),c.next=7,a.task.abort();case 7:delete this.uploadingMessageInfo[t],c.next=14;break;case 10:c.prev=10,c.t0=c.catch(3),delete this.uploadingMessageInfo[t],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",c.t0);case 14:c.next=22;break;case 16:if(!a){c.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),a.abort=!0,c.next=22;break;case 21:throw new F_({code:U_.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return c.stop()}}),_callee4,this,[[3,10]])})))},a.getFileMd5=function getFileMd5(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var _=this;return Sa.wrap((function _callee5$(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",new da((function(E,h){var m,g=new t;(null===(m=_.uploadingMessageInfo[a])||void 0===m?void 0:m.abort)?h(new F_({code:U_.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):_.uploadingMessageInfo[a]={abort:!1,task:g};try{g.md5(c,(function(t,a){"aborted"===t?h(new F_({code:U_.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:t}})):t?h(new F_({code:U_.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:t}})):E(a)}))}catch(t){h(new F_({code:U_.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:t}}))}})));case 1:case"end":return E.stop()}}),_callee5)})))},a.shortUrlToLong=function shortUrlToLong(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee6(){return Sa.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this.checkV2(),a.abrupt("return",this.core.cloudStorage.getOriginUrl(t));case 2:case"end":return a.stop()}}),_callee6,this)})))},a.videoCoverUrl=function videoCoverUrl(t,a){return this.checkV2(),this.core.V2NIMStorageUtil.videoCoverUrl(t,a)},a.imageThumbUrl=function imageThumbUrl(t,a){return this.checkV2(),this.core.V2NIMStorageUtil.imageThumbUrl(t,a)},V2NIMStorageServiceImpl}(Xh),Zh=function(){function FileUtil(t,a){this.core=t,this.service=a}var t=FileUtil.prototype;return t.doSendFile=function doSendFile(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var c,_,E,h,m,g,I,T;return Sa.wrap((function _callee$(N){for(;;)switch(N.prev=N.next){case 0:return c=t.attachment,N.prev=1,N.next=4,this.core.V2NIMStorageService._uploadFile({taskId:t.messageClientId,uploadParams:{fileObj:(null==c?void 0:c.file)||(null==c?void 0:c.path),sceneName:null==c?void 0:c.sceneName}},a,{fileType:t.messageType});case 4:for(I in(E=N.sent)[0],h=E[1],m=ba(ba({},c),{uploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS}),h.w&&(m.width=m.width||h.w),h.h&&(m.height=m.height||h.h),h.dur&&(m.duration=m.duration||h.dur),m.ext=m.ext&&-1===indexOf(_=m.ext).call(_,".")?"."+m.ext:m.ext,g=["w","h","dur","ext","name"],h)includes(g).call(g,I)||(m[I]=h[I]);m.raw,m.file,m.path,T=__rest(m,["raw","file","path"]),t.attachment=JSON.parse(iu(T)),t.attachment&&(t.attachment.raw=attachmentToRaw(t.messageType,t.attachment)),N.next=23;break;case 19:throw N.prev=19,N.t0=N.catch(1),t.attachment&&(t.attachment.uploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED),N.t0;case 23:case"end":return N.stop()}}),_callee,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var a;return Sa.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({messageClientId:{type:"string",allowEmpty:!1}},t,"",!0),includes(a=[lf.V2NIM_MESSAGE_TYPE_AUDIO,lf.V2NIM_MESSAGE_TYPE_FILE,lf.V2NIM_MESSAGE_TYPE_IMAGE,lf.V2NIM_MESSAGE_TYPE_VIDEO]).call(a,t.messageType)){c.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+t.messageType+" incorrect"}});case 3:if(t.sendingState!==sf.V2NIM_MESSAGE_SENDING_STATE_FAILED&&t.sendingState!==sf.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED){c.next=5;break}throw new F_({code:Df.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return c.next=7,this.core.V2NIMStorageService._cancelUploadFile(t.messageClientId);case 7:case"end":return c.stop()}}),_callee2,this)})))},FileUtil}(),em=function(){function SendUtil(t,a){this.msgs=[],this.maxIdCount=100,this.core=t,this.service=a}var t=SendUtil.prototype;return t.reset=function reset(){this.msgs=[]},t.prepareMessage=function prepareMessage(t,a){void 0===a&&(a={});var c=this.checkIfResend(t),_=this.checkIfAntispam(a,t),E=_.clientAntispamResult,h=_.text;return t.text=h,{messageBeforeSend:this.generateSendMessage({message:t,params:a,resend:c,clientAntispamResult:E}),clientAntispamResult:E}},t.doSendMessage=function doSendMessage(t,a,c,_){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var E,h,m,g,I;return Sa.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(E={enabled:!1},!a.attachment||"object"!=typeof a.attachment||!("uploadState"in a.attachment)||a.attachment.url||a.attachment.uploadState!==cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN&&a.attachment.uploadState!==cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED){T.next=26;break}return h=Ga(),T.prev=3,a.attachmentUploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,a.attachment.uploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING,this.core.V2NIMChatroomService.emit("onSendMessage",a),T.next=9,this.service.fileUtil.doSendFile(a,_);case 9:a.attachmentUploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,a.attachment.uploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS,this.core.V2NIMChatroomService.emit("onSendMessage",a),T.next=23;break;case 14:throw T.prev=14,T.t0=T.catch(3),a.attachmentUploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,a.attachment.uploadState=cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED,a.sendingState=sf.V2NIM_MESSAGE_SENDING_STATE_FAILED,this.core.V2NIMChatroomService.emit("onSendMessage",a),E.attachUploadDuration=Ga()-h,this.doMsgSendReport(t,E,a,T.t0),T.t0;case 23:E.attachUploadDuration=Ga()-h,T.next=27;break;case 26:this.core.V2NIMChatroomService.emit("onSendMessage",a);case 27:return this.cacheMsg(a),this.core.timeOrigin.checkNodeReliable(t)&&(E.apiCallingTime=this.core.timeOrigin.getNTPTime(t),E.sendTime=this.core.timeOrigin.getNTPTime(),a.__clientExt={statistics:E}),T.prev=29,T.next=32,this.core.clientSocket.sendCmd("v2ChatroomSendMessage",{tag:a});case 32:m=T.sent,T.next=41;break;case 35:throw T.prev=35,T.t1=T.catch(29),a.sendingState=sf.V2NIM_MESSAGE_SENDING_STATE_FAILED,this.core.V2NIMChatroomService.emit("onSendMessage",a),this.doMsgSendReport(t,E,a,T.t1),T.t1;case 41:return g=formatMessage(ba(ba(ba({},a),m.content.data),{sendingState:sf.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED}),this.core.account),this.doMsgSendReport(t,E,a),(I=g.antispamResult)&&(g.sendingState=sf.V2NIM_MESSAGE_SENDING_STATE_FAILED),delete g.antispamResult,delete g.__clientExt,this.core.V2NIMChatroomService.emit("onSendMessage",g),T.abrupt("return",ba(ba({message:g},I?{antispamResult:I}:{}),c?{clientAntispamResult:c}:{}));case 49:case"end":return T.stop()}}),_callee,this,[[3,14],[29,35]])})))},t.doMsgSendReport=function doMsgSendReport(t,a,c,_){a.apiCallingTime=this.core.timeOrigin.getNTPTime(t),a.sendTime=this.core.timeOrigin.getNTPTime();var E=this.core.timeOrigin.getNTPTime(),h=Nd(_,"detail.reason");this.core.reporter.report("msgSend",{clientId:c.messageClientId,msgTime:c.createTime,fromAccid:c.senderId,type:4,roomId:c.roomId,result:_?_.code:200,failReason:h||(null==_?void 0:_.message)||"",rt:E-a.apiCallingTime,apiCallingTime:a.apiCallingTime,sendTime:a.sendTime,attachUploadDuration:a.attachUploadDuration,apiCallbackTime:E})},t.doMsgReceiveReport=function doMsgReceiveReport(t,a){if(t.senderId!==this.core.account){var c=Nd(t,"__clientExt.statistics.apiCallingTime")||0,_=Nd(t,"__clientExt.statistics.sendTime")||0,E=Nd(t,"__clientExt.statistics.attachUploadDuration")||0,h=this.core.timeOrigin.getNTPTime(),m=t.createTime,g=this.core.timeOrigin.checkNodeReliable(a.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(a.__receiveTimeNode):h;this.core.reporter.report("msgReceive",{clientId:t.messageClientId,receiveTime:g,serverTime:m,apiCallingTime:c,sendTime:_,attachUploadDuration:E,callbackTime:h,preHandleTime:h,fromAccid:t.senderId,type:4,roomId:t.roomId,result:200,failReason:"",rt:h-m})}},t.cacheMsg=function cacheMsg(t){this.msgs.push({messageClientId:t.messageClientId,senderId:t.senderId}),this.msgs.length>this.maxIdCount&&this.msgs.shift()},t.checkIfResend=function checkIfResend(t){var a;return some(a=this.msgs).call(a,(function(a){return a.messageClientId===t.messageClientId}))},t.generateSendMessage=function generateSendMessage(t){var a,c,_,E=t.message,h=t.params,m=t.resend,g=t.clientAntispamResult,I={};(E.locationInfo||h.locationInfo)&&(I.x=(null===(a=E.locationInfo||h.locationInfo)||void 0===a?void 0:a.x)||0,I.y=(null===(c=E.locationInfo||h.locationInfo)||void 0===c?void 0:c.y)||0,I.z=(null===(_=E.locationInfo||h.locationInfo)||void 0===_?void 0:_.z)||0);var T=ba(ba(ba({},E),h),{messageConfig:ba(ba({},E.messageConfig),h.messageConfig),routeConfig:ba(ba({},E.routeConfig),h.routeConfig),antispamConfig:ba(ba({},E.antispamConfig),h.antispamConfig),attachment:ba({},E.attachment),locationInfo:I,resend:m,sendingState:sf.V2NIM_MESSAGE_SENDING_STATE_SENDING,clientAntispamHit:!!g&&g.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD});return T.messageType!==lf.V2NIM_MESSAGE_TYPE_TEXT&&T.messageType!==lf.V2NIM_MESSAGE_TYPE_TIPS||(T.attachment=T.text),T},t.checkIfAntispam=function checkIfAntispam(t,a){var c,_=a.text;if(t.clientAntispamEnabled&&a.messageType!==lf.V2NIM_MESSAGE_TYPE_CUSTOM&&a.text)if((c=this.core.V2NIMClientAntispamUtil.checkTextAntispam(a.text||"",t.clientAntispamReplace)).operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE)_=c.replacedText;else if(c.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD)throw new F_({code:Df.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:c,text:_}},SendUtil}(),tm={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},roomId:{type:"string",allowEmpty:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}}},rm={params:{type:"object",required:!1,rules:{messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}},antiSpamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}}},receiverIds:{type:"array",required:!1},notifyTargetTags:{type:"string",required:!1},locationInfo:{type:"object",required:!1,rules:{x:{type:"number"},y:{type:"number"},z:{type:"number"}}}}}},nm={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},om=ba(ba({},nm),{duration:{type:"number",required:!1}}),im=ba(ba({},om),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),am=ba(ba({},nm),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),sm={option:{type:"object",rules:{direction:{type:"enum",values:getEnumValues(uf),required:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(lf)},beginTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}}}},cm={messageOption:{type:"object",rules:{tags:{type:"array",min:1,itemType:"string"},direction:{type:"enum",values:getEnumValues(uf),required:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:getEnumValues(lf)},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}}}},lm="V2NIMChatroomMessageService",um={"36_6":"v2ChatroomSendMessage","36_9":"v2ChatroomGetMessageList","36_35":"v2ChatroomMessageAck","36_36":"v2ChatroomGetMessageListByTag","13_7":"v2ChatroomOnMessage","29_17":"v2ChatroomDownloadLocalAntiSpamVocabs","6_23":"v2ChatroomGetServerTime","13_99":"v2ChatroomUpdateCDNInfo"},_m={version:1,md5:2,nosurl:3,thesaurus:4},dm={messageClientId:1,messageType:{id:2,retType:"number"},attachment:{id:3,converter:function converter(t,a){return attachmentToRaw(a.messageType,t)},retConverter:function retConverter(t,a){return rawToAttachment(t,Number(a[2]))}},serverExtension:4,resend:{id:5,converter:boolToInt,retType:"boolean"},userInfoTimestamp:{id:6,access:"userInfoConfig.userInfoTimestamp",retType:"number"},senderNick:{id:7,access:"userInfoConfig.senderNick"},senderAvatar:{id:8,access:"userInfoConfig.senderAvatar"},senderExtension:{id:9,access:"userInfoConfig.senderExtension"},antispamCustomMessageEnabled:{id:10,def:function def(t){return Nd(t,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function retConverter(){}},antispamCustomMessage:{id:11,access:"antispamConfig.antispamCustomMessage"},historyEnabled:{id:12,access:"messageConfig.historyEnabled",converter:function converter(t){return t?0:1},retConverter:function retConverter(t){return!jd(t)}},text:13,antiSpamBusinessId:{id:14,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:15,access:"clientAntispamHit",converter:boolToInt,retType:"boolean"},antispamEnabled:{id:16,access:"antispamConfig.antispamEnabled",converter:boolToInt,retType:"boolean"},createTime:{id:20,retType:"number"},senderId:21,roomId:22,senderClientType:{id:23,retType:"number"},highPriority:{id:25,access:"messageConfig.highPriority",converter:boolToInt,retType:"boolean"},callbackExtension:27,subType:{id:28,retType:"number"},antispamCheating:{id:29,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:30,access:"routeConfig.routeEnvironment"},notifyTargetTags:31,antispamExtension:{id:32,access:"antispamConfig.antispamExtension"},antispamResult:33,x:{id:34,access:"locationInfo.x",retType:"number"},y:{id:35,access:"locationInfo.y",retType:"number"},z:{id:36,access:"locationInfo.z",retType:"number"},receiverIds:{id:37,converter:objectToJSONString},__clientExt:{id:39,converter:objectToJSONString,retConverter:stringToJSONObject},routeEnabled:{id:100,access:"routeConfig.routeEnabled",converter:boolToInt,retType:"boolean",retDef:!0}},pm={v2ChatroomSendMessage:{sid:36,cid:6,service:lm,params:[{type:"Property",name:"tag",reflectMapper:dm}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(dm)}]},v2ChatroomOnMessage:{sid:13,cid:7,service:lm,response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(dm)}]},v2ChatroomGetMessageList:{sid:36,cid:9,service:lm,params:[{type:"Long",name:"beginTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"messageTypes"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(dm)}]},v2ChatroomMessageAck:{sid:36,cid:35,service:lm,params:[{type:"Property",name:"tag",reflectMapper:{messageClientId:1,roomId:2}}]},v2ChatroomGetMessageListByTag:{sid:36,cid:36,service:lm,params:[{type:"Property",name:"tag",reflectMapper:{tags:1,messageTypes:2,beginTime:3,endTime:4,limit:5,reverse:6}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:invertSerializeItem(dm)}]},v2ChatroomDownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:lm,params:[{type:"Property",name:"tag",reflectMapper:_m}],response:[{type:"Property",name:"data",reflectMapper:invertSerializeItem(_m)}]},v2ChatroomGetServerTime:{sid:6,cid:23,service:lm,response:[{type:"Long",name:"time"}]},v2ChatroomUpdateCDNInfo:{sid:13,cid:99,service:lm,response:[{type:"Property",name:"chatroomCdnInfo",reflectMapper:invertSerializeItem(Cf)}]}},Em=Y.setInterval,fm=fm||function(t){var a;"undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),void 0!==wa&&wa.crypto&&(a=wa.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&"undefined"!=typeof global&&global.crypto&&(a=global.crypto);var c=function cryptoSecureRandomInt(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},_=ft||function(){function F(){}return function(t){var a;return F.prototype=t,a=new F,F.prototype=null,a}}(),E={},h=E.lib={},m=h.Base={extend:function extend(t){var a=_(this);return t&&a.mixIn(t),a.hasOwnProperty("init")&&this.init!==a.init||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function create(){var t=this.extend();return t.init.apply(t,arguments),t},init:function init(){},mixIn:function mixIn(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function clone(){return this.init.prototype.extend(this)}},g=h.WordArray=m.extend({init:function init(t,a){t=this.words=t||[],this.sigBytes=null!=a?a:4*t.length},toString:function toString(t){return(t||T).stringify(this)},concat:function concat(t){var a=this.words,c=t.words,_=this.sigBytes,E=t.sigBytes;if(this.clamp(),_%4)for(var h=0;h<E;h++){var m=c[h>>>2]>>>24-h%4*8&255;a[_+h>>>2]|=m<<24-(_+h)%4*8}else for(var g=0;g<E;g+=4)a[_+g>>>2]=c[g>>>2];return this.sigBytes+=E,this},clamp:function clamp(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=t.ceil(c/4)},clone:function clone(){var t,clone=m.clone.call(this);return clone.words=slice(t=this.words).call(t,0),clone},random:function random(t){for(var a=[],_=0;_<t;_+=4)a.push(c());return new g.init(a,t)}}),I=E.enc={},T=I.Hex={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,_=[],E=0;E<c;E++){var h=a[E>>>2]>>>24-E%4*8&255;_.push((h>>>4).toString(16)),_.push((15&h).toString(16))}return _.join("")},parse:function parse(t){for(var a=t.length,c=[],_=0;_<a;_+=2)c[_>>>3]|=jd(t.substr(_,2),16)<<24-_%8*4;return new g.init(c,a/2)}},N=I.Latin1={stringify:function stringify(t){for(var a=t.words,c=t.sigBytes,_=[],E=0;E<c;E++){var h=a[E>>>2]>>>24-E%4*8&255;_.push(String.fromCharCode(h))}return _.join("")},parse:function parse(t){for(var a=t.length,c=[],_=0;_<a;_++)c[_>>>2]|=(255&t.charCodeAt(_))<<24-_%4*8;return new g.init(c,a)}},M=I.Utf8={stringify:function stringify(t){try{return decodeURIComponent(escape(N.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function parse(t){return N.parse(unescape(encodeURIComponent(t)))}},O=h.BufferedBlockAlgorithm=m.extend({reset:function reset(){this._data=new g.init,this._nDataBytes=0},_append:function _append(t){var a;"string"==typeof t&&(t=M.parse(t)),concat(a=this._data).call(a,t),this._nDataBytes+=t.sigBytes},_process:function _process(a){var c,_=this._data,E=_.words,h=_.sigBytes,m=this.blockSize,I=h/(4*m),T=(I=a?t.ceil(I):t.max((0|I)-this._minBufferSize,0))*m,N=t.min(4*T,h);if(T){for(var M=0;M<T;M+=m)this._doProcessBlock(E,M);c=splice(E).call(E,0,T),_.sigBytes-=N}return new g.init(c,N)},clone:function clone(){var clone=m.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0});h.Hasher=O.extend({cfg:m.extend(),init:function init(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function reset(){O.reset.call(this),this._doReset()},update:function update(t){return this._append(t),this._process(),this},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(t){return function(a,c){return new t.init(c).finalize(a)}},_createHmacHelper:function _createHmacHelper(t){return function(a,c){return new S.HMAC.init(t,c).finalize(a)}}});var S=E.algo={};return E}(Math),hm=fm,mm=hm.lib,gm=mm.WordArray,Im=mm.Hasher,Tm=hm.algo,Nm=[],vm=Tm.SHA1=Im.extend({_doReset:function _doReset(){this._hash=new gm.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=this._hash.words,_=c[0],E=c[1],h=c[2],m=c[3],g=c[4],I=0;I<80;I++){if(I<16)Nm[I]=0|t[a+I];else{var T=Nm[I-3]^Nm[I-8]^Nm[I-14]^Nm[I-16];Nm[I]=T<<1|T>>>31}var N=(_<<5|_>>>27)+g+Nm[I];N+=I<20?1518500249+(E&h|~E&m):I<40?1859775393+(E^h^m):I<60?(E&h|E&m|h&m)-1894007588:(E^h^m)-899497514,g=m,m=h,h=E<<30|E>>>2,E=_,_=N}c[0]=c[0]+_|0,c[1]=c[1]+E|0,c[2]=c[2]+h|0,c[3]=c[3]+m|0,c[4]=c[4]+g|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,_=8*t.sigBytes;return a[_>>>5]|=128<<24-_%32,a[14+(_+64>>>9<<4)]=Math.floor(c/4294967296),a[15+(_+64>>>9<<4)]=c,t.sigBytes=4*a.length,this._process(),this._hash},clone:function clone(){var clone=Im.clone.call(this);return clone._hash=this._hash.clone(),clone}});hm.SHA1=Im._createHelper(vm),hm.HmacSHA1=Im._createHmacHelper(vm),fm.SHA1,function(t){var a=t,c=a.lib.Base,_=a.enc.Utf8;a.algo.HMAC=c.extend({init:function init(t,a){t=this._hasher=new t.init,"string"==typeof a&&(a=_.parse(a));var c=t.blockSize,E=4*c;a.sigBytes>E&&(a=t.finalize(a)),a.clamp();for(var h=this._oKey=a.clone(),m=this._iKey=a.clone(),g=h.words,I=m.words,T=0;T<c;T++)g[T]^=1549556828,I[T]^=909522486;h.sigBytes=m.sigBytes=E,this.reset()},reset:function reset(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function update(t){return this._hasher.update(t),this},finalize:function finalize(t){var a,c=this._hasher,_=c.finalize(t);return c.reset(),c.finalize(concat(a=this._oKey.clone()).call(a,_))}})}(fm);var Mm=fm,Om=Mm.lib,Sm=Om.Base,Am=Om.WordArray,Cm=Mm.algo,Rm=Cm.MD5,ym=Cm.EvpKDF=Sm.extend({cfg:Sm.extend({keySize:4,hasher:Rm,iterations:1}),init:function init(t){this.cfg=this.cfg.extend(t)},compute:function compute(t,a){for(var c,_=this.cfg,E=_.hasher.create(),h=Am.create(),m=h.words,g=_.keySize,I=_.iterations;m.length<g;){c&&E.update(c),c=E.update(t).finalize(a),E.reset();for(var T=1;T<I;T++)c=E.finalize(c),E.reset();concat(h).call(h,c)}return h.sigBytes=4*g,h}});Mm.EvpKDF=function(t,a,c){return ym.create(c).compute(t,a)},fm.EvpKDF;var bm=fm,Dm=bm.lib.WordArray;bm.enc.Base64={stringify:function stringify(t){var a=t.words,c=t.sigBytes,_=this._map;t.clamp();for(var E=[],h=0;h<c;h+=3)for(var m=(a[h>>>2]>>>24-h%4*8&255)<<16|(a[h+1>>>2]>>>24-(h+1)%4*8&255)<<8|a[h+2>>>2]>>>24-(h+2)%4*8&255,g=0;g<4&&h+.75*g<c;g++)E.push(_.charAt(m>>>6*(3-g)&63));var I=_.charAt(64);if(I)for(;E.length%4;)E.push(I);return E.join("")},parse:function parse(t){var a=t.length,c=this._map,_=this._reverseMap;if(!_){_=this._reverseMap=[];for(var E=0;E<c.length;E++)_[c.charCodeAt(E)]=E}var h=c.charAt(64);if(h){var m=indexOf(t).call(t,h);-1!==m&&(a=m)}return function parseLoop(t,a,c){for(var _=[],E=0,h=0;h<a;h++)if(h%4){var m=c[t.charCodeAt(h-1)]<<h%4*2|c[t.charCodeAt(h)]>>>6-h%4*2;_[E>>>2]|=m<<24-E%4*8,E++}return Dm.create(_,E)}(t,a,_)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};var km=fm.enc.Base64,Vm=fm,Lm=Vm.lib,Pm=Lm.WordArray,wm=Lm.Hasher,xm=Vm.algo,Um=[];!function(){for(var t=0;t<64;t++)Um[t]=4294967296*Math.abs(Math.sin(t+1))|0}();var Gm=xm.MD5=wm.extend({_doReset:function _doReset(){this._hash=new Pm.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(t,a){for(var c=0;c<16;c++){var _=a+c,E=t[_];t[_]=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8)}var h=this._hash.words,m=t[a+0],g=t[a+1],I=t[a+2],T=t[a+3],N=t[a+4],M=t[a+5],O=t[a+6],S=t[a+7],A=t[a+8],C=t[a+9],R=t[a+10],b=t[a+11],D=t[a+12],k=t[a+13],V=t[a+14],L=t[a+15],P=h[0],w=h[1],x=h[2],U=h[3];P=FF(P,w,x,U,m,7,Um[0]),U=FF(U,P,w,x,g,12,Um[1]),x=FF(x,U,P,w,I,17,Um[2]),w=FF(w,x,U,P,T,22,Um[3]),P=FF(P,w,x,U,N,7,Um[4]),U=FF(U,P,w,x,M,12,Um[5]),x=FF(x,U,P,w,O,17,Um[6]),w=FF(w,x,U,P,S,22,Um[7]),P=FF(P,w,x,U,A,7,Um[8]),U=FF(U,P,w,x,C,12,Um[9]),x=FF(x,U,P,w,R,17,Um[10]),w=FF(w,x,U,P,b,22,Um[11]),P=FF(P,w,x,U,D,7,Um[12]),U=FF(U,P,w,x,k,12,Um[13]),x=FF(x,U,P,w,V,17,Um[14]),P=GG(P,w=FF(w,x,U,P,L,22,Um[15]),x,U,g,5,Um[16]),U=GG(U,P,w,x,O,9,Um[17]),x=GG(x,U,P,w,b,14,Um[18]),w=GG(w,x,U,P,m,20,Um[19]),P=GG(P,w,x,U,M,5,Um[20]),U=GG(U,P,w,x,R,9,Um[21]),x=GG(x,U,P,w,L,14,Um[22]),w=GG(w,x,U,P,N,20,Um[23]),P=GG(P,w,x,U,C,5,Um[24]),U=GG(U,P,w,x,V,9,Um[25]),x=GG(x,U,P,w,T,14,Um[26]),w=GG(w,x,U,P,A,20,Um[27]),P=GG(P,w,x,U,k,5,Um[28]),U=GG(U,P,w,x,I,9,Um[29]),x=GG(x,U,P,w,S,14,Um[30]),P=HH(P,w=GG(w,x,U,P,D,20,Um[31]),x,U,M,4,Um[32]),U=HH(U,P,w,x,A,11,Um[33]),x=HH(x,U,P,w,b,16,Um[34]),w=HH(w,x,U,P,V,23,Um[35]),P=HH(P,w,x,U,g,4,Um[36]),U=HH(U,P,w,x,N,11,Um[37]),x=HH(x,U,P,w,S,16,Um[38]),w=HH(w,x,U,P,R,23,Um[39]),P=HH(P,w,x,U,k,4,Um[40]),U=HH(U,P,w,x,m,11,Um[41]),x=HH(x,U,P,w,T,16,Um[42]),w=HH(w,x,U,P,O,23,Um[43]),P=HH(P,w,x,U,C,4,Um[44]),U=HH(U,P,w,x,D,11,Um[45]),x=HH(x,U,P,w,L,16,Um[46]),P=II(P,w=HH(w,x,U,P,I,23,Um[47]),x,U,m,6,Um[48]),U=II(U,P,w,x,S,10,Um[49]),x=II(x,U,P,w,V,15,Um[50]),w=II(w,x,U,P,M,21,Um[51]),P=II(P,w,x,U,D,6,Um[52]),U=II(U,P,w,x,T,10,Um[53]),x=II(x,U,P,w,R,15,Um[54]),w=II(w,x,U,P,g,21,Um[55]),P=II(P,w,x,U,A,6,Um[56]),U=II(U,P,w,x,L,10,Um[57]),x=II(x,U,P,w,O,15,Um[58]),w=II(w,x,U,P,k,21,Um[59]),P=II(P,w,x,U,N,6,Um[60]),U=II(U,P,w,x,b,10,Um[61]),x=II(x,U,P,w,I,15,Um[62]),w=II(w,x,U,P,C,21,Um[63]),h[0]=h[0]+P|0,h[1]=h[1]+w|0,h[2]=h[2]+x|0,h[3]=h[3]+U|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,c=8*this._nDataBytes,_=8*t.sigBytes;a[_>>>5]|=128<<24-_%32;var E=Math.floor(c/4294967296),h=c;a[15+(_+64>>>9<<4)]=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8),a[14+(_+64>>>9<<4)]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),t.sigBytes=4*(a.length+1),this._process();for(var m=this._hash,g=m.words,I=0;I<4;I++){var T=g[I];g[I]=16711935&(T<<8|T>>>24)|4278255360&(T<<24|T>>>8)}return m},clone:function clone(){var clone=wm.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(t,a,c,_,E,h,m){var g=t+(a&c|~a&_)+E+m;return(g<<h|g>>>32-h)+a}function GG(t,a,c,_,E,h,m){var g=t+(a&_|c&~_)+E+m;return(g<<h|g>>>32-h)+a}function HH(t,a,c,_,E,h,m){var g=t+(a^c^_)+E+m;return(g<<h|g>>>32-h)+a}function II(t,a,c,_,E,h,m){var g=t+(c^(a|~_))+E+m;return(g<<h|g>>>32-h)+a}Vm.MD5=wm._createHelper(Gm),Vm.HmacMD5=wm._createHmacHelper(Gm),fm.MD5,function(t){t.lib.Cipher||function(){var a=t,c=a.lib,_=c.Base,E=c.WordArray,h=c.BufferedBlockAlgorithm,m=a.enc;m.Utf8;var g=m.Base64,I=a.algo.EvpKDF,T=c.Cipher=h.extend({cfg:_.extend(),createEncryptor:function createEncryptor(t,a){return this.create(this._ENC_XFORM_MODE,t,a)},createDecryptor:function createDecryptor(t,a){return this.create(this._DEC_XFORM_MODE,t,a)},init:function init(t,a,c){this.cfg=this.cfg.extend(c),this._xformMode=t,this._key=a,this.reset()},reset:function reset(){h.reset.call(this),this._doReset()},process:function process(t){return this._append(t),this._process()},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(t){return"string"==typeof t?D:R}return function(t){return{encrypt:function encrypt(a,c,_){return selectCipherStrategy(c).encrypt(t,a,c,_)},decrypt:function decrypt(a,c,_){return selectCipherStrategy(c).decrypt(t,a,c,_)}}}}()});c.StreamCipher=T.extend({_doFinalize:function _doFinalize(){return this._process(!0)},blockSize:1});var N=a.mode={},M=c.BlockCipherMode=_.extend({createEncryptor:function createEncryptor(t,a){return this.Encryptor.create(t,a)},createDecryptor:function createDecryptor(t,a){return this.Decryptor.create(t,a)},init:function init(t,a){this._cipher=t,this._iv=a}}),O=N.CBC=function(){var t=M.extend();function xorBlock(t,a,c){var _,E=this._iv;E?(_=E,this._iv=void 0):_=this._prevBlock;for(var h=0;h<c;h++)t[a+h]^=_[h]}return t.Encryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,_=c.blockSize;xorBlock.call(this,t,a,_),c.encryptBlock(t,a),this._prevBlock=slice(t).call(t,a,a+_)}}),t.Decryptor=t.extend({processBlock:function processBlock(t,a){var c=this._cipher,_=c.blockSize,E=slice(t).call(t,a,a+_);c.decryptBlock(t,a),xorBlock.call(this,t,a,_),this._prevBlock=E}}),t}(),S=(a.pad={}).Pkcs7={pad:function pad(t,a){for(var c=4*a,_=c-t.sigBytes%c,h=_<<24|_<<16|_<<8|_,m=[],g=0;g<_;g+=4)m.push(h);var I=E.create(m,_);concat(t).call(t,I)},unpad:function unpad(t){var a=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=a}};c.BlockCipher=T.extend({cfg:T.cfg.extend({mode:O,padding:S}),reset:function reset(){var t;T.reset.call(this);var a=this.cfg,c=a.iv,_=a.mode;this._xformMode==this._ENC_XFORM_MODE?t=_.createEncryptor:(t=_.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,c&&c.words):(this._mode=t.call(_,this,c&&c.words),this._mode.__creator=t)},_doProcessBlock:function _doProcessBlock(t,a){this._mode.processBlock(t,a)},_doFinalize:function _doFinalize(){var t,a=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(a.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),a.unpad(t)),t},blockSize:4});var A=c.CipherParams=_.extend({init:function init(t){this.mixIn(t)},toString:function toString(t){return(t||this.formatter).stringify(this)}}),C=(a.format={}).OpenSSL={stringify:function stringify(t){var a,c,_,h=t.ciphertext,m=t.salt;m?a=concat(c=concat(_=E.create([1398893684,1701076831])).call(_,m)).call(c,h):a=h;return a.toString(g)},parse:function parse(t){var a,c=g.parse(t),_=c.words;return 1398893684==_[0]&&1701076831==_[1]&&(a=E.create(slice(_).call(_,2,4)),splice(_).call(_,0,4),c.sigBytes-=16),A.create({ciphertext:c,salt:a})}},R=c.SerializableCipher=_.extend({cfg:_.extend({format:C}),encrypt:function encrypt(t,a,c,_){_=this.cfg.extend(_);var E=t.createEncryptor(c,_),h=E.finalize(a),m=E.cfg;return A.create({ciphertext:h,key:c,iv:m.iv,algorithm:t,mode:m.mode,padding:m.padding,blockSize:t.blockSize,formatter:_.format})},decrypt:function decrypt(t,a,c,_){return _=this.cfg.extend(_),a=this._parse(a,_.format),t.createDecryptor(c,_).finalize(a.ciphertext)},_parse:function _parse(t,a){return"string"==typeof t?a.parse(t,this):t}}),b=(a.kdf={}).OpenSSL={execute:function execute(t,a,c,_){var h;_||(_=E.random(8));var m=I.create({keySize:a+c}).compute(t,_),g=E.create(slice(h=m.words).call(h,a),4*c);return m.sigBytes=4*a,A.create({key:m,iv:g,salt:_})}},D=c.PasswordBasedCipher=R.extend({cfg:R.cfg.extend({kdf:b}),encrypt:function encrypt(t,a,c,_){var E=(_=this.cfg.extend(_)).kdf.execute(c,t.keySize,t.ivSize);_.iv=E.iv;var h=R.encrypt.call(this,t,a,E.key,_);return h.mixIn(E),h},decrypt:function decrypt(t,a,c,_){_=this.cfg.extend(_),a=this._parse(a,_.format);var E=_.kdf.execute(c,t.keySize,t.ivSize,a.salt);return _.iv=E.iv,R.decrypt.call(this,t,a,E.key,_)}})}()}(fm);var Fm=fm,Bm=Fm.lib.BlockCipher,Hm=Fm.algo,Ym=[],jm=[],Km=[],Wm=[],qm=[],zm=[],$m=[],Xm=[],Jm=[],Qm=[];!function(){for(var t=[],a=0;a<256;a++)t[a]=a<128?a<<1:a<<1^283;var c=0,_=0;for(a=0;a<256;a++){var E=_^_<<1^_<<2^_<<3^_<<4;E=E>>>8^255&E^99,Ym[c]=E,jm[E]=c;var h=t[c],m=t[h],g=t[m],I=257*t[E]^16843008*E;Km[c]=I<<24|I>>>8,Wm[c]=I<<16|I>>>16,qm[c]=I<<8|I>>>24,zm[c]=I;I=16843009*g^65537*m^257*h^16843008*c;$m[E]=I<<24|I>>>8,Xm[E]=I<<16|I>>>16,Jm[E]=I<<8|I>>>24,Qm[E]=I,c?(c=h^t[t[t[g^h]]],_^=t[t[_]]):c=_=1}}();var Zm=[0,1,2,4,8,16,32,64,128,27,54],eg=Hm.AES=Bm.extend({_doReset:function _doReset(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,a=t.words,c=t.sigBytes/4,_=4*((this._nRounds=c+6)+1),E=this._keySchedule=[],h=0;h<_;h++)h<c?E[h]=a[h]:(I=E[h-1],h%c?c>6&&h%c==4&&(I=Ym[I>>>24]<<24|Ym[I>>>16&255]<<16|Ym[I>>>8&255]<<8|Ym[255&I]):(I=Ym[(I=I<<8|I>>>24)>>>24]<<24|Ym[I>>>16&255]<<16|Ym[I>>>8&255]<<8|Ym[255&I],I^=Zm[h/c|0]<<24),E[h]=E[h-c]^I);for(var m=this._invKeySchedule=[],g=0;g<_;g++){h=_-g;if(g%4)var I=E[h];else I=E[h-4];m[g]=g<4||h<=4?I:$m[Ym[I>>>24]]^Xm[Ym[I>>>16&255]]^Jm[Ym[I>>>8&255]]^Qm[Ym[255&I]]}}},encryptBlock:function encryptBlock(t,a){this._doCryptBlock(t,a,this._keySchedule,Km,Wm,qm,zm,Ym)},decryptBlock:function decryptBlock(t,a){var c=t[a+1];t[a+1]=t[a+3],t[a+3]=c,this._doCryptBlock(t,a,this._invKeySchedule,$m,Xm,Jm,Qm,jm);c=t[a+1];t[a+1]=t[a+3],t[a+3]=c},_doCryptBlock:function _doCryptBlock(t,a,c,_,E,h,m,g){for(var I=this._nRounds,T=t[a]^c[0],N=t[a+1]^c[1],M=t[a+2]^c[2],O=t[a+3]^c[3],S=4,A=1;A<I;A++){var C=_[T>>>24]^E[N>>>16&255]^h[M>>>8&255]^m[255&O]^c[S++],R=_[N>>>24]^E[M>>>16&255]^h[O>>>8&255]^m[255&T]^c[S++],b=_[M>>>24]^E[O>>>16&255]^h[T>>>8&255]^m[255&N]^c[S++],D=_[O>>>24]^E[T>>>16&255]^h[N>>>8&255]^m[255&M]^c[S++];T=C,N=R,M=b,O=D}C=(g[T>>>24]<<24|g[N>>>16&255]<<16|g[M>>>8&255]<<8|g[255&O])^c[S++],R=(g[N>>>24]<<24|g[M>>>16&255]<<16|g[O>>>8&255]<<8|g[255&T])^c[S++],b=(g[M>>>24]<<24|g[O>>>16&255]<<16|g[T>>>8&255]<<8|g[255&N])^c[S++],D=(g[O>>>24]<<24|g[T>>>16&255]<<16|g[N>>>8&255]<<8|g[255&M])^c[S++];t[a]=C,t[a+1]=R,t[a+2]=b,t[a+3]=D},keySize:8});Fm.AES=Bm._createHelper(eg);var tg,rg=fm.AES;fm.mode.ECB=((tg=fm.lib.BlockCipherMode.extend()).Encryptor=tg.extend({processBlock:function processBlock(t,a){this._cipher.encryptBlock(t,a)}}),tg.Decryptor=tg.extend({processBlock:function processBlock(t,a){this._cipher.decryptBlock(t,a)}}),tg);var ng=fm.mode.ECB,og=fm.enc.Utf8,ig=fm.pad.Pkcs7;var ag=function noop(){},sg=vE&&1/oE(new vE([,-0]))[1]==1/0?function(t){return new vE(t)}:ag,cg=sg;var lg=function baseUniq(t,a,c){var _=-1,E=Jf,h=t.length,m=!0,g=[],I=g;if(c)m=!1,E=Qf;else if(h>=200){var T=a?null:cg(t);if(T)return oE(T);m=!1,E=tE,I=new Zp}else I=a?[]:g;e:for(;++_<h;){var N=t[_],M=a?a(N):N;if(N=c||0!==N?N:0,m&&M==M){for(var O=I.length;O--;)if(I[O]===M)continue e;a&&I.push(M),g.push(N)}else E(I,M,c)||(I!==g&&I.push(M),g.push(N))}return g};var ug=function uniqBy(t,a){return t&&t.length?lg(t,ef(a)):[]},_g={enabled:!1,cdnUrls:[],timestamp:Ga(),pollingIntervalSeconds:5,pollingTimeoutMillis:1e3},dg=invertSerializeItem(dm),pg=function(){function CDNUtil(t,a){this.config=_g,this.lastSuccessTimestamp=0,this.pollingTimer=0,this.msgBufferInterval=300,this.emitTimer=0,this.core=t,this.service=a,this.promiseManager=new lp}var t=CDNUtil.prototype;return t.reset=function reset(){this.config=_g,this.lastSuccessTimestamp=0,this.pollingTimer&&clearInterval(this.pollingTimer),this.pollingTimer=0,this.emitTimer&&clearInterval(this.emitTimer),this.emitTimer=0},t.setOptions=function setOptions(t){this.config=ba({},this.config,t),this.core.logger.log("CDNUtil::setOptions",this.config),this.polling()},t.polling=function polling(){var t;(this.pollingTimer&&clearInterval(this.pollingTimer),this.pollingTimer=0,this.config.enabled)&&(this.pollingTimer=Em(bind$1(t=this.fetchMsgs).call(t,this),1e3*this.config.pollingIntervalSeconds))},t.fetchMsgs=function fetchMsgs(t){return void 0===t&&(t=0),__awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a,c,_,E,h,m;return Sa.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:if((a=this.config.cdnUrls)&&a.length>0){g.next=3;break}return g.abrupt("return");case 3:if(c=a.shift()){g.next=6;break}return g.abrupt("return");case 6:if(this.config.cdnUrls.push(c),_=this.core.timeOrigin.getNTPTime(),_-=_%(1e3*this.config.pollingIntervalSeconds),this.lastSuccessTimestamp!==_){g.next=11;break}return g.abrupt("return");case 11:return c=c.replace("#time",""+_),E=this.config.pollingTimeoutMillis||1e3*this.config.pollingIntervalSeconds/2,this.core.logger.log("CDNUtil::fetchMsgs start:",c),h={},g.prev=15,g.next=18,this.promiseManager.add(this.core.adapters.request(c,{method:"GET",dataType:"json",timeout:E},{exception_service:8}));case 18:h=g.sent,g.next=31;break;case 21:if(g.prev=21,g.t0=g.catch(15),this.core.logger.warn("CDNUtil::fetchMsgs failed:",g.t0),(m=g.t0).code!==Df.V2NIM_ERROR_CODE_CANCELLED){g.next=27;break}return g.abrupt("return");case 27:if(!(t>=3)){g.next=29;break}return g.abrupt("return");case 29:return 404===m.code&&this.core.timeOrigin.setOriginTimetick(),g.abrupt("return",this.fetchMsgs(t+1));case 31:this.requestSuccess(h,_);case 32:case"end":return g.stop()}}),_callee,this,[[15,21]])})))},t.requestSuccess=function requestSuccess(t,a){var c=this;if(this.lastSuccessTimestamp>a)return this.core.logger.warn("CDNUtil::fetchMsgs:ignore",this.lastSuccessTimestamp,a),void(this.lastSuccessTimestamp=0);this.lastSuccessTimestamp=a;var _=Nd(t,"data.data");if(_){if(t.data.ptm&&(this.config.pollingTimeoutMillis=t.data.ptm),t.data.pis){var E=this.config.pollingIntervalSeconds;this.config.pollingIntervalSeconds=t.data.pis,t.data.pis!==E&&this.polling()}var h=!0===t.data.e?this.decryptAES(_,this.config.decryptKey):_,m=this.formatMessages(h);m=ug(m,"messageClientId"),m=filter(m).call(m,(function(t){return!c.service.sendUtil.checkIfResend(t)&&(c.service.sendUtil.cacheMsg(t),!0)})),this.core.logger.log("CDNUtil::fetchMsgs success at "+a+", msg.length: "+m.length),this.emitSmoothly(m,1e3*t.data.c)}},t.decryptAES=function decryptAES(t,a){if(!t||!a)return"[]";try{return rg.decrypt(t,km.parse(a),{mode:ng,padding:ig}).toString(og)}catch(t){var c=t;throw new F_({code:Df.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Decrypt AES failed",rawError:c}})}},t.formatMessages=function formatMessages(t){var a=this,c=[];try{c=JSON.parse(t)}catch(a){var _=a;throw new F_({code:Df.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"JSON parse error",rawData:t,rawError:_}})}return map$7(c).call(c,(function(t){return formatMessage(deserialize(t,dg),a.core.account)}))},t.emitSmoothly=function emitSmoothly(t,a){var c=this;if(t&&t.length>0){var _=Math.ceil(a/this.msgBufferInterval),E=Math.ceil(t.length*this.msgBufferInterval/a);this.core.logger.log("CDNUtil::emitSmoothly total length: "+t.length+", group length: "+E+", times: "+_),this.emitTimer&&clearInterval(this.emitTimer),this.emitTimer=0,this.emitTimer=Em((function(){var a=splice(t).call(t,0,E);if(0===a.length)return c.emitTimer&&clearInterval(c.emitTimer),void(c.emitTimer=0);c.core.V2NIMChatroomService.emit("onReceiveMessages",a)}),this.msgBufferInterval)}},CDNUtil}(),Eg=function(t){function V2NIMChatroomMessageServiceImpl(a){var c;return c=t.call(this,"V2NIMChatroomMessageService",a)||this,registerParser({cmdMap:um,cmdConfig:pm}),c.fileUtil=new Zh(c.core,$e(c)),c.sendUtil=new em(c.core,$e(c)),c.cdnUtil=new pg(c.core,$e(c)),c.setListener(),c}yt(V2NIMChatroomMessageServiceImpl,t);var a=V2NIMChatroomMessageServiceImpl.prototype;return a.reset=function reset(t){this.sendUtil.reset(),this.cdnUtil.reset(),this.core.V2NIMClientAntispamUtil.reset(t)},a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){t.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("V2NIMChatroomMessageService/onReceiveNotification",(function(a,c){Nd(a,"attachment.type")===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MESSAGE_REVOKE&&t.core.V2NIMChatroomService.emit("onMessageRevokedNotification",c.data.msgId,c.data.msgTime)}))},a.getMessageList=function getMessageList(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a,c,_=this;return Sa.wrap((function _callee$(E){for(;;)switch(E.prev=E.next){case 0:return validate(sm,{option:t},"",!0),E.next=3,this.core.clientSocket.sendCmd("v2ChatroomGetMessageList",ba(ba({beginTime:0,limit:100},t),{reverse:t.direction===uf.V2NIM_QUERY_DIRECTION_ASC}));case 3:return a=E.sent,c=a.content.datas,map$7(c).call(c,(function(t){return formatMessage(t,_.core.account)})),E.abrupt("return",c);case 7:case"end":return E.stop()}}),_callee,this)})))},a.getMessageListByTag=function getMessageListByTag(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){var a,c,_=this;return Sa.wrap((function _callee2$(E){for(;;)switch(E.prev=E.next){case 0:if(validate(cm,{messageOption:t},"",!0),!("number"==typeof(null==t?void 0:t.beginTime)&&"number"==typeof(null==t?void 0:t.endTime)&&t.beginTime>t.endTime)){E.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"beginTime must be less than endTime"}});case 3:return E.next=5,this.core.clientSocket.sendCmd("v2ChatroomGetMessageListByTag",{tag:ba(ba({},t),{tags:iu(t.tags),messageType:t.messageTypes?iu(t.messageTypes):void 0,reverse:t.direction===uf.V2NIM_QUERY_DIRECTION_ASC?0:1})});case 5:return a=E.sent,c=a.content.datas,map$7(c).call(c,(function(t){return formatMessage(t,_.core.account)})),E.abrupt("return",c);case 9:case"end":return E.stop()}}),_callee2,this)})))},a.sendMessage=function sendMessage(t,a,c){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var _,E,h,m,g;return Sa.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:if(validate(tm,{message:t},"",!0),validate(rm,{params:a},"",!0),t.senderId===this.core.account){I.next=4;break}throw new F_({code:Df.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"message.senderId must be self"}});case 4:return _=this.core.timeOrigin.getTimeNode(),E=this.sendUtil.prepareMessage(t,a),h=E.messageBeforeSend,m=E.clientAntispamResult,I.next=8,this.sendUtil.doSendMessage(_,h,m,c);case 8:return g=I.sent,I.abrupt("return",g);case 10:case"end":return I.stop()}}),_callee3,this)})))},a.v2ChatroomMessageAck=function v2ChatroomMessageAck(t,a){this.core.clientSocket.sendCmd("v2ChatroomMessageAck",{tag:{messageClientId:t,roomId:a}})},a.v2ChatroomOnMessageHandler=function v2ChatroomOnMessageHandler(t){var a=t.content.data,c=a.attachment,_=formatMessage(a,this.core.account);this.sendUtil.checkIfResend(_)||(a.messageType===lf.V2NIM_MESSAGE_TYPE_NOTIFICATION?this.core.eventBus.emit("V2NIMChatroomMessageService/onReceiveNotification",_,c):this.sendUtil.cacheMsg(_),this.sendUtil.doMsgReceiveReport(_,t),delete _.__clientExt,this.core.V2NIMChatroomService.emit("onReceiveMessages",[_]))},a.v2ChatroomUpdateCDNInfoHandler=function v2ChatroomUpdateCDNInfoHandler(t){var a=t.content.chatroomCdnInfo;this.cdnUtil.setOptions(a)},V2NIMChatroomMessageServiceImpl}(mh),fg=function(){function V2NIMChatroomMessageCreatorImpl(t){this.name="V2NIMChatroomMessageCreator",this.defaultNosSceneName="nim_default_im",this.core=t}var t=V2NIMChatroomMessageCreatorImpl.prototype;return t.createMessage=function createMessage(t,a){return ba(ba(ba({messageClientId:Yp(),createTime:Ga(),senderId:this.core.auth.getLoginUser(),roomId:this.core.auth.getRoomId(),isSelf:!0,sendingState:sf.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN,messageType:t,senderClientType:Sp.Web},a),a.attachment?{attachment:ba(ba({},a.attachment),{raw:attachmentToRaw(t,a.attachment)})}:{}),{messageConfig:ba({historyEnabled:!0,highPriority:!1},a.messageConfig),routeConfig:ba({routeEnabled:!0},a.routeConfig),antispamConfig:ba({antispamEnabled:!0},a.antispamConfig)})},t.createTextMessage=function createTextMessage(t){return validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(lf.V2NIM_MESSAGE_TYPE_TEXT,{text:t})},t.createImageMessage=function createImageMessage(t,a,c,_,E){validate(am,{name:a,sceneName:c,width:_,height:E},"",!0);var h=this.createGenericFileMessageAttachment(t,a,c,void 0,_,E);return this.createMessage(lf.V2NIM_MESSAGE_TYPE_IMAGE,{attachment:h,attachmentUploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},t.createAudioMessage=function createAudioMessage(t,a,c,_){validate(om,{name:a,sceneName:c,duration:_},"",!0);var E=this.createGenericFileMessageAttachment(t,a,c,_);return this.createMessage(lf.V2NIM_MESSAGE_TYPE_AUDIO,{attachment:E,attachmentUploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},t.createVideoMessage=function createVideoMessage(t,a,c,_,E,h){validate(im,{name:a,sceneName:c,duration:_,width:E,height:h},"",!0);var m=this.createGenericFileMessageAttachment(t,a,c,_,E,h);return this.createMessage(lf.V2NIM_MESSAGE_TYPE_VIDEO,{attachment:m,attachmentUploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},t.createFileMessage=function createFileMessage(t,a,c){validate(nm,{name:a,sceneName:c},"",!0);var _=this.createGenericFileMessageAttachment(t,a,c);return this.createMessage(lf.V2NIM_MESSAGE_TYPE_FILE,{attachment:_,attachmentUploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN})},t.createGenericFileMessageAttachment=function createGenericFileMessageAttachment(t,a,c,_,E,h){if(c=c||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene(c))throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+c+" has not been added"}});var m=getFileOrPath(t),g=m.file,I=m.path,T=ba(ba(ba({name:a,uploadState:cf.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN,sceneName:c||this.defaultNosSceneName},_?{duration:_}:{}),E?{width:E}:{}),h?{height:h}:{});if(g){var N,M=lastIndexOf(N=g.name).call(N,"."),O=-1===M?g.name:g.name.substring(0,M);T.name=T.name||O,T.size=g.size,T.ext=getFileExtension(g.name)}else if(I){var S=lastIndexOf(I).call(I,"/"),A=lastIndexOf(I).call(I,"."),C=-1===A?I.substring(S+1):I.substring(S+1,A);T.name=T.name||C,T.ext=getFileExtension(I)}return T=JSON.parse(iu(T)),I?T.path=I:g&&(T.file=g),T},t.createLocationMessage=function createLocationMessage(t,a,c){return validate({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:t,longitude:a,address:c},"",!0),this.createMessage(lf.V2NIM_MESSAGE_TYPE_LOCATION,{attachment:{latitude:t,longitude:a,address:c}})},t.createCustomMessage=function createCustomMessage(t){return validate({rawAttachment:{type:"string"}},{rawAttachment:t},"",!0),this.createMessage(lf.V2NIM_MESSAGE_TYPE_CUSTOM,{attachment:{raw:t}})},t.createForwardMessage=function createForwardMessage(t){var a=[lf.V2NIM_MESSAGE_TYPE_ROBOT,lf.V2NIM_MESSAGE_TYPE_NOTIFICATION,lf.V2NIM_MESSAGE_TYPE_AVCHAT,lf.V2NIM_MESSAGE_TYPE_TIPS];if(includes(a).call(a,t.messageType))return null;var c={messageClientId:Yp(),messageType:t.messageType};return t.text&&(c.text=t.text),t.attachment&&(c.attachment=t.attachment),t.attachment&&"uploadState"in t.attachment&&(c.attachmentUploadState=t.attachment.uploadState),this.createMessage(t.messageType,c)},t.createTipsMessage=function createTipsMessage(t){return validate({text:{type:"string",allowEmpty:!1}},{text:t},"",!0),this.createMessage(lf.V2NIM_MESSAGE_TYPE_TIPS,{text:t})},V2NIMChatroomMessageCreatorImpl}(),hg={option:{type:"object",rules:{memberRoles:{type:"array",itemType:"enum",values:getEnumValues(ff),required:!1},onlyBlocked:{type:"boolean",required:!1},onlyChatBanned:{type:"boolean",required:!1},onlyOnline:{type:"boolean",required:!1},pageToken:{type:"string",required:!1},limit:{type:"number",min:1,required:!1}}}},mg={accountId:{type:"string",allowEmpty:!1},updateParams:{type:"object",rules:{memberRole:{type:"enum",values:[ff.V2NIM_CHATROOM_MEMBER_ROLE_MANAGER,ff.V2NIM_CHATROOM_MEMBER_ROLE_NORMAL,ff.V2NIM_CHATROOM_MEMBER_ROLE_NORMAL_GUEST]},memberLevel:{type:"number",min:0,required:!1},notificationExtension:{type:"string",required:!1}}}},gg={accountId:{type:"string",allowEmpty:!1},blocked:{type:"boolean"},notificationExtension:{type:"string",required:!1}},Ig={accountId:{type:"string",allowEmpty:!1},chatBanned:{type:"boolean"},notificationExtension:{type:"string",required:!1}},Tg={updateParams:{type:"object",rules:{roomNick:{type:"string",allowEmpty:!1,required:!1},roomAvatar:{type:"string",required:!1},serverExtension:{type:"string",required:!1},notificationEnabled:{type:"boolean",required:!1},notificationExtension:{type:"string",required:!1},persistence:{type:"boolean",required:!1}}},antispamConfig:{type:"object",rules:{antispamBusinessId:{type:"string",required:!1}}}},Ng={accountId:{type:"string",allowEmpty:!1},tempChatBannedDuration:{type:"number",min:0},notificationEnabled:{type:"boolean"},notificationExtension:{type:"string",required:!1}},vg={option:{type:"object",rules:{tag:{type:"string",allowEmpty:!1},pageToken:{type:"string",required:!1},limit:{type:"number",min:1,required:!1}}}},Mg=function(t){function V2NIMChatroomMemberServiceImpl(a){var c;return c=t.call(this,"V2NIMChatroomMemberService",a)||this,registerParser({cmdMap:Tf,cmdConfig:Mf}),c}yt(V2NIMChatroomMemberServiceImpl,t);var a=V2NIMChatroomMemberServiceImpl.prototype;return a.getMemberListByOption=function getMemberListByOption(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a;return Sa.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate(hg,{option:t},"",!0),c.next=3,this.core.clientSocket.sendCmd("v2ChatroomGetMemberListByOption",{tag:t});case 3:return a=c.sent,c.abrupt("return",{finished:!a.content.hasMore,pageToken:a.content.pageToken,memberList:a.content.datas});case 5:case"end":return c.stop()}}),_callee,this)})))},a.updateMemberRole=function updateMemberRole(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate(mg,{accountId:t,updateParams:a},"",!0),c.next=3,this.core.sendCmd("v2ChatroomUpdateMemberRole",{tag:ba(ba({notificationExtension:""},a),{accountId:t})});case 3:case"end":return c.stop()}}),_callee2,this)})))},a.setMemberBlockedStatus=function setMemberBlockedStatus(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){var _;return Sa.wrap((function _callee3$(E){for(;;)switch(E.prev=E.next){case 0:return validate(gg,_={accountId:t,blocked:a,notificationExtension:c},"",!0),E.next=4,this.core.sendCmd("v2ChatroomSetMemberBlockedStatus",_);case 4:case"end":return E.stop()}}),_callee3,this)})))},a.setMemberChatBannedStatus=function setMemberChatBannedStatus(t,a,c){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){var _;return Sa.wrap((function _callee4$(E){for(;;)switch(E.prev=E.next){case 0:return validate(Ig,_={accountId:t,chatBanned:a,notificationExtension:c},"",!0),E.next=4,this.core.sendCmd("v2ChatroomSetMemberChatBannedStatus",_);case 4:case"end":return E.stop()}}),_callee4,this)})))},a.setMemberTempChatBanned=function setMemberTempChatBanned(t,a,c,_){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){var E;return Sa.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return validate(Ng,E={accountId:t,tempChatBannedDuration:a,notificationEnabled:c,notificationExtension:_},"",!0),E.notificationExtension=E.notificationExtension||"",h.next=5,this.core.sendCmd("v2ChatroomSetMemberTempChatBanned",E);case 5:case"end":return h.stop()}}),_callee5,this)})))},a.updateSelfMemberInfo=function updateSelfMemberInfo(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee6(){return Sa.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:if(validate(Tg,{updateParams:t,antispamConfig:a},"",!0),void 0!==t.roomAvatar||void 0!==t.roomNick||void 0!==t.serverExtension){c.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"updateSelfMemberInfo: nothing to update"}});case 3:return c.next=5,this.core.clientSocket.sendCmd("v2ChatroomUpdateSelfMemberInfo",{tag:t,notificationEnabled:"boolean"!=typeof t.notificationEnabled||t.notificationEnabled,notificationExtension:t.notificationExtension||"",persistence:"boolean"==typeof t.persistence&&t.persistence,antispamConfig:a});case 5:case"end":return c.stop()}}),_callee6,this)})))},a.getMemberByIds=function getMemberByIds(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee7(){var a;return Sa.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({accountIds:{type:"array",itemType:"string",min:1}},{accountIds:t},"",!0),c.next=3,this.core.clientSocket.sendCmd("v2ChatroomGetMemberByIds",{accountIds:t});case 3:return a=c.sent,c.abrupt("return",a.content.datas);case 5:case"end":return c.stop()}}),_callee7,this)})))},a.kickMember=function kickMember(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee8(){return Sa.wrap((function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return validate({accountId:{type:"string",allowEmpty:!1}},{accountId:t},"",!0),validate({notificationExtension:{type:"string",required:!1}},{notificationExtension:a},"",!0),c.next=4,this.core.clientSocket.sendCmd("v2ChatroomKickMember",{accountId:t,notificationExtension:a});case 4:case"end":return c.stop()}}),_callee8,this)})))},a.getMemberListByTag=function getMemberListByTag(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee9(){var a;return Sa.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate(vg,{option:t},"",!0),c.next=3,this.core.clientSocket.sendCmd("v2ChatroomGetMemberListByTag",{tag:ba({limit:100},t)});case 3:return a=c.sent,c.abrupt("return",{finished:!a.content.hasMore,pageToken:a.content.pageToken,memberList:a.content.datas});case 5:case"end":return c.stop()}}),_callee9,this)})))},a.getMemberCountByTag=function getMemberCountByTag(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee10(){var a;return Sa.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return validate({tag:{type:"string",allowEmpty:!1}},{tag:t},"",!0),c.next=3,this.core.clientSocket.sendCmd("v2ChatroomGetMemberCountByTag",{tag:t});case 3:return a=c.sent,c.abrupt("return",a.content.data);case 5:case"end":return c.stop()}}),_callee10,this)})))},a.v2ChatroomOnMemberTagUpdatedHandler=function v2ChatroomOnMemberTagUpdatedHandler(t){var a;if(null===(a=t.content.data)||void 0===a?void 0:a.tag){var c=JSON.parse(t.content.data.tag);this.core.V2NIMChatroomService.emit("onChatroomTagsUpdated",c)}},V2NIMChatroomMemberServiceImpl}(mh),Og=function(t){function V2NIMChatroomServiceImpl(a){var c;return(c=t.call(this,"V2NIMChatroomService",a)||this).setListener(),c}yt(V2NIMChatroomServiceImpl,t);var a=V2NIMChatroomServiceImpl.prototype;return a.setListener=function setListener(){var t=this;this.core.eventBus.on("V2NIMChatroomMessageService/onReceiveNotification",(function(a,c){return __awaiter(t,void 0,void 0,Sa.mark((function _callee(){var t,_,E,h,m,g,I,T,N,M,O,S;return Sa.wrap((function _callee$(A){for(;;)switch(A.prev=A.next){case 0:t=a.attachment,_=Nd(a,"attachment.type"),A.t0=_,A.next=A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_ENTER?5:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_KICKED?9:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_EXIT?11:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_BLOCK_REMOVED?14:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_ADDED?15:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_CHAT_BANNED_REMOVED?17:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_ROLE_UPDATE?19:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_ADDED?21:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_ADDED?23:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_TEMP_CHAT_BANNED_REMOVED?25:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAG_TEMP_CHAT_BANNED_REMOVED?27:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED?29:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_CHAT_BANNED_REMOVED?32:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_TAGS_UPDATE?35:A.t0===_f.V2NIM_CHATROOM_MESSAGE_NOTIFICATION_TYPE_MEMBER_INFO_UPDATED?38:42;break;case 5:return E=a.attachment.currentMember,this.emit("onChatroomMemberEnter",E),t.operatorId!==this.core.account&&this.core.V2NIMChatroomInfoService.model.chatroomInfo&&this.core.V2NIMChatroomInfoService.model.chatroomInfo.onlineUserCount++,A.abrupt("break",42);case 9:if(td(t.targetIds))for(h=0;h<t.targetIds.length;h++)this.emit("onChatroomMemberExit",t.targetIds[h]);return A.abrupt("break",42);case 11:return this.emit("onChatroomMemberExit",t.operatorId),t.operatorId!==this.core.account&&this.core.V2NIMChatroomInfoService.model.chatroomInfo&&this.core.V2NIMChatroomInfoService.model.chatroomInfo.onlineUserCount--,A.abrupt("break",42);case 14:return A.abrupt("break",42);case 15:return t.targetIds&&includes(m=t.targetIds).call(m,this.core.account)&&this.emit("onSelfChatBannedUpdated",!0),A.abrupt("break",42);case 17:return t.targetIds&&includes(g=t.targetIds).call(g,this.core.account)&&this.emit("onSelfChatBannedUpdated",!1),A.abrupt("break",42);case 19:return this.emit("onChatroomMemberRoleUpdated",t.previousRole,t.currentMember),A.abrupt("break",42);case 21:return includes(I=a.attachment.targetIds).call(I,this.core.account)&&(T=c.data.muteDuration,this.emit("onSelfTempChatBannedUpdated",!0,T)),A.abrupt("break",42);case 23:return includes(N=this.core.tags).call(N,c.data.targetTag)&&(M=c.data.muteDuration,this.emit("onSelfTempChatBannedUpdated",!0,M)),A.abrupt("break",42);case 25:return includes(O=a.attachment.targetIds).call(O,this.core.account)&&this.emit("onSelfTempChatBannedUpdated",!1,0),A.abrupt("break",42);case 27:return this.emit("onSelfTempChatBannedUpdated",!1,0),A.abrupt("break",42);case 29:return this.emit("onChatroomChatBannedUpdated",!0),this.core.V2NIMChatroomInfoService.model.chatroomInfo&&(this.core.V2NIMChatroomInfoService.model.chatroomInfo.chatBanned=!0),A.abrupt("break",42);case 32:return this.emit("onChatroomChatBannedUpdated",!1),this.core.V2NIMChatroomInfoService.model.chatroomInfo&&(this.core.V2NIMChatroomInfoService.model.chatroomInfo.chatBanned=!1),A.abrupt("break",42);case 35:return this.core.options.tags=c.data.tags||[],this.emit("onChatroomTagsUpdated",c.data.tags),A.abrupt("break",42);case 38:return(S=a.attachment.currentMember).memberLevel=S.memberLevel||0,this.emit("onChatroomMemberInfoUpdated",S),A.abrupt("break",42);case 42:case"end":return A.stop()}}),_callee,this)})))}))},a.sendMessage=function sendMessage(t,a,c){return this.core.V2NIMChatroomMessageService.sendMessage(t,a,c)},a.cancelMessageAttachmentUpload=function cancelMessageAttachmentUpload(t){return this.core.V2NIMChatroomMessageService.fileUtil.cancelMessageAttachmentUpload(t)},a.getMessageList=function getMessageList(t){return this.core.V2NIMChatroomMessageService.getMessageList(t)},a.getMessageListByTag=function getMessageListByTag(t){return this.core.V2NIMChatroomMessageService.getMessageListByTag(t)},a.getMemberListByOption=function getMemberListByOption(t){return this.core.V2NIMChatroomMemberService.getMemberListByOption(t)},a.updateMemberRole=function updateMemberRole(t,a){return this.core.V2NIMChatroomMemberService.updateMemberRole(t,a)},a.setMemberBlockedStatus=function setMemberBlockedStatus(t,a,c){return this.core.V2NIMChatroomMemberService.setMemberBlockedStatus(t,a,c)},a.setMemberChatBannedStatus=function setMemberChatBannedStatus(t,a,c){return this.core.V2NIMChatroomMemberService.setMemberChatBannedStatus(t,a,c)},a.setMemberTempChatBanned=function setMemberTempChatBanned(t,a,c,_){return this.core.V2NIMChatroomMemberService.setMemberTempChatBanned(t,a,c,_)},a.updateSelfMemberInfo=function updateSelfMemberInfo(t,a){return this.core.V2NIMChatroomMemberService.updateSelfMemberInfo(t,a)},a.getMemberByIds=function getMemberByIds(t){return this.core.V2NIMChatroomMemberService.getMemberByIds(t)},a.kickMember=function kickMember(t,a){return this.core.V2NIMChatroomMemberService.kickMember(t,a)},a.getMemberListByTag=function getMemberListByTag(t){return this.core.V2NIMChatroomMemberService.getMemberListByTag(t)},a.getMemberCountByTag=function getMemberCountByTag(t){return this.core.V2NIMChatroomMemberService.getMemberCountByTag(t)},a.getChatroomInfo=function getChatroomInfo(){return this.core.V2NIMChatroomInfoService.getChatroomInfo()},a.updateChatroomInfo=function updateChatroomInfo(t,a){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.core.V2NIMChatroomInfoService.updateChatroomInfo(t,a));case 1:case"end":return c.stop()}}),_callee2,this)})))},a.updateChatroomLocationInfo=function updateChatroomLocationInfo(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee3(){return Sa.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.core.V2NIMChatroomInfoService.updateChatroomLocationInfo(t));case 1:case"end":return a.stop()}}),_callee3,this)})))},a.updateChatroomTags=function updateChatroomTags(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee4(){return Sa.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.core.V2NIMChatroomInfoService.updateChatroomTags(t));case 1:case"end":return a.stop()}}),_callee4,this)})))},a.setTempChatBannedByTag=function setTempChatBannedByTag(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee5(){return Sa.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.core.V2NIMChatroomInfoService.setTempChatBannedByTag(t));case 1:case"end":return a.stop()}}),_callee5,this)})))},V2NIMChatroomServiceImpl}(lh),Sg=entryVirtual("Array").keys,Ag=Array.prototype,Cg={DOMTokenList:!0,NodeList:!0},keys=function(t){var a=t.keys;return t===Ag||j(Ag,t)&&a===Ag.keys||ue(Cg,xt(t))?Sg:a},Rg=function(){function V2NIMClientAntispamUtilImpl(t){this.core=t}var t=V2NIMClientAntispamUtilImpl.prototype;return t.reset=function reset(t){t===Ap.Destroy&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function downloadLocalAntiSpamVocabs(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var t;return Sa.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.vocabInfo){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,this.core.sendCmd("v2ChatroomDownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 5:t=a.sent,this.vocabInfo=ba(ba({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(2),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",a.t0);case 12:case"end":return a.stop()}}),_callee,this,[[2,9]])})))},t.checkTextAntispam=function checkTextAntispam(t,a){if(void 0===a&&(a="**"),validate({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:t,replace:a},"",!0),!this.vocabInfo)return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t};for(var c=t,_=0;_<this.vocabInfo.thesaurus.length;_++){var E=this.filterContent(c,this.vocabInfo.thesaurus[_],a);if(c=E.replacedText,E.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||E.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD)return E}return{operateType:c===t?df.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE:df.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:c}},t.filterContent=function filterContent(t,a,c){for(var _=0;_<keys(a).length;_++){var E=keys(a)[_],h=E.match||a.match,m=E.operate||a.operate,g=void 0;try{g=this.matchContent(t,E.key,h,m,c)}catch(t){}if(g&&(t=g.replacedText,g.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD||g.operateType===df.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD))return g}return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t}},t.matchContent=function matchContent(t,a,c,_,E){var h=!1,m="";if(1===c)indexOf(t).call(t,a)>=0&&(h=!0,m=a);else if(2===c){new RegExp(a,"g").test(t)&&(h=!0)}if(h&&""!==m)switch(_){case 1:return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE,replacedText:t.replace(m,E)};case 2:return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD,replacedText:t};case 3:return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD,replacedText:t}}return{operateType:df.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE,replacedText:t}},V2NIMClientAntispamUtilImpl}(),yg={initParams:{type:"object",rules:{appkey:{type:"string",allowEmpty:!1},customClientType:{type:"number",required:!1},isFixedDeviceId:{type:"boolean",required:!1},debugLevel:{type:"enum",values:["off","error","warn","log","debug"],required:!1}}},otherParams:{type:"object",rules:{cloudStorageConfig:{type:"object",required:!1,rules:{commonUploadHost:{type:"string",required:!1},chunkUploadHost:{type:"string",required:!1},uploadReplaceFormat:{type:"string",required:!1},downloadUrl:{type:"string",required:!1},downloadHostList:{type:"array",required:!1},nosCdnEnable:{type:"boolean",required:!1},storageKeyPrefix:{type:"string",required:!1},isNeedToGetUploadPolicyFromServer:{type:"boolean",required:!1},cdn:{type:"object",required:!1,allowEmpty:!1,rules:{defaultCdnDomain:{type:"string",required:!1},cdnDomain:{type:"string",required:!1},bucket:{type:"string",required:!1},objectNamePrefix:{type:"string",required:!1}}}}},reporterConfig:{type:"object",allowEmpty:!1,required:!1,rules:{isDataReportEnable:{type:"boolean",required:!1},reportConfigUrl:{type:"string",required:!1},reportUrl:{type:"string",required:!1}}},abtestConfig:{type:"object",allowEmpty:!1,required:!1,rules:{isAbtestEnable:{type:"boolean",required:!1},abtestUrl:{type:"string",required:!1}}}}}},bg={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},Dg="ReporterHook::setMonitorForResources:",kg=function(){function ReporterHookCloudStorage(t,a){this.traceData=bg,this.core=t,this.traceData=ba({},bg,a)}var t=ReporterHookCloudStorage.prototype;return t.reset=function reset(){this.traceData=ba({},bg)},t.start=function start(){var t,a;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(a=null===(t=this.core.clientSocket)||void 0===t?void 0:t.socket)||void 0===a?void 0:a.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ga()},t.update=function update(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){return Sa.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(this.traceData.user_id){a.next=2;break}return a.abrupt("return");case 2:this.core.logger.log(Dg+" upload update",t),ba(this.traceData,t);case 4:case"end":return a.stop()}}),_callee,this)})))},t.end=function end(t){this.traceData.user_id&&(this.core.logger.log(Dg+" upload end cause of "+t),this.traceData.state=t,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Ga())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=bg)},ReporterHookCloudStorage}(),Vg=1,Lg={},Pg=function(t){function V2NIMChatroomClient(a,c){var _,E,h,m,g,I,T,N;void 0===c&&(c={}),(_=t.call(this)||this).pluginMap={},_.eventBus=new nd,_.options={appkey:"",account:"",tags:[],debugLevel:"debug",xhrConnectTimeout:8e3,socketConnectTimeout:8e3,apiVersion:"v2",isFixedDeviceId:!1,loginSDKTypeParamCompat:!1,binaryWebsocket:!0},_.config={deviceId:"",clientSession:"",binaryWebsocket:!0},_.options.appkey=a.appkey,_.options.customClientType=a.customClientType,_.options.isFixedDeviceId=a.isFixedDeviceId,_.options.loginSDKTypeParamCompat=a.loginSDKTypeParamCompat,_.instanceId=Vg,Vg+=1,_.logger=new z_(a.debugLevel||"debug"),_.timerManager=new Rp,_.adapters=new yp($e(_)),_.timeOrigin=new dp($e(_),{},"v2ChatroomGetServerTime"),_.reporterHookLinkKeep=new dh($e(_)),_.reporterHookCloudStorage=new kg($e(_)),"boolean"==typeof a.binaryWebsocket&&(_.options.binaryWebsocket=a.binaryWebsocket),_.options.isFixedDeviceId?(_.config.deviceId=zl.localStorage.getItem("__CHATROOM_DEVC_ID__")||Yp(),_.config.clientSession=zl.localStorage.getItem("__CHATROOM_CLIENT_SESSION_ID__")||Yp(),zl.localStorage.setItem("__CHATROOM_DEVC_ID__",_.config.deviceId),zl.localStorage.setItem("__CHATROOM_CLIENT_SESSION_ID__",_.config.clientSession)):(_.config.deviceId=Yp(),_.config.clientSession=Yp()),_.abtest=new Xp($e(_),{isAbtestEnable:void 0===(null===(E=c.abtestConfig)||void 0===E?void 0:E.isAbtestEnable)||(null===(h=c.abtestConfig)||void 0===h?void 0:h.isAbtestEnable),abtestUrl:(null===(m=c.abtestConfig)||void 0===m?void 0:m.abtestUrl)||$_,abtestProjectKey:X_});var M=zl.getSystemInfo();return _.reporter=new us({reportConfigUrl:(null===(g=c.reporterConfig)||void 0===g?void 0:g.reportConfigUrl)||"https://statistic.live.126.net/dispatcher/req",reportUrl:(null===(I=c.reporterConfig)||void 0===I?void 0:I.reportUrl)||"https://statistic.live.126.net/statics/report/common/form",isDataReportEnable:void 0===(null===(T=c.reporterConfig)||void 0===T?void 0:T.isDataReportEnable)||(null===(N=c.reporterConfig)||void 0===N?void 0:N.isDataReportEnable),common:{app_key:a.appkey,dev_id:_.config.deviceId,platform:"Web",sdk_ver:"10.2.700",env:"online",os_name:M.os,os_ver:M.osVer,lib_env:M.libEnv,host_env:M.hostEnv,host_env_ver:M.hostEnvVer,manufactor:M.manufactor,model:M.model,v2:!0},request:zl.request,logger:_.logger,autoStart:!0}),zl.setLogger(_.logger),_.auth=new uh($e(_)),_.V2NIMChatroomLoginService=_.auth,_.options.binaryWebsocket&&"BROWSER"===zl.platform&&"function"==typeof TextDecoder&&"function"==typeof TextEncoder&&"function"==typeof Uint8Array?(_.config.binaryWebsocket=!0,_.clientSocket=new Tp($e(_))):(_.config.binaryWebsocket=!1,_.clientSocket=new Cp($e(_))),_.cloudStorage=new $h($e(_),ba({storageKeyPrefix:"V2NIMChatroomClient"},c.cloudStorageConfig)),_.V2NIMChatroomInfoService=new Sh($e(_)),_.V2NIMStorageService=new Qh($e(_)),_.V2NIMChatroomMessageService=new Eg($e(_)),_.V2NIMChatroomMessageCreator=new fg($e(_)),_.V2NIMClientAntispamUtil=new Rg($e(_)),_.V2NIMChatroomMemberService=new Mg($e(_)),_.V2NIMChatroomService=new Og($e(_)),_}yt(V2NIMChatroomClient,t),V2NIMChatroomClient.getInstanceList=function getInstanceList(){return Pa(Lg)},V2NIMChatroomClient.getInstance=function getInstance(t){return validate({instanceId:{type:"number",allowEmpty:!1}},{instanceId:t},"",!0),Lg[t]},V2NIMChatroomClient.newInstance=function newInstance(t,a){void 0===a&&(a={}),validate(yg,{initParams:t,otherParams:a},"",!0);var c=new V2NIMChatroomClient(t,a);return Lg[c.instanceId]=c,c},V2NIMChatroomClient.destroyInstance=function destroyInstance(t){var a=this.getInstance(t);if(a)return delete Lg[t],a._exitAsync().then((function(){a._clear()})).catch((function(){a._clear()}))},V2NIMChatroomClient.destroyAll=function destroyAll(){for(var t in Lg)this.destroyInstance(Number(t))};var a=V2NIMChatroomClient.prototype;return a.getInstanceId=function getInstanceId(){return this.instanceId},a._clearModuleData=function _clearModuleData(t){void 0===t&&(t=Ap.Logout);var a=Pa(this);forEach$1(a).call(a,(function(a){a&&"function"==typeof a.reset&&a.reset(t)}))},a._removeAllModuleListeners=function _removeAllModuleListeners(){var t=Pa(this);forEach$1(t).call(t,(function(t){t&&"function"==typeof t.removeAllListeners&&t.removeAllListeners()}))},a._clear=function _clear(){this.removeAllListeners(),this.eventBus.removeAllListeners(),this.logger.destroy(),this.reporter.destroy(),this.timerManager.destroy(),this._clearModuleData(Ap.Destroy),this._removeAllModuleListeners()},a.enter=function enter(t,a){var c;return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var _,E;return Sa.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(validate(sh,{roomId:t,enterParams:a},"",!0),a.accountId||a.anonymousMode){h.next=3;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"accountId is required"}});case 3:if(_=Nd(a,"loginOption.authType")||jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT,a.loginOption=a.loginOption||{authType:_},_!==jp.V2NIM_LOGIN_AUTH_TYPE_DEFAULT){h.next=8;break}if(a.anonymousMode||a.token){h.next=8;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"token is required when authType == 0"}});case 8:if(_!==jp.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN){h.next=11;break}if(null===(c=a.loginOption)||void 0===c?void 0:c.tokenProvider){h.next=11;break}throw new F_({code:Df.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"tokenProvider is required when authType == 1"}});case 11:return h.next=13,this.auth.login(this.options.appkey,t,a);case 13:return E=h.sent,this.V2NIMChatroomInfoService._setChatroomInfo(E.chatroom),h.abrupt("return",E);case 16:case"end":return h.stop()}}),_callee,this)})))},a._exitAsync=function _exitAsync(){return __awaiter(this,void 0,void 0,Sa.mark((function _callee2(){return Sa.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return this.auth.reset(),t.prev=1,t.next=4,this.auth.logout();case 4:return t.abrupt("return");case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",da.resolve());case 10:case"end":return t.stop()}}),_callee2,this,[[1,7]])})))},a.exit=function exit(){this._exitAsync()},a.sendCmd=function sendCmd(t,a,c){return this.clientSocket.sendCmd(t,a,c)},a.getChatroomInfo=function getChatroomInfo(){return this.V2NIMChatroomInfoService.getChatroomInfo()},ze(V2NIMChatroomClient,[{key:"account",get:function get(){return this.options.account}},{key:"tags",get:function get(){return this.options.tags}},{key:"status",get:function get(){return this.auth.lifeCycle.chatroomStatus===hf.V2NIM_CHATROOM_STATUS_ENTERED?"logined":""}}]),V2NIMChatroomClient}(nd),wg=createCommonjsModule((function(t,c){(function(){var _={function:!0,object:!0}[typeof window]&&window||this,E=c,h=t&&!t.nodeType&&t,m=E&&h&&"object"==typeof a&&a;!m||m.global!==m&&m.window!==m&&m.self!==m||(_=m);var g=Math.pow(2,53)-1,I=/\bOpera/,T=Object.prototype,N=T.hasOwnProperty,M=T.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var c in t)N.call(t,c)&&a(t[c],c,t)}function getClassOf(t){return null==t?capitalize(t):M.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var c=null;return function each(t,a){var c=-1,_=t?t.length:0;if("number"==typeof _&&_>-1&&_<=g)for(;++c<_;)a(t[c],c,t);else forOwn(t,a)}(t,(function(_,E){c=a(c,_,E,t)})),c}function trim(t){return String(t).replace(/^ +| +$/g,"")}var O=function parse(t){var a=_,c=t&&"object"==typeof t&&"String"!=getClassOf(t);c&&(a=t,t=null);var E=a.navigator||{},h=E.userAgent||"";t||(t=h);var m,g,T=c?!!E.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(M.toString()),N="Object",O=c?N:"ScriptBridgingProxyObject",S=c?N:"Environment",A=c&&a.java?"JavaPackage":getClassOf(a.java),C=c?N:"RuntimeObject",R=/\bJava/.test(A)&&a.java,b=R&&getClassOf(a.environment)==S,D=R?"a":"α",k=R?"b":"β",V=a.document||{},L=a.operamini||a.opera,P=I.test(P=c&&L?L["[[Class]]"]:getClassOf(L))?P:L=null,w=t,x=[],U=null,G=t==h,B=G&&L&&"function"==typeof L.version&&L.version(),H=function getLayout(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Y=function getName(a){return reduce(a,(function(a,c){return a||RegExp("\\b"+(c.pattern||qualify(c))+"\\b","i").exec(t)&&(c.label||c)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),j=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),K=function getManufacturer(a){return reduce(a,(function(a,c,_){return a||(c[j]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(j)]||RegExp("\\b"+qualify(_)+"(?:\\b|\\w*\\d)","i").exec(t))&&_}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function getOS(a){return reduce(a,(function(a,c){var _=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+_+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,c){var _={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&c&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(_=_[/[\d.]+$/.exec(t)])&&(t="Windows "+_),t=String(t),a&&c&&(t=t.replace(RegExp(a,"i"),c)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,_,c.label||c)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,c){var _=c.pattern||qualify(c);return!a&&(a=RegExp("\\b"+_+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+_+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+_+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(c.label&&!RegExp(_,"i").test(c.label)?c.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),c=c.label||c,a=format(a[0].replace(RegExp(_,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,c){return a||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(H&&(H=[H]),/\bAndroid\b/.test(W)&&!j&&(m=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(j=trim(m[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),K&&!j?j=getProduct([K]):K&&j&&(j=j.replace(RegExp("^("+qualify(K)+")[-_.\\s]","i"),K+" ").replace(RegExp("^("+qualify(K)+")[-_.]?(\\w)","i"),K+" $2")),(m=/\bGoogle TV\b/.exec(j))&&(j=m[0]),/\bSimulator\b/i.test(t)&&(j=(j?j+" ":"")+"Simulator"),"Opera Mini"==Y&&/\bOPiOS\b/.test(t)&&x.push("running in Turbo/Uncompressed mode"),"IE"==Y&&/\blike iPhone OS\b/.test(t)?(K=(m=parse(t.replace(/like iPhone OS/,""))).manufacturer,j=m.product):/^iP/.test(j)?(Y||(Y="Safari"),W="iOS"+((m=/ OS ([\d_]+)/i.exec(t))?" "+m[1].replace(/_/g,"."):"")):"Konqueror"==Y&&/^Linux\b/i.test(W)?W="Kubuntu":K&&"Google"!=K&&(/Chrome/.test(Y)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(j))||/\bAndroid\b/.test(W)&&/^Chrome/.test(Y)&&/\bVersion\//i.test(t)?(Y="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==Y?(/\bMobi/i.test(t)||(W="Android",x.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&x.unshift("accelerated")):"UC Browser"==Y&&/\bUCWEB\b/.test(t)?x.push("speed mode"):"PaleMoon"==Y&&(m=/\bFirefox\/([\d.]+)\b/.exec(t))?x.push("identifying as Firefox "+m[1]):"Firefox"==Y&&(m=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),j||(j=m[1])):!Y||(m=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(Y))?(Y&&!j&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(m+"/")+8))&&(Y=null),(m=j||K||W)&&(j||K||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(Y=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:m)+" Browser")):"Electron"==Y&&(m=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&x.push("Chromium "+m),B||(B=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(Y),"(?:Firefox|Minefield|NetFront)"])),(m=("iCab"==H&&parseFloat(B)>3?"WebKit":/\bOpera\b/.test(Y)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(H)&&"WebKit"||!H&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==H&&/\bPlayStation\b(?! Vita\b)/i.test(Y)&&"NetFront")&&(H=[m]),"IE"==Y&&(m=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(Y+=" Mobile",W="Windows Phone "+(/\+$/.test(m)?m:m+".x"),x.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(Y="IE Mobile",W="Windows Phone 8.x",x.unshift("desktop mode"),B||(B=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=Y&&"Trident"==H&&(m=/\brv:([\d.]+)/.exec(t))&&(Y&&x.push("identifying as "+Y+(B?" "+B:"")),Y="IE",B=m[1]),G){if(function isHostType(t,a){var c=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(c)||"object"==c&&!t[a])}(a,"global"))if(R&&(w=(m=R.lang.System).getProperty("os.arch"),W=W||m.getProperty("os.name")+" "+m.getProperty("os.version")),b){try{B=a.require("ringo/engine").version.join("."),Y="RingoJS"}catch(t){(m=a.system)&&m.global.system==a.system&&(Y="Narwhal",W||(W=m[0].os||null))}Y||(Y="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(m=a.process)&&("object"==typeof m.versions&&("string"==typeof m.versions.electron?(x.push("Node "+m.versions.node),Y="Electron",B=m.versions.electron):"string"==typeof m.versions.nw&&(x.push("Chromium "+B,"Node "+m.versions.node),Y="NW.js",B=m.versions.nw)),Y||(Y="Node.js",w=m.arch,W=m.platform,B=(B=/[\d.]+/.exec(m.version))?B[0]:null));else getClassOf(m=a.runtime)==O?(Y="Adobe AIR",W=m.flash.system.Capabilities.os):getClassOf(m=a.phantom)==C?(Y="PhantomJS",B=(m=m.version||null)&&m.major+"."+m.minor+"."+m.patch):"number"==typeof V.documentMode&&(m=/\bTrident\/(\d+)/i.exec(t))?(B=[B,V.documentMode],(m=+m[1]+4)!=B[1]&&(x.push("IE "+B[1]+" mode"),H&&(H[1]=""),B[1]=m),B="IE"==Y?String(B[1].toFixed(1)):B[0]):"number"==typeof V.documentMode&&/^(?:Chrome|Firefox)\b/.test(Y)&&(x.push("masking as "+Y+" "+B),Y="IE",B="11.0",H=["Trident"],W="Windows");W=W&&format(W)}if(B&&(m=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(B)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(G&&E.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(U=/b/i.test(m)?"beta":"alpha",B=B.replace(RegExp(m+"\\+?$"),"")+("beta"==U?k:D)+(/\d+\+?/.exec(m)||"")),"Fennec"==Y||"Firefox"==Y&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))Y="Firefox Mobile";else if("Maxthon"==Y&&B)B=B.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(j))"Xbox 360"==j&&(W=null),"Xbox 360"==j&&/\bIEMobile\b/.test(t)&&x.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(Y)&&(!Y||j||/Browser|Mobi/.test(Y))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==Y&&G)try{null===a.external&&x.unshift("platform preview")}catch(t){x.unshift("embedded")}else(/\bBlackBerry\b/.test(j)||/\bBB10\b/.test(t))&&(m=(RegExp(j.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||B)?(W=((m=[m,/BB10/.test(t)])[1]?(j=null,K="BlackBerry"):"Device Software")+" "+m[0],B=null):this!=forOwn&&"Wii"!=j&&(G&&L||/Opera/.test(Y)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==Y&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==Y&&(W&&!/^Win/.test(W)&&B>5.5||/\bWindows XP\b/.test(W)&&B>8||8==B&&!/\bTrident\b/.test(t)))&&!I.test(m=parse.call(forOwn,t.replace(I,"")+";"))&&m.name&&(m="ing as "+m.name+((m=m.version)?" "+m:""),I.test(Y)?(/\bIE\b/.test(m)&&"Mac OS"==W&&(W=null),m="identify"+m):(m="mask"+m,Y=P?format(P.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(m)&&(W=null),G||(B=null)),H=["Presto"],x.push(m));else Y+=" Mobile";(m=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(m=[parseFloat(m.replace(/\.(\d)$/,".0$1")),m],"Safari"==Y&&"+"==m[1].slice(-1)?(Y="WebKit Nightly",U="alpha",B=m[1].slice(0,-1)):B!=m[1]&&B!=(m[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(B=null),m[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==m[0]&&537.36==m[2]&&parseFloat(m[1])>=28&&"WebKit"==H&&(H=["Blink"]),G&&(T||m[1])?(H&&(H[1]="like Chrome"),m=m[1]||((m=m[0])<530?1:m<532?2:m<532.05?3:m<533?4:m<534.03?5:m<534.07?6:m<534.1?7:m<534.13?8:m<534.16?9:m<534.24?10:m<534.3?11:m<535.01?12:m<535.02?"13+":m<535.07?15:m<535.11?16:m<535.19?17:m<536.05?18:m<536.1?19:m<537.01?20:m<537.11?"21+":m<537.13?23:m<537.18?24:m<537.24?25:m<537.36?26:"Blink"!=H?"27":"28")):(H&&(H[1]="like Safari"),m=(m=m[0])<400?1:m<500?2:m<526?3:m<533?4:m<534?"4+":m<535?5:m<537?6:m<538?7:m<601?8:m<602?9:m<604?10:m<606?11:m<608?12:"12"),H&&(H[1]+=" "+(m+="number"==typeof m?".x":/[.+]/.test(m)?"":"+")),"Safari"==Y&&(!B||parseInt(B)>45)?B=m:"Chrome"==Y&&/\bHeadlessChrome/i.test(t)&&x.unshift("headless")),"Opera"==Y&&(m=/\bzbov|zvav$/.exec(W))?(Y+=" ",x.unshift("desktop mode"),"zvav"==m?(Y+="Mini",B=null):Y+="Mobile",W=W.replace(RegExp(" *"+m+"$"),"")):"Safari"==Y&&/\bChrome\b/.exec(H&&H[1])?(x.unshift("desktop mode"),Y="Chrome Mobile",B=null,/\bOS X\b/.test(W)?(K="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(Y)&&!B&&(B=getVersion("Chrome")),B&&0==B.indexOf(m=/[\d.]+$/.exec(W))&&t.indexOf("/"+m+"-")>-1&&(W=trim(W.replace(m,""))),W&&-1!=W.indexOf(Y)&&!RegExp(Y+" OS").test(W)&&(W=W.replace(RegExp(" *"+qualify(Y)+" *"),"")),H&&!/\b(?:Avant|Nook)\b/.test(Y)&&(/Browser|Lunascape|Maxthon/.test(Y)||"Safari"!=Y&&/^iOS/.test(W)&&/\bSafari\b/.test(H[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(Y)&&H[1])&&(m=H[H.length-1])&&x.push(m),x.length&&(x=["("+x.join("; ")+")"]),K&&j&&j.indexOf(K)<0&&x.push("on "+K),j&&x.push((/^on /.test(x[x.length-1])?"":"on ")+j),W&&(m=/ ([\d.+]+)$/.exec(W),g=m&&"/"==W.charAt(W.length-m[0].length-1),W={architecture:32,family:m&&!g?W.replace(m[0],""):W,version:m?m[1]:null,toString:function(){var t=this.version;return this.family+(t&&!g?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(m=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(w))&&!/\bi686\b/i.test(w)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+m),"")),Y&&(/\bWOW64\b/i.test(t)||G&&/\w(?:86|32)$/.test(E.cpuClass||E.platform)&&!/\bWin64; x64\b/i.test(t))&&x.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==Y&&parseFloat(B)>=39&&(W.architecture=64),t||(t=null);var q={};return q.description=t,q.layout=H&&H[0],q.manufacturer=K,q.name=Y,q.prerelease=U,q.product=j,q.ua=t,q.version=Y&&B,q.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},q.parse=parse,q.toString=function toStringPlatform(){return this.description||""},q.version&&x.unshift(B),q.name&&x.unshift(Y),W&&Y&&(W!=String(W).split(" ")[0]||W!=Y.split(" ")[0]&&!j)&&x.push(j?"("+W+")":"on "+W),x.length&&(q.description=x.join(" ")),q}();E&&h?forOwn(O,(function(t,a){E[a]=t})):_.platform=O}).call(a)})),xg=Math.floor,mergeSort=function(t,a){var c=t.length,_=xg(c/2);return c<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,_),a),mergeSort(arraySliceSimple(t,_),a),a)},insertionSort=function(t,a){for(var c,_,E=t.length,h=1;h<E;){for(_=h,c=t[h];_&&a(t[_-1],c)>0;)t[_]=t[--_];_!==h++&&(t[_]=c)}return t},merge=function(t,a,c,_){for(var E=a.length,h=c.length,m=0,g=0;m<E||g<h;)t[m+g]=m<E&&g<h?_(a[m],c[g])<=0?a[m++]:c[g++]:m<E?a[m++]:c[g++];return t},Ug=mergeSort,Gg=K.match(/firefox\/(\d+)/i),Fg=!!Gg&&+Gg[1],Bg=/MSIE|Trident/.test(K),Hg=K.match(/AppleWebKit\/(\d+)\./),Yg=!!Hg&&+Hg[1],jg=[],Kg=A(jg.sort),Wg=A(jg.push),qg=fails((function(){jg.sort(void 0)})),zg=fails((function(){jg.sort(null)})),$g=arrayMethodIsStrict("sort"),Xg=!fails((function(){if(X)return X<70;if(!(Fg&&Fg>3)){if(Bg)return!0;if(Yg)return Yg<603;var t,a,c,_,E="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:c=3;break;case 68:case 71:c=4;break;default:c=2}for(_=0;_<47;_++)jg.push({k:a+_,v:c})}for(jg.sort((function(t,a){return a.v-t.v})),_=0;_<jg.length;_++)a=jg[_].k.charAt(0),E.charAt(E.length-1)!==a&&(E+=a);return"DGBEFHACIJK"!==E}}));_export({target:"Array",proto:!0,forced:qg||!zg||!$g||!Xg},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(Xg)return void 0===t?Kg(a):Kg(a,t);var c,_,E=[],h=lengthOfArrayLike(a);for(_=0;_<h;_++)_ in a&&Wg(E,a[_]);for(Ug(E,function(t){return function(a,c){return void 0===c?-1:void 0===a?1:void 0!==t?+t(a,c)||0:toString$1(a)>toString$1(c)?1:-1}}(t)),c=lengthOfArrayLike(E),_=0;_<c;)a[_]=E[_++];for(;_<h;)deletePropertyOrThrow(a,_++);return a}});var Jg=entryVirtual("Array").sort,Qg=Array.prototype,sort=function(t){var a=t.sort;return t===Qg||j(Qg,t)&&a===Qg.sort?Jg:a},Zg=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function d(a,c){for(var _ in c)t.o(c,_)&&!t.o(a,_)&&qe(a,_,{enumerable:!0,get:c[_]})},o:function o(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function _default(){return M}});var c=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(t){},this.onProgress=function(t){},this.onUploadProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var c=void 0!==Qn&&ed(t)||t["@@iterator"];if(!c){if(td(t)||(c=function(t,a){if(t){var c;if("string"==typeof t)return r(t,a);var _=slice(c=Object.prototype.toString.call(t)).call(c,8,-1);return"Object"===_&&t.constructor&&(_=t.constructor.name),"Map"===_||"Set"===_?Z_(t):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var _=0,E=function i(){};return{s:E,n:function n(){return _>=t.length?{done:!0}:{done:!1,value:t[_++]}},e:function e(t){throw t},f:E}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,m=!0,g=!1;return{s:function s(){c=c.call(t)},n:function n(){var t=c.next();return m=t.done,t},e:function e(t){g=!0,h=t},f:function f(){try{m||null==c.return||c.return()}finally{if(g)throw h}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var c=0,_=new Array(a);c<a;c++)_[c]=t[c];return _}var _={privateObj:{},setItem:function setItem(t,a){_.privateObj[t]=a},getItem:function getItem(t){return _.privateObj[t]},removeItem:function removeItem(t){delete _.privateObj[t]},getKeys:function getKeys(){return Ja(_.privateObj)}},E={getFileKey:function getFileKey(t){var a=t.size.toString(),c=t.lastModified.toString();return"_NosUploader_"+t.name+slice(a).call(a,a.length-5)+slice(c).call(c,c.length-5)},getFileInfo:function getFileInfo(t){var a=_.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function initFile(t,a,c){E.clearExpiredInfo();var h=this.getFileKey(a),m={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Ga(),end:!1};return t.payload&&(m.payload=t.payload),c&&_.setItem(h,iu(m)),h},setUploadContext:function setUploadContext(t,a,c){var E=this.getFileInfo(t);E&&(E.ctx=a,c&&_.setItem(t,iu(E)))},setComplete:function setComplete(t,a){var c=this.getFileInfo(t);c&&(c.modifyAt=Ga(),c.end=!0,a&&_.setItem(t,iu(c)))},getUploadContext:function getUploadContext(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function removeFileInfo(t){0===indexOf(t).call(t,"_NosUploader_")&&_.removeItem(t)},clearExpiredInfo:function clearExpiredInfo(){var t,a="function"==typeof _.getKeys?_.getKeys():Ja(_),c=Ga(),h=[],m=n(a);try{for(m.s();!(t=m.n()).done;){var g=t.value;if(0===indexOf(g).call(g,"_NosUploader_")){var I=E.getFileInfo(g);null===I||c-I.modifyAt>M.expireTime?_.removeItem(g):h.push({fileInfo:I,key:g})}}}catch(t){m.e(t)}finally{m.f()}if(h.length>M.maxFileCache){var T,N,O=n(slice(T=sort(h).call(h,(function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt}))).call(T,M.maxFileCache));try{for(O.s();!(N=O.n()).done;){var S,A=N.value;0===indexOf(S=A.key).call(S,"_NosUploader_")&&_.removeItem(A.key)}}catch(t){O.e(t)}finally{O.f()}}}},h=E;function u(t){return(u="function"==typeof Qn&&"symbol"==typeof so?function(t){return typeof t}:function(t){return t&&"function"==typeof Qn&&t.constructor===Qn&&t!==Qn.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Ru?new Ru:void 0;return(l=function l(t){var c,_;if(null===t||(_=t,-1===indexOf(c=Function.toString.call(_)).call(c,"[native code]")))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=ft(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,c){return(s=p()?xu:function(t,a,c){var _=[null];_.push.apply(_,a);var E=new(bind$1(Function).apply(t,_));return c&&d(E,c.prototype),E}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!xu)return!1;if(xu.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(xu(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=It||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=It?uo:function(t){return t.__proto__||uo(t)})(t)}var m=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=ft(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,c,_=(a=r,c=p(),function(){var t,_=y(a);if(c){var E=y(this).constructor;t=xu(_,arguments,E)}else t=_.apply(this,arguments);return f(this,t)});function r(t,a){var c;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(c=_.call(this,"NosUploadError:"+t)).errCode=a,c.errMsg=t,c}return r}(l(Error)),g=function e(t,a,c){if("uploading"===t.uploadState){var _=t.config,E=t.param,g=h.getUploadContext(t.fileKey);if(!g)return c(0);var I=new XMLHttpRequest,T=_.directUploadAddr+"/".concat(E.bucketName)+"/".concat(encodeURIComponent(E.objectName))+"?uploadContext"+"&context=".concat(g)+"&version=".concat(_.version);I.onreadystatechange=function(){var E;if("abort"!==t.uploadState&&4===I.readyState){var g,N,M,O;try{O=JSON.parse(I.responseText)}catch(t){O={errMsg:"JsonParseError in getOffset",errCode:500}}200===I.status?O.errCode?t.config.onError(new m(O.errMsg,O.errCode)):c(O.offset):I.status.toString().match(/^5/)?e(t,a-1,c):a>0?("function"==typeof(null===(E=_.logger)||void 0===E?void 0:E.error)&&_.logger.error(concat(g="getOffset(".concat(T,") error. retry after 3 seconds. ")).call(g,(new Date).toTimeString())),ns((function(){e(t,a-1,c)}),3500)):I.status?(h.removeFileInfo(t.fileKey),_.onError(new m(concat(N=concat(M="getOffset(".concat(T,") error: ")).call(M,I.status," ")).call(N,I.statusText)))):_.onError(new m("getOffset(".concat(T,") error. no Error Code")))}},I.open("get",T),I.setRequestHeader("x-nos-token",E.token),I.timeout=_.getOffsetTimeout,I.send()}},I=function e(t,a,c,_){if("uploading"===t.uploadState){var E=t.param,g=t.config,I=slice(File.prototype),T=void 0!==E.ctx?E.ctx:"",N=a+g.trunkSize>t.file.size,M=N?t.file.size:a+g.trunkSize,O=new XMLHttpRequest,S=g.directUploadAddr+"/".concat(E.bucketName)+"/".concat(encodeURIComponent(E.objectName));if(O.upload.onprogress=function(c){if("abort"!==t.uploadState){var _=0;c.lengthComputable?(_=(a+c.loaded)/t.file.size,g.onProgress(_),g.onUploadProgress({loaded:c.loaded,total:t.file.size,percentage:_,percentageText:(100*_).toFixed(2)+"%"})):g.onError(new m("browser does not support query upload progress"))}},O.onreadystatechange=function(){var E,I;if("abort"!==t.uploadState&&4===O.readyState){var T,M,A,C;try{C=JSON.parse(O.responseText)}catch(t){"function"==typeof(null===(E=g.logger)||void 0===E?void 0:E.error)&&g.logger.error("JsonParseError in uploadTrunk",t),C={errMsg:"JsonParseError in uploadTrunk"}}200===O.status?(t.setContext(C.context),N?(_(),t.setComplete()):e(t,C.offset,g.retryCount,_)):O.status.toString().match(/^5/)?c>0?e(t,a,c-1,_):(h.removeFileInfo(t.fileKey),g.onError(new m(C.errMsg,C.errCode))):c>0?("function"==typeof(null===(I=g.logger)||void 0===I?void 0:I.error)&&g.logger.error(concat(T="uploadTrunk(".concat(S,") error. retry after 3 seconds. ")).call(T,(new Date).toTimeString())),ns((function(){e(t,a,c-1,_)}),3500)):O.status?(h.removeFileInfo(t.fileKey),g.onError(new m(concat(M=concat(A="uploadTrunk(".concat(S,") error: ")).call(A,O.status," ")).call(M,O.statusText)))):g.onError(new m("uploadTrunk(".concat(S,") error. no Error Code. Please check your network")))}},O.open("post",S+"?offset=".concat(a)+"&complete=".concat(N)+"&context=".concat(T)+"&version=".concat(g.version)),O.setRequestHeader("x-nos-token",E.token),E.md5&&O.setRequestHeader("content-md5",E.md5),t.file.type&&O.setRequestHeader("content-type",t.file.type),O.timeout=g.trunkUploadTimeout,"undefined"!=typeof FileReader){var A=new FileReader;A.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)instanceof ArrayBuffer&&t.target.result.byteLength>0?O.send(t.target.result):g.onError(new m("Read ArrayBuffer failed",194003))})),A.addEventListener("error",(function(t){var a=t.target.error;g.onError(new m("Read ArrayBuffer error. ".concat(a.toString()),194003))})),A.readAsArrayBuffer(I.call(t.file,a,M))}else O.send(I.call(t.file,a,M))}};function v(t,a){for(var c=0;c<a.length;c++){var _=a[c];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),qe(t,_.key,_)}}var T=function(){function e(t,a,c){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=c,this.file=t,this.param=a,this.fileKey=h.initFile(a,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function value(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;g(this,a.retryCount,(function(c){I(t,c,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function value(){this.setUploadState("paused")}},{key:"abort",value:function value(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new m("Upload Aborted",10499)))}},{key:"setUploadState",value:function value(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function value(t){h.setUploadContext(this.fileKey,t,this.config.enableCache),this.param.ctx=t}},{key:"setComplete",value:function value(){h.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&v(e.prototype,t),e}(),N={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function getFileUploadInformation(t){var a=h.getFileKey(t),c=h.getFileInfo(a);return null===c?null:Ga()-c.modifyAt>N.expireTime?(h.removeFileInfo(a),null):{uploadInfo:ba({bucketName:c.bucket,objectName:c.obj,token:c.token,ctx:c.ctx},c.payload?{payload:c.payload}:{}),complete:c.end}},setMaxFileCache:function setMaxFileCache(t){N.maxFileCache=t},setExpireTime:function setExpireTime(t){N.expireTime=t},printCaches:function printCaches(){if("undefined"!=typeof localStorage)for(var t=0,a=Ja(localStorage);t<a.length;t++){var c=a[t],_=h.getFileInfo(c);_&&console.log(_,"modifiedAt",new Date(_.modifyAt).toTimeString())}},createConfig:function createConfig(t){return new c(t)},createTask:function createTask(t,a,c){return new T(t,a,c)}},M=N;return a.default}()})),eI=createCommonjsModule((function(t,a){t.exports=function(){function object2String(t){if(t){var a,c="";return forEach$1(a=Ja(t)).call(a,(function(a,_){c+=0===_?"?":"&",c+=a+"="+t[a]})),c}return""}var t=function(t){function V2NIMError(a,c,_,E){var h;return(h=t.call(this,_)||this).source=a,h.code=c,h.desc=_,h.detail=E||{},h}return yt(V2NIMError,t),V2NIMError}(Bu(Error));function request(a,c){void 0===c&&(c={dataType:"json",method:"GET",timeout:5e3});var _="text"===c.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",E="GET"===c.method?object2String(c.params):"";return new da((function(h,m){if(window.XMLHttpRequest){var g,I=new XMLHttpRequest;if(I.onreadystatechange=function(){if(4===I.readyState)if(200===I.status){try{g=JSON.parse(I.response||"{}")}catch(t){g=I.response}h({status:I.status,data:g})}else ns((function(){m(new t(1,I.status,"readyState: "+I.readyState+"; statusText: "+I.statusText))}),0)},I.open(c.method,""+a+E),I.timeout=c.timeout||5e3,I.setRequestHeader("Content-Type",_),c.headers)for(var T in c.headers)I.setRequestHeader(T,c.headers[T]);I.ontimeout=function(a){m(new t(1,408,a&&a.message?a.message:"request timeout"))},I.send(iu(c.data))}else m(new t(2,10400,"request no suppout"))}))}return request}()})),tI=console;var rI=null,nI=null,oI={setLogger:function setLogger(t){tI=t},platform:"BROWSER",localStorage:window.localStorage,request:eI,WebSocket:window.WebSocket,uploadFile:function uploadFile(t){return __awaiter(this,void 0,void 0,Sa.mark((function _callee(){var a,c,_,E,h,m;return Sa.wrap((function _callee$(g){for(;;)switch(g.prev=g.next){case 0:if(t.fileInput||t.file){g.next=2;break}throw new Error("File not exist");case 2:if(!t.file){g.next=6;break}E=t.file,g.next=20;break;case 6:if("string"!=typeof t.fileInput){g.next=15;break}if(!((h=document.getElementById(t.fileInput))&&h.files&&h.files[0])){g.next=12;break}E=h.files[0],g.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:g.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){g.next=19;break}E=t.fileInput.files[0],g.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&E.size>t.maxSize)){g.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+E.size);case 22:return g.next=24,new da((function(a,c){var _,h=Zg.getFileUploadInformation(E),m=Zg.createConfig({enableCache:!0,retryCount:0,directUploadAddr:t.chunkUploadHost,onError:function onError(t){c(t)},onUploadProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}});if(h)if(h.complete)t.onUploadProgress&&t.onUploadProgress({total:E.size,loaded:E.size,percentage:1,percentageText:"100%"}),a(h.uploadInfo);else{_=Zg.createTask(E,h.uploadInfo,m);try{t.onUploadStart&&t.onUploadStart(_)}catch(t){tI.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),_.abort(),c(t)}}else{_=Zg.createTask(E,ba(ba({bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},t.md5?{md5:t.md5}:{}),t.payload?{payload:t.payload}:{}),m);try{t.onUploadStart&&t.onUploadStart(_)}catch(t){tI.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),_.abort(),c(t)}}}));case 24:return(m=g.sent).name=E.name,m.size=E.size,m.type=E.type,m.ext=lastIndexOf(a=m.name).call(a,".")>-1?slice(c=m.name).call(c,lastIndexOf(_=m.name).call(_,".")+1).toLowerCase():"",g.abrupt("return",m);case 30:case"end":return g.stop()}}),_callee)})))},getFileUploadInformation:function getFileUploadInformation(t){var a;if(t.file)a=t.file;else if("string"==typeof t.fileInput){var c=document.getElementById(t.fileInput);if(!(c&&c.files&&c.files[0]))throw new Error("Can not get file from fileInput");a=c.files[0]}else{if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0]))throw new Error("Can not get file from fileInput "+t.fileInput);a=t.fileInput.files[0]}return Zg.getFileUploadInformation(a)},getSystemInfo:function getSystemInfo(){var t,a,c=wg.version||"";if(isElectron())try{var _=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);_&&_[1]&&"string"==typeof _[1]&&(c=_[1])}catch(t){}return{os:(null===(t=wg.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=wg.os)||void 0===a?void 0:a.version)||"",browser:wg.name||"",browserVer:wg.version||"",libEnv:"BROWSER",hostEnv:isElectron()?"Electron":isMobile()?"H5":isBrowser()?"BROWSER":"Unset",hostEnvEnum:isElectron()?Yl.Electron:isMobile()?Yl.H5:isBrowser()?Yl.BROWSER:Yl.Unset,hostEnvVer:c,userAgent:navigator&&navigator.userAgent,model:c,manufactor:wg.name||""}},net:{getNetworkStatus:function getNetworkStatus(){return da.resolve({net_type:jl.kStatNetTypeUnkonw,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function onNetworkStatusChange(t){rI=function onlineListener(){t({isConnected:!0,networkType:jl.kStatNetTypeUnkonw})},nI=function offlineListener(){t({isConnected:!1,networkType:jl.kStatNetTypeUnkonw})},window.addEventListener("online",rI),window.addEventListener("offline",nI)},offNetworkStatusChange:function offNetworkStatusChange(){rI&&window.removeEventListener("online",rI),nI&&window.removeEventListener("offline",nI),rI=null,nI=null}}};!function setAdapters(t){Ll(zl,t)}(oI),t.V2NIMChatroomConst=Vf,t.default=Pg,Object.defineProperty(t,"__esModule",{value:!0})}));
